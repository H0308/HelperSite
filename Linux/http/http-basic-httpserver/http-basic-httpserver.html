<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=canonical href=https://www.help-doc.top/Linux/http/http-basic-httpserver/http-basic-httpserver.html><link rel=prev href=../../process-relationship-daemon/process-relationship-daemon.html><link rel=next href=../http-serialization/http-serialization.html><link rel=icon href=../../../images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.12"><title>介绍HTTP协议基本结构与基本实现HTTPServer - 柯懒的知识库</title><link rel=stylesheet href=../../../assets/stylesheets/main.2afb09e1.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.06af60db.min.css><link rel=stylesheet href=../../../css/timeline.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.css><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-9XWRGNRRSY"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-9XWRGNRRSY",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-9XWRGNRRSY",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script><link rel=stylesheet href=../../../stylesheets/colors.min.css><link rel=stylesheet href=../../../stylesheets/theme2.min.css media="screen and (max-width: 1199px)"><link rel=stylesheet href=../../../stylesheets/theme2.min.css media="screen and (min-width: 1200px)" id=theme2-desktop><link rel=stylesheet href=../../../stylesheets/theme1.min.css media="screen and (min-width: 1200px)" id=theme1-desktop><link rel=stylesheet href=../../../stylesheets/print.min.css><link rel=stylesheet href=../../../stylesheets/font-dongguanti.min.css id=font-dongguanti><link rel=stylesheet href=../../../stylesheets/font-oppoti.min.css id=font-oppoti disabled><link rel=stylesheet href=../../../stylesheets/font-jiangchengti.min.css id=font-jiangchengti disabled><link rel=stylesheet href=../../../stylesheets/font-lxgw.min.css id=font-lxgw disabled><link rel=stylesheet href=../../../stylesheets/code-font-dejavu-sans-mono.min.css id=code-font-dejavu-sans-mono><link rel=stylesheet href=../../../stylesheets/code-font-zsft-hk.min.css id=code-font-zsft-hk disabled><link rel=stylesheet href=https://unpkg.com/@waline/client@v3/dist/waline.css><link rel=stylesheet href=../../../stylesheets/waline.min.css><script src=https://cdn.jsdelivr.net/npm/mermaid@11.5.0/dist/mermaid.min.js></script><script src=../../../javascripts/start.min.js></script><script type=module src=../../../javascripts/waline.min.js></script> <link href="../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../../assets/javascripts/glightbox.min.js"></script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=white data-md-color-accent=cyan> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#httphttpserver class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=页眉> <a href=../../../index.html title=柯懒的知识库 class="md-header__button md-logo" aria-label=柯懒的知识库 data-md-component=logo> <img src=../../../assets/logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> 柯懒的知识库 </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> 介绍HTTP协议基本结构与基本实现HTTPServer </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=white data-md-color-accent=cyan aria-label type=radio name=__palette id=__palette_1> </form> <!-- 头像元素 - 直接在HTML中定义 --> <div class=header-avatar> <img src=../../../author/作者.assets/20250206-200653.jpg alt=头像> <div class=avatar-dropdown> <p><strong>柯懒不是柯南</strong></p> <a href=../../../author/contact/contact.html class=avatar-dropdown-item>吵醒柯懒</a> <div class=avatar-dropdown-divider></div> <a href=../../../author/about/about.html class=avatar-dropdown-item>柯懒自传</a> <div class=avatar-dropdown-divider></div> <a href=https://github.com/H0308 class=avatar-dropdown-item>柯懒的零食库</a> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=查找> <button type=reset class="md-search__icon md-icon" title=清空当前内容 aria-label=清空当前内容 tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 正在初始化搜索引擎 </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> </nav> </header> <!-- 独立的切换按钮 --> <div class=toolbar-toggle-btn id=toolbarToggleBtn onclick=toggleToolbar()> <div class=toggle-icon> <svg class=toggle-arrow-icon viewbox="0 0 1024 1024" version=1.1 xmlns=http://www.w3.org/2000/svg width=16 height=16> <path d="M346.538667 1024L170.666667 853.333333l341.333333-341.333333-341.333333-341.333333 175.872-170.666667L853.333333 512z" fill=currentColor></path> </svg> </div> </div> <!-- 右侧固定功能条 - 独立于内容区 --> <div class=floating-toolbar id=floatingToolbar> <!-- 字体切换功能 --> <div class="toolbar-item font-switcher"> <div class=toolbar-icon> <svg class=font-icon viewbox="0 0 1024 1024" version=1.1 xmlns=http://www.w3.org/2000/svg width=20 height=20> <path d="M913.408 1024l-66.56 0q-29.696 0-51.2-5.12t-36.864-15.872-26.112-27.136-19.968-37.888q-15.36-38.912-28.16-70.656t-22.016-55.296q-11.264-26.624-20.48-49.152l-254.976 0q-7.168 23.552-17.408 51.2-8.192 23.552-21.504 56.832t-30.72 72.192q-20.48 46.08-47.104 63.488t-60.416 17.408l-70.656 0q-45.056 0-60.928-19.968t2.56-68.096q18.432-46.08 43.008-108.544t52.224-132.608 57.344-143.872 57.344-144.384q65.536-164.864 137.216-343.04 7.168-17.408 18.432-31.744 10.24-11.264 27.136-21.504t42.496-10.24q26.624 0 43.52 10.752t28.16 24.064q12.288 15.36 19.456 33.792 72.704 180.224 138.24 345.088 27.648 70.656 57.344 143.872t56.832 142.336 51.2 129.536 41.472 104.448q14.336 34.816 4.096 62.464t-43.008 27.648zM616.448 634.88l-97.28-347.136-1.024 0-108.544 347.136 206.848 0z" fill=currentColor></path> </svg> </div> <div class=toolbar-label>内容字体</div> <div class=font-dropdown-toolbar> <div class=font-current-toolbar onclick=toggleFontDropdownToolbar()> <span class=current-font-name-toolbar>东观体</span> <svg class=dropdown-arrow-icon viewbox="0 0 1024 1024" version=1.1 xmlns=http://www.w3.org/2000/svg width=12 height=12> <path d="M878.592 250.88q29.696 0 48.128 11.264t24.576 29.696 0 41.472-26.624 45.568q-82.944 92.16-159.744 180.224t-148.48 164.864q-19.456 20.48-45.568 31.744t-53.76 11.776-53.248-8.704-43.008-28.672q-39.936-44.032-82.944-90.112l-88.064-92.16q-43.008-46.08-85.504-90.624t-79.36-86.528q-17.408-19.456-22.528-40.448t1.024-38.4 23.552-28.672 45.056-11.264q35.84 0 98.816-0.512t137.728-0.512l153.6 0 150.528 0 125.952 0 79.872 0z" fill=currentColor></path> </svg> </div> <div class=font-options-toolbar> <div class=font-option-toolbar data-font=dongguanti onclick="selectFontToolbar('dongguanti')">上图东观体 </div> <div class=font-option-toolbar data-font=oppoti onclick="selectFontToolbar('oppoti')">OPPO Sans </div> <div class=font-option-toolbar data-font=jiangchengti onclick="selectFontToolbar('jiangchengti')"> 江城黑体</div> <div class=font-option-toolbar data-font=lxgw onclick="selectFontToolbar('lxgw')">霞鹜臻楷</div> </div> </div> </div> <!-- 代码字体切换功能 --> <div class="toolbar-item code-font-switcher"> <div class=toolbar-icon> <svg t=1753672111433 class="icon code-font-icon" viewbox="0 0 1024 1024" version=1.1 xmlns=http://www.w3.org/2000/svg p-id=5148 width=20 height=20> <path d="M941.709938 0H82.290062A82.290062 82.290062 0 0 0 0 82.290062v859.419876A82.290062 82.290062 0 0 0 82.290062 1022.53923h859.419876A82.290062 82.290062 0 0 0 1022.53923 941.709938V82.290062A82.290062 82.290062 0 0 0 941.709938 0zM188.439372 553.631954a40.901569 40.901569 0 0 1-29.215406-70.116975L292.154066 351.558726 159.223966 218.628626a40.901569 40.901569 0 0 1 58.430813-57.94389l160.197813 162.145507a40.901569 40.901569 0 0 1 0 57.943889l-160.197813 160.684736a40.901569 40.901569 0 0 1-29.215407 12.173086z m443.587257 0H405.120304a40.901569 40.901569 0 0 1 0-82.290061H633.000476a40.901569 40.901569 0 0 1 0 82.290061z" fill=currentColor p-id=5149></path> </svg> </div> <div class=toolbar-label>代码字体</div> <div class=code-font-dropdown-toolbar> <div class=code-font-current-toolbar onclick=toggleCodeFontDropdownToolbar()> <span class=current-code-font-name-toolbar>DejaVu Sans Mono</span> <svg class=dropdown-arrow-icon viewbox="0 0 1024 1024" version=1.1 xmlns=http://www.w3.org/2000/svg width=12 height=12> <path d="M878.592 250.88q29.696 0 48.128 11.264t24.576 29.696 0 41.472-26.624 45.568q-82.944 92.16-159.744 180.224t-148.48 164.864q-19.456 20.48-45.568 31.744t-53.76 11.776-53.248-8.704-43.008-28.672q-39.936-44.032-82.944-90.112l-88.064-92.16q-43.008-46.08-85.504-90.624t-79.36-86.528q-17.408-19.456-22.528-40.448t1.024-38.4 23.552-28.672 45.056-11.264q35.84 0 98.816-0.512t137.728-0.512l153.6 0 150.528 0 125.952 0 79.872 0z" fill=currentColor></path> </svg> </div> <div class=code-font-options-toolbar> <div class=code-font-option-toolbar data-code-font=dejavu onclick="selectCodeFontToolbar('dejavu')"> DejaVu Sans Mono</div> <div class=code-font-option-toolbar data-code-font=zsft onclick="selectCodeFontToolbar('zsft')"> JetBrains Mono</div> </div> </div> </div> <!-- 主题切换功能 --> <div class="toolbar-item theme-switcher" onclick=switchTheme()> <div class=toolbar-icon> <svg class=theme-icon viewbox="0 0 1024 1024" version=1.1 xmlns=http://www.w3.org/2000/svg width=20 height=20> <path d="M876.572788 522.301623c-1.886977 12.375865-9.657964 30.331819-35.880185 45.48903-56.489572 32.697703-150.21828 83.990926-174.010149 96.958262-13.143345 24.431435-66.067718 122.221646-98.141204 178.503487-16.117073 28.124548-36.055171 34.041304-50.030463 34.041304-0.031722 0-0.031722 0-0.031722 0-14.613836 0-29.1806-6.460132-43.234687-19.218714-47.183626-42.643216-125.994576-117.105115-146.013515-136.083351-27.757181-4.732791-138.338718-23.743774-200.584388-35.752272-17.924231-3.533476-32.649608-14.07046-40.372499-29.084409-5.78782-11.256368-10.281157-30.05962 1.471514-55.658647 26.989701-59.047838 74.126254-157.557432 85.957721-182.196599-3.437286-27.117614-16.996093-135.060045-23.760147-198.905142-1.886977-17.460674 3.901867-35.096333 15.829524-48.351218 12.791327-14.278191 30.667463-21.48943 49.854455-19.426445 63.669088 6.332219 173.259042 19.426445 200.584388 22.705118 24.335245-11.879562 121.085776-58.936297 180.133613-86.34146 9.91379-4.573155 19.85828-6.92369 29.596062-6.92369 28.748764 0 52.172243 20.642133 58.328453 51.421136 12.599969 62.997799 30.93864 166.70272 35.639708 193.484689 18.851347 19.682271 91.953272 96.031147 135.060045 143.07151C872.72004 487.125473 879.307062 504.71406 876.572788 522.301623L876.572788 522.301623zM825.375755 499.085876C776.017604 445.314205 687.245791 352.977193 686.365748 352.017332c-2.942005-3.069919-4.956895-6.971785-5.676279-11.208273-0.207731-1.215688-22.193465-127.001509-36.551474-198.936865-0.799202-3.917216-4.285606-16.836457-16.196891-16.836457-3.453658 0-7.30743 1.006933-11.464099 2.942005-67.282383 31.179117-183.955662 88.180342-185.170327 88.771813-3.693112 1.790786-7.850805 2.558265-11.975752 2.01489-1.295506-0.224104-133.63765-16.165168-205.988468-23.424502-0.079818 0-0.207731 0-0.287549 0-7.30743 0-11.128455 2.89391-13.319353 5.40408-3.677762 4.124947-5.644557 9.91379-5.068436 15.110139 7.674796 72.623018 24.255427 202.934922 24.463158 204.325595 0.511653 4.109598-0.159636 8.266267-1.966795 11.960403-0.591471 1.215688-57.657164 120.04712-88.339977 187.201589-3.565199 7.754614-4.41352 14.214746-2.350534 18.131963 1.935072 3.725858 6.588045 5.820566 10.360975 6.53995 70.719668 13.718443 204.644867 36.519752 206.036563 36.727483 4.189416 0.671289 8.058536 2.686179 11.112082 5.580089 1.006933 0.87902 96.414887 91.281983 150.090367 139.889027 8.314363 7.563256 13.143345 8.106632 14.437827 8.106632 3.485381 0 8.314363-4.621251 12.727882-12.391215 36.343743-63.828724 100.011808-181.988868 100.636025-183.155437 1.983167-3.64604 5.004991-6.667863 8.650007-8.650007 1.134847-0.671289 114.418936-62.373583 178.6314-99.516528 8.698103-5.036713 14.278191-10.568706 14.94948-14.854313C834.681702 511.845481 831.49922 505.800811 825.375755 499.085876L825.375755 499.085876zM935.333076 935.670256c-4.157693 4.157693-9.689686 6.299473-15.141862 6.299473-5.548366 0-11.048637-2.142803-15.238053-6.299473l-171.915441-171.915441c-8.362458-8.394181-8.362458-21.98471 0-30.426987 8.394181-8.394181 21.98471-8.394181 30.379914 0l171.915441 171.915441C943.727257 913.684522 943.727257 927.275052 935.333076 935.670256L935.333076 935.670256z" fill=currentColor></path> </svg> </div> <div class=toolbar-label>主题切换</div> </div> <!-- 返回顶部功能 --> <div class="toolbar-item back-to-top" onclick=scrollToTop()> <div class=toolbar-icon> <svg class=back-to-top-icon viewbox="0 0 1024 1024" xmlns=http://www.w3.org/2000/svg> <path d="M882.688 624.128l-336.896-583.68c-15.872-27.136-54.784-27.136-70.656 0L138.24 624.128c-15.872 27.136 4.096 61.44 35.328 61.44H317.44c22.528 0 40.96 18.432 40.96 40.96v239.616c0 22.528 18.432 40.96 40.96 40.96h223.232c22.528 0 40.96-18.432 40.96-40.96v-239.616c0-22.528 18.432-40.96 40.96-40.96h143.872c30.208 0 50.176-34.304 34.304-61.44z"> </path> </svg> </div> <div class=toolbar-label>返回顶部</div> </div> </div> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=标签 data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../../index.html class=md-tabs__link> 主页 </a> </li> <li class=md-tabs__item> <a href=../../../intro/intro.html class=md-tabs__link> 网站介绍 </a> </li> <li class=md-tabs__item> <a href=../../../timeline/timeline.html class=md-tabs__link> 网站时间线 </a> </li> <li class=md-tabs__item> <a href=../../../c-lang/index.html class=md-tabs__link> 编程语言 </a> </li> <li class=md-tabs__item> <a href=../../../data-structure/time-space-complexity/time-space-complexity.html class=md-tabs__link> 数据结构与算法 </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../../options-commands/options-commands.html class=md-tabs__link> Linux </a> </li> <li class=md-tabs__item> <a href=../../../html-css/html/html.html class=md-tabs__link> 前端 </a> </li> <li class=md-tabs__item> <a href=../../../MySQL/JDBC/JDBC-basic/JDBC-basic.html class=md-tabs__link> MySQL </a> </li> <li class=md-tabs__item> <a href=../../../JavaEE/Spring/springmvc-basic/springmvc-basic.html class=md-tabs__link> JavaEE应用开发 </a> </li> <li class=md-tabs__item> <a href=../../../other/shell/shell.html class=md-tabs__link> 扩展知识 </a> </li> <li class=md-tabs__item> <a href=../../../tooltips/vscode-snippets/vscode-snippets.html class=md-tabs__link> 工具帮助 </a> </li> <li class=md-tabs__item> <a href=../../../test-encrypt/test-encrypt.html class=md-tabs__link> 测试加密功能 </a> </li> <li class=md-tabs__item> <a href=../../../projects/boost-searching-engine/boost-searching-engine.html class=md-tabs__link> 项目 </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=导航栏 data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../../index.html title=柯懒的知识库 class="md-nav__button md-logo" aria-label=柯懒的知识库 data-md-component=logo> <img src=../../../assets/logo.png alt=logo> </a> 柯懒的知识库 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../index.html class=md-nav__link> <span class=md-ellipsis> 主页 </span> </a> </li> <li class=md-nav__item> <a href=../../../intro/intro.html class=md-nav__link> <span class=md-ellipsis> 网站介绍 </span> </a> </li> <li class=md-nav__item> <a href=../../../timeline/timeline.html class=md-nav__link> <span class=md-ellipsis> 网站时间线 </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../c-lang/index.html class=md-nav__link> <span class=md-ellipsis> 编程语言 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../data-structure/time-space-complexity/time-space-complexity.html class=md-nav__link> <span class=md-ellipsis> 数据结构与算法 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6 checked> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex> <span class=md-ellipsis> Linux </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=true> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Linux </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../options-commands/options-commands.html class=md-nav__link> <span class=md-ellipsis> Linux常用选项和指令 </span> </a> </li> <li class=md-nav__item> <a href=../../permission/permission.html class=md-nav__link> <span class=md-ellipsis> Linux权限相关 </span> </a> </li> <li class=md-nav__item> <a href=../../software-installation/software-installation.html class=md-nav__link> <span class=md-ellipsis> CentOS软件安装 </span> </a> </li> <li class=md-nav__item> <a href=../../gcc-gdb/gcc-gdb.html class=md-nav__link> <span class=md-ellipsis> Linux下的gcc与gdb </span> </a> </li> <li class=md-nav__item> <a href=../../makefile-progress-bar/makefile-progress-bar.html class=md-nav__link> <span class=md-ellipsis> Linux下的Makefile与进度条程序 </span> </a> </li> <li class=md-nav__item> <a href=../../os-basic/os-basic.html class=md-nav__link> <span class=md-ellipsis> 操作系统基础知识 </span> </a> </li> <li class=md-nav__item> <a href=../../process-basic/process-basic.html class=md-nav__link> <span class=md-ellipsis> Linux进程基础 </span> </a> </li> <li class=md-nav__item> <a href=../../process-state-priority/process-state-priority.html class=md-nav__link> <span class=md-ellipsis> Linux进程状态与进程优先级 </span> </a> </li> <li class=md-nav__item> <a href=../../process-switch-scheduling/process-switch-scheduling.html class=md-nav__link> <span class=md-ellipsis> Linux进程切换以及调度算法 </span> </a> </li> <li class=md-nav__item> <a href=../../command-line-env/command-line-env.html class=md-nav__link> <span class=md-ellipsis> Linux命令行与环境变量 </span> </a> </li> <li class=md-nav__item> <a href=../../process-address-space/process-address-space.html class=md-nav__link> <span class=md-ellipsis> Linux进程地址空间 </span> </a> </li> <li class=md-nav__item> <a href=../../process-control/process-control.html class=md-nav__link> <span class=md-ellipsis> Linux进程控制 </span> </a> </li> <li class=md-nav__item> <a href=../../linux-fileop/linux-fileop.html class=md-nav__link> <span class=md-ellipsis> Linux文件操作基础 </span> </a> </li> <li class=md-nav__item> <a href=../../io-process/io-process.html class=md-nav__link> <span class=md-ellipsis> Linux中输入和输出基本过程 </span> </a> </li> <li class=md-nav__item> <a href=../../file-system/file-system.html class=md-nav__link> <span class=md-ellipsis> Linux文件系统 </span> </a> </li> <li class=md-nav__item> <a href=../../soft-hard-link/soft-hard-link.html class=md-nav__link> <span class=md-ellipsis> Linux软链接和硬链接 </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../com-process/com-anonymous-pipe/com-anonymous-pipe.html class=md-nav__link> <span class=md-ellipsis> Linux进程间通信 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class=md-nav__item> <a href=../../signals-os-principles/signals-os-principles.html class=md-nav__link> <span class=md-ellipsis> Linux信号与操作系统原理 </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../linux-thread/thread-concept-op/thread-concept-op.html class=md-nav__link> <span class=md-ellipsis> Linux线程 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class=md-nav__item> <a href=../../net-basic/net-basic.html class=md-nav__link> <span class=md-ellipsis> 网络基础知识 </span> </a> </li> <li class=md-nav__item> <a href=../../socket-basic/socket-basic.html class=md-nav__link> <span class=md-ellipsis> Socket编程基础 </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../udp/udp-basic/udp-basic.html class=md-nav__link> <span class=md-ellipsis> UDP编程 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class=md-nav__item> <a href=../../tcp-basic/tcp-basic.html class=md-nav__link> <span class=md-ellipsis> TCP编程接口基本使用 </span> </a> </li> <li class=md-nav__item> <a href=../../serialization-net-cal/serialization-net-cal.html class=md-nav__link> <span class=md-ellipsis> 序列化和反序列化与网络计算器 </span> </a> </li> <li class=md-nav__item> <a href=../../process-relationship-daemon/process-relationship-daemon.html class=md-nav__link> <span class=md-ellipsis> 进程间关系和守护进程 </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_26 checked> <label class=md-nav__link for=__nav_6_26 id=__nav_6_26_label tabindex=0> <span class=md-ellipsis> 应用层协议HTTP </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_26_label aria-expanded=true> <label class=md-nav__title for=__nav_6_26> <span class="md-nav__icon md-icon"></span> 应用层协议HTTP </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> 介绍HTTP协议基本结构与基本实现HTTPServer </span> <span class="md-nav__icon md-icon"></span> </label> <a href=http-basic-httpserver.html class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> 介绍HTTP协议基本结构与基本实现HTTPServer </span> </a> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#http class=md-nav__link> <span class=md-ellipsis> HTTP协议 </span> </a> </li> <li class=md-nav__item> <a href=#urluri class=md-nav__link> <span class=md-ellipsis> URL与URI </span> </a> </li> <li class=md-nav__item> <a href=#url class=md-nav__link> <span class=md-ellipsis> 深入URL结构 </span> </a> </li> <li class=md-nav__item> <a href=#url_1 class=md-nav__link> <span class=md-ellipsis> URL编码 </span> </a> <nav class=md-nav aria-label=URL编码> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_1 class=md-nav__link> <span class=md-ellipsis> 编码原理 </span> </a> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> <span class=md-ellipsis> 常见编码示例 </span> </a> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> <span class=md-ellipsis> 编码示例 </span> </a> </li> <li class=md-nav__item> <a href=#url_2 class=md-nav__link> <span class=md-ellipsis> URL编码的应用场景 </span> </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> <span class=md-ellipsis> 注意事项 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#httphttp class=md-nav__link> <span class=md-ellipsis> HTTP请求结构和HTTP响应结构 </span> </a> <nav class=md-nav aria-label=HTTP请求结构和HTTP响应结构> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_5 class=md-nav__link> <span class=md-ellipsis> 基本认识 </span> </a> </li> <li class=md-nav__item> <a href=#http_1 class=md-nav__link> <span class=md-ellipsis> HTTP请求结构 </span> </a> </li> <li class=md-nav__item> <a href=#http_2 class=md-nav__link> <span class=md-ellipsis> HTTP响应结构 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_6 class=md-nav__link> <span class=md-ellipsis> 封装网络接口 </span> </a> <nav class=md-nav aria-label=封装网络接口> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_7 class=md-nav__link> <span class=md-ellipsis> 基本设计思路 </span> </a> </li> <li class=md-nav__item> <a href=#_8 class=md-nav__link> <span class=md-ellipsis> 设计抽象类 </span> </a> </li> <li class=md-nav__item> <a href=#_9 class=md-nav__link> <span class=md-ellipsis> 设计具体类 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#tcpserver class=md-nav__link> <span class=md-ellipsis> 实现TcpServer类 </span> </a> </li> <li class=md-nav__item> <a href=#http_3 class=md-nav__link> <span class=md-ellipsis> 实现HTTP服务器 </span> </a> <nav class=md-nav aria-label=实现HTTP服务器> <ul class=md-nav__list> <li class=md-nav__item> <a href=#httpserver class=md-nav__link> <span class=md-ellipsis> 创建HttpServer类 </span> </a> </li> <li class=md-nav__item> <a href=#http_4 class=md-nav__link> <span class=md-ellipsis> 实现处理HTTP请求接口 </span> </a> </li> <li class=md-nav__item> <a href=#_10 class=md-nav__link> <span class=md-ellipsis> 测试 </span> </a> </li> <li class=md-nav__item> <a href=#_11 class=md-nav__link> <span class=md-ellipsis> 封装发送和接收接口 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_12 class=md-nav__link> <span class=md-ellipsis> 图表梳理 </span> </a> <nav class=md-nav aria-label=图表梳理> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_13 class=md-nav__link> <span class=md-ellipsis> 类间关系 </span> </a> </li> <li class=md-nav__item> <a href=#_14 class=md-nav__link> <span class=md-ellipsis> 执行逻辑 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../http-serialization/http-serialization.html class=md-nav__link> <span class=md-ellipsis> 深入HTTP序列化和反序列化 </span> </a> </li> <li class=md-nav__item> <a href=../http-header-request-method/http-header-request-method.html class=md-nav__link> <span class=md-ellipsis> HTTP报头属性和请求方式 </span> </a> </li> <li class=md-nav__item> <a href=../http-cookie-session/http-cookie-session.html class=md-nav__link> <span class=md-ellipsis> HTTP中的Cookie和Session </span> </a> </li> <li class=md-nav__item> <a href=../http-version/http-version.html class=md-nav__link> <span class=md-ellipsis> HTTP版本介绍 </span> </a> </li> <li class=md-nav__item> <a href=../https/https.html class=md-nav__link> <span class=md-ellipsis> HTTPS协议介绍与原理 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../udp-principles/udp-principles.html class=md-nav__link> <span class=md-ellipsis> UDP协议原理 </span> </a> </li> <li class=md-nav__item> <a href=../../tcp-principles/tcp-principles.html class=md-nav__link> <span class=md-ellipsis> TCP协议原理 </span> </a> </li> <li class=md-nav__item> <a href=../../tcp-connection-backlog/tcp-connection-backlog.html class=md-nav__link> <span class=md-ellipsis> 理解Linux如何看待连接以及TCP全连接队列 </span> </a> </li> <li class=md-nav__item> <a href=../../ip/ip.html class=md-nav__link> <span class=md-ellipsis> 网络层IP协议 </span> </a> </li> <li class=md-nav__item> <a href=../../datalink/datalink.html class=md-nav__link> <span class=md-ellipsis> 数据链路层协议 </span> </a> </li> <li class=md-nav__item> <a href=../../dns-icmp/dns-icmp.html class=md-nav__link> <span class=md-ellipsis> DNS与ICMP </span> </a> </li> <li class=md-nav__item> <a href=../../nat-proxy/nat-proxy.html class=md-nav__link> <span class=md-ellipsis> NAT技术、代理服务器和内网穿透 </span> </a> </li> <li class=md-nav__item> <a href=../../io-model-select-poll/io-model-select-poll.html class=md-nav__link> <span class=md-ellipsis> 五种IO模型与select和poll分别实现多路转接 </span> </a> </li> <li class=md-nav__item> <a href=../../epoll/epoll.html class=md-nav__link> <span class=md-ellipsis> epoll实现多路转接 </span> </a> </li> <li class=md-nav__item> <a href=../../reactor-et/reactor-et.html class=md-nav__link> <span class=md-ellipsis> Reactor模式与完善基于边缘触发模式epoll实现TCP服务器 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../html-css/html/html.html class=md-nav__link> <span class=md-ellipsis> 前端 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../MySQL/JDBC/JDBC-basic/JDBC-basic.html class=md-nav__link> <span class=md-ellipsis> MySQL </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../JavaEE/Spring/springmvc-basic/springmvc-basic.html class=md-nav__link> <span class=md-ellipsis> JavaEE应用开发 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../other/shell/shell.html class=md-nav__link> <span class=md-ellipsis> 扩展知识 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../tooltips/vscode-snippets/vscode-snippets.html class=md-nav__link> <span class=md-ellipsis> 工具帮助 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../test-encrypt/test-encrypt.html class=md-nav__link> <span class=md-ellipsis> 测试加密功能 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../projects/boost-searching-engine/boost-searching-engine.html class=md-nav__link> <span class=md-ellipsis> 项目 </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#http class=md-nav__link> <span class=md-ellipsis> HTTP协议 </span> </a> </li> <li class=md-nav__item> <a href=#urluri class=md-nav__link> <span class=md-ellipsis> URL与URI </span> </a> </li> <li class=md-nav__item> <a href=#url class=md-nav__link> <span class=md-ellipsis> 深入URL结构 </span> </a> </li> <li class=md-nav__item> <a href=#url_1 class=md-nav__link> <span class=md-ellipsis> URL编码 </span> </a> <nav class=md-nav aria-label=URL编码> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_1 class=md-nav__link> <span class=md-ellipsis> 编码原理 </span> </a> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> <span class=md-ellipsis> 常见编码示例 </span> </a> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> <span class=md-ellipsis> 编码示例 </span> </a> </li> <li class=md-nav__item> <a href=#url_2 class=md-nav__link> <span class=md-ellipsis> URL编码的应用场景 </span> </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> <span class=md-ellipsis> 注意事项 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#httphttp class=md-nav__link> <span class=md-ellipsis> HTTP请求结构和HTTP响应结构 </span> </a> <nav class=md-nav aria-label=HTTP请求结构和HTTP响应结构> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_5 class=md-nav__link> <span class=md-ellipsis> 基本认识 </span> </a> </li> <li class=md-nav__item> <a href=#http_1 class=md-nav__link> <span class=md-ellipsis> HTTP请求结构 </span> </a> </li> <li class=md-nav__item> <a href=#http_2 class=md-nav__link> <span class=md-ellipsis> HTTP响应结构 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_6 class=md-nav__link> <span class=md-ellipsis> 封装网络接口 </span> </a> <nav class=md-nav aria-label=封装网络接口> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_7 class=md-nav__link> <span class=md-ellipsis> 基本设计思路 </span> </a> </li> <li class=md-nav__item> <a href=#_8 class=md-nav__link> <span class=md-ellipsis> 设计抽象类 </span> </a> </li> <li class=md-nav__item> <a href=#_9 class=md-nav__link> <span class=md-ellipsis> 设计具体类 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#tcpserver class=md-nav__link> <span class=md-ellipsis> 实现TcpServer类 </span> </a> </li> <li class=md-nav__item> <a href=#http_3 class=md-nav__link> <span class=md-ellipsis> 实现HTTP服务器 </span> </a> <nav class=md-nav aria-label=实现HTTP服务器> <ul class=md-nav__list> <li class=md-nav__item> <a href=#httpserver class=md-nav__link> <span class=md-ellipsis> 创建HttpServer类 </span> </a> </li> <li class=md-nav__item> <a href=#http_4 class=md-nav__link> <span class=md-ellipsis> 实现处理HTTP请求接口 </span> </a> </li> <li class=md-nav__item> <a href=#_10 class=md-nav__link> <span class=md-ellipsis> 测试 </span> </a> </li> <li class=md-nav__item> <a href=#_11 class=md-nav__link> <span class=md-ellipsis> 封装发送和接收接口 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_12 class=md-nav__link> <span class=md-ellipsis> 图表梳理 </span> </a> <nav class=md-nav aria-label=图表梳理> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_13 class=md-nav__link> <span class=md-ellipsis> 类间关系 </span> </a> </li> <li class=md-nav__item> <a href=#_14 class=md-nav__link> <span class=md-ellipsis> 执行逻辑 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=httphttpserver>介绍HTTP协议基本结构与基本实现HTTPServer<a class=headerlink href=#httphttpserver title="Permanent link">&para;</a></h1> <div style="margin-top: -30px; font-size: 0.75em; opacity: 0.7;"> <p><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10h-2a8 8 0 0 1-8 8 8 8 0 0 1-8-8 8 8 0 0 1 8-8zm6.78 1a.7.7 0 0 0-.48.2l-1.22 1.21 2.5 2.5L20.8 5.7c.26-.26.26-.7 0-.95L19.25 3.2c-.13-.13-.3-.2-.47-.2m-2.41 2.12L9 12.5V15h2.5l7.37-7.38z"/></svg></span> 约 4133 个字 <span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M392.8 1.2c-17-4.9-34.7 5-39.6 22l-128 448c-4.9 17 5 34.7 22 39.6s34.7-5 39.6-22l128-448c4.9-17-5-34.7-22-39.6m80.6 120.1c-12.5 12.5-12.5 32.8 0 45.3l89.3 89.4-89.4 89.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l112-112c12.5-12.5 12.5-32.8 0-45.3l-112-112c-12.5-12.5-32.8-12.5-45.3 0zm-306.7 0c-12.5-12.5-32.8-12.5-45.3 0l-112 112c-12.5 12.5-12.5 32.8 0 45.3l112 112c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256l89.4-89.4c12.5-12.5 12.5-32.8 0-45.3"/></svg></span> 287 行代码 <span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 17H7V3h14m0-2H7a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2M3 5H1v16a2 2 0 0 0 2 2h16v-2H3m12.96-10.71-2.75 3.54-1.96-2.36L8.5 15h11z"/></svg></span> 4 张图片 <span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 20c4.42 0 8-3.58 8-8s-3.58-8-8-8-8 3.58-8 8 3.58 8 8 8m0-18c5.5 0 10 4.5 10 10s-4.5 10-10 10C6.47 22 2 17.5 2 12S6.5 2 12 2m.5 11H11V7h1.5v4.26l3.7-2.13.75 1.3z"/></svg></span> 预计阅读时间 17 分钟</p> </div> <h2 id=http>HTTP协议<a class=headerlink href=#http title="Permanent link">&para;</a></h2> <p>前面已经了解了协议的重要性并且已经定义了属于我们自己的协议，但是在网络中，已经有一些成熟的协议，最常用的就是HTTP协议</p> <p>在互联网世界中，HTTP（HyperText Transfer Protocol，超文本传输协议）是一个至关重要的协议。它定义了客户端（如浏览器）与服务器之间如何通信，以交换或传输超文本（如HTML文档）</p> <p>HTTP协议是客户端与服务器之间通信的基础。客户端通过HTTP协议向服务器发送请求，服务器收到请求后处理并返回响应。HTTP协议是一个基于TCP协议的<strong>无连接、无状态</strong>的协议，即每次请求都需要建立新的连接，且服务器不会保存客户端的状态信息</p> <p>因为HTTP是基于TCP的，而TCP是面向字节流的，所以在传递信息时肯定会存在收到的信息不完整的情况，那么根据前面的经验，不论是客户端和服务端都需要做数据完整性检查</p> <h2 id=urluri>URL与URI<a class=headerlink href=#urluri title="Permanent link">&para;</a></h2> <p>URI（统一资源标识符）是用于标识网络资源的字符串，而URL（统一资源定位符）是URI的一个扩展，它不仅标识资源，还提供了定位该资源的方法</p> <p>一个标准的URL通常包含以下几个部分：</p> <div class="language-text highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>Text Only</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-1>http://www.example.com:80/path/to/resource?param1=value1&amp;param2=value2#fragment
</span></code></pre></div></td></tr></table></div> <ol> <li>协议（<code>http://</code>）：指定客户端和服务器之间通信使用的协议</li> <li>主机名（<code>www.example.com</code>）：资源所在服务器的域名或IP地址</li> <li>端口号（<code>:80</code>）：服务器上运行的服务的端口号(HTTP默认为80)</li> <li>路径（<code>/path/to/resource</code>）：资源在服务器上的具体位置</li> <li>查询参数（<code>?param1=value1&amp;param2=value2</code>）: 发送给服务器的额外参数</li> <li>片段标识符（<code>#fragment</code>）: 资源内的特定部分的引用</li> </ol> <h2 id=url>深入URL结构<a class=headerlink href=#url title="Permanent link">&para;</a></h2> <p>仔细观察URL的结构，除去协议、主机名和端口号以外，剩余的部分正好就是文件的路径，而在操作系统之下标记一个文件的路径也是使用同样的结构，所以这里就可以得出一个结论：URL的结构实际上就是找到对应的主机，再在该主机上找到指定路径下的文件</p> <p>两台计算机进行网络通信实际上就是在做IO，而要做IO就需要有对应的数据交换，所以首先就必须要定位到文件的位置，定位文件就是通过路径进行的，所以URL的设计思想对应的就是操作系统定位文件的方式，但是需要注意在URL中，路径开始的第一个<code>/</code>并不代表着操作系统的根目录，而是Web应用的根目录</p> <h2 id=url_1>URL编码<a class=headerlink href=#url_1 title="Permanent link">&para;</a></h2> <p>URL编码是一种将非ASCII字符和特殊字符转换为可在URL中安全传输的编码方式。因为URL只能使用ASCII字符集中的一部分字符，所以需要对其他字符进行编码</p> <h3 id=_1>编码原理<a class=headerlink href=#_1 title="Permanent link">&para;</a></h3> <p>URL编码遵循以下规则：</p> <ol> <li><strong>ASCII字母、数字和某些特殊字符</strong>保持不变，即：</li> <li>字母：<code>A-Z</code>, <code>a-z</code></li> <li>数字：<code>0-9</code></li> <li> <p>特殊字符：<code>-</code>, <code>_</code>, <code>.</code>, <code>~</code></p> </li> <li> <p><strong>其他字符</strong>（如空格、中文、特殊符号）按照以下步骤编码：</p> </li> <li>将字符转换为字节序列（通常使用UTF-8编码）</li> <li>每个字节用百分号<code>%</code>后跟两位十六进制数表示</li> </ol> <h3 id=_2>常见编码示例<a class=headerlink href=#_2 title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>字符</th> <th>URL编码</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>空格</td> <td><code>%20</code> (或 <code>+</code>)</td> <td>空格可以编码为<code>%20</code>或<code>+</code>（表单提交时）</td> </tr> <tr> <td><code>!</code></td> <td><code>%21</code></td> <td>感叹号</td> </tr> <tr> <td><code>#</code></td> <td><code>%23</code></td> <td>井号（必须编码，因为在URL中有特殊含义）</td> </tr> <tr> <td><code>$</code></td> <td><code>%24</code></td> <td>美元符号</td> </tr> <tr> <td><code>&amp;</code></td> <td><code>%26</code></td> <td>和号（必须编码，因为用于分隔参数）</td> </tr> <tr> <td><code>+</code></td> <td><code>%2B</code></td> <td>加号</td> </tr> <tr> <td><code>/</code></td> <td><code>%2F</code></td> <td>正斜杠（在路径中通常不编码）</td> </tr> <tr> <td><code>:</code></td> <td><code>%3A</code></td> <td>冒号（在协议分隔符后通常不编码）</td> </tr> <tr> <td><code>=</code></td> <td><code>%3D</code></td> <td>等号（在查询参数中通常不编码）</td> </tr> <tr> <td><code>?</code></td> <td><code>%3F</code></td> <td>问号（必须编码，因为用于引导查询参数）</td> </tr> <tr> <td><code>@</code></td> <td><code>%40</code></td> <td>at符号</td> </tr> <tr> <td><code>中</code></td> <td><code>%E4%B8%AD</code></td> <td>汉字"中"的UTF-8编码</td> </tr> </tbody> </table> <h3 id=_3>编码示例<a class=headerlink href=#_3 title="Permanent link">&para;</a></h3> <p>原始URL中包含中文和特殊字符： <div class="language-text highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>Text Only</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-1-1>https://example.com/搜索?关键词=中国&amp;category=历史
</span></code></pre></div></td></tr></table></div></p> <p>编码后的URL： <div class="language-text highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>Text Only</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-2-1>https://example.com/%E6%90%9C%E7%B4%A2?%E5%85%B3%E9%94%AE%E8%AF%8D=%E4%B8%AD%E5%9B%BD&amp;category=%E5%8E%86%E5%8F%B2
</span></code></pre></div></td></tr></table></div></p> <h3 id=url_2>URL编码的应用场景<a class=headerlink href=#url_2 title="Permanent link">&para;</a></h3> <ol> <li><strong>查询参数传递</strong>：确保包含特殊字符的参数能正确传递</li> <li><strong>表单提交</strong>：当使用GET方法提交表单时，表单数据会编码到URL中</li> <li><strong>国际化URL</strong>：包含非英语字符的URL需要编码</li> <li><strong>防止字符注入攻击</strong>：编码可以防止某些特殊字符被解释为代码</li> </ol> <h3 id=_4>注意事项<a class=headerlink href=#_4 title="Permanent link">&para;</a></h3> <ul> <li>不同的字符集可能产生不同的编码结果，现代Web应用通常使用UTF-8</li> <li>某些旧系统可能使用非标准编码（如GB2312）</li> <li>浏览器会自动对输入的URL进行编码</li> <li>在服务器端编程中，各种语言都提供了URL编码和解码的函数</li> <li>编码应该在正确的位置进行，不要对整个URL进行编码，而是对各部分中的特殊字符进行编码</li> </ul> <p>URL编码确保了含有特殊字符的数据可以通过URL安全传输，是Web应用开发中的基础知识</p> <h2 id=httphttp>HTTP请求结构和HTTP响应结构<a class=headerlink href=#httphttp title="Permanent link">&para;</a></h2> <h3 id=_5>基本认识<a class=headerlink href=#_5 title="Permanent link">&para;</a></h3> <p>既然是传递数据，那么肯定要做的就是确定双方都认识的一个结构，这样获取到的数据才能被正确解释，在HTTP中，有两种结构，分别是HTTP请求和HTTP响应</p> <p>一个基本的HTTP请求结构如下图所示：</p> <p><a class=glightbox href="1. 介绍HTTP协议基本结构与基本实现HTTPServer.assets/image.png" data-type=image data-width=100% data-height=auto data-desc-position=bottom><img src="1. 介绍HTTP协议基本结构与基本实现HTTPServer.assets/image.png"></a></p> <p>一个基本的HTTP响应结构如下图所示：</p> <p><a class=glightbox href="1. 介绍HTTP协议基本结构与基本实现HTTPServer.assets\image1.png" data-type=image data-width=100% data-height=auto data-desc-position=bottom><img src="1. 介绍HTTP协议基本结构与基本实现HTTPServer.assets\image1.png"></a></p> <p>在上面两个结构图中，可以看到都存在换行符，这里的换行符更准确来说应该是<code>\r\n</code></p> <p>但是这仅仅只是定义了结构，根据前面的知识可以知道除了有结构以外，还需要对结构化的数据进行序列化和反序列化，HTTP协议的设计者也考虑到了这一点，所以HTTP实际上有自己的序列化和反序列化方式，而不需要程序员自己去实现前面类似于使用JSONCPP库进行JSON格式字符串的来回转换</p> <h3 id=http_1>HTTP请求结构<a class=headerlink href=#http_1 title="Permanent link">&para;</a></h3> <p>在HTTP请求结构中：</p> <p>首先是请求行部分，其中第一个就是HTTP的请求方法，具体的方法一共有6种，但是最常见的就是<code>GET</code>和<code>POST</code>方法，具体二者的区别会在<a href=#>后面的章节进行讲解</a>；接着是<code>URI</code>实际上对应的就是<a href=javascript:; class=custom-tooltip data-title=即去除协议+IP地址+端口号（域名）剩余的部分，但是不包括参数>资源路径</a>；最后就是HTTP版本，具体在<a href=#>HTTP版本部分</a>会有具体介绍，此处不具体说明</p> <p>第二部分就是请求报头，请求报头所有的属性都是以<code>key: value</code>的形式存在，具体存在哪些属性在<a href=#>后面的章节会提及</a>，此处不具体说明</p> <p>最后就是请求正文，这里一般存放着请求时传递给服务器的参数，但是具体是否存在请求参数需要看请求方式，具体见<a href=#>后面的章节进行讲解</a></p> <h3 id=http_2>HTTP响应结构<a class=headerlink href=#http_2 title="Permanent link">&para;</a></h3> <p>在HTTP响应结构中：</p> <p>首先是响应行部分，第一个就是HTTP版本，之所以HTTP请求和响应中都需要指定版本号是为了确保通信双方能够正确理解和处理彼此的消息，处理版本差异，并在不同版本的HTTP协议间提供平滑的过渡。这种设计使得HTTP协议能够在保持向后兼容的同时不断发展和改进；接着是状态码，HTTP协议规定，不论是请求成功还是请求失败都需要给客户端响应，但是如果一味地响应同一种数据，那么客户端就无法分辨哪一个为正常数据，所以为了标识不同的响应结果，就需要这个状态码，在<a href=https://www.help-doc.top/Linux/http/http-serialization/http-serialization.html#http_4>深入HTTP序列化和反序列化</a>有具体讲解，此处不具体说明；最后就是状态码描述，这个描述文字对应的状态码的含义，具体见<a href=https://www.help-doc.top/Linux/http/http-serialization/http-serialization.html#http_4>深入HTTP序列化和反序列化</a></p> <p>第二部分和第三部分与HTTP请求结构的第二部分相同，此处不再赘述</p> <h2 id=_6>封装网络接口<a class=headerlink href=#_6 title="Permanent link">&para;</a></h2> <p>接下来需要编写处理HTTP请求的服务器，而因为HTTP是基于TCP的，所以为了后面编写的方便，此处先对前面使用的网络接口进行封装</p> <h3 id=_7>基本设计思路<a class=headerlink href=#_7 title="Permanent link">&para;</a></h3> <p>本次封装考虑采用模版方法设计模式（Template Method Pattern），其是一种行为型设计模式，它定义了一个算法的框架，但将一些步骤的具体实现延迟到子类中。通过这种方式，模板方法允许子类在不改变算法结构的情况下重新定义某些步骤</p> <p>该模式的核心思想是：在父类中定义算法的整体结构，而将某些具体步骤留给子类去实现 。这样可以确保算法的骨架保持一致，同时允许子类根据需要自定义某些细节</p> <p>在模版方法设计模式中存在一些核心概念：</p> <ol> <li>抽象类（Abstract Class）：定义了算法的整体框架，并包含一个或多个抽象方法（由子类实现）。此外，它还可能包含一些具体方法（默认实现），这些方法可以直接被子类复用</li> <li>模板方法（Template Method）：模板方法是一个具体方法，一般不允许被子类重写。它定义了算法的执行步骤，调用了抽象方法和具体方法</li> <li>具体类（Concrete Class）：具体类（子类）继承抽象类，并实现抽象方法，提供具体的实现逻辑</li> </ol> <p>根据这个模式的基本介绍，下面考虑具体的设计思路：</p> <p>首先是抽象类，定义为<code>BaseSocket</code>，其中提供一系列抽象方法和一个具体模版方法<code>initSocket</code>，在具体模版方法中需要调用抽象方法，当子类实现抽象方法后，通过向上转型调用抽象类中的具体方法</p> <p>接着是具体类，具体类一共有两个，一个是<code>UdpSocket</code>，另外一个是<code>TcpSocket</code>，因为本次需要实现<code>HttpServer</code>，所以重点实现<code>TcpSocket</code>类</p> <p>在具体方法中，因为是针对<code>TcpSocket</code>，所以需要经过下面的三个步骤：</p> <ol> <li>创建服务器监听套接字</li> <li>绑定服务器监听套接字</li> <li>服务器进入监听状态</li> </ol> <p>根据这三个步骤，在<code>initSocket</code>函数中就需要对应的三个方法的调用</p> <h3 id=_8>设计抽象类<a class=headerlink href=#_8 title="Permanent link">&para;</a></h3> <p>根据上面的思路，可以设计出抽象类如下：</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-3-1><span class=k>class</span><span class=w> </span><span class=nc>BaseSocket</span>
</span><span id=__span-3-2><span class=p>{</span>
</span><span id=__span-3-3><span class=k>public</span><span class=o>:</span>
</span><span id=__span-3-4><span class=w>   </span><span class=k>virtual</span><span class=w> </span><span class=o>~</span><span class=n>BaseSocket</span><span class=p>()</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>default</span><span class=p>;</span>
</span><span id=__span-3-5><span class=w>   </span><span class=c1>// 创建套接字</span>
</span><span id=__span-3-6><span class=w>   </span><span class=k>virtual</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>createSocket</span><span class=p>()</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-3-7><span class=w>   </span><span class=c1>// 绑定</span>
</span><span id=__span-3-8><span class=w>   </span><span class=k>virtual</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>toBind</span><span class=p>()</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-3-9><span class=w>   </span><span class=c1>// 监听</span>
</span><span id=__span-3-10><span class=w>   </span><span class=k>virtual</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>toListen</span><span class=p>()</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-3-11>
</span><span id=__span-3-12><span class=w>   </span><span class=c1>// 具体实现方法</span>
</span><span id=__span-3-13><span class=w>   </span><span class=kt>void</span><span class=w> </span><span class=nf>initSocket</span><span class=p>()</span>
</span><span id=__span-3-14><span class=w>   </span><span class=p>{</span>
</span><span id=__span-3-15><span class=w>      </span><span class=n>createSocket</span><span class=p>();</span>
</span><span id=__span-3-16><span class=w>      </span><span class=n>toBind</span><span class=p>();</span>
</span><span id=__span-3-17><span class=w>      </span><span class=n>toListen</span><span class=p>();</span>
</span><span id=__span-3-18><span class=w>   </span><span class=p>}</span>
</span><span id=__span-3-19><span class=p>};</span>
</span></code></pre></div></td></tr></table></div> <h3 id=_9>设计具体类<a class=headerlink href=#_9 title="Permanent link">&para;</a></h3> <p>本次以TCP为例，设计<code>TcpServer</code>类，需要继承<code>BaseServer</code>并实现对应的抽象方法，需要注意，子类不允许实现<code>initServer</code>方法，实现方式与前面类似，只是将具体逻辑抽取到单独的函数中，代码如下：</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span>
<span class=normal>45</span>
<span class=normal>46</span>
<span class=normal>47</span>
<span class=normal>48</span>
<span class=normal>49</span>
<span class=normal>50</span>
<span class=normal>51</span>
<span class=normal>52</span>
<span class=normal>53</span>
<span class=normal>54</span>
<span class=normal>55</span>
<span class=normal>56</span>
<span class=normal>57</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-4-1><span class=c1>// 默认端口</span>
</span><span id=__span-4-2><span class=k>const</span><span class=w> </span><span class=kt>uint16_t</span><span class=w> </span><span class=n>default_port</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>8080</span><span class=p>;</span>
</span><span id=__span-4-3><span class=c1>// 默认最大支持排队等待连接的客户端个数</span>
</span><span id=__span-4-4><span class=k>const</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>max_backlog</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>8</span><span class=p>;</span>
</span><span id=__span-4-5>
</span><span id=__span-4-6><span class=k>class</span><span class=w> </span><span class=nc>TcpSocket</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=k>public</span><span class=w> </span><span class=n>BaseSocket</span>
</span><span id=__span-4-7><span class=p>{</span>
</span><span id=__span-4-8><span class=k>public</span><span class=o>:</span>
</span><span id=__span-4-9><span class=w>    </span><span class=n>TcpSocket</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>port</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>default_port</span><span class=p>)</span>
</span><span id=__span-4-10><span class=w>        </span><span class=o>:</span><span class=w> </span><span class=n>_listen_socketfd</span><span class=p>(</span><span class=mi>-1</span><span class=p>),</span><span class=w> </span><span class=n>_s_addr_in</span><span class=p>(</span><span class=n>port</span><span class=p>)</span>
</span><span id=__span-4-11><span class=w>    </span><span class=p>{</span>
</span><span id=__span-4-12><span class=w>    </span><span class=p>}</span>
</span><span id=__span-4-13>
</span><span id=__span-4-14><span class=w>    </span><span class=c1>// 实现创建套接字</span>
</span><span id=__span-4-15><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=n>createSocket</span><span class=p>()</span><span class=w> </span><span class=k>override</span>
</span><span id=__span-4-16><span class=w>    </span><span class=p>{</span>
</span><span id=__span-4-17><span class=w>        </span><span class=n>_listen_socketfd</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>socket</span><span class=p>(</span><span class=n>AF_INET</span><span class=p>,</span><span class=w> </span><span class=n>SOCK_STREAM</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>);</span>
</span><span id=__span-4-18><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>_listen_socketfd</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>0</span><span class=p>)</span>
</span><span id=__span-4-19><span class=w>        </span><span class=p>{</span>
</span><span id=__span-4-20><span class=w>            </span><span class=n>LOG</span><span class=p>(</span><span class=n>LogLevel</span><span class=o>::</span><span class=n>FATAL</span><span class=p>)</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;监听套接字创建失败：&quot;</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>strerror</span><span class=p>(</span><span class=n>errno</span><span class=p>);</span>
</span><span id=__span-4-21><span class=w>            </span><span class=n>exit</span><span class=p>(</span><span class=k>static_cast</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>(</span><span class=n>ErrorNumber</span><span class=o>::</span><span class=n>SocketFail</span><span class=p>));</span>
</span><span id=__span-4-22><span class=w>        </span><span class=p>}</span>
</span><span id=__span-4-23><span class=w>        </span><span class=n>LOG</span><span class=p>(</span><span class=n>LogLevel</span><span class=o>::</span><span class=n>INFO</span><span class=p>)</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;监听套接字创建成功：&quot;</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>_listen_socketfd</span><span class=p>;</span>
</span><span id=__span-4-24><span class=w>    </span><span class=p>}</span>
</span><span id=__span-4-25>
</span><span id=__span-4-26><span class=w>    </span><span class=c1>// 实现绑定</span>
</span><span id=__span-4-27><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=n>toBind</span><span class=p>()</span><span class=w> </span><span class=k>override</span>
</span><span id=__span-4-28><span class=w>    </span><span class=p>{</span>
</span><span id=__span-4-29><span class=w>        </span><span class=kt>int</span><span class=w> </span><span class=n>n</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>bind</span><span class=p>(</span><span class=n>_listen_socketfd</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>_s_addr_in</span><span class=p>,</span><span class=w> </span><span class=n>_s_addr_in</span><span class=p>.</span><span class=n>getLength</span><span class=p>());</span>
</span><span id=__span-4-30><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>n</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>0</span><span class=p>)</span>
</span><span id=__span-4-31><span class=w>        </span><span class=p>{</span>
</span><span id=__span-4-32><span class=w>            </span><span class=n>LOG</span><span class=p>(</span><span class=n>LogLevel</span><span class=o>::</span><span class=n>ERROR</span><span class=p>)</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;绑定失败：&quot;</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>strerror</span><span class=p>(</span><span class=n>errno</span><span class=p>);</span>
</span><span id=__span-4-33><span class=w>            </span><span class=n>exit</span><span class=p>(</span><span class=k>static_cast</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>(</span><span class=n>ErrorNumber</span><span class=o>::</span><span class=n>BindSocketFail</span><span class=p>));</span>
</span><span id=__span-4-34><span class=w>        </span><span class=p>}</span>
</span><span id=__span-4-35><span class=w>        </span><span class=n>LOG</span><span class=p>(</span><span class=n>LogLevel</span><span class=o>::</span><span class=n>INFO</span><span class=p>)</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;绑定成功&quot;</span><span class=p>;</span>
</span><span id=__span-4-36><span class=w>    </span><span class=p>}</span>
</span><span id=__span-4-37>
</span><span id=__span-4-38><span class=w>    </span><span class=c1>// 实现监听</span>
</span><span id=__span-4-39><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=n>toListen</span><span class=p>()</span><span class=w> </span><span class=k>override</span>
</span><span id=__span-4-40><span class=w>    </span><span class=p>{</span>
</span><span id=__span-4-41><span class=w>        </span><span class=kt>int</span><span class=w> </span><span class=n>ret</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>listen</span><span class=p>(</span><span class=n>_listen_socketfd</span><span class=p>,</span><span class=w> </span><span class=n>max_backlog</span><span class=p>);</span>
</span><span id=__span-4-42><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>ret</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>0</span><span class=p>)</span>
</span><span id=__span-4-43><span class=w>        </span><span class=p>{</span>
</span><span id=__span-4-44><span class=w>            </span><span class=n>LOG</span><span class=p>(</span><span class=n>LogLevel</span><span class=o>::</span><span class=n>ERROR</span><span class=p>)</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;监听失败：&quot;</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>strerror</span><span class=p>(</span><span class=n>errno</span><span class=p>);</span>
</span><span id=__span-4-45><span class=w>            </span><span class=n>exit</span><span class=p>(</span><span class=k>static_cast</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>(</span><span class=n>ErrorNumber</span><span class=o>::</span><span class=n>ListenFail</span><span class=p>));</span>
</span><span id=__span-4-46><span class=w>        </span><span class=p>}</span>
</span><span id=__span-4-47><span class=w>        </span><span class=n>LOG</span><span class=p>(</span><span class=n>LogLevel</span><span class=o>::</span><span class=n>INFO</span><span class=p>)</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;监听成功&quot;</span><span class=p>;</span>
</span><span id=__span-4-48><span class=w>    </span><span class=p>}</span>
</span><span id=__span-4-49>
</span><span id=__span-4-50><span class=w>    </span><span class=o>~</span><span class=n>TcpSocket</span><span class=p>()</span>
</span><span id=__span-4-51><span class=w>    </span><span class=p>{</span>
</span><span id=__span-4-52><span class=w>    </span><span class=p>}</span>
</span><span id=__span-4-53>
</span><span id=__span-4-54><span class=k>private</span><span class=o>:</span>
</span><span id=__span-4-55><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>_listen_socketfd</span><span class=p>;</span><span class=w>  </span><span class=c1>// 监听套接字</span>
</span><span id=__span-4-56><span class=w>    </span><span class=n>SockAddrIn</span><span class=w> </span><span class=n>_s_addr_in</span><span class=p>;</span><span class=w> </span><span class=c1>// 套接字结构</span>
</span><span id=__span-4-57><span class=p>};</span>
</span></code></pre></div></td></tr></table></div> <p>接着，因为TCP还需要一个接收过程，所以还需要一个接口用于接收，并且为了让上层处理具体的客户端信息，考虑将客户端信息返回给上层</p> <p>根据这个思路，首先在抽象类中定义接收抽象函数和获取接收套接字函数：</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-5-1><span class=c1>// 接收</span>
</span><span id=__span-5-2><span class=k>virtual</span><span class=w> </span><span class=n>SockAddrIn</span><span class=w> </span><span class=nf>toAccept</span><span class=p>()</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span></code></pre></div></td></tr></table></div> <p>接着在具体类中实现：</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-6-1><span class=c1>// 实现接收</span>
</span><span id=__span-6-2><span class=n>SockAddrIn</span><span class=w> </span><span class=nf>toAccept</span><span class=p>()</span><span class=w> </span><span class=k>override</span>
</span><span id=__span-6-3><span class=p>{</span>
</span><span id=__span-6-4><span class=w>    </span><span class=k>struct</span><span class=w> </span><span class=nc>sockaddr_in</span><span class=w> </span><span class=n>peer</span><span class=p>;</span>
</span><span id=__span-6-5><span class=w>    </span><span class=kt>socklen_t</span><span class=w> </span><span class=n>length</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=n>peer</span><span class=p>);</span>
</span><span id=__span-6-6><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>ac_socketfd</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>accept</span><span class=p>(</span><span class=n>_listen_socketfd</span><span class=p>,</span><span class=w> </span><span class=k>reinterpret_cast</span><span class=o>&lt;</span><span class=k>struct</span><span class=w> </span><span class=nc>sockaddr</span><span class=w> </span><span class=o>*&gt;</span><span class=p>(</span><span class=o>&amp;</span><span class=n>peer</span><span class=p>),</span><span class=w> </span><span class=o>&amp;</span><span class=n>length</span><span class=p>);</span>
</span><span id=__span-6-7>
</span><span id=__span-6-8><span class=w>    </span><span class=k>if</span><span class=p>(</span><span class=n>ac_socketfd</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>0</span><span class=p>)</span>
</span><span id=__span-6-9><span class=w>    </span><span class=p>{</span>
</span><span id=__span-6-10><span class=w>        </span><span class=n>LOG</span><span class=p>(</span><span class=n>LogLevel</span><span class=o>::</span><span class=n>ERROR</span><span class=p>)</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;接收失败：&quot;</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>strerror</span><span class=p>(</span><span class=n>errno</span><span class=p>);</span>
</span><span id=__span-6-11><span class=w>        </span><span class=n>exit</span><span class=p>(</span><span class=k>static_cast</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>(</span><span class=n>ErrorNumber</span><span class=o>::</span><span class=n>AcceptFail</span><span class=p>));</span>
</span><span id=__span-6-12><span class=w>    </span><span class=p>}</span>
</span><span id=__span-6-13>
</span><span id=__span-6-14><span class=w>    </span><span class=n>LOG</span><span class=p>(</span><span class=n>LogLevel</span><span class=o>::</span><span class=n>INFO</span><span class=p>)</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;接收成功：&quot;</span><span class=p>;</span>
</span><span id=__span-6-15>
</span><span id=__span-6-16><span class=w>    </span><span class=c1>// 向上层返回客户端</span>
</span><span id=__span-6-17><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>peer</span><span class=p>;</span>
</span><span id=__span-6-18><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <h2 id=tcpserver>实现<code>TcpServer</code>类<a class=headerlink href=#tcpserver title="Permanent link">&para;</a></h2> <p>有了基本接口的封装后，因为<code>HttpServer</code>基于TCP，所以需要先实现<code>TcpServer</code>类，基本思路如下：</p> <p>对于<code>TcpServer</code>类来说，需要考虑的事情就是执行任务，而因为是服务器，本次考虑只让服务器做监听和接收而不进行任何其他任务，所以考虑使用回调函数将任务交给上层。但是现在就遇到了一个问题，<code>TcpSocket</code>的<code>ac_socketfd</code>是一个局部变量，并且此时没有相应的接口可以获得该局部变量，所以为了解决这个问题，可以考虑对开始的<code>toAccept</code>函数进行改写</p> <p>首先，为了外部可以获取到客户端的信息，可以考虑设计一个输出型参数：</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-7-1><span class=kt>void</span><span class=w> </span><span class=nf>toAccept</span><span class=p>(</span><span class=n>SockAddrIn</span><span class=w> </span><span class=o>*</span><span class=n>client</span><span class=p>)</span>
</span><span id=__span-7-2><span class=p>{</span>
</span><span id=__span-7-3><span class=w>    </span><span class=c1>// ...</span>
</span><span id=__span-7-4><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <p>接着，为了外部可以直接使用接收成功后的套接字，这里直接将函数返回值修改为<code>int</code>即可：</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-8-1><span class=kt>int</span><span class=w> </span><span class=nf>toAccept</span><span class=p>(</span><span class=n>SockAddrIn</span><span class=w> </span><span class=o>*</span><span class=n>client</span><span class=p>)</span>
</span><span id=__span-8-2><span class=p>{</span>
</span><span id=__span-8-3><span class=w>    </span><span class=c1>// ...</span>
</span><span id=__span-8-4><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <p>最后，整体修改<code>toAccept</code>函数的逻辑：</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-9-1><span class=c1>// 实现接收</span>
</span><span id=__span-9-2><span class=kt>int</span><span class=w> </span><span class=nf>toAccept</span><span class=p>(</span><span class=n>SockAddrIn</span><span class=o>*</span><span class=w> </span><span class=n>client</span><span class=p>)</span><span class=w> </span><span class=k>override</span>
</span><span id=__span-9-3><span class=p>{</span>
</span><span id=__span-9-4><span class=w>    </span><span class=k>struct</span><span class=w> </span><span class=nc>sockaddr_in</span><span class=w> </span><span class=n>peer</span><span class=p>;</span>
</span><span id=__span-9-5><span class=w>    </span><span class=kt>socklen_t</span><span class=w> </span><span class=n>length</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=n>peer</span><span class=p>);</span>
</span><span id=__span-9-6><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>ac_socketfd</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>accept</span><span class=p>(</span><span class=n>_listen_socketfd</span><span class=p>,</span><span class=w> </span><span class=k>reinterpret_cast</span><span class=o>&lt;</span><span class=k>struct</span><span class=w> </span><span class=nc>sockaddr</span><span class=w> </span><span class=o>*&gt;</span><span class=p>(</span><span class=o>&amp;</span><span class=n>peer</span><span class=p>),</span><span class=w> </span><span class=o>&amp;</span><span class=n>length</span><span class=p>);</span>
</span><span id=__span-9-7>
</span><span id=__span-9-8><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>ac_socketfd</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>0</span><span class=p>)</span>
</span><span id=__span-9-9><span class=w>    </span><span class=p>{</span>
</span><span id=__span-9-10><span class=w>        </span><span class=n>LOG</span><span class=p>(</span><span class=n>LogLevel</span><span class=o>::</span><span class=n>ERROR</span><span class=p>)</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;接收失败：&quot;</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>strerror</span><span class=p>(</span><span class=n>errno</span><span class=p>);</span>
</span><span id=__span-9-11><span class=w>        </span><span class=n>exit</span><span class=p>(</span><span class=k>static_cast</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>(</span><span class=n>ErrorNumber</span><span class=o>::</span><span class=n>AcceptFail</span><span class=p>));</span>
</span><span id=__span-9-12><span class=w>    </span><span class=p>}</span>
</span><span id=__span-9-13>
</span><span id=__span-9-14><span class=w>    </span><span class=n>LOG</span><span class=p>(</span><span class=n>LogLevel</span><span class=o>::</span><span class=n>INFO</span><span class=p>)</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;接收成功：&quot;</span><span class=p>;</span>
</span><span id=__span-9-15>
</span><span id=__span-9-16><span class=w>    </span><span class=o>*</span><span class=n>client</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>peer</span><span class=p>;</span>
</span><span id=__span-9-17>
</span><span id=__span-9-18><span class=w>    </span><span class=c1>// 向上层返回客户端</span>
</span><span id=__span-9-19><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>ac_socketfd</span><span class=p>;</span>
</span><span id=__span-9-20><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <p>既然服务器要做监听和接收，那么少不了的就是调用<code>TcpSocket</code>中的监听和接收接口，而因为监听是在初始化就开始了，所以只需要在启动时处理接收即可，接着将其他任务交给上层，但是，交给上层之前，需要处理好接收和任务分离，保证接收和执行任务可以独立进行，此时就需要利用前面的线程或者进程，本次考虑使用线程，所以基本代码如下：</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span>
<span class=normal>45</span>
<span class=normal>46</span>
<span class=normal>47</span>
<span class=normal>48</span>
<span class=normal>49</span>
<span class=normal>50</span>
<span class=normal>51</span>
<span class=normal>52</span>
<span class=normal>53</span>
<span class=normal>54</span>
<span class=normal>55</span>
<span class=normal>56</span>
<span class=normal>57</span>
<span class=normal>58</span>
<span class=normal>59</span>
<span class=normal>60</span>
<span class=normal>61</span>
<span class=normal>62</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-10-1><span class=k>using</span><span class=w> </span><span class=n>task_t</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>function</span><span class=o>&lt;</span><span class=kt>void</span><span class=p>(</span><span class=n>SockAddrIn</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=p>)</span><span class=o>&gt;</span><span class=p>;</span>
</span><span id=__span-10-2><span class=k>using</span><span class=w> </span><span class=n>base_socket_ptr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>shared_ptr</span><span class=o>&lt;</span><span class=n>BaseSocket</span><span class=o>&gt;</span><span class=p>;</span>
</span><span id=__span-10-3>
</span><span id=__span-10-4><span class=k>class</span><span class=w> </span><span class=nc>TcpServer</span><span class=p>;</span>
</span><span id=__span-10-5>
</span><span id=__span-10-6><span class=k>struct</span><span class=w> </span><span class=nc>data</span>
</span><span id=__span-10-7><span class=p>{</span>
</span><span id=__span-10-8><span class=w>    </span><span class=n>SockAddrIn</span><span class=w> </span><span class=n>client</span><span class=p>;</span>
</span><span id=__span-10-9><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>ac_socketfd</span><span class=p>;</span>
</span><span id=__span-10-10><span class=w>    </span><span class=n>TcpServer</span><span class=o>*</span><span class=w> </span><span class=n>self</span><span class=p>;</span>
</span><span id=__span-10-11><span class=p>};</span>
</span><span id=__span-10-12>
</span><span id=__span-10-13><span class=k>class</span><span class=w> </span><span class=nc>TcpServer</span>
</span><span id=__span-10-14><span class=p>{</span>
</span><span id=__span-10-15><span class=k>public</span><span class=o>:</span>
</span><span id=__span-10-16><span class=w>    </span><span class=n>TcpServer</span><span class=p>(</span><span class=kt>uint16_t</span><span class=w> </span><span class=n>port</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>default_port</span><span class=p>)</span>
</span><span id=__span-10-17><span class=w>        </span><span class=o>:</span><span class=n>_bs</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>make_shared</span><span class=o>&lt;</span><span class=n>TcpSocket</span><span class=o>&gt;</span><span class=p>(</span><span class=n>port</span><span class=p>))</span>
</span><span id=__span-10-18><span class=w>        </span><span class=p>,</span><span class=n>_isRunning</span><span class=p>(</span><span class=nb>false</span><span class=p>)</span>
</span><span id=__span-10-19><span class=w>    </span><span class=p>{</span>
</span><span id=__span-10-20><span class=w>        </span><span class=n>_bs</span><span class=o>-&gt;</span><span class=n>initSocket</span><span class=p>();</span>
</span><span id=__span-10-21><span class=w>    </span><span class=p>}</span>
</span><span id=__span-10-22>
</span><span id=__span-10-23><span class=w>    </span><span class=c1>// 注册方法</span>
</span><span id=__span-10-24><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=n>registerFunc</span><span class=p>(</span><span class=n>task_t</span><span class=w> </span><span class=n>handler</span><span class=p>)</span>
</span><span id=__span-10-25><span class=w>    </span><span class=p>{</span>
</span><span id=__span-10-26><span class=w>        </span><span class=n>_handler</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>handler</span><span class=p>;</span>
</span><span id=__span-10-27><span class=w>    </span><span class=p>}</span>
</span><span id=__span-10-28>
</span><span id=__span-10-29><span class=w>    </span><span class=k>static</span><span class=w> </span><span class=kt>void</span><span class=o>*</span><span class=w> </span><span class=n>routine</span><span class=p>(</span><span class=kt>void</span><span class=o>*</span><span class=w> </span><span class=n>args</span><span class=p>)</span>
</span><span id=__span-10-30><span class=w>    </span><span class=p>{</span>
</span><span id=__span-10-31><span class=w>        </span><span class=k>struct</span><span class=w> </span><span class=nc>data</span><span class=o>*</span><span class=w> </span><span class=n>ptr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>reinterpret_cast</span><span class=o>&lt;</span><span class=k>struct</span><span class=w> </span><span class=nc>data</span><span class=o>*&gt;</span><span class=p>(</span><span class=n>args</span><span class=p>);</span>
</span><span id=__span-10-32><span class=w>        </span><span class=n>ptr</span><span class=o>-&gt;</span><span class=n>self</span><span class=o>-&gt;</span><span class=n>_handler</span><span class=p>(</span><span class=n>ptr</span><span class=o>-&gt;</span><span class=n>client</span><span class=p>,</span><span class=w> </span><span class=n>ptr</span><span class=o>-&gt;</span><span class=n>ac_socketfd</span><span class=p>);</span>
</span><span id=__span-10-33>
</span><span id=__span-10-34><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nb>NULL</span><span class=p>;</span>
</span><span id=__span-10-35><span class=w>    </span><span class=p>}</span>
</span><span id=__span-10-36>
</span><span id=__span-10-37><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=n>start</span><span class=p>()</span>
</span><span id=__span-10-38><span class=w>    </span><span class=p>{</span>
</span><span id=__span-10-39><span class=w>        </span><span class=n>_isRunning</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>true</span><span class=p>;</span>
</span><span id=__span-10-40><span class=w>        </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>_isRunning</span><span class=p>)</span>
</span><span id=__span-10-41><span class=w>        </span><span class=p>{</span>
</span><span id=__span-10-42><span class=w>            </span><span class=n>SockAddrIn</span><span class=w> </span><span class=n>client</span><span class=p>;</span>
</span><span id=__span-10-43><span class=w>            </span><span class=c1>// 因为在SockAddrIn内部重载了&amp;，此处注意使用addressof取出当前对象的实际地址</span>
</span><span id=__span-10-44><span class=w>            </span><span class=kt>int</span><span class=w> </span><span class=n>ac_socketfd</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>_bs</span><span class=o>-&gt;</span><span class=n>toAccept</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>addressof</span><span class=p>(</span><span class=n>client</span><span class=p>));</span>
</span><span id=__span-10-45>
</span><span id=__span-10-46><span class=w>            </span><span class=n>pthread_t</span><span class=w> </span><span class=n>pid</span><span class=p>;</span>
</span><span id=__span-10-47><span class=w>            </span><span class=k>struct</span><span class=w> </span><span class=nc>data</span><span class=w> </span><span class=n>d</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=n>client</span><span class=p>,</span><span class=w> </span><span class=n>ac_socketfd</span><span class=p>,</span><span class=w> </span><span class=k>this</span><span class=p>};</span>
</span><span id=__span-10-48><span class=w>            </span><span class=n>pthread_create</span><span class=p>(</span><span class=o>&amp;</span><span class=n>pid</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>,</span><span class=w> </span><span class=n>routine</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>d</span><span class=p>);</span>
</span><span id=__span-10-49><span class=w>        </span><span class=p>}</span>
</span><span id=__span-10-50><span class=w>    </span><span class=p>}</span>
</span><span id=__span-10-51>
</span><span id=__span-10-52><span class=w>    </span><span class=c1>// 获取底层接口</span>
</span><span id=__span-10-53><span class=w>    </span><span class=n>base_socket_ptr</span><span class=w> </span><span class=n>getSocketPtr</span><span class=p>()</span>
</span><span id=__span-10-54><span class=w>    </span><span class=p>{</span>
</span><span id=__span-10-55><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>_bs</span><span class=p>;</span>
</span><span id=__span-10-56><span class=w>    </span><span class=p>}</span>
</span><span id=__span-10-57>
</span><span id=__span-10-58><span class=k>private</span><span class=o>:</span>
</span><span id=__span-10-59><span class=w>    </span><span class=n>std</span><span class=o>::</span><span class=n>shared_ptr</span><span class=o>&lt;</span><span class=n>BaseSocket</span><span class=o>&gt;</span><span class=w> </span><span class=n>_bs</span><span class=p>;</span><span class=w> </span><span class=c1>// 向上转型</span>
</span><span id=__span-10-60><span class=w>    </span><span class=kt>bool</span><span class=w> </span><span class=n>_isRunning</span><span class=p>;</span>
</span><span id=__span-10-61><span class=w>    </span><span class=n>task_t</span><span class=w> </span><span class=n>_handler</span><span class=p>;</span>
</span><span id=__span-10-62><span class=p>};</span>
</span></code></pre></div></td></tr></table></div> <h2 id=http_3>实现HTTP服务器<a class=headerlink href=#http_3 title="Permanent link">&para;</a></h2> <p>有了基本的<code>TcpServer</code>类后就可以开始实现基于TCP的HTTP服务器，为了能够快速看到服务器运行效果，先搭建一个基本的服务器端。这个服务器需要实现的功能：当浏览器请求服务端时可以看到服务端给浏览器回显的一行HTML内容</p> <p>有了目标功能后，现在考虑如何实现这个功能。既然要给浏览器回显一行HTML内容，那么服务器就必须要有给客户端返回HTTP响应的功能。需要注意，本次客户端只是发送一个不含有任何请求报头和请求体的HTTP请求，所以服务器可以不用对客户端的请求进行细致化处理，具体如何细致化处理会在<a href=https://www.help-doc.top/Linux/http/http-serialization/http-serialization.html>深入HTTP序列化和反序列化</a></p> <h3 id=httpserver>创建<code>HttpServer</code>类<a class=headerlink href=#httpserver title="Permanent link">&para;</a></h3> <p>因为HTTP是基于TCP的，所以在<code>HttpServer</code>类中需要有一个<code>TcpServer</code>成员，接着根据前面的思路，需要提供处理HTTP请求的函数，所以整体结构如下：</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-11-1><span class=k>class</span><span class=w> </span><span class=nc>HttpServer</span>
</span><span id=__span-11-2><span class=p>{</span>
</span><span id=__span-11-3><span class=k>public</span><span class=o>:</span>
</span><span id=__span-11-4><span class=w>    </span><span class=n>HttpServer</span><span class=p>(</span><span class=kt>uint16_t</span><span class=w> </span><span class=n>port</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>default_port</span><span class=p>)</span>
</span><span id=__span-11-5><span class=w>        </span><span class=o>:</span><span class=n>_tp</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>make_shared</span><span class=o>&lt;</span><span class=n>TcpServer</span><span class=o>&gt;</span><span class=p>(</span><span class=n>port</span><span class=p>))</span>
</span><span id=__span-11-6><span class=w>    </span><span class=p>{</span>
</span><span id=__span-11-7>
</span><span id=__span-11-8><span class=w>    </span><span class=p>}</span>
</span><span id=__span-11-9>
</span><span id=__span-11-10><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=n>handleHttpRequest</span><span class=p>(</span><span class=n>SockAddrIn</span><span class=w> </span><span class=n>sock_addr_in</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>ac_socketfd</span><span class=p>)</span>
</span><span id=__span-11-11><span class=w>    </span><span class=p>{</span>
</span><span id=__span-11-12>
</span><span id=__span-11-13><span class=w>    </span><span class=p>}</span>
</span><span id=__span-11-14>
</span><span id=__span-11-15><span class=k>private</span><span class=o>:</span>
</span><span id=__span-11-16><span class=w>    </span><span class=n>std</span><span class=o>::</span><span class=n>shared_ptr</span><span class=o>&lt;</span><span class=n>TcpServer</span><span class=o>&gt;</span><span class=w> </span><span class=n>_tp</span><span class=p>;</span>
</span><span id=__span-11-17><span class=p>};</span>
</span></code></pre></div></td></tr></table></div> <p>但是，上面的基本结构中还缺少一个关键的环节：启动服务器。启动HTTP服务器本质就是启动<code>TcpServer</code>，启动<code>TcpServer</code>时需要传递执行的任务，因为本次<code>TcpServer</code>执行的就是处理HTTP请求，所以执行的函数就是<code>handleHttpRequest</code>，所以实现如下：</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span>
<span class=normal>8</span>
<span class=normal>9</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-12-1><span class=kt>void</span><span class=w> </span><span class=nf>start</span><span class=p>()</span>
</span><span id=__span-12-2><span class=p>{</span>
</span><span id=__span-12-3><span class=w>    </span><span class=c1>// 注册方法</span>
</span><span id=__span-12-4><span class=w>    </span><span class=n>_tp</span><span class=o>-&gt;</span><span class=n>registerFunc</span><span class=p>([</span><span class=k>this</span><span class=p>](</span><span class=n>SockAddrIn</span><span class=w> </span><span class=n>sock_addr_in</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>ac_socketfd</span><span class=p>){</span>
</span><span id=__span-12-5><span class=w>        </span><span class=k>this</span><span class=o>-&gt;</span><span class=n>handleHttpRequest</span><span class=p>(</span><span class=n>sock_addr_in</span><span class=p>,</span><span class=w> </span><span class=n>ac_socketfd</span><span class=p>);</span>
</span><span id=__span-12-6><span class=w>    </span><span class=p>});</span>
</span><span id=__span-12-7>
</span><span id=__span-12-8><span class=w>    </span><span class=n>_tp</span><span class=o>-&gt;</span><span class=n>start</span><span class=p>();</span>
</span><span id=__span-12-9><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <h3 id=http_4>实现处理HTTP请求接口<a class=headerlink href=#http_4 title="Permanent link">&para;</a></h3> <p>根据前面提到的目标，服务器只需要根据HTTP响应结构向客户端返回对应的内容即可。首先，构建一个内容作为HTTP响应结构的响应体：</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-13-1><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=w> </span><span class=n>msg</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;&lt;h1&gt;Hello Linux&lt;/h1&gt;&quot;</span><span class=p>;</span>
</span><span id=__span-13-2><span class=k>const</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=w> </span><span class=n>sep</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;</span><span class=se>\r\n</span><span class=s>&quot;</span><span class=p>;</span>
</span><span id=__span-13-3><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=w> </span><span class=n>body</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>msg</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>sep</span><span class=p>;</span>
</span><span id=__span-13-4><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=w> </span><span class=n>status_line</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;HTTP/1.1 200 OK&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>sep</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>sep</span><span class=p>;</span>
</span><span id=__span-13-5>
</span><span id=__span-13-6><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=w> </span><span class=n>httpResponse</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>status_line</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>body</span><span class=p>;</span>
</span></code></pre></div></td></tr></table></div> <p>接着要实现发送，就必须要调用对应的接口，即<code>send</code>，所以基本实现如下：</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-14-1><span class=kt>void</span><span class=w> </span><span class=nf>handleHttpRequest</span><span class=p>(</span><span class=n>SockAddrIn</span><span class=w> </span><span class=n>sock_addr_in</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>ac_socketfd</span><span class=p>)</span>
</span><span id=__span-14-2><span class=p>{</span>
</span><span id=__span-14-3><span class=w>    </span><span class=n>LOG</span><span class=p>(</span><span class=n>LogLevel</span><span class=o>::</span><span class=n>INFO</span><span class=p>)</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;收到来自：&quot;</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>sock_addr_in</span><span class=p>.</span><span class=n>getIp</span><span class=p>()</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;:&quot;</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>sock_addr_in</span><span class=p>.</span><span class=n>getPort</span><span class=p>()</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;的连接&quot;</span><span class=p>;</span>
</span><span id=__span-14-4>
</span><span id=__span-14-5><span class=w>    </span><span class=c1>// 不对客户端发送的HTTP请求进行处理</span>
</span><span id=__span-14-6>
</span><span id=__span-14-7><span class=w>    </span><span class=c1>// 向客户端发送一个HTTP响应</span>
</span><span id=__span-14-8><span class=w>    </span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=w> </span><span class=n>msg</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;&lt;h1&gt;Hello Linux&lt;/h1&gt;&quot;</span><span class=p>;</span>
</span><span id=__span-14-9><span class=w>    </span><span class=k>const</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=w> </span><span class=n>sep</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;</span><span class=se>\r\n</span><span class=s>&quot;</span><span class=p>;</span>
</span><span id=__span-14-10><span class=w>    </span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=w> </span><span class=n>body</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>msg</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>sep</span><span class=p>;</span>
</span><span id=__span-14-11><span class=w>    </span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=w> </span><span class=n>status_line</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;HTTP/1.1 200 OK&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>sep</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>sep</span><span class=p>;</span>
</span><span id=__span-14-12>
</span><span id=__span-14-13><span class=w>    </span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=w> </span><span class=n>httpResponse</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>status_line</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>body</span><span class=p>;</span>
</span><span id=__span-14-14>
</span><span id=__span-14-15><span class=w>    </span><span class=kt>ssize_t</span><span class=w> </span><span class=n>ret</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>send</span><span class=p>(</span><span class=n>ac_socketfd</span><span class=p>,</span><span class=w> </span><span class=n>httpResponse</span><span class=p>.</span><span class=n>c_str</span><span class=p>(),</span><span class=w> </span><span class=n>httpResponse</span><span class=p>.</span><span class=n>size</span><span class=p>(),</span><span class=w> </span><span class=mi>0</span><span class=p>);</span>
</span><span id=__span-14-16><span class=w>    </span><span class=p>(</span><span class=kt>void</span><span class=p>)</span><span class=n>ret</span><span class=p>;</span>
</span><span id=__span-14-17><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <h3 id=_10>测试<a class=headerlink href=#_10 title="Permanent link">&para;</a></h3> <p>测试代码如下：</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-15-1><span class=cp>#include</span><span class=w> </span><span class=cpf>&quot;HttpServer.hpp&quot;</span>
</span><span id=__span-15-2><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;memory&gt;</span>
</span><span id=__span-15-3>
</span><span id=__span-15-4><span class=k>using</span><span class=w> </span><span class=k>namespace</span><span class=w> </span><span class=nn>HttpServerModule</span><span class=p>;</span>
</span><span id=__span-15-5>
</span><span id=__span-15-6><span class=kt>int</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>argc</span><span class=p>,</span><span class=w> </span><span class=kt>char</span><span class=o>*</span><span class=w> </span><span class=n>argv</span><span class=p>[])</span>
</span><span id=__span-15-7><span class=p>{</span>
</span><span id=__span-15-8><span class=w>    </span><span class=kt>uint16_t</span><span class=w> </span><span class=n>port</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>stoi</span><span class=p>(</span><span class=n>argv</span><span class=p>[</span><span class=mi>1</span><span class=p>]);</span>
</span><span id=__span-15-9>
</span><span id=__span-15-10><span class=w>    </span><span class=n>std</span><span class=o>::</span><span class=n>shared_ptr</span><span class=o>&lt;</span><span class=n>HttpServer</span><span class=o>&gt;</span><span class=w> </span><span class=n>hs</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>make_shared</span><span class=o>&lt;</span><span class=n>HttpServer</span><span class=o>&gt;</span><span class=p>(</span><span class=n>port</span><span class=p>);</span>
</span><span id=__span-15-11>
</span><span id=__span-15-12><span class=w>    </span><span class=n>hs</span><span class=o>-&gt;</span><span class=n>start</span><span class=p>();</span>
</span><span id=__span-15-13>
</span><span id=__span-15-14><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-15-15><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <p>编译运行后打开浏览器输入对应的IP地址和端口号即可看到一个客户端收到的内容：</p> <p><a class=glightbox href="1. 介绍HTTP协议基本结构与基本实现HTTPServer.assets/image-20250313161327667.png" data-type=image data-width=100% data-height=auto data-desc-position=bottom><img src="1. 介绍HTTP协议基本结构与基本实现HTTPServer.assets/image-20250313161327667.png"></a></p> <h3 id=_11>封装发送和接收接口<a class=headerlink href=#_11 title="Permanent link">&para;</a></h3> <p>在上面最后一步：向客户端发送HTTP响应时使用的是底层<code>send</code>接口，既然是底层接口，同样可以考虑对这个接口进行封装，同时也对接收接口进行封装。因此，封装的基本思路为：首先在<code>BaseSocket</code>基类中创建接口和发送两个接口的声明，再在具体实现类<code>TcpSocket</code>中实现这两个接口：</p> <div class="tabbed-set tabbed-alternate" data-tabs=1:2><input checked=checked id=__tabbed_1_1 name=__tabbed_1 type=radio><input id=__tabbed_1_2 name=__tabbed_1 type=radio><div class=tabbed-labels><label for=__tabbed_1_1><code>BaseSocket</code></label><label for=__tabbed_1_2><code>TcpSocket</code></label></div> <div class=tabbed-content> <div class=tabbed-block> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-16-1><span class=c1>// 发送数据</span>
</span><span id=__span-16-2><span class=k>virtual</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>sendData</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=w> </span><span class=o>&amp;</span><span class=n>in_data</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>ac_socketfd</span><span class=p>)</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-16-3><span class=c1>// 接收数据</span>
</span><span id=__span-16-4><span class=k>virtual</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>recvData</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=w> </span><span class=o>&amp;</span><span class=n>out_data</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>ac_socketfd</span><span class=p>)</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span></code></pre></div></td></tr></table></div> </div> <div class=tabbed-block> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-17-1><span class=c1>// 接收数据</span>
</span><span id=__span-17-2><span class=kt>void</span><span class=w> </span><span class=nf>recvData</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=w> </span><span class=o>&amp;</span><span class=n>out_data</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>ac_socketfd</span><span class=p>)</span><span class=w> </span><span class=k>override</span>
</span><span id=__span-17-3><span class=p>{</span>
</span><span id=__span-17-4><span class=w>    </span><span class=kt>char</span><span class=w> </span><span class=n>buffer</span><span class=p>[</span><span class=mi>4096</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=mi>0</span><span class=p>};</span>
</span><span id=__span-17-5><span class=w>    </span><span class=kt>ssize_t</span><span class=w> </span><span class=n>ret</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>recv</span><span class=p>(</span><span class=n>ac_socketfd</span><span class=p>,</span><span class=w> </span><span class=n>buffer</span><span class=p>,</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=n>buffer</span><span class=p>),</span><span class=w> </span><span class=mi>0</span><span class=p>);</span>
</span><span id=__span-17-6><span class=w>    </span><span class=k>if</span><span class=p>(</span><span class=n>ret</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>0</span><span class=p>)</span>
</span><span id=__span-17-7><span class=w>    </span><span class=p>{</span>
</span><span id=__span-17-8><span class=w>        </span><span class=n>out_data</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>buffer</span><span class=p>;</span>
</span><span id=__span-17-9><span class=w>    </span><span class=p>}</span>
</span><span id=__span-17-10><span class=p>}</span>
</span><span id=__span-17-11>
</span><span id=__span-17-12><span class=c1>// 发送数据</span>
</span><span id=__span-17-13><span class=kt>void</span><span class=w> </span><span class=nf>sendData</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=w> </span><span class=o>&amp;</span><span class=n>in_data</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>ac_socketfd</span><span class=p>)</span><span class=w> </span><span class=k>override</span>
</span><span id=__span-17-14><span class=p>{</span>
</span><span id=__span-17-15><span class=w>    </span><span class=kt>ssize_t</span><span class=w> </span><span class=n>ret</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>send</span><span class=p>(</span><span class=n>ac_socketfd</span><span class=p>,</span><span class=w> </span><span class=n>in_data</span><span class=p>.</span><span class=n>c_str</span><span class=p>(),</span><span class=w> </span><span class=n>in_data</span><span class=p>.</span><span class=n>size</span><span class=p>(),</span><span class=w> </span><span class=mi>0</span><span class=p>);</span>
</span><span id=__span-17-16><span class=w>    </span><span class=p>(</span><span class=kt>void</span><span class=p>)</span><span class=n>ret</span><span class=p>;</span>
</span><span id=__span-17-17><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> </div> </div> </div> <p>但是，现在又遇到了第二个问题，因为接收数据接口和发送数据接口都是<code>TcpSocket</code>类中的，而在<code>HttpServer</code>中是<code>TcpServer</code>，无法直接调用到<code>TcpSocket</code>中的接收和发送接口，这里最直接的思路就是在<code>TcpServer</code>中提供一个接口返回底层的<code>TcpSocket</code>类或者其基类对象：</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-18-1><span class=n>socket_ptr</span><span class=w> </span><span class=nf>getSocketPtr</span><span class=p>()</span>
</span><span id=__span-18-2><span class=p>{</span>
</span><span id=__span-18-3><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>_bs</span><span class=p>;</span>
</span><span id=__span-18-4><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <p>此时在上层就可以调用该接口获取到调用对象的指针，对应的整体处理HTTP请求接口实现如下：</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-19-1><span class=kt>void</span><span class=w> </span><span class=nf>handleHttpRequest</span><span class=p>(</span><span class=n>SockAddrIn</span><span class=w> </span><span class=n>sock_addr_in</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>ac_socketfd</span><span class=p>)</span>
</span><span id=__span-19-2><span class=p>{</span>
</span><span id=__span-19-3><span class=w>    </span><span class=n>LOG</span><span class=p>(</span><span class=n>LogLevel</span><span class=o>::</span><span class=n>INFO</span><span class=p>)</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;收到来自：&quot;</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>sock_addr_in</span><span class=p>.</span><span class=n>getIp</span><span class=p>()</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;:&quot;</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>sock_addr_in</span><span class=p>.</span><span class=n>getPort</span><span class=p>()</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;的连接&quot;</span><span class=p>;</span>
</span><span id=__span-19-4>
</span><span id=__span-19-5><span class=w>    </span><span class=c1>// 不对客户端发送的HTTP请求进行处理</span>
</span><span id=__span-19-6>
</span><span id=__span-19-7><span class=w>    </span><span class=c1>// 向客户端发送一个HTTP响应</span>
</span><span id=__span-19-8><span class=w>    </span><span class=c1>// ...</span>
</span><span id=__span-19-9>
</span><span id=__span-19-10><span class=w>    </span><span class=n>std</span><span class=o>::</span><span class=n>shared_ptr</span><span class=o>&lt;</span><span class=n>BaseSocket</span><span class=o>&gt;</span><span class=w> </span><span class=n>bs</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>_tp</span><span class=o>-&gt;</span><span class=n>getSocketPtr</span><span class=p>();</span>
</span><span id=__span-19-11><span class=w>    </span><span class=n>bs</span><span class=o>-&gt;</span><span class=n>sendData</span><span class=p>(</span><span class=n>httpResponse</span><span class=p>,</span><span class=w> </span><span class=n>ac_socketfd</span><span class=p>);</span>
</span><span id=__span-19-12><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <p>再次编译运行后打开浏览器输入对应的IP地址和端口号即可看到一个客户端收到的内容：</p> <p><a class=glightbox href="1. 介绍HTTP协议基本结构与基本实现HTTPServer.assets/image-20250313161327667.png" data-type=image data-width=100% data-height=auto data-desc-position=bottom><img src="1. 介绍HTTP协议基本结构与基本实现HTTPServer.assets/image-20250313161327667.png"></a></p> <h2 id=_12>图表梳理<a class=headerlink href=#_12 title="Permanent link">&para;</a></h2> <h3 id=_13>类间关系<a class=headerlink href=#_13 title="Permanent link">&para;</a></h3> <pre class=mermaid><code>classDiagram
    %% 命名空间声明
    namespace SockAddrInModule {
        class SockAddrIn
    }

    namespace serverSocketModule {
        class BaseSocket
        class TcpSocket
    }

    namespace TcpServerModule {
        class TcpServer
        class data
    }

    namespace HttpServerModule {
        class HttpServer
    }

    %% 类定义
    class SockAddrIn {
        -struct sockaddr_in _s_addr_in
        -std::string _ip
        -uint16_t _port
        -void NetPort2Local()
        -void NetIP2Local()
        +SockAddrIn()
        +SockAddrIn(const struct sockaddr_in&amp;)
        +SockAddrIn(uint16_t port)
        +SockAddrIn(uint16_t port, std::string ip)
        +struct sockaddr* operator&amp;()
        +bool operator==(const SockAddrIn&amp;)
        +socklen_t getLength()
        +std::string getIp()
        +uint16_t getPort()
    }

    class BaseSocket {
        &lt;&lt;abstract&gt;&gt;
        +virtual void createSocket()
        +virtual void toBind()
        +virtual void toListen()
        +virtual int toAccept(SockAddrIn*)
        +virtual void sendData(std::string&amp;, int)
        +virtual void recvData(std::string&amp;, int)
        +void initSocket()
        +virtual ~BaseSocket()
    }

    class TcpSocket {
        -int _listen_socketfd
        -int _ac_socketfd
        -SockAddrIn _s_addr_in
        +TcpSocket(int port = default_port)
        +void createSocket()
        +void toBind()
        +void toListen()
        +int toAccept(SockAddrIn*)
        +void sendData(std::string&amp;, int)
        +void recvData(std::string&amp;, int)
        +~TcpSocket()
    }

    class data {
        +SockAddrIn client
        +int ac_socketfd
        +TcpServer* self
    }

    class TcpServer {
        -std::shared_ptr&lt;BaseSocket&gt; _bs
        -bool _isRunning
        -task_t _handler
        +TcpServer(uint16_t port = default_port)
        +void registerFunc(task_t handler)
        +static void* routine(void* args)
        +void start()
        +base_socket_ptr getSocketPtr()
    }

    class HttpServer {
        -std::shared_ptr&lt;TcpServer&gt; _tp
        +HttpServer(uint16_t port = default_port)
        +void start()
        +void handleHttpRequest(SockAddrIn, int)
    }

    %% 类之间的关系
    BaseSocket &lt;|-- TcpSocket : 继承
    TcpSocket o-- SockAddrIn : 包含
    TcpServer o-- BaseSocket : 包含(智能指针)
    HttpServer o-- TcpServer : 包含(智能指针)
    TcpServer ..&gt; SockAddrIn : 使用
    HttpServer ..&gt; SockAddrIn : 使用
    TcpServer ..&gt; data : 使用</code></pre> <h3 id=_14>执行逻辑<a class=headerlink href=#_14 title="Permanent link">&para;</a></h3> <pre class=mermaid><code>sequenceDiagram
    participant Client
    participant Main as Main程序
    participant HttpServer
    participant TcpServer
    participant TcpSocket
    participant SockAddrIn

    %% 初始化阶段
    Main-&gt;&gt;HttpServer: 创建(port)
    HttpServer-&gt;&gt;TcpServer: 创建(port)
    TcpServer-&gt;&gt;TcpSocket: 创建(port)
    TcpSocket-&gt;&gt;SockAddrIn: 创建(port)
    TcpServer-&gt;&gt;TcpSocket: initSocket()
    TcpSocket-&gt;&gt;TcpSocket: createSocket()
    TcpSocket-&gt;&gt;TcpSocket: toBind()
    TcpSocket-&gt;&gt;SockAddrIn: operator&amp;()
    TcpSocket-&gt;&gt;TcpSocket: toListen()

    %% 服务启动阶段
    Main-&gt;&gt;HttpServer: start()
    HttpServer-&gt;&gt;TcpServer: registerFunc(handleHttpRequest)
    HttpServer-&gt;&gt;TcpServer: start()

    %% 连接处理循环
    loop 服务运行期间
        Client-&gt;&gt;TcpSocket: 发起连接
        TcpServer-&gt;&gt;TcpSocket: toAccept(client)
        TcpSocket--&gt;&gt;TcpServer: 返回ac_socketfd
        TcpServer-&gt;&gt;TcpServer: 创建data结构体
        TcpServer-&gt;&gt;TcpServer: pthread_create(routine, data)

        %% 线程处理请求
        TcpServer-&gt;&gt;HttpServer: handleHttpRequest(client, ac_socketfd)
        HttpServer-&gt;&gt;SockAddrIn: getIp()
        HttpServer-&gt;&gt;SockAddrIn: getPort()
        HttpServer-&gt;&gt;TcpServer: getSocketPtr()
        TcpServer--&gt;&gt;HttpServer: 返回BaseSocket指针

        %% HTTP响应发送
        HttpServer-&gt;&gt;TcpSocket: sendData(httpResponse, ac_socketfd)
        TcpSocket-&gt;&gt;Client: 发送HTTP响应
    end</code></pre> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title=最后更新> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">2025年7月30日</span> </span> </aside> <form class=md-feedback name=feedback hidden> <fieldset> <legend class=md-feedback__title> 页面有帮助吗？ </legend> <div class=md-feedback__inner> <div class=md-feedback__list> <button class="md-feedback__icon md-icon" type=submit title=页面对我有帮助 data-md-value=1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M5 9v12H1V9zm4 12a2 2 0 0 1-2-2V9c0-.55.22-1.05.59-1.41L14.17 1l1.06 1.06c.27.27.44.64.44 1.05l-.03.32L14.69 8H21a2 2 0 0 1 2 2v2c0 .26-.05.5-.14.73l-3.02 7.05C19.54 20.5 18.83 21 18 21zm0-2h9.03L21 12v-2h-8.79l1.13-5.32L9 9.03z"/></svg> </button> <button class="md-feedback__icon md-icon" type=submit title=页面没有帮助到我 data-md-value=0> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 15V3h4v12zM15 3a2 2 0 0 1 2 2v10c0 .55-.22 1.05-.59 1.41L9.83 23l-1.06-1.06c-.27-.27-.44-.64-.44-1.06l.03-.31.95-4.57H3a2 2 0 0 1-2-2v-2c0-.26.05-.5.14-.73l3.02-7.05C4.46 3.5 5.17 3 6 3zm0 2H5.97L3 12v2h8.78l-1.13 5.32L15 14.97z"/></svg> </button> </div> <div class=md-feedback__note> <div data-md-value=1 hidden> 谢谢你的反馈！ </div> <div data-md-value=0 hidden> 谢谢你的反馈！联系<a href=https://www.help-doc.top/author/contact/contact.html>作者</a>提供更详细的信息 </div> </div> </div> </fieldset> </form> <!-- Waline 评论系统 --> <div id=waline></div> <!-- 阅读进度条 - 直接在HTML中定义 --> <div class=reading-progress></div> <!-- 滚动指示器 - 直接在HTML中定义 --> <div class=scroll-indicator></div> <!-- 评论系统 --> <!-- Waline 评论系统 --> <div id=waline></div> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <!--
  Copyright (c) 2016-2024 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
--> <!-- Footer --> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2024-2025 柯懒不是柯南 </div> </div> <div class="md-footer-love md-typeset"> 一闪一闪亮晶晶，不及<span class=love-highlight>小亮</span><span class=love-heart>♥</span>照我心。To Li Liang </div> <div class=md-social> <a href=https://github.com/H0308 target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> <a href=https://www.help-doc.top/author/contact/contact.html target=_blank rel=noopener title=www.help-doc.top class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M433.754 420.445c-11.526 1.393-44.86-52.741-44.86-52.741 0 31.345-16.136 72.247-51.051 101.786 16.842 5.192 54.843 19.167 45.803 34.421-7.316 12.343-125.51 7.881-159.632 4.037-34.122 3.844-152.316 8.306-159.632-4.037-9.045-15.25 28.918-29.214 45.783-34.415-34.92-29.539-51.059-70.445-51.059-101.792 0 0-33.334 54.134-44.859 52.741-5.37-.65-12.424-29.644 9.347-99.704 10.261-33.024 21.995-60.478 40.144-105.779C60.683 98.063 108.982.006 224 0c113.737.006 163.156 96.133 160.264 214.963 18.118 45.223 29.912 72.85 40.144 105.778 21.768 70.06 14.716 99.053 9.346 99.704"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": ["navigation.indexes", "navigation.prune", "navigation.tabs", "search.highlight", "content.code.copy"], "search": "../../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script> <script src=../../../assets/javascripts/bundle.c8b220af.min.js></script> <script src=../../../javascripts/katex.min.js></script> <script src=../../../javascripts/other.min.js></script> <script src=../../../javascripts/copyright.min.js></script> <script src=https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.js></script> <script src=https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/contrib/auto-render.min.js></script> <script src=../../../assets/javascripts/toggle-sidebar.js async></script> <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body> </html>