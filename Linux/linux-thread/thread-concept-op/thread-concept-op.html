<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=canonical href=https://www.help-doc.top/Linux/linux-thread/thread-concept-op/thread-concept-op.html><link rel=prev href=../../signals-os-principles/signals-os-principles.html><link rel=next href=../thread-lib/thread-lib.html><link rel=icon href=../../../images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.12"><title>Linux线程概念与线程操作 - 柯懒的知识库</title><link rel=stylesheet href=../../../assets/stylesheets/main.2afb09e1.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.06af60db.min.css><link rel=stylesheet href=../../../css/timeline.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.css><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-9XWRGNRRSY"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-9XWRGNRRSY",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-9XWRGNRRSY",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script><link rel=stylesheet href=../../../stylesheets/colors.min.css><link rel=stylesheet href=../../../stylesheets/theme2.min.css media="screen and (max-width: 1199px)"><link rel=stylesheet href=../../../stylesheets/theme2.min.css media="screen and (min-width: 1200px)" id=theme2-desktop><link rel=stylesheet href=../../../stylesheets/theme1.min.css media="screen and (min-width: 1200px)" id=theme1-desktop><link rel=stylesheet href=../../../stylesheets/print.min.css><link rel=stylesheet href=../../../stylesheets/font-dongguanti.min.css id=font-dongguanti><link rel=stylesheet href=../../../stylesheets/font-oppoti.min.css id=font-oppoti disabled><link rel=stylesheet href=../../../stylesheets/font-jiangchengti.min.css id=font-jiangchengti disabled><link rel=stylesheet href=../../../stylesheets/font-lxgw.min.css id=font-lxgw disabled><link rel=stylesheet href=../../../stylesheets/code-font-dejavu-sans-mono.min.css id=code-font-dejavu-sans-mono><link rel=stylesheet href=../../../stylesheets/code-font-zsft-hk.min.css id=code-font-zsft-hk disabled><link rel=stylesheet href=../../../stylesheets/code-font-google-sans-code.min.css id=code-font-google-sans-code disabled><link rel=stylesheet href=https://unpkg.com/@waline/client@v3/dist/waline.css><link rel=stylesheet href=../../../stylesheets/waline.min.css><script src=../../../javascripts/start.min.js></script><script defer src=https://cloud.umami.is/script.js data-website-id=02f9b8b7-93d4-4026-bdd8-221f2fcea2cf></script> <link href="../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../../assets/javascripts/glightbox.min.js"></script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=white data-md-color-accent=cyan> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#linux class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=页眉> <a href=../../../index.html title=柯懒的知识库 class="md-header__button md-logo" aria-label=柯懒的知识库 data-md-component=logo> <img src=../../../assets/logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> 柯懒的知识库 </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Linux线程概念与线程操作 </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=white data-md-color-accent=cyan aria-label type=radio name=__palette id=__palette_1> </form> <div class=header-avatar> <img src=../../../author/作者.assets/20250206-200653.jpg alt=头像> <div class=avatar-dropdown> <p><strong>柯懒不是柯南</strong></p> <a href=../../../author/contact/contact.html class=avatar-dropdown-item>联系作者</a> <div class=avatar-dropdown-divider></div> <a href=../../../author/about/about.html class=avatar-dropdown-item>关于作者</a> <div class=avatar-dropdown-divider></div> <a href=https://github.com/H0308 class=avatar-dropdown-item>Github仓库</a> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=查找> <button type=reset class="md-search__icon md-icon" title=清空当前内容 aria-label=清空当前内容 tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 正在初始化搜索引擎 </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> </nav> </header> <div class=toolbar-toggle-btn id=toolbarToggleBtn onclick=toggleToolbar()> <div class=toggle-icon> <svg class=toggle-arrow-icon viewbox="0 0 1024 1024" version=1.1 xmlns=http://www.w3.org/2000/svg width=16 height=16> <path d="M346.538667 1024L170.666667 853.333333l341.333333-341.333333-341.333333-341.333333 175.872-170.666667L853.333333 512z" fill=currentColor></path> </svg> </div> </div> <div class=floating-toolbar id=floatingToolbar> <div class="toolbar-item font-switcher"> <div class=toolbar-icon> <svg class=font-icon viewbox="0 0 1024 1024" version=1.1 xmlns=http://www.w3.org/2000/svg width=20 height=20> <path d="M913.408 1024l-66.56 0q-29.696 0-51.2-5.12t-36.864-15.872-26.112-27.136-19.968-37.888q-15.36-38.912-28.16-70.656t-22.016-55.296q-11.264-26.624-20.48-49.152l-254.976 0q-7.168 23.552-17.408 51.2-8.192 23.552-21.504 56.832t-30.72 72.192q-20.48 46.08-47.104 63.488t-60.416 17.408l-70.656 0q-45.056 0-60.928-19.968t2.56-68.096q18.432-46.08 43.008-108.544t52.224-132.608 57.344-143.872 57.344-144.384q65.536-164.864 137.216-343.04 7.168-17.408 18.432-31.744 10.24-11.264 27.136-21.504t42.496-10.24q26.624 0 43.52 10.752t28.16 24.064q12.288 15.36 19.456 33.792 72.704 180.224 138.24 345.088 27.648 70.656 57.344 143.872t56.832 142.336 51.2 129.536 41.472 104.448q14.336 34.816 4.096 62.464t-43.008 27.648zM616.448 634.88l-97.28-347.136-1.024 0-108.544 347.136 206.848 0z" fill=currentColor></path> </svg> </div> <div class=toolbar-label>内容字体</div> <div class=font-dropdown-toolbar> <div class=font-current-toolbar onclick=toggleFontDropdownToolbar()> <span class=current-font-name-toolbar>东观体</span> <svg class=dropdown-arrow-icon viewbox="0 0 1024 1024" version=1.1 xmlns=http://www.w3.org/2000/svg width=12 height=12> <path d="M878.592 250.88q29.696 0 48.128 11.264t24.576 29.696 0 41.472-26.624 45.568q-82.944 92.16-159.744 180.224t-148.48 164.864q-19.456 20.48-45.568 31.744t-53.76 11.776-53.248-8.704-43.008-28.672q-39.936-44.032-82.944-90.112l-88.064-92.16q-43.008-46.08-85.504-90.624t-79.36-86.528q-17.408-19.456-22.528-40.448t1.024-38.4 23.552-28.672 45.056-11.264q35.84 0 98.816-0.512t137.728-0.512l153.6 0 150.528 0 125.952 0 79.872 0z" fill=currentColor></path> </svg> </div> <div class=font-options-toolbar> <div class=font-option-toolbar data-font=dongguanti onclick="selectFontToolbar('dongguanti')">上图东观体 </div> <div class=font-option-toolbar data-font=oppoti onclick="selectFontToolbar('oppoti')">OPPO Sans </div> <div class=font-option-toolbar data-font=jiangchengti onclick="selectFontToolbar('jiangchengti')"> 江城黑体</div> <div class=font-option-toolbar data-font=lxgw onclick="selectFontToolbar('lxgw')">霞鹜臻楷</div> </div> </div> </div> <div class="toolbar-item code-font-switcher"> <div class=toolbar-icon> <svg t=1753672111433 class="icon code-font-icon" viewbox="0 0 1024 1024" version=1.1 xmlns=http://www.w3.org/2000/svg p-id=5148 width=20 height=20> <path d="M941.709938 0H82.290062A82.290062 82.290062 0 0 0 0 82.290062v859.419876A82.290062 82.290062 0 0 0 82.290062 1022.53923h859.419876A82.290062 82.290062 0 0 0 1022.53923 941.709938V82.290062A82.290062 82.290062 0 0 0 941.709938 0zM188.439372 553.631954a40.901569 40.901569 0 0 1-29.215406-70.116975L292.154066 351.558726 159.223966 218.628626a40.901569 40.901569 0 0 1 58.430813-57.94389l160.197813 162.145507a40.901569 40.901569 0 0 1 0 57.943889l-160.197813 160.684736a40.901569 40.901569 0 0 1-29.215407 12.173086z m443.587257 0H405.120304a40.901569 40.901569 0 0 1 0-82.290061H633.000476a40.901569 40.901569 0 0 1 0 82.290061z" fill=currentColor p-id=5149></path> </svg> </div> <div class=toolbar-label>代码字体</div> <div class=code-font-dropdown-toolbar> <div class=code-font-current-toolbar onclick=toggleCodeFontDropdownToolbar()> <span class=current-code-font-name-toolbar>DejaVu Sans Mono</span> <svg class=dropdown-arrow-icon viewbox="0 0 1024 1024" version=1.1 xmlns=http://www.w3.org/2000/svg width=12 height=12> <path d="M878.592 250.88q29.696 0 48.128 11.264t24.576 29.696 0 41.472-26.624 45.568q-82.944 92.16-159.744 180.224t-148.48 164.864q-19.456 20.48-45.568 31.744t-53.76 11.776-53.248-8.704-43.008-28.672q-39.936-44.032-82.944-90.112l-88.064-92.16q-43.008-46.08-85.504-90.624t-79.36-86.528q-17.408-19.456-22.528-40.448t1.024-38.4 23.552-28.672 45.056-11.264q35.84 0 98.816-0.512t137.728-0.512l153.6 0 150.528 0 125.952 0 79.872 0z" fill=currentColor></path> </svg> </div> <div class=code-font-options-toolbar> <div class=code-font-option-toolbar data-code-font=dejavu onclick="selectCodeFontToolbar('dejavu')"> DejaVu Sans Mono</div> <div class=code-font-option-toolbar data-code-font=google-sans-code onclick="selectCodeFontToolbar('google-sans-code')"> Google Sans Code</div> <div class=code-font-option-toolbar data-code-font=zsft onclick="selectCodeFontToolbar('zsft')"> JetBrains Mono</div> </div> </div> </div> <div class="toolbar-item theme-switcher" onclick=switchTheme()> <div class=toolbar-icon> <svg class=theme-icon viewbox="0 0 1024 1024" version=1.1 xmlns=http://www.w3.org/2000/svg width=20 height=20> <path d="M876.572788 522.301623c-1.886977 12.375865-9.657964 30.331819-35.880185 45.48903-56.489572 32.697703-150.21828 83.990926-174.010149 96.958262-13.143345 24.431435-66.067718 122.221646-98.141204 178.503487-16.117073 28.124548-36.055171 34.041304-50.030463 34.041304-0.031722 0-0.031722 0-0.031722 0-14.613836 0-29.1806-6.460132-43.234687-19.218714-47.183626-42.643216-125.994576-117.105115-146.013515-136.083351-27.757181-4.732791-138.338718-23.743774-200.584388-35.752272-17.924231-3.533476-32.649608-14.07046-40.372499-29.084409-5.78782-11.256368-10.281157-30.05962 1.471514-55.658647 26.989701-59.047838 74.126254-157.557432 85.957721-182.196599-3.437286-27.117614-16.996093-135.060045-23.760147-198.905142-1.886977-17.460674 3.901867-35.096333 15.829524-48.351218 12.791327-14.278191 30.667463-21.48943 49.854455-19.426445 63.669088 6.332219 173.259042 19.426445 200.584388 22.705118 24.335245-11.879562 121.085776-58.936297 180.133613-86.34146 9.91379-4.573155 19.85828-6.92369 29.596062-6.92369 28.748764 0 52.172243 20.642133 58.328453 51.421136 12.599969 62.997799 30.93864 166.70272 35.639708 193.484689 18.851347 19.682271 91.953272 96.031147 135.060045 143.07151C872.72004 487.125473 879.307062 504.71406 876.572788 522.301623L876.572788 522.301623zM825.375755 499.085876C776.017604 445.314205 687.245791 352.977193 686.365748 352.017332c-2.942005-3.069919-4.956895-6.971785-5.676279-11.208273-0.207731-1.215688-22.193465-127.001509-36.551474-198.936865-0.799202-3.917216-4.285606-16.836457-16.196891-16.836457-3.453658 0-7.30743 1.006933-11.464099 2.942005-67.282383 31.179117-183.955662 88.180342-185.170327 88.771813-3.693112 1.790786-7.850805 2.558265-11.975752 2.01489-1.295506-0.224104-133.63765-16.165168-205.988468-23.424502-0.079818 0-0.207731 0-0.287549 0-7.30743 0-11.128455 2.89391-13.319353 5.40408-3.677762 4.124947-5.644557 9.91379-5.068436 15.110139 7.674796 72.623018 24.255427 202.934922 24.463158 204.325595 0.511653 4.109598-0.159636 8.266267-1.966795 11.960403-0.591471 1.215688-57.657164 120.04712-88.339977 187.201589-3.565199 7.754614-4.41352 14.214746-2.350534 18.131963 1.935072 3.725858 6.588045 5.820566 10.360975 6.53995 70.719668 13.718443 204.644867 36.519752 206.036563 36.727483 4.189416 0.671289 8.058536 2.686179 11.112082 5.580089 1.006933 0.87902 96.414887 91.281983 150.090367 139.889027 8.314363 7.563256 13.143345 8.106632 14.437827 8.106632 3.485381 0 8.314363-4.621251 12.727882-12.391215 36.343743-63.828724 100.011808-181.988868 100.636025-183.155437 1.983167-3.64604 5.004991-6.667863 8.650007-8.650007 1.134847-0.671289 114.418936-62.373583 178.6314-99.516528 8.698103-5.036713 14.278191-10.568706 14.94948-14.854313C834.681702 511.845481 831.49922 505.800811 825.375755 499.085876L825.375755 499.085876zM935.333076 935.670256c-4.157693 4.157693-9.689686 6.299473-15.141862 6.299473-5.548366 0-11.048637-2.142803-15.238053-6.299473l-171.915441-171.915441c-8.362458-8.394181-8.362458-21.98471 0-30.426987 8.394181-8.394181 21.98471-8.394181 30.379914 0l171.915441 171.915441C943.727257 913.684522 943.727257 927.275052 935.333076 935.670256L935.333076 935.670256z" fill=currentColor></path> </svg> </div> <div class=toolbar-label>主题切换</div> </div> <div class="toolbar-item back-to-top" onclick=scrollToTop()> <div class=toolbar-icon> <svg class=back-to-top-icon viewbox="0 0 1024 1024" xmlns=http://www.w3.org/2000/svg> <path d="M882.688 624.128l-336.896-583.68c-15.872-27.136-54.784-27.136-70.656 0L138.24 624.128c-15.872 27.136 4.096 61.44 35.328 61.44H317.44c22.528 0 40.96 18.432 40.96 40.96v239.616c0 22.528 18.432 40.96 40.96 40.96h223.232c22.528 0 40.96-18.432 40.96-40.96v-239.616c0-22.528 18.432-40.96 40.96-40.96h143.872c30.208 0 50.176-34.304 34.304-61.44z"> </path> </svg> </div> <div class=toolbar-label>返回顶部</div> </div> </div> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=标签 data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../../index.html class=md-tabs__link> 主页 </a> </li> <li class=md-tabs__item> <a href=../../../timeline/timeline.html class=md-tabs__link> 网站时间线 </a> </li> <li class=md-tabs__item> <a href=../../../languages/index.html class=md-tabs__link> 编程语言 </a> </li> <li class=md-tabs__item> <a href=../../../data-structure-algo/index.html class=md-tabs__link> 数据结构与算法 </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../../index.html class=md-tabs__link> Linux </a> </li> <li class=md-tabs__item> <a href=../../../front-end/index.html class=md-tabs__link> 前端 </a> </li> <li class=md-tabs__item> <a href=../../../MySQL/index.html class=md-tabs__link> MySQL </a> </li> <li class=md-tabs__item> <a href=../../../JavaEE/index.html class=md-tabs__link> JavaEE应用开发 </a> </li> <li class=md-tabs__item> <a href=../../../software-test/index.html class=md-tabs__link> 软件测试 </a> </li> <li class=md-tabs__item> <a href=../../../other/index.html class=md-tabs__link> 扩展知识 </a> </li> <li class=md-tabs__item> <a href=../../../tooltips/index.html class=md-tabs__link> 工具帮助 </a> </li> <li class=md-tabs__item> <a href=../../../test-encrypt/test-encrypt.html class=md-tabs__link> 测试加密功能 </a> </li> <li class=md-tabs__item> <a href=../../../projects/index.html class=md-tabs__link> 项目 </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=导航栏 data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../../index.html title=柯懒的知识库 class="md-nav__button md-logo" aria-label=柯懒的知识库 data-md-component=logo> <img src=../../../assets/logo.png alt=logo> </a> 柯懒的知识库 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../index.html class=md-nav__link> <span class=md-ellipsis> 主页 </span> </a> </li> <li class=md-nav__item> <a href=../../../timeline/timeline.html class=md-nav__link> <span class=md-ellipsis> 网站时间线 </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../languages/index.html class=md-nav__link> <span class=md-ellipsis> 编程语言 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../data-structure-algo/index.html class=md-nav__link> <span class=md-ellipsis> 数据结构与算法 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5 checked> <div class="md-nav__link md-nav__container"> <a href=../../index.html class="md-nav__link "> <span class=md-ellipsis> Linux </span> </a> <label class="md-nav__link " for=__nav_5 id=__nav_5_label tabindex> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=true> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Linux </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../options-commands/options-commands.html class=md-nav__link> <span class=md-ellipsis> Linux常用选项和指令 </span> </a> </li> <li class=md-nav__item> <a href=../../permission/permission.html class=md-nav__link> <span class=md-ellipsis> Linux权限相关 </span> </a> </li> <li class=md-nav__item> <a href=../../software-installation/software-installation.html class=md-nav__link> <span class=md-ellipsis> CentOS软件安装 </span> </a> </li> <li class=md-nav__item> <a href=../../gcc-gdb/gcc-gdb.html class=md-nav__link> <span class=md-ellipsis> Linux下的gcc与gdb </span> </a> </li> <li class=md-nav__item> <a href=../../makefile-progress-bar/makefile-progress-bar.html class=md-nav__link> <span class=md-ellipsis> Linux下的Makefile与进度条程序 </span> </a> </li> <li class=md-nav__item> <a href=../../os-basic/os-basic.html class=md-nav__link> <span class=md-ellipsis> 操作系统基础知识 </span> </a> </li> <li class=md-nav__item> <a href=../../process-basic/process-basic.html class=md-nav__link> <span class=md-ellipsis> Linux进程基础 </span> </a> </li> <li class=md-nav__item> <a href=../../process-state-priority/process-state-priority.html class=md-nav__link> <span class=md-ellipsis> Linux进程状态与进程优先级 </span> </a> </li> <li class=md-nav__item> <a href=../../process-switch-scheduling/process-switch-scheduling.html class=md-nav__link> <span class=md-ellipsis> Linux进程切换以及调度算法 </span> </a> </li> <li class=md-nav__item> <a href=../../command-line-env/command-line-env.html class=md-nav__link> <span class=md-ellipsis> Linux命令行与环境变量 </span> </a> </li> <li class=md-nav__item> <a href=../../process-address-space/process-address-space.html class=md-nav__link> <span class=md-ellipsis> Linux进程地址空间 </span> </a> </li> <li class=md-nav__item> <a href=../../process-control/process-control.html class=md-nav__link> <span class=md-ellipsis> Linux进程控制 </span> </a> </li> <li class=md-nav__item> <a href=../../linux-fileop/linux-fileop.html class=md-nav__link> <span class=md-ellipsis> Linux文件操作基础 </span> </a> </li> <li class=md-nav__item> <a href=../../io-process/io-process.html class=md-nav__link> <span class=md-ellipsis> Linux中输入和输出基本过程 </span> </a> </li> <li class=md-nav__item> <a href=../../file-system/file-system.html class=md-nav__link> <span class=md-ellipsis> Linux文件系统 </span> </a> </li> <li class=md-nav__item> <a href=../../soft-hard-link/soft-hard-link.html class=md-nav__link> <span class=md-ellipsis> Linux软链接和硬链接 </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../com-process/com-anonymous-pipe/com-anonymous-pipe.html class=md-nav__link> <span class=md-ellipsis> Linux进程间通信 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class=md-nav__item> <a href=../../signals-os-principles/signals-os-principles.html class=md-nav__link> <span class=md-ellipsis> Linux信号与操作系统原理 </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_20 checked> <label class=md-nav__link for=__nav_5_20 id=__nav_5_20_label tabindex=0> <span class=md-ellipsis> Linux线程 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_20_label aria-expanded=true> <label class=md-nav__title for=__nav_5_20> <span class="md-nav__icon md-icon"></span> Linux线程 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Linux线程概念与线程操作 </span> <span class="md-nav__icon md-icon"></span> </label> <a href=thread-concept-op.html class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Linux线程概念与线程操作 </span> </a> <nav class="md-nav md-nav--secondary" aria-label=本节目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 本节目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#_1 class=md-nav__link> <span class=md-ellipsis> 线程概念 </span> </a> <nav class=md-nav aria-label=线程概念> <ul class=md-nav__list> <li class=md-nav__item> <a href=#linux_1 class=md-nav__link> <span class=md-ellipsis> Linux线程的设计 </span> </a> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> <span class=md-ellipsis> 理解页表与虚拟地址到物理地址转换 </span> </a> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> <span class=md-ellipsis> 理解页表标志位 </span> </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> <span class=md-ellipsis> 细致理解缺页中断 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> <span class=md-ellipsis> 线程的优点和缺点 </span> </a> </li> <li class=md-nav__item> <a href=#_6 class=md-nav__link> <span class=md-ellipsis> 线程独有和共有的数据 </span> </a> </li> <li class=md-nav__item> <a href=#_7 class=md-nav__link> <span class=md-ellipsis> 线程操作 </span> </a> <nav class=md-nav aria-label=线程操作> <ul class=md-nav__list> <li class=md-nav__item> <a href=#id class=md-nav__link> <span class=md-ellipsis> 创建线程与获取线程id </span> </a> <nav class=md-nav aria-label=创建线程与获取线程id> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_8 class=md-nav__link> <span class=md-ellipsis> 基本使用 </span> </a> </li> <li class=md-nav__item> <a href=#_9 class=md-nav__link> <span class=md-ellipsis> 理解资源划分 </span> </a> </li> <li class=md-nav__item> <a href=#_10 class=md-nav__link> <span class=md-ellipsis> 线程瓜分进程资源 </span> </a> </li> <li class=md-nav__item> <a href=#id_1 class=md-nav__link> <span class=md-ellipsis> 查看轻量级进程状态与其id </span> </a> </li> <li class=md-nav__item> <a href=#_11 class=md-nav__link> <span class=md-ellipsis> 创建多线程并且访问同一个函数中的局部变量 </span> </a> </li> <li class=md-nav__item> <a href=#_12 class=md-nav__link> <span class=md-ellipsis> 创建多线程并且访问同一个全局变量 </span> </a> </li> <li class=md-nav__item> <a href=#_13 class=md-nav__link> <span class=md-ellipsis> 线程局部存储 </span> </a> </li> <li class=md-nav__item> <a href=#_14 class=md-nav__link> <span class=md-ellipsis> 理解栈独立和堆共享 </span> </a> </li> <li class=md-nav__item> <a href=#_15 class=md-nav__link> <span class=md-ellipsis> 信号问题 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_16 class=md-nav__link> <span class=md-ellipsis> 线程等待与回收 </span> </a> </li> <li class=md-nav__item> <a href=#_17 class=md-nav__link> <span class=md-ellipsis> 线程退出 </span> </a> </li> <li class=md-nav__item> <a href=#_18 class=md-nav__link> <span class=md-ellipsis> 线程分离 </span> </a> </li> <li class=md-nav__item> <a href=#_19 class=md-nav__link> <span class=md-ellipsis> 线程程序替换 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#c class=md-nav__link> <span class=md-ellipsis> C++中的线程操作 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../thread-lib/thread-lib.html class=md-nav__link> <span class=md-ellipsis> Linux线程库与线程库封装 </span> </a> </li> <li class=md-nav__item> <a href=../thread-sync/thread-sync.html class=md-nav__link> <span class=md-ellipsis> Linux线程互斥与同步 </span> </a> </li> <li class=md-nav__item> <a href=../thread-semaphore/thread-semaphore.html class=md-nav__link> <span class=md-ellipsis> Linux线程与信号量 </span> </a> </li> <li class=md-nav__item> <a href=../thread-pc/thread-pc.html class=md-nav__link> <span class=md-ellipsis> 生产者消费者模型（Producer-Consumer Model） </span> </a> </li> <li class=md-nav__item> <a href=../log/log.html class=md-nav__link> <span class=md-ellipsis> 日志系统 </span> </a> </li> <li class=md-nav__item> <a href=../thread-safe-deadlock/thread-safe-deadlock.html class=md-nav__link> <span class=md-ellipsis> Linux线程安全与死锁 </span> </a> </li> <li class=md-nav__item> <a href=../thread-pool/thread-pool.html class=md-nav__link> <span class=md-ellipsis> Linux线程池 </span> </a> </li> <li class=md-nav__item> <a href=../thread-rw/thread-rw.html class=md-nav__link> <span class=md-ellipsis> 读者写者问题与读写锁 </span> </a> </li> <li class=md-nav__item> <a href=../thread-spin/thread-spin.html class=md-nav__link> <span class=md-ellipsis> 自旋锁 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../net-basic/net-basic.html class=md-nav__link> <span class=md-ellipsis> 网络基础知识 </span> </a> </li> <li class=md-nav__item> <a href=../../socket-basic/socket-basic.html class=md-nav__link> <span class=md-ellipsis> Socket编程基础 </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../udp/udp-basic/udp-basic.html class=md-nav__link> <span class=md-ellipsis> UDP编程 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class=md-nav__item> <a href=../../tcp-basic/tcp-basic.html class=md-nav__link> <span class=md-ellipsis> TCP编程接口基本使用 </span> </a> </li> <li class=md-nav__item> <a href=../../serialization-net-cal/serialization-net-cal.html class=md-nav__link> <span class=md-ellipsis> 序列化和反序列化与网络计算器 </span> </a> </li> <li class=md-nav__item> <a href=../../process-relationship-daemon/process-relationship-daemon.html class=md-nav__link> <span class=md-ellipsis> 进程间关系和守护进程 </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../http/http-basic-httpserver/http-basic-httpserver.html class=md-nav__link> <span class=md-ellipsis> 应用层协议HTTP </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class=md-nav__item> <a href=../../udp-principles/udp-principles.html class=md-nav__link> <span class=md-ellipsis> UDP协议原理 </span> </a> </li> <li class=md-nav__item> <a href=../../tcp-principles/tcp-principles.html class=md-nav__link> <span class=md-ellipsis> TCP协议原理 </span> </a> </li> <li class=md-nav__item> <a href=../../tcp-connection-backlog/tcp-connection-backlog.html class=md-nav__link> <span class=md-ellipsis> 理解Linux如何看待连接以及TCP全连接队列 </span> </a> </li> <li class=md-nav__item> <a href=../../ip/ip.html class=md-nav__link> <span class=md-ellipsis> 网络层IP协议 </span> </a> </li> <li class=md-nav__item> <a href=../../datalink/datalink.html class=md-nav__link> <span class=md-ellipsis> 数据链路层协议 </span> </a> </li> <li class=md-nav__item> <a href=../../dns-icmp/dns-icmp.html class=md-nav__link> <span class=md-ellipsis> DNS与ICMP </span> </a> </li> <li class=md-nav__item> <a href=../../nat-proxy/nat-proxy.html class=md-nav__link> <span class=md-ellipsis> NAT技术、代理服务器和内网穿透 </span> </a> </li> <li class=md-nav__item> <a href=../../io-model-select-poll/io-model-select-poll.html class=md-nav__link> <span class=md-ellipsis> 五种IO模型与select和poll分别实现多路转接 </span> </a> </li> <li class=md-nav__item> <a href=../../epoll/epoll.html class=md-nav__link> <span class=md-ellipsis> epoll实现多路转接 </span> </a> </li> <li class=md-nav__item> <a href=../../reactor-et/reactor-et.html class=md-nav__link> <span class=md-ellipsis> Reactor模式与完善基于边缘触发模式epoll实现TCP服务器 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../front-end/index.html class=md-nav__link> <span class=md-ellipsis> 前端 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../MySQL/index.html class=md-nav__link> <span class=md-ellipsis> MySQL </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../JavaEE/index.html class=md-nav__link> <span class=md-ellipsis> JavaEE应用开发 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../software-test/index.html class=md-nav__link> <span class=md-ellipsis> 软件测试 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../other/index.html class=md-nav__link> <span class=md-ellipsis> 扩展知识 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../tooltips/index.html class=md-nav__link> <span class=md-ellipsis> 工具帮助 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../test-encrypt/test-encrypt.html class=md-nav__link> <span class=md-ellipsis> 测试加密功能 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../projects/index.html class=md-nav__link> <span class=md-ellipsis> 项目 </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=本节目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 本节目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#_1 class=md-nav__link> <span class=md-ellipsis> 线程概念 </span> </a> <nav class=md-nav aria-label=线程概念> <ul class=md-nav__list> <li class=md-nav__item> <a href=#linux_1 class=md-nav__link> <span class=md-ellipsis> Linux线程的设计 </span> </a> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> <span class=md-ellipsis> 理解页表与虚拟地址到物理地址转换 </span> </a> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> <span class=md-ellipsis> 理解页表标志位 </span> </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> <span class=md-ellipsis> 细致理解缺页中断 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> <span class=md-ellipsis> 线程的优点和缺点 </span> </a> </li> <li class=md-nav__item> <a href=#_6 class=md-nav__link> <span class=md-ellipsis> 线程独有和共有的数据 </span> </a> </li> <li class=md-nav__item> <a href=#_7 class=md-nav__link> <span class=md-ellipsis> 线程操作 </span> </a> <nav class=md-nav aria-label=线程操作> <ul class=md-nav__list> <li class=md-nav__item> <a href=#id class=md-nav__link> <span class=md-ellipsis> 创建线程与获取线程id </span> </a> <nav class=md-nav aria-label=创建线程与获取线程id> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_8 class=md-nav__link> <span class=md-ellipsis> 基本使用 </span> </a> </li> <li class=md-nav__item> <a href=#_9 class=md-nav__link> <span class=md-ellipsis> 理解资源划分 </span> </a> </li> <li class=md-nav__item> <a href=#_10 class=md-nav__link> <span class=md-ellipsis> 线程瓜分进程资源 </span> </a> </li> <li class=md-nav__item> <a href=#id_1 class=md-nav__link> <span class=md-ellipsis> 查看轻量级进程状态与其id </span> </a> </li> <li class=md-nav__item> <a href=#_11 class=md-nav__link> <span class=md-ellipsis> 创建多线程并且访问同一个函数中的局部变量 </span> </a> </li> <li class=md-nav__item> <a href=#_12 class=md-nav__link> <span class=md-ellipsis> 创建多线程并且访问同一个全局变量 </span> </a> </li> <li class=md-nav__item> <a href=#_13 class=md-nav__link> <span class=md-ellipsis> 线程局部存储 </span> </a> </li> <li class=md-nav__item> <a href=#_14 class=md-nav__link> <span class=md-ellipsis> 理解栈独立和堆共享 </span> </a> </li> <li class=md-nav__item> <a href=#_15 class=md-nav__link> <span class=md-ellipsis> 信号问题 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_16 class=md-nav__link> <span class=md-ellipsis> 线程等待与回收 </span> </a> </li> <li class=md-nav__item> <a href=#_17 class=md-nav__link> <span class=md-ellipsis> 线程退出 </span> </a> </li> <li class=md-nav__item> <a href=#_18 class=md-nav__link> <span class=md-ellipsis> 线程分离 </span> </a> </li> <li class=md-nav__item> <a href=#_19 class=md-nav__link> <span class=md-ellipsis> 线程程序替换 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#c class=md-nav__link> <span class=md-ellipsis> C++中的线程操作 </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=linux>Linux线程概念与线程操作<a class=headerlink href=#linux title="Permanent link">&para;</a></h1> <div style="margin-top: -30px; font-size: 0.75em; opacity: 0.7;"> <p><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10h-2a8 8 0 0 1-8 8 8 8 0 0 1-8-8 8 8 0 0 1 8-8zm6.78 1a.7.7 0 0 0-.48.2l-1.22 1.21 2.5 2.5L20.8 5.7c.26-.26.26-.7 0-.95L19.25 3.2c-.13-.13-.3-.2-.47-.2m-2.41 2.12L9 12.5V15h2.5l7.37-7.38z"/></svg></span> 约 7894 个字 <span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M392.8 1.2c-17-4.9-34.7 5-39.6 22l-128 448c-4.9 17 5 34.7 22 39.6s34.7-5 39.6-22l128-448c4.9-17-5-34.7-22-39.6m80.6 120.1c-12.5 12.5-12.5 32.8 0 45.3l89.3 89.4-89.4 89.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l112-112c12.5-12.5 12.5-32.8 0-45.3l-112-112c-12.5-12.5-32.8-12.5-45.3 0zm-306.7 0c-12.5-12.5-32.8-12.5-45.3 0l-112 112c-12.5 12.5-12.5 32.8 0 45.3l112 112c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256l89.4-89.4c12.5-12.5 12.5-32.8 0-45.3"/></svg></span> 205 行代码 <span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 17H7V3h14m0-2H7a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2M3 5H1v16a2 2 0 0 0 2 2h16v-2H3m12.96-10.71-2.75 3.54-1.96-2.36L8.5 15h11z"/></svg></span> 11 张图片 <span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 20c4.42 0 8-3.58 8-8s-3.58-8-8-8-8 3.58-8 8 3.58 8 8 8m0-18c5.5 0 10 4.5 10 10s-4.5 10-10 10C6.47 22 2 17.5 2 12S6.5 2 12 2m.5 11H11V7h1.5v4.26l3.7-2.13.75 1.3z"/></svg></span> 预计阅读时间 29 分钟</p> </div> <h2 id=_1>线程概念<a class=headerlink href=#_1 title="Permanent link">&para;</a></h2> <p>前面提到<a href=https://www.help-doc.top/Linux/process-basic/process-basic.html#_1>进程=程序代码和数据+进程结构体</a>，在线程部分就需要进一步更新之前的认识</p> <p>进程实际上承担分配系统资源的基本实体，而线程是进程中的一个执行分支，是操作系统调度的基本单位</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>此处需要注意，操作系统并不是直接调用进程，而是调用线程，所以进程并不是操作系统调度的基本单位</p> </div> <h3 id=linux_1>Linux线程的设计<a class=headerlink href=#linux_1 title="Permanent link">&para;</a></h3> <p>要想更清楚地理解进程就必须深入到一个具体的操作系统中学习，在Linux中，实际上并没有所谓的线程，因为如果存在线程，那么操作系统必定要对线程进行管理，对应的线程也就需要属于自己的结构和调度方案，但是因为线程本质是进程中的一个执行分支（即执行某一段代码，并且这段代码是通过特殊的方式执行的），其中的相关内容与进程非常类似，所以可以不需要额外单独创建一个结构来表示线程，只需要复用进程的PCB结构即可。这样一来，线程所能看到的就是一个进程所有的内容，包括进程的虚拟地址空间、打开的各种文件、各种数据等，这种线程在Linux下统一称为轻量级进程（LWP），之所以轻量，就是因为轻量级进程不需要携带各种资源，只需要执行对应的代码得到对应的结果即可</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>虽然Linux下只有轻量级进程的概念，但是为了描述方便，除非是为了描述具体区别，否则后面的内容会互换使用「线程」和「轻量级进程」这两个名词</p> </div> <p>进程和线程的关系如下图所示：</p> <p><a class=glightbox href="1. Linux线程概念与线程操作.assets/image-20250131143735073.png" data-type=image data-width=100% data-height=auto data-desc-position=bottom><img src="1. Linux线程概念与线程操作.assets/image-20250131143735073.png"></a></p> <p>在前面的部分提及到的进程调度，实际上更准确来说是线程调度，只不过其中只有一个线程（即主线程），而从线程部分开始，一个进程内就可以有多个线程，所有线程共享一个进程的资源</p> <p>对于用于CPU调度来说，其看到的只有每一个线程的<code>task_struct</code>，但是进程中可能不止有一个<code>task_struct</code>，所以CPU所能看到的<code>task_struct</code>个数一定是小于等于进程内部总共<code>task_struct</code>的个数</p> <h3 id=_2>理解页表与虚拟地址到物理地址转换<a class=headerlink href=#_2 title="Permanent link">&para;</a></h3> <p>前面提到线程本质是一个执行流，执行属于自己的代码，但是一个进程内部所有的线程都共用一个虚拟地址空间，此时就需要考虑如何做到不同的线程看到不同的资源</p> <p>首先了解Linux中的内存管理，在Linux中，操作系统为了更好得将内存和硬盘进行交互，除了从磁盘上读取数据时按照4kb大小读取外，在内存中，写入/读取数据也是按照4kb进行的，而在内存中，这4kb也被称为页框，有了这样的管理方式，就可以尽可能减少内存的碎片，尽管已经可能存在碎片，但是这个碎片只会出现在多个页框内</p> <p>同样，每一个页框也有自己的属性，操作系统也需要管理所有的页框，即需要对应的结构，对应的结构源码如下：</p> <div class="language-c highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-1><span class=k>struct</span><span class=w> </span><span class=nc>page</span><span class=w> </span>
</span><span id=__span-0-2><span class=p>{</span>
</span><span id=__span-0-3><span class=w>    </span><span class=kt>unsigned</span><span class=w> </span><span class=kt>long</span><span class=w> </span><span class=n>flags</span><span class=p>;</span><span class=w>        </span><span class=cm>/* atomic flags, some possibly</span>
</span><span id=__span-0-4><span class=cm>                       updated asynchronously */</span>
</span><span id=__span-0-5><span class=w>    </span><span class=n>atomic_t</span><span class=w> </span><span class=n>count</span><span class=p>;</span><span class=w>         </span><span class=cm>/* Usage count, see below. */</span>
</span><span id=__span-0-6><span class=w>    </span><span class=k>struct</span><span class=w> </span><span class=nc>list_head</span><span class=w> </span><span class=n>list</span><span class=p>;</span><span class=w>      </span><span class=cm>/* -&gt;mapping has some page lists. */</span>
</span><span id=__span-0-7><span class=w>    </span><span class=k>struct</span><span class=w> </span><span class=nc>address_space</span><span class=w> </span><span class=o>*</span><span class=n>mapping</span><span class=p>;</span><span class=w>  </span><span class=cm>/* The inode (or ...) we belong to. */</span>
</span><span id=__span-0-8><span class=w>    </span><span class=kt>unsigned</span><span class=w> </span><span class=kt>long</span><span class=w> </span><span class=n>index</span><span class=p>;</span><span class=w>        </span><span class=cm>/* Our offset within mapping. */</span>
</span><span id=__span-0-9><span class=w>    </span><span class=k>struct</span><span class=w> </span><span class=nc>list_head</span><span class=w> </span><span class=n>lru</span><span class=p>;</span><span class=w>       </span><span class=cm>/* Pageout list, eg. active_list;</span>
</span><span id=__span-0-10><span class=cm>                       protected by zone-&gt;lru_lock !! */</span>
</span><span id=__span-0-11><span class=w>    </span><span class=k>union</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-0-12><span class=w>        </span><span class=k>struct</span><span class=w> </span><span class=nc>pte_chain</span><span class=w> </span><span class=o>*</span><span class=n>chain</span><span class=p>;</span><span class=cm>/* Reverse pte mapping pointer.</span>
</span><span id=__span-0-13><span class=cm>                     * protected by PG_chainlock */</span>
</span><span id=__span-0-14><span class=w>        </span><span class=n>pte_addr_t</span><span class=w> </span><span class=n>direct</span><span class=p>;</span>
</span><span id=__span-0-15><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=n>pte</span><span class=p>;</span>
</span><span id=__span-0-16><span class=w>    </span><span class=kt>unsigned</span><span class=w> </span><span class=kt>long</span><span class=w> </span><span class=n>private</span><span class=p>;</span><span class=w>      </span><span class=cm>/* mapping-private opaque data */</span>
</span><span id=__span-0-17>
</span><span id=__span-0-18><span class=cp>#if defined(WANT_PAGE_VIRTUAL)</span>
</span><span id=__span-0-19><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=o>*</span><span class=n>virtual</span><span class=p>;</span><span class=w>          </span><span class=cm>/* Kernel virtual address (NULL if</span>
</span><span id=__span-0-20><span class=cm>                       not kmapped, ie. highmem) */</span>
</span><span id=__span-0-21><span class=cp>#endif </span><span class=cm>/* WANT_PAGE_VIRTUAL */</span>
</span><span id=__span-0-22><span class=p>};</span>
</span></code></pre></div></td></tr></table></div> <p>接着，操作系统可以考虑使用一个数组对所有的页框进行管理，其中的元素都是<code>struct page*</code>，之所以用数组，原因之一是因为数组可以使用下标进行访问，而在C语言的世界里，下标和对应的地址（即起始地址+偏移量）可以相互转换，有了这一点，一旦在页表中通过虚拟地址找到了对应的物理地址，就可以在对应的页框数组中通过下标找到指向指定物理地址对应页框的指针从而访问到对应的属性</p> <p>也就是说当获取到一个物理地址，那么通过该地址/4kb即可获取到改地址所在页框的起始地址值，通过该地址值根据C语言数组名即为数组的起始地址的特点就可以获取到偏移量计算出下标，进而获取到指定的元素，对应的地址/4kb也可以转化为地址/<span class=arithmatex>\(2^{12}byte\)</span></p> <p>理解了上面的内存管理方式后，接下来就可以深入理解页表是如何进行虚拟地址到物理地址转换的。因为内存是按照4kb进行读写操作的，所以虚拟地址同样也是按照4kb进行，此时的4kb被称为页，在前面<a href=https://www.help-doc.top/Linux/process-address-space/process-address-space.html#_7>Linux进程地址空间</a>提到，页表中主要的字段有：虚拟地址、物理地址、读写权限和是否存在标记，但是实际上页表中可以并不需要虚拟地址字段，因为虚拟地址是从0开始计算的，一直到最大值，所以可以考虑直接将当前的虚拟地址和虚拟地址空间起始地址之间的偏移量作为索引去对应映射的物理地址即可，这样的做法可以在一定程度上减少页表在物理内存中的占用，但是尽管如此，如果页表中仅有物理地址，在32位系统下，每一个物理地址在每一个页表项中占4个字节（32位比特位），而一个虚拟地址空间就有<span class=arithmatex>\(2^{32}\)</span>个地址，所以一共需要<span class=arithmatex>\(2^{32}\times 4 byte = 2^{34} = 16GB\)</span>，可以看到单单一个页表就需要占用16GB，远超一个物理内存本身的大小，所以页表不可能直接是上面的形式</p> <p>在Linux中，页表实际上是一个多级页表，类似于<a href=https://www.help-doc.top/Linux/file-system/file-system.html#inode>Linux文件系统</a>部分提到的数据块指针，示意图如下：</p> <p><a class=glightbox href="1. Linux线程概念与线程操作.assets\Snipaste_2025-01-31_17-01-59.png" data-type=image data-width=100% data-height=auto data-desc-position=bottom><img src="1. Linux线程概念与线程操作.assets\Snipaste_2025-01-31_17-01-59.png"></a></p> <p>在32为系统下，其中，一级页表称为页目录，一共有1024（<span class=arithmatex>\(2^{10}\)</span>）项，每一项称为页目录表项，二级页表（或简称页表）每一个页表也有1024项，每一项称为页表项，页目录中每一项中存储的都是对应二级页表的起始地址，所以总共<span class=arithmatex>\(1024\times1024\times4=4MB\)</span>大小，此时当通过虚拟地址定位物理地址时，就直接通过32位地址依次查询，具体步骤如下：</p> <ol> <li>前10位（作为下标）定位页目录中指定项，此时就可以找到指定的页表</li> <li>中间10位（作为下标）定位页表中指定项，此时就可以找到虚拟地址对应的物理页框起始地址</li> <li>最后12位（作为偏移量）定位页框中具体的某一个字节的地址，此时就可以通过页框起始地址+偏移量找到指定字节的地址</li> </ol> <p>整体的示意图如下：</p> <p><a class=glightbox href="1. Linux线程概念与线程操作.assets\download.png" data-type=image data-width=100% data-height=auto data-desc-position=bottom><img src="1. Linux线程概念与线程操作.assets\download.png"></a></p> <p>一旦找到一个字节，如果想通过这个字节作为起始值找不同类型的值，就可以通过类型的字节占用获取到完整的值，这就是为什么编译型语言层面需要有变量类型的原因。而之所以知道对应的页框是否被使用只需要通过前20位获取到对应的页框物理地址转换为下标访问对应页框的属性即可</p> <p>对应的源码如下：</p> <div class="language-c highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-1-1><span class=k>typedef</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=kt>unsigned</span><span class=w> </span><span class=kt>long</span><span class=w> </span><span class=n>pte</span><span class=p>;</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=n>pte_t</span><span class=p>;</span><span class=w> </span><span class=c1>// 页表目录</span>
</span><span id=__span-1-2><span class=k>typedef</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=kt>unsigned</span><span class=w> </span><span class=kt>long</span><span class=w> </span><span class=n>pgd</span><span class=p>;</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=n>pgd_t</span><span class=p>;</span><span class=w> </span><span class=c1>// 二级页表</span>
</span></code></pre></div></td></tr></table></div> <p>最后，在操作系统中，存在一个指针<code>struct task_struct* current</code>，在前面<a href="https://www.help-doc.top/Linux/process-state-priority/process-state-priority.html?h=current#_6">Linux进程状态与进程优先级</a>部分提到这个指针指向的就是当前正在被调度的进程，具体来说就是进程中对应的线程，当CPU调度时，就会有对应的寄存器存储当前<code>current</code>指针中的内容，所以CPU一直都知道当前正在被调度的进程，而在前面提到过MMU寄存器负责将CPU读取到的虚拟地址进行查表找到对应的物理地址，而要找到页表就需要通过CR3寄存器，所以整个过程如下图所示：</p> <p><a class=glightbox href="1. Linux线程概念与线程操作.assets\screenshot-20250131-183242.png" data-type=image data-width=100% data-height=auto data-desc-position=bottom><img src="1. Linux线程概念与线程操作.assets\screenshot-20250131-183242.png"></a></p> <p>在CPU发展的过程中，查表行为一直都是一个非常高频的行为，所以其效率也是值得关注的，查表的操作本可以交给软件完成，但是软件的速度毕竟没有硬件快，所以最后还是在CPU中集成了一个硬件MMU，实际上，并不是每一次MMU都去查页表获取到物理地址，而是先看缓存中是否存在已经查到指定虚拟地址对应的物理地址，这个缓存也是通过硬件实现的，即TLB寄存器，所以整个过程就变为：查表时，先查看TLB是否存在需要的虚拟地址对应的物理地址，没有就去查表，并将这个映射存储到TLB，如下图所示：</p> <p><a class=glightbox href="1. Linux线程概念与线程操作.assets\download1.png" data-type=image data-width=100% data-height=auto data-desc-position=bottom><img src="1. Linux线程概念与线程操作.assets\download1.png"></a></p> <h3 id=_3>理解页表标志位<a class=headerlink href=#_3 title="Permanent link">&para;</a></h3> <p>在<a href=https://www.help-doc.top/Linux/process-address-space/process-address-space.html#_7>Linux进程地址空间</a>部分提到过，页表中含有一些标记位，但是上面的理论只提到了物理地址，实际上，因为在32位系统中，一共由<span class=arithmatex>\(2^{32}\)</span>个地址，因为每4kb为一个页框，所以总共有<span class=arithmatex>\(\frac{2^{32}}{2^{12}}=2^{20}\)</span>，所以实际上在每一个二级页表项中，表示完所有的页框地址也只需要20位二进制，剩余的12位就可以用来作为标记位</p> <h3 id=_4>细致理解缺页中断<a class=headerlink href=#_4 title="Permanent link">&para;</a></h3> <p>CPU给MMU的虚拟地址，在TLB和页表都没有找到对应的物理页，该怎么办呢？其实这就是缺页异常<code>Page Fault</code>，它是个由硬件中断触发的可以由软件逻辑纠正的错误。假如目标内存页在物理内存中没有对应的物理页或者存在但无对应权限，CPU就无法获取数据，这种情况下CPU就会报告一个缺页错误。由于CPU没有数据就无法进行计算，CPU罢工了进程也就出现了缺页中断，进程会从用户态切换到内核态，并将缺页中断交给内核的<code>Page Fault Handler</code>处理，如下图所示：</p> <p><a class=glightbox href="1. Linux线程概念与线程操作.assets\download2.png" data-type=image data-width=100% data-height=auto data-desc-position=bottom><img src="1. Linux线程概念与线程操作.assets\download2.png"></a></p> <p>缺页中断会交给 PageFaultHandler 处理，其根据缺页中断的不同类型会进行不同的处理：</p> <ol> <li><code>Hard Page Fault</code>也被称为<code>Major Page Fault</code>，翻译为硬缺页错误/主要缺页错误，这时物理内存中没有对应的物理，需要CPU打开磁盘设备读取到物理内存中，再让MMU建⽴虚拟地址和物理地址的映射</li> <li><code>Soft Page Fault</code>也被称为<code>Minor Page Fault</code>，翻译为软缺页错误/次要缺页错误，这时物理内存中是存在对应物理页的，只不过可能是其他进程调入的，发出缺页异常的进程不知道而已，此时MMU只需要建立映射即可，⽆需从磁盘读取写入内存，一般出现在多进程共享内存区域</li> <li><code>Invalid Page Fault</code>翻译为无效缺页错误，⽐如进程访问的内存地址越界访问，又比如对空指针解引⽤内核就会报<code>segmentation fault</code>错误中断进程直接挂掉</li> </ol> <h2 id=_5>线程的优点和缺点<a class=headerlink href=#_5 title="Permanent link">&para;</a></h2> <p>对比进程，线程也有对应的优点，具体如下表所示：</p> <table> <thead> <tr> <th>特性</th> <th>进程</th> <th>线程</th> </tr> </thead> <tbody> <tr> <td><strong>创建代价</strong></td> <td>创建一个新进程的代价较大</td> <td>创建一个新线程的代价较小</td> </tr> <tr> <td><strong>上下文切换工作量</strong></td> <td>进程之间的切换需要操作系统做较多的工作，涉及不同的虚拟内存空间</td> <td>线程之间的切换需要操作系统做的工作较少，因为线程共享相同的虚拟内存空间</td> </tr> <tr> <td><strong>寄存器内容切换</strong></td> <td>切换时需要保存和恢复所有寄存器的内容</td> <td>切换时需要保存和恢复较少的寄存器内容</td> </tr> <tr> <td><strong>缓存机制影响</strong></td> <td>上下文切换会扰乱处理器缓存机制，导致已缓存的内存地址失效，并且TLB会被刷新</td> <td>上下文切换对处理器缓存机制影响较小，TLB不会被刷新</td> </tr> <tr> <td><strong>资源占用</strong></td> <td>占用较多系统资源</td> <td>占用较少系统资源</td> </tr> <tr> <td><strong>多处理器利用</strong></td> <td>可以利用多处理器，但效率较低</td> <td>能充分利用多处理器的并行处理能力</td> </tr> <tr> <td><strong>等待I/O操作</strong></td> <td>在等待慢速I/O操作结束时，无法执行其他计算任务</td> <td>在等待慢速I/O操作结束时，可以执行其他计算任务</td> </tr> </tbody> </table> <p>在线程的优点中，主要就是寄存器内容切换和缓存机制上，因为进程需要保存代码和数据，切换时需要全部切换，而线程只需要保存部分数据和代码，切换时只需要切换一部分内容，所以切换线程更方便且容易，另外一个影响切换性能的并不是进程本身的内容，而是缓存硬件，例如前面提到的TLB以及CPU中本身存在的Cache，如果是线程，因为页表不需要切换，并且相关的代码也不需要切换，所以在一定程度上节省了刷新缓存硬件的开销，但是进程就必须全部刷新，所以导致进程切换相对于线程就比较耗时</p> <div class="admonition info"> <p class=admonition-title>局部性原理</p> <p>局部性原理（Principle of Locality）是计算机科学中的一个重要概念，特别是在内存管理和缓存设计中。它描述了程序在访问数据时表现出的一种倾向，即程序倾向于访问最近访问过的数据或与其相邻的数据</p> <p>局部性原理分为两种主要类型：时间局部性和空间局部性：</p> <ul> <li>时间局部性指的是如果一个数据项被访问，那么在不久的将来它很可能再次被访问。这种现象通常出现在循环、递归调用等场景中，因为这些结构会反复访问相同的数据</li> <li>空间局部性指的是如果一个数据项被访问，那么与之相邻的数据项也很可能很快被访问。这是因为大多数程序在访问数据时，往往会按顺序访问连续存储的数据，如数组元素、结构体成员等</li> </ul> <p>局部性原理的应用</p> <ol> <li> <p>CPU缓存（Cache）：</p> <ul> <li>时间局部性：缓存机制利用时间局部性，将最近访问的数据保存在快速缓存中，以便下次访问时能快速获取</li> <li>空间局部性：缓存通常以块（cache lines）为单位加载数据，这样当一个数据项被加载到缓存时，其邻近的数据也会一并加载进来，提高访问效率</li> </ul> </li> <li> <p>虚拟内存管理：</p> <ul> <li>操作系统通过分页机制管理内存，页面大小的设计也考虑了局部性原理。较大的页面可以更好地利用空间局部性，但可能会增加内存浪费；较小的页面则更适合精细的内存管理</li> </ul> </li> <li> <p>预取技术：</p> <ul> <li>现代处理器和存储系统常使用预取技术（prefetching），基于局部性原理预测即将访问的数据，并提前将其加载到缓存或更高层次的存储中，从而减少等待时间</li> </ul> </li> <li> <p>文件系统和数据库：</p> <ul> <li>文件系统和数据库系统在设计时也会考虑局部性原理，例如通过缓存最近访问的文件块或数据库记录来提高性能</li> </ul> </li> </ol> </div> <div class="admonition info"> <p class=admonition-title>在Linux中查看CPU信息</p> <p>在Linux中查看CPU信息可以使用下面的指令：</p> <div class="language-shell highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>Bash</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-2-1>cat<span class=w> </span>/proc/cpuinfo
</span></code></pre></div></td></tr></table></div> </div> <p>同样，线程也有对应的缺点：</p> <ol> <li>性能损失：计算密集型线程往往无法与其他线程共享同一个处理器。如果计算密集型线程的数量比可用的处理器多，可能会有较大的性能损失，增加额外的同步和调度开销</li> <li>健壮性降低：编写多线程需要更全面深入的考虑，在一个多线程程序里，因时间分配上的细微偏差或者因共享了不该共享的变量而造成不良影响的可能性很大，线程之间缺乏保护</li> <li>缺乏访问控制：进程是访问控制的基本粒度，在一个线程中调用某些OS函数会对整个进程造成影响</li> <li>编程难度提高：编写与调试一个多线程程序比单线程程序困难得多</li> </ol> <h2 id=_6>线程独有和共有的数据<a class=headerlink href=#_6 title="Permanent link">&para;</a></h2> <p>在PCB中，线程独有的数据：</p> <ul> <li>线程ID</li> <li>一组寄存器</li> <li>栈</li> <li>错误码</li> <li>信号屏蔽字</li> <li>调度优先级</li> </ul> <p>线程中共有的数据：</p> <p>同一地址空间，因此代码段、数据段都是共享的，如果定义一个函数，在各线程中都可以调用，如果定义一个全局变量，在各线程中都可以访问到除此之外，各线程还共享以下进程资源和环境：</p> <ul> <li>文件描述符表</li> <li>每种信号的处理方式(<code>SIG_IGN</code>、<code>SIG_DFL</code>或者自定义的信号处理函数)</li> <li>当前工作目录</li> <li>用户id和组id</li> </ul> <h2 id=_7>线程操作<a class=headerlink href=#_7 title="Permanent link">&para;</a></h2> <h3 id=id>创建线程与获取线程id<a class=headerlink href=#id title="Permanent link">&para;</a></h3> <h4 id=_8>基本使用<a class=headerlink href=#_8 title="Permanent link">&para;</a></h4> <p>如果想在Linux下创建进程可以使用下面的函数：</p> <div class="language-c highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-3-1><span class=kt>int</span><span class=w> </span><span class=nf>pthread_create</span><span class=p>(</span><span class=n>pthread_t</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=kr>thread</span><span class=p>,</span><span class=w> </span>
</span><span id=__span-3-2><span class=w>                    </span><span class=k>const</span><span class=w> </span><span class=n>pthread_attr_t</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>attr</span><span class=p>,</span><span class=w> </span>
</span><span id=__span-3-3><span class=w>                    </span><span class=kt>void</span><span class=w> </span><span class=o>*</span><span class=p>(</span><span class=o>*</span><span class=n>start_routine</span><span class=p>)(</span><span class=kt>void</span><span class=w> </span><span class=o>*</span><span class=p>),</span><span class=w> </span>
</span><span id=__span-3-4><span class=w>                    </span><span class=kt>void</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>arg</span><span class=p>);</span>
</span></code></pre></div></td></tr></table></div> <p>需要注意，<code>pthread_create</code>函数并不是Linux提供的创建线程的系统调度，而是Linux中对轻量级进程已有的接口进行封装的动态库中的函数，既然是动态库，那么在编译链接时就需要在编译命令后带上<code>-lpthread</code></p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>需要注意，较新的Linux操作系统可能不需要携带<code>-lpthread</code>，但是对于不需要带上<code>-lpthread</code>的Linux也可以带上，不会影响编译</p> </div> <p>前面提到在Linux中只存在轻量级进程，即LWP，也就是说在Linux下创建线程就需要使用创建轻量级进程的方式，实际上，在Linux系统调用中存在一个调用<code>clone</code>，该接口可以根据传入的指定标记指定创建的是子进程还是轻量级进程，但是这个接口使用起来非常麻烦，所以为了进一步简化创建线程的步骤使其与通用操作系统中提到的线程概念更加贴切，就出现了用户级线程库，即<code>libpthread.so</code></p> <p>该函数中，第一个参数表示创建的新线程的<code>id</code>值，第二个参数表示线程属性，一般情况下用不到，只需要传递<code>NULL</code>即可，第三个参数表示线程需要执行的代码，其为一个回调函数，第四个参数就是回调函数的参数</p> <p>使用<code>pthread_create</code>创建线程的方式如下：</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-4-1><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;iostream&gt;</span>
</span><span id=__span-4-2><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;unistd.h&gt;</span>
</span><span id=__span-4-3><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;pthread.h&gt;</span>
</span><span id=__span-4-4>
</span><span id=__span-4-5><span class=kt>void</span><span class=w> </span><span class=o>*</span><span class=nf>routine</span><span class=p>(</span><span class=kt>void</span><span class=w> </span><span class=o>*</span><span class=n>arg</span><span class=p>)</span>
</span><span id=__span-4-6><span class=p>{</span>
</span><span id=__span-4-7><span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=nb>true</span><span class=p>)</span>
</span><span id=__span-4-8><span class=w>    </span><span class=p>{</span>
</span><span id=__span-4-9><span class=w>        </span><span class=n>std</span><span class=o>::</span><span class=n>cout</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;我是一个轻量级进程（线程）&quot;</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span><span id=__span-4-10><span class=w>        </span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span><span id=__span-4-11><span class=w>    </span><span class=p>}</span>
</span><span id=__span-4-12><span class=p>}</span>
</span><span id=__span-4-13>
</span><span id=__span-4-14><span class=kt>int</span><span class=w> </span><span class=nf>main</span><span class=p>()</span>
</span><span id=__span-4-15><span class=p>{</span>
</span><span id=__span-4-16><span class=w>    </span><span class=n>pthread_t</span><span class=w> </span><span class=n>thid</span><span class=p>;</span>
</span><span id=__span-4-17>
</span><span id=__span-4-18><span class=w>    </span><span class=n>pthread_create</span><span class=p>(</span><span class=o>&amp;</span><span class=n>thid</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>,</span><span class=w> </span><span class=n>routine</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=kt>void</span><span class=w> </span><span class=o>*</span><span class=p>)</span><span class=s>&quot;thread-1&quot;</span><span class=p>);</span>
</span><span id=__span-4-19>
</span><span id=__span-4-20><span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=nb>true</span><span class=p>)</span>
</span><span id=__span-4-21><span class=w>    </span><span class=p>{</span>
</span><span id=__span-4-22><span class=w>        </span><span class=n>std</span><span class=o>::</span><span class=n>cout</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;我是主线程&quot;</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span><span id=__span-4-23><span class=w>        </span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span><span id=__span-4-24><span class=w>    </span><span class=p>}</span>
</span><span id=__span-4-25>
</span><span id=__span-4-26><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-4-27><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <p>编译运行上面的代码即可看到下面的运行结果：</p> <p><a class=glightbox href="1. Linux线程概念与线程操作.assets\Snipaste_2025-02-06_16-15-28.png" data-type=image data-width=100% data-height=auto data-desc-position=bottom><img src="1. Linux线程概念与线程操作.assets\Snipaste_2025-02-06_16-15-28.png"></a></p> <p>从上面的运行结果可以看出，两个线程是异步打印到同一个资源（显示器）上，所以存在打印错乱的情况，但是的确可以做到每一个线程完成自己的任务而不会受到其他线程的干扰，这两个线程就是两个不同的执行流，而因为<code>routine</code>函数始终在访问同一个资源，所以此时其是<a href=https://www.help-doc.top/Linux/18.%20Linux%E4%BF%A1%E5%8F%B7%E4%B8%8E%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86/18.%20Linux%E4%BF%A1%E5%8F%B7%E4%B8%8E%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86.html#_11>不可重入函数</a></p> <h4 id=_9>理解资源划分<a class=headerlink href=#_9 title="Permanent link">&para;</a></h4> <p>通过上面这个例子来理解操作系统是如何针对每一个线程进行资源划分的。实际上，并不需要操作系统单独采取一套新的方案来处理资源划分的问题，因为在程序编译链接时，每一个函数乃至变量都具有了虚拟地址，一旦CPU拿到了对应的虚拟地址，根据虚拟地址到物理地址的映射即可指定对应的代码得到对应的结果，这种通过部分虚拟地址查找页表的部分区域的方式就可以实现资源划分</p> <h4 id=_10>线程瓜分进程资源<a class=headerlink href=#_10 title="Permanent link">&para;</a></h4> <p>另外因为一个进程中可能存在很多个线程，所有线程共享整个进程拥有的资源，此时势必存在某些资源是被平均分配的，例如进程的时间片，如果一个进程中存在多个线程，那么多个线程拿到的时间片并不等于进程所有的时间片，而是所有线程拿到的时间片总和等于整个线程的时间片</p> <h4 id=id_1>查看轻量级进程状态与其<code>id</code><a class=headerlink href=#id_1 title="Permanent link">&para;</a></h4> <p>如果此时需要查看轻量级进程的状态，可以使用下面的命令：</p> <div class="language-shell highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>Bash</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-5-1>ps<span class=w> </span>-aL
</span></code></pre></div></td></tr></table></div> <p>例如查看上面运行的进程对应的轻量级进程如下：</p> <p><a class=glightbox href="1. Linux线程概念与线程操作.assets\Snipaste_2025-02-06_16-18-11.png" data-type=image data-width=100% data-height=auto data-desc-position=bottom><img src="1. Linux线程概念与线程操作.assets\Snipaste_2025-02-06_16-18-11.png"></a></p> <p>其中，<code>PID</code>与<code>LWP</code>相同的即为主线程，其余的均为新线程，即轻量级进程</p> <p>在用户级线程库中提供了一个接口<code>pthread_self</code>来获取当前线程的<code>id</code>：</p> <div class="language-c highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-6-1><span class=n>pthread_t</span><span class=w> </span><span class=nf>pthread_self</span><span class=p>(</span><span class=kt>void</span><span class=p>);</span>
</span></code></pre></div></td></tr></table></div> <p>因为参数是<code>void</code>，所以该接口不需要传递任何参数</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>需要注意的是，线程<code>id</code>不等于使用<code>ps -aL</code>指令查看到的<code>LWP</code>值</p> </div> <h4 id=_11>创建多线程并且访问同一个函数中的局部变量<a class=headerlink href=#_11 title="Permanent link">&para;</a></h4> <p>若此时有多个新线程，并且均访问同一个方法，当在该函数中使用一个局部变量时，因为每一个新线程都会在自己的栈上开辟栈帧空间，所以这个局部变量在理论上时每一个线程所私有的，即：</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-7-1><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;iostream&gt;</span>
</span><span id=__span-7-2><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;unistd.h&gt;</span>
</span><span id=__span-7-3><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;pthread.h&gt;</span>
</span><span id=__span-7-4>
</span><span id=__span-7-5><span class=kt>void</span><span class=w> </span><span class=o>*</span><span class=nf>routine</span><span class=p>(</span><span class=kt>void</span><span class=w> </span><span class=o>*</span><span class=n>arg</span><span class=p>)</span>
</span><span id=__span-7-6><span class=p>{</span>
</span><span id=__span-7-7><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>val</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span>
</span><span id=__span-7-8>
</span><span id=__span-7-9><span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=nb>true</span><span class=p>)</span>
</span><span id=__span-7-10><span class=w>    </span><span class=p>{</span>
</span><span id=__span-7-11><span class=w>        </span><span class=n>std</span><span class=o>::</span><span class=n>cout</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;我是&quot;</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>pthread_self</span><span class=p>()</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;轻量级进程（线程），val = &quot;</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>val</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span><span id=__span-7-12><span class=w>        </span><span class=n>val</span><span class=o>++</span><span class=p>;</span>
</span><span id=__span-7-13><span class=w>        </span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span><span id=__span-7-14><span class=w>    </span><span class=p>}</span>
</span><span id=__span-7-15><span class=p>}</span>
</span><span id=__span-7-16>
</span><span id=__span-7-17><span class=kt>int</span><span class=w> </span><span class=nf>main</span><span class=p>()</span>
</span><span id=__span-7-18><span class=p>{</span>
</span><span id=__span-7-19><span class=w>    </span><span class=n>pthread_t</span><span class=w> </span><span class=n>thid1</span><span class=p>;</span>
</span><span id=__span-7-20><span class=w>    </span><span class=n>pthread_t</span><span class=w> </span><span class=n>thid2</span><span class=p>;</span>
</span><span id=__span-7-21>
</span><span id=__span-7-22><span class=w>    </span><span class=n>pthread_create</span><span class=p>(</span><span class=o>&amp;</span><span class=n>thid1</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>,</span><span class=w> </span><span class=n>routine</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=kt>void</span><span class=w> </span><span class=o>*</span><span class=p>)</span><span class=s>&quot;thread-1&quot;</span><span class=p>);</span>
</span><span id=__span-7-23><span class=w>    </span><span class=n>pthread_create</span><span class=p>(</span><span class=o>&amp;</span><span class=n>thid2</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>,</span><span class=w> </span><span class=n>routine</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=kt>void</span><span class=w> </span><span class=o>*</span><span class=p>)</span><span class=s>&quot;thread-1&quot;</span><span class=p>);</span>
</span><span id=__span-7-24>
</span><span id=__span-7-25><span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=nb>true</span><span class=p>)</span>
</span><span id=__span-7-26><span class=w>    </span><span class=p>{</span>
</span><span id=__span-7-27><span class=w>        </span><span class=n>std</span><span class=o>::</span><span class=n>cout</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;我是主线程&quot;</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span><span id=__span-7-28><span class=w>        </span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span><span id=__span-7-29><span class=w>    </span><span class=p>}</span>
</span><span id=__span-7-30>
</span><span id=__span-7-31><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-7-32><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <p>编译运行上面的代码即可看到尽管两个两个新线程都在修改<code>val</code>，但是二者并没有影响到另外的<code>val</code>，这也验证了每个线程实际上也有自己的栈</p> <h4 id=_12>创建多线程并且访问同一个全局变量<a class=headerlink href=#_12 title="Permanent link">&para;</a></h4> <p>但是如果两个线程访问的是全局变量，则结果就会不一样：</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-8-1><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;iostream&gt;</span>
</span><span id=__span-8-2><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;unistd.h&gt;</span>
</span><span id=__span-8-3><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;pthread.h&gt;</span>
</span><span id=__span-8-4>
</span><span id=__span-8-5><span class=kt>int</span><span class=w> </span><span class=n>val</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-8-6>
</span><span id=__span-8-7><span class=kt>void</span><span class=w> </span><span class=o>*</span><span class=nf>routine</span><span class=p>(</span><span class=kt>void</span><span class=w> </span><span class=o>*</span><span class=n>arg</span><span class=p>)</span>
</span><span id=__span-8-8><span class=p>{</span>
</span><span id=__span-8-9><span class=w>    </span><span class=c1>// int val = 1;</span>
</span><span id=__span-8-10>
</span><span id=__span-8-11><span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=nb>true</span><span class=p>)</span>
</span><span id=__span-8-12><span class=w>    </span><span class=p>{</span>
</span><span id=__span-8-13><span class=w>        </span><span class=n>std</span><span class=o>::</span><span class=n>cout</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;我是&quot;</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>pthread_self</span><span class=p>()</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;轻量级进程（线程），val = &quot;</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>val</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span><span id=__span-8-14><span class=w>        </span><span class=n>val</span><span class=o>++</span><span class=p>;</span>
</span><span id=__span-8-15><span class=w>        </span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span><span id=__span-8-16><span class=w>    </span><span class=p>}</span>
</span><span id=__span-8-17><span class=p>}</span>
</span><span id=__span-8-18>
</span><span id=__span-8-19><span class=kt>int</span><span class=w> </span><span class=nf>main</span><span class=p>()</span>
</span><span id=__span-8-20><span class=p>{</span>
</span><span id=__span-8-21><span class=w>    </span><span class=n>pthread_t</span><span class=w> </span><span class=n>thid1</span><span class=p>;</span>
</span><span id=__span-8-22><span class=w>    </span><span class=n>pthread_t</span><span class=w> </span><span class=n>thid2</span><span class=p>;</span>
</span><span id=__span-8-23>
</span><span id=__span-8-24><span class=w>    </span><span class=n>pthread_create</span><span class=p>(</span><span class=o>&amp;</span><span class=n>thid1</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>,</span><span class=w> </span><span class=n>routine</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=kt>void</span><span class=w> </span><span class=o>*</span><span class=p>)</span><span class=s>&quot;thread-1&quot;</span><span class=p>);</span>
</span><span id=__span-8-25><span class=w>    </span><span class=n>pthread_create</span><span class=p>(</span><span class=o>&amp;</span><span class=n>thid2</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>,</span><span class=w> </span><span class=n>routine</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=kt>void</span><span class=w> </span><span class=o>*</span><span class=p>)</span><span class=s>&quot;thread-1&quot;</span><span class=p>);</span>
</span><span id=__span-8-26>
</span><span id=__span-8-27><span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=nb>true</span><span class=p>)</span>
</span><span id=__span-8-28><span class=w>    </span><span class=p>{</span>
</span><span id=__span-8-29><span class=w>        </span><span class=n>std</span><span class=o>::</span><span class=n>cout</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;我是主线程&quot;</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span><span id=__span-8-30><span class=w>        </span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span><span id=__span-8-31><span class=w>    </span><span class=p>}</span>
</span><span id=__span-8-32>
</span><span id=__span-8-33><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-8-34><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <p>在上面的代码中，将<code>val</code>变量作为了全局变量供两个线程进行访问，此时两个线程均看得到这个变量，所以这个变量就是两个线程的共享资源，与前面显示器打印问题一样，因为共用并且没加保护，导致一个线程的修改会影响到另一个线程，这个效果同样适用于静态变量</p> <h4 id=_13>线程局部存储<a class=headerlink href=#_13 title="Permanent link">&para;</a></h4> <p>如果希望每个线程访问全局变量时不受其他线程的影响可以使用线程局部存储，其允许每个线程拥有自己的全局变量副本。这意味着，虽然变量名是全局的，但每个线程访问的是该变量的独立实例</p> <p>在Linux中，开启线程局部存储可以使用<code>__thread</code>关键字修饰内置类型的全局变量，注意不可以修饰自定义类型。例如下面的代码：</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-9-1><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;iostream&gt;</span>
</span><span id=__span-9-2><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;cstring&gt;</span>
</span><span id=__span-9-3><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;unistd.h&gt;</span>
</span><span id=__span-9-4><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;pthread.h&gt;</span>
</span><span id=__span-9-5>
</span><span id=__span-9-6><span class=c1>// 使用线程局部存储</span>
</span><span id=__span-9-7><span class=n>__thread</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>val</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-9-8>
</span><span id=__span-9-9><span class=kt>void</span><span class=w> </span><span class=o>*</span><span class=nf>routine</span><span class=p>(</span><span class=kt>void</span><span class=w> </span><span class=o>*</span><span class=n>arg</span><span class=p>)</span>
</span><span id=__span-9-10><span class=p>{</span>
</span><span id=__span-9-11><span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=nb>true</span><span class=p>)</span>
</span><span id=__span-9-12><span class=w>    </span><span class=p>{</span>
</span><span id=__span-9-13><span class=w>        </span><span class=n>std</span><span class=o>::</span><span class=n>cout</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;我是&quot;</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>pthread_self</span><span class=p>()</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;轻量级进程（线程），我的val=&quot;</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>val</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span><span id=__span-9-14><span class=w>        </span><span class=n>val</span><span class=o>++</span><span class=p>;</span>
</span><span id=__span-9-15><span class=w>        </span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span><span id=__span-9-16><span class=w>    </span><span class=p>}</span>
</span><span id=__span-9-17>
</span><span id=__span-9-18><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>arg</span><span class=p>;</span>
</span><span id=__span-9-19><span class=p>}</span>
</span><span id=__span-9-20>
</span><span id=__span-9-21><span class=kt>int</span><span class=w> </span><span class=nf>main</span><span class=p>()</span>
</span><span id=__span-9-22><span class=p>{</span>
</span><span id=__span-9-23><span class=w>    </span><span class=n>pthread_t</span><span class=w> </span><span class=n>thid1</span><span class=p>;</span>
</span><span id=__span-9-24>
</span><span id=__span-9-25><span class=w>    </span><span class=n>pthread_create</span><span class=p>(</span><span class=o>&amp;</span><span class=n>thid1</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>,</span><span class=w> </span><span class=n>routine</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=kt>void</span><span class=w> </span><span class=o>*</span><span class=p>)</span><span class=s>&quot;thread-1&quot;</span><span class=p>);</span>
</span><span id=__span-9-26>
</span><span id=__span-9-27><span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=nb>true</span><span class=p>)</span>
</span><span id=__span-9-28><span class=w>    </span><span class=p>{</span>
</span><span id=__span-9-29><span class=w>        </span><span class=n>std</span><span class=o>::</span><span class=n>cout</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;我是主线程，我的val=&quot;</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>val</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span><span id=__span-9-30><span class=w>        </span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span><span id=__span-9-31><span class=w>    </span><span class=p>}</span>
</span><span id=__span-9-32>
</span><span id=__span-9-33><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-9-34><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <p>运行上面的代码后可以看到下面的结果：</p> <p><a class=glightbox href="1. Linux线程概念与线程操作.assets\Snipaste_2025-02-08_17-44-23.png" data-type=image data-width=100% data-height=auto data-desc-position=bottom><img src="1. Linux线程概念与线程操作.assets\Snipaste_2025-02-08_17-44-23.png"></a></p> <p>从上面的结果可以看出，新线程对全局变量<code>val</code>的修改并不影响主线程</p> <h4 id=_14>理解栈独立和堆共享<a class=headerlink href=#_14 title="Permanent link">&para;</a></h4> <p><strong>栈</strong>是每个线程私有的内存区域，用于存储局部变量、方法参数、返回地址等。每个新线程都会创建自己的栈。<strong>栈上的数据独立于其他线程</strong>，这意味着如果一个线程在它的栈中创建了一个变量，这个变量不能被直接访问到，除非它被显式地传递给另一个线程（例如通过方法参数或共享对象）。这种独立性提供了天然的线程安全，因为每个线程都有自己的栈空间，不会无意间影响其他线程的数据</p> <p><strong>堆</strong>是一个全局共享的内存区域，用于动态分配内存。所有线程都可以访问堆上分配的对象。如果一个对象在堆上被创建，并且其引用（即内存地址）被传递给多个线程，那么这些线程就可以同时访问甚至修改该对象的内容。因为堆是共享的，所以在多线程环境下访问堆上的对象时需要特别小心，通常需要使用同步机制来避免竞态条件或数据不一致的问题</p> <p>所以，不论是堆上的数据还是栈上的数据，只要能获取到指定内容的地址，就不存在所谓的栈独立性，此刻栈和堆都是共享的，而所谓的栈独立性和堆共享性更强调所有的线程都有自己的栈，但是堆只共有一个</p> <h4 id=_15>信号问题<a class=headerlink href=#_15 title="Permanent link">&para;</a></h4> <p>在一个进程中，不论是哪一个线程出现线程异常问题，例如除0异常、野指针异常等，都会导致整个进程崩溃而不是单独的一个线程退出，所以对于任意一个线程来说，只要是同一个进程，那么一旦有一个线程收到了某一个信号，那么其它的所有线程都会收到同一个信号，从而执行同一个信号处理方法</p> <p>但是每个线程可以有自己的信号屏蔽字，即每个线程可以有自己的阻塞信号的位图</p> <h3 id=_16>线程等待与回收<a class=headerlink href=#_16 title="Permanent link">&para;</a></h3> <p>前面学到子进程一旦退出，父进程就要回收对应的子进程，防止僵尸进程问题，同样，对于线程来说，也存在类似于僵尸进程的问题，但是这个问题在操作系统重无法查看，所以一旦线程退出，主线程也需要等待并回收退出的线程。另外，一个线程是否完成任务也需要通过对应线程的退出信息判断，所以在主线程需要通过等待并回收对应的线程从而获取到退出信息</p> <p>基于上面两点原因，主线程需要等待并回收退出的线程。在Linux中，如果需要等待退出的线程，可以使用接口<code>pthread_join</code>：</p> <div class="language-c highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-10-1><span class=kt>int</span><span class=w> </span><span class=nf>pthread_join</span><span class=p>(</span><span class=n>pthread_t</span><span class=w> </span><span class=kr>thread</span><span class=p>,</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=o>**</span><span class=n>retval</span><span class=p>);</span>
</span></code></pre></div></td></tr></table></div> <p>这个接口的第一个参数表示要等待的线程<code>id</code>，第二个参数是一个输出型参数，线程退出的信息会写入到该参数，后续只需要读取该参数的值即可获取到退出线程的退出信息。之所以第二个参数是二级指针，是因为前面创建线程时对应执行函数的返回值为<code>void*</code>，传入一个变量时同样需要对应大小的变量接收对应的返回值防止出现截断或者溢出问题，而需要修改一个一级指针就需要一个二级指针，示意图如下：</p> <p><a class=glightbox href="1. Linux线程概念与线程操作.assets\Snipaste_2025-02-06_17-35-43.png" data-type=image data-width=100% data-height=auto data-desc-position=bottom><img src="1. Linux线程概念与线程操作.assets\Snipaste_2025-02-06_17-35-43.png"></a></p> <p>需要注意，在上图中，线程执行函数的退出信息并不是直接就被<code>pthread_join</code>函数拿到的，而是先存放在<a href=#>线程结构<code>pthread</code></a>中，再有<code>pthread_join</code>函数通过获取对应的属性拿到线程执行函数的退出信息</p> <p>如果等待的线程没有退出，那么等待方式依旧是阻塞式等待，一旦等待成功，函数返回0，否则返回指定的错误码</p> <p>基本使用如下：</p> <div class="language-c highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-11-1><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;iostream&gt;</span>
</span><span id=__span-11-2><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;cstring&gt;</span>
</span><span id=__span-11-3><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;unistd.h&gt;</span>
</span><span id=__span-11-4><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;pthread.h&gt;</span>
</span><span id=__span-11-5>
</span><span id=__span-11-6><span class=kt>void</span><span class=w> </span><span class=o>*</span><span class=nf>routine</span><span class=p>(</span><span class=kt>void</span><span class=w> </span><span class=o>*</span><span class=n>arg</span><span class=p>)</span>
</span><span id=__span-11-7><span class=p>{</span>
</span><span id=__span-11-8><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>count</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-11-9><span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=nb>true</span><span class=p>)</span>
</span><span id=__span-11-10><span class=w>    </span><span class=p>{</span>
</span><span id=__span-11-11><span class=w>        </span><span class=n>std</span><span class=o>::</span><span class=n>cout</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;我是&quot;</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>pthread_self</span><span class=p>()</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;轻量级进程（线程） &quot;</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span><span id=__span-11-12><span class=w>        </span><span class=n>count</span><span class=o>++</span><span class=p>;</span>
</span><span id=__span-11-13><span class=w>        </span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span><span id=__span-11-14><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>count</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>5</span><span class=p>)</span>
</span><span id=__span-11-15><span class=w>            </span><span class=k>break</span><span class=p>;</span>
</span><span id=__span-11-16><span class=w>    </span><span class=p>}</span>
</span><span id=__span-11-17>
</span><span id=__span-11-18><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>arg</span><span class=p>;</span>
</span><span id=__span-11-19><span class=p>}</span>
</span><span id=__span-11-20>
</span><span id=__span-11-21><span class=kt>int</span><span class=w> </span><span class=nf>main</span><span class=p>()</span>
</span><span id=__span-11-22><span class=p>{</span>
</span><span id=__span-11-23><span class=w>    </span><span class=n>pthread_t</span><span class=w> </span><span class=n>thid1</span><span class=p>;</span>
</span><span id=__span-11-24>
</span><span id=__span-11-25><span class=w>    </span><span class=n>pthread_create</span><span class=p>(</span><span class=o>&amp;</span><span class=n>thid1</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>,</span><span class=w> </span><span class=n>routine</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=kt>void</span><span class=w> </span><span class=o>*</span><span class=p>)</span><span class=s>&quot;thread-1&quot;</span><span class=p>);</span>
</span><span id=__span-11-26>
</span><span id=__span-11-27><span class=w>    </span><span class=c1>// 等待线程</span>
</span><span id=__span-11-28><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=o>*</span><span class=n>ret</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>nullptr</span><span class=p>;</span>
</span><span id=__span-11-29><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>n</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>pthread_join</span><span class=p>(</span><span class=n>thid1</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>ret</span><span class=p>);</span>
</span><span id=__span-11-30>
</span><span id=__span-11-31><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>n</span><span class=p>)</span>
</span><span id=__span-11-32><span class=w>        </span><span class=n>printf</span><span class=p>(</span><span class=s>&quot;%s</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=kt>char</span><span class=w> </span><span class=o>*</span><span class=p>)</span><span class=n>ret</span><span class=p>);</span>
</span><span id=__span-11-33><span class=w>    </span><span class=k>else</span>
</span><span id=__span-11-34><span class=w>        </span><span class=n>std</span><span class=o>::</span><span class=n>cerr</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;错误码为：&quot;</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>n</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>strerror</span><span class=p>(</span><span class=n>n</span><span class=p>)</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span><span id=__span-11-35>
</span><span id=__span-11-36><span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=nb>true</span><span class=p>)</span>
</span><span id=__span-11-37><span class=w>    </span><span class=p>{</span>
</span><span id=__span-11-38><span class=w>        </span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span><span id=__span-11-39><span class=w>    </span><span class=p>}</span>
</span><span id=__span-11-40>
</span><span id=__span-11-41><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-11-42><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <p>运行结果如下：</p> <p><a class=glightbox href="1. Linux线程概念与线程操作.assets\Snipaste_2025-02-06_17-55-32.png" data-type=image data-width=100% data-height=auto data-desc-position=bottom><img src="1. Linux线程概念与线程操作.assets\Snipaste_2025-02-06_17-55-32.png"></a></p> <p><strong>创建线程的传参问题和回收线程的返回值问题：</strong></p> <p>观察到不论是创建线程时传入线程函数的参数还是等待回收线程获取线程函数的返回值对应的类型是<code>void*</code>类型的指针，这种指针类型没有任何类型说明，只是为了让编译器方便开辟空间，但是正因为这个类型的存在，可以让传参和返回值为任意类型</p> <h3 id=_17>线程退出<a class=headerlink href=#_17 title="Permanent link">&para;</a></h3> <p>线程退出类似于前面的进程退出，但是如果线程直接使用<code>exit</code>接口会导致整个进程退出，但是线程使用<code>return</code>只是当前线程退出，类似的还可以使用<code>pthread_exit</code>接口退出当前线程而不是整个进程：</p> <div class="language-c highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-12-1><span class=kt>void</span><span class=w> </span><span class=nf>pthread_exit</span><span class=p>(</span><span class=kt>void</span><span class=w> </span><span class=o>*</span><span class=n>retval</span><span class=p>);</span>
</span></code></pre></div></td></tr></table></div> <p>该接口接收一个参数表示退出信息</p> <p>除了上面的两种线程退出的方法外，还可以使用下面的接口取消一个线程：</p> <div class="language-c highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-13-1><span class=kt>int</span><span class=w> </span><span class=nf>pthread_cancel</span><span class=p>(</span><span class=n>pthread_t</span><span class=w> </span><span class=kr>thread</span><span class=p>);</span>
</span></code></pre></div></td></tr></table></div> <p>该接口接收一个参数，表示需要取消的线程<code>id</code></p> <p>一般情况下，这个接口是主线程调用，取消其他的新线程，并且必须取消线程之前必须确保指定的线程存在</p> <p>注意，取消的线程依旧需要回收，并且对应线程的退出码为-1，这个值是一个宏，定义如下：</p> <div class="language-c highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-14-1><span class=cp>#define PTHREAD_CANCELED ((void*)-1)</span>
</span></code></pre></div></td></tr></table></div> <h3 id=_18>线程分离<a class=headerlink href=#_18 title="Permanent link">&para;</a></h3> <p>前面回收线程时是阻塞式等待，但是注意回收线程没有非阻塞式等待，所以也就没有对应的非阻塞式等待的接口。在Linux中，线程被等待的状态分为以下两种：</p> <ol> <li>joinable：表示线程需要被阻塞式等待</li> <li>detached：表示线程已经被分离，主线程不再需要等待</li> </ol> <p>需要注意的是，在多执行流的情况下，一定要确保主执行流最后退出，防止分离的线程比主执行流先退出导致分离的线程需要的资源被释放导致错误</p> <p>线程分离操作可以分为两种：</p> <ol> <li>自主分离</li> <li>被动分离</li> </ol> <p>需要分离线程时可以使用下面的接口：</p> <div class="language-c highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-15-1><span class=kt>int</span><span class=w> </span><span class=nf>pthread_detach</span><span class=p>(</span><span class=n>pthread_t</span><span class=w> </span><span class=kr>thread</span><span class=p>);</span>
</span></code></pre></div></td></tr></table></div> <p>该接口传递一个参数，表示需要分离的线程的<code>id</code>，如果是自主分离，则通过<code>pthread_self</code>接口获取到当前线程的<code>id</code>实现，否则通过直接通过具体的值被其他线程被动分离</p> <p>由于分离后的新线程不需要主线程等待，所以如果一个线程依旧等待分离的线程，那么<code>pthread_join</code>就不再返回0而是返回22</p> <h3 id=_19>线程程序替换<a class=headerlink href=#_19 title="Permanent link">&para;</a></h3> <p>注意，<a href=https://www.help-doc.top/Linux/process-control/process-control.html#_7>进程程序替换</a>是不可以直接发生在线程执行流中的，因为程序替换的本质是替换掉当前进程的代码，此时线程的代码也会被替换从而导致错误，但是可以在线程中创建子进程，再在子进程中使用进程程序替换</p> <h2 id=c>C++中的线程操作<a class=headerlink href=#c title="Permanent link">&para;</a></h2> <p>除了C语言对系统的相关线程操作进行了封装外，其他编程语言也会做同样的事情，这样可以确保语言具有可移植性，同样，C++中也有对应的线程库<code>&lt;thread&gt;</code>，具体接口见<a href=https://www.help-doc.top/cpp/multi-thread/multi-thread.html#c>C++并发支持库</a>部分，但是需要注意的是，如果是在Linux下使用C++线程库编写代码，编译该代码时依旧需要携带<code>-lpthread</code>，因为C++线程库本质也是封装了<code>libpthread.so</code></p> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title=最后更新> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">2025年7月30日</span> </span> </aside> <form class=md-feedback name=feedback hidden> <fieldset> <legend class=md-feedback__title> 页面有帮助吗？ </legend> <div class=md-feedback__inner> <div class=md-feedback__list> <button class="md-feedback__icon md-icon" type=submit title=页面对我有帮助 data-md-value=1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M5 9v12H1V9zm4 12a2 2 0 0 1-2-2V9c0-.55.22-1.05.59-1.41L14.17 1l1.06 1.06c.27.27.44.64.44 1.05l-.03.32L14.69 8H21a2 2 0 0 1 2 2v2c0 .26-.05.5-.14.73l-3.02 7.05C19.54 20.5 18.83 21 18 21zm0-2h9.03L21 12v-2h-8.79l1.13-5.32L9 9.03z"/></svg> </button> <button class="md-feedback__icon md-icon" type=submit title=页面没有帮助到我 data-md-value=0> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 15V3h4v12zM15 3a2 2 0 0 1 2 2v10c0 .55-.22 1.05-.59 1.41L9.83 23l-1.06-1.06c-.27-.27-.44-.64-.44-1.06l.03-.31.95-4.57H3a2 2 0 0 1-2-2v-2c0-.26.05-.5.14-.73l3.02-7.05C4.46 3.5 5.17 3 6 3zm0 2H5.97L3 12v2h8.78l-1.13 5.32L15 14.97z"/></svg> </button> </div> <div class=md-feedback__note> <div data-md-value=1 hidden> 谢谢你的反馈！ </div> <div data-md-value=0 hidden> 谢谢你的反馈！联系<a href=https://www.help-doc.top/author/contact/contact.html>作者</a>提供更详细的信息 </div> </div> </div> </fieldset> </form> <!-- Waline 评论系统 --> <div id=waline></div> <!-- 评论系统 --> <!-- Waline 评论系统 --> <div id=waline></div> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2024-2025 柯懒不是柯南 </div> </div> <div class="md-footer-love md-typeset"> 一闪一闪亮晶晶，不及<span class=love-highlight>小亮</span><span class=love-heart>♥</span>照我心。To Li Liang </div> <div class=md-social> <a href=https://github.com/H0308 target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> <a href=https://www.help-doc.top/author/contact/contact.html target=_blank rel=noopener title=www.help-doc.top class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M433.754 420.445c-11.526 1.393-44.86-52.741-44.86-52.741 0 31.345-16.136 72.247-51.051 101.786 16.842 5.192 54.843 19.167 45.803 34.421-7.316 12.343-125.51 7.881-159.632 4.037-34.122 3.844-152.316 8.306-159.632-4.037-9.045-15.25 28.918-29.214 45.783-34.415-34.92-29.539-51.059-70.445-51.059-101.792 0 0-33.334 54.134-44.859 52.741-5.37-.65-12.424-29.644 9.347-99.704 10.261-33.024 21.995-60.478 40.144-105.779C60.683 98.063 108.982.006 224 0c113.737.006 163.156 96.133 160.264 214.963 18.118 45.223 29.912 72.85 40.144 105.778 21.768 70.06 14.716 99.053 9.346 99.704"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": ["navigation.indexes", "navigation.prune", "navigation.tabs", "search.highlight", "content.code.copy"], "search": "../../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script> <script src=../../../assets/javascripts/bundle.c8b220af.min.js></script> <script src=../../../javascripts/katex.min.js></script> <script src=../../../javascripts/other.min.js></script> <script src=../../../javascripts/copyright.min.js></script> <script src=../../../javascripts/waline.min.js></script> <script src=https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.js></script> <script src=https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/contrib/auto-render.min.js></script> <script src=https://cdn.jsdelivr.net/npm/mermaid@11.5.0/dist/mermaid.min.js></script> <script src=../../../assets/javascripts/toggle-sidebar.js async></script> <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body> </html>