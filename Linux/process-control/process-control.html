<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=canonical href=https://www.help-doc.top/Linux/process-control/process-control.html><link rel=prev href=../process-address-space/process-address-space.html><link rel=next href=../linux-fileop/linux-fileop.html><link rel=icon href=../../images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.12"><title>Linux进程控制 - 柯懒的知识库</title><link rel=stylesheet href=../../assets/stylesheets/main.2afb09e1.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><link rel=stylesheet href=../../css/timeline.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-9XWRGNRRSY"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-9XWRGNRRSY",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-9XWRGNRRSY",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script><link rel=stylesheet href=../../stylesheets/colors.min.css><link rel=stylesheet href=../../stylesheets/theme2.min.css media="screen and (max-width: 1199px)"><link rel=stylesheet href=../../stylesheets/theme2.min.css media="screen and (min-width: 1200px)" id=theme2-desktop><link rel=stylesheet href=../../stylesheets/theme1.min.css media="screen and (min-width: 1200px)" id=theme1-desktop><link rel=stylesheet href=../../stylesheets/print.min.css><link rel=stylesheet href=../../stylesheets/font-dongguanti.min.css id=font-dongguanti><link rel=stylesheet href=../../stylesheets/font-oppoti.min.css id=font-oppoti disabled><link rel=stylesheet href=../../stylesheets/font-jiangchengti.min.css id=font-jiangchengti disabled><link rel=stylesheet href=../../stylesheets/font-lxgw.min.css id=font-lxgw disabled><link rel=stylesheet href=../../stylesheets/code-font-dejavu-sans-mono.min.css id=code-font-dejavu-sans-mono><link rel=stylesheet href=../../stylesheets/code-font-zsft-hk.min.css id=code-font-zsft-hk disabled><link rel=stylesheet href=https://unpkg.com/@waline/client@v3/dist/waline.css><link rel=stylesheet href=../../stylesheets/waline.min.css><script src=../../javascripts/start.min.js></script> <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../assets/javascripts/glightbox.min.js"></script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=white data-md-color-accent=cyan> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#linux class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=页眉> <a href=../../index.html title=柯懒的知识库 class="md-header__button md-logo" aria-label=柯懒的知识库 data-md-component=logo> <img src=../../assets/logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> 柯懒的知识库 </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Linux进程控制 </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=white data-md-color-accent=cyan aria-label type=radio name=__palette id=__palette_1> </form> <!-- 头像元素 - 直接在HTML中定义 --> <div class=header-avatar> <img src=../../author/作者.assets/20250206-200653.jpg alt=头像> <div class=avatar-dropdown> <p><strong>柯懒不是柯南</strong></p> <a href=../../author/contact/contact.html class=avatar-dropdown-item>吵醒柯懒</a> <div class=avatar-dropdown-divider></div> <a href=../../author/about/about.html class=avatar-dropdown-item>柯懒自传</a> <div class=avatar-dropdown-divider></div> <a href=https://github.com/H0308 class=avatar-dropdown-item>柯懒的零食库</a> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=查找> <button type=reset class="md-search__icon md-icon" title=清空当前内容 aria-label=清空当前内容 tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 正在初始化搜索引擎 </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> </nav> </header> <!-- 独立的切换按钮 --> <div class=toolbar-toggle-btn id=toolbarToggleBtn onclick=toggleToolbar()> <div class=toggle-icon> <svg class=toggle-arrow-icon viewbox="0 0 1024 1024" version=1.1 xmlns=http://www.w3.org/2000/svg width=16 height=16> <path d="M346.538667 1024L170.666667 853.333333l341.333333-341.333333-341.333333-341.333333 175.872-170.666667L853.333333 512z" fill=currentColor></path> </svg> </div> </div> <!-- 右侧固定功能条 - 独立于内容区 --> <div class=floating-toolbar id=floatingToolbar> <!-- 字体切换功能 --> <div class="toolbar-item font-switcher"> <div class=toolbar-icon> <svg class=font-icon viewbox="0 0 1024 1024" version=1.1 xmlns=http://www.w3.org/2000/svg width=20 height=20> <path d="M913.408 1024l-66.56 0q-29.696 0-51.2-5.12t-36.864-15.872-26.112-27.136-19.968-37.888q-15.36-38.912-28.16-70.656t-22.016-55.296q-11.264-26.624-20.48-49.152l-254.976 0q-7.168 23.552-17.408 51.2-8.192 23.552-21.504 56.832t-30.72 72.192q-20.48 46.08-47.104 63.488t-60.416 17.408l-70.656 0q-45.056 0-60.928-19.968t2.56-68.096q18.432-46.08 43.008-108.544t52.224-132.608 57.344-143.872 57.344-144.384q65.536-164.864 137.216-343.04 7.168-17.408 18.432-31.744 10.24-11.264 27.136-21.504t42.496-10.24q26.624 0 43.52 10.752t28.16 24.064q12.288 15.36 19.456 33.792 72.704 180.224 138.24 345.088 27.648 70.656 57.344 143.872t56.832 142.336 51.2 129.536 41.472 104.448q14.336 34.816 4.096 62.464t-43.008 27.648zM616.448 634.88l-97.28-347.136-1.024 0-108.544 347.136 206.848 0z" fill=currentColor></path> </svg> </div> <div class=toolbar-label>内容字体</div> <div class=font-dropdown-toolbar> <div class=font-current-toolbar onclick=toggleFontDropdownToolbar()> <span class=current-font-name-toolbar>东观体</span> <svg class=dropdown-arrow-icon viewbox="0 0 1024 1024" version=1.1 xmlns=http://www.w3.org/2000/svg width=12 height=12> <path d="M878.592 250.88q29.696 0 48.128 11.264t24.576 29.696 0 41.472-26.624 45.568q-82.944 92.16-159.744 180.224t-148.48 164.864q-19.456 20.48-45.568 31.744t-53.76 11.776-53.248-8.704-43.008-28.672q-39.936-44.032-82.944-90.112l-88.064-92.16q-43.008-46.08-85.504-90.624t-79.36-86.528q-17.408-19.456-22.528-40.448t1.024-38.4 23.552-28.672 45.056-11.264q35.84 0 98.816-0.512t137.728-0.512l153.6 0 150.528 0 125.952 0 79.872 0z" fill=currentColor></path> </svg> </div> <div class=font-options-toolbar> <div class=font-option-toolbar data-font=dongguanti onclick="selectFontToolbar('dongguanti')">上图东观体 </div> <div class=font-option-toolbar data-font=oppoti onclick="selectFontToolbar('oppoti')">OPPO Sans </div> <div class=font-option-toolbar data-font=jiangchengti onclick="selectFontToolbar('jiangchengti')"> 江城黑体</div> <div class=font-option-toolbar data-font=lxgw onclick="selectFontToolbar('lxgw')">霞鹜臻楷</div> </div> </div> </div> <!-- 代码字体切换功能 --> <div class="toolbar-item code-font-switcher"> <div class=toolbar-icon> <svg t=1753672111433 class="icon code-font-icon" viewbox="0 0 1024 1024" version=1.1 xmlns=http://www.w3.org/2000/svg p-id=5148 width=20 height=20> <path d="M941.709938 0H82.290062A82.290062 82.290062 0 0 0 0 82.290062v859.419876A82.290062 82.290062 0 0 0 82.290062 1022.53923h859.419876A82.290062 82.290062 0 0 0 1022.53923 941.709938V82.290062A82.290062 82.290062 0 0 0 941.709938 0zM188.439372 553.631954a40.901569 40.901569 0 0 1-29.215406-70.116975L292.154066 351.558726 159.223966 218.628626a40.901569 40.901569 0 0 1 58.430813-57.94389l160.197813 162.145507a40.901569 40.901569 0 0 1 0 57.943889l-160.197813 160.684736a40.901569 40.901569 0 0 1-29.215407 12.173086z m443.587257 0H405.120304a40.901569 40.901569 0 0 1 0-82.290061H633.000476a40.901569 40.901569 0 0 1 0 82.290061z" fill=currentColor p-id=5149></path> </svg> </div> <div class=toolbar-label>代码字体</div> <div class=code-font-dropdown-toolbar> <div class=code-font-current-toolbar onclick=toggleCodeFontDropdownToolbar()> <span class=current-code-font-name-toolbar>DejaVu Sans Mono</span> <svg class=dropdown-arrow-icon viewbox="0 0 1024 1024" version=1.1 xmlns=http://www.w3.org/2000/svg width=12 height=12> <path d="M878.592 250.88q29.696 0 48.128 11.264t24.576 29.696 0 41.472-26.624 45.568q-82.944 92.16-159.744 180.224t-148.48 164.864q-19.456 20.48-45.568 31.744t-53.76 11.776-53.248-8.704-43.008-28.672q-39.936-44.032-82.944-90.112l-88.064-92.16q-43.008-46.08-85.504-90.624t-79.36-86.528q-17.408-19.456-22.528-40.448t1.024-38.4 23.552-28.672 45.056-11.264q35.84 0 98.816-0.512t137.728-0.512l153.6 0 150.528 0 125.952 0 79.872 0z" fill=currentColor></path> </svg> </div> <div class=code-font-options-toolbar> <div class=code-font-option-toolbar data-code-font=dejavu onclick="selectCodeFontToolbar('dejavu')"> DejaVu Sans Mono</div> <div class=code-font-option-toolbar data-code-font=zsft onclick="selectCodeFontToolbar('zsft')"> JetBrains Mono</div> </div> </div> </div> <!-- 主题切换功能 --> <div class="toolbar-item theme-switcher" onclick=switchTheme()> <div class=toolbar-icon> <svg class=theme-icon viewbox="0 0 1024 1024" version=1.1 xmlns=http://www.w3.org/2000/svg width=20 height=20> <path d="M876.572788 522.301623c-1.886977 12.375865-9.657964 30.331819-35.880185 45.48903-56.489572 32.697703-150.21828 83.990926-174.010149 96.958262-13.143345 24.431435-66.067718 122.221646-98.141204 178.503487-16.117073 28.124548-36.055171 34.041304-50.030463 34.041304-0.031722 0-0.031722 0-0.031722 0-14.613836 0-29.1806-6.460132-43.234687-19.218714-47.183626-42.643216-125.994576-117.105115-146.013515-136.083351-27.757181-4.732791-138.338718-23.743774-200.584388-35.752272-17.924231-3.533476-32.649608-14.07046-40.372499-29.084409-5.78782-11.256368-10.281157-30.05962 1.471514-55.658647 26.989701-59.047838 74.126254-157.557432 85.957721-182.196599-3.437286-27.117614-16.996093-135.060045-23.760147-198.905142-1.886977-17.460674 3.901867-35.096333 15.829524-48.351218 12.791327-14.278191 30.667463-21.48943 49.854455-19.426445 63.669088 6.332219 173.259042 19.426445 200.584388 22.705118 24.335245-11.879562 121.085776-58.936297 180.133613-86.34146 9.91379-4.573155 19.85828-6.92369 29.596062-6.92369 28.748764 0 52.172243 20.642133 58.328453 51.421136 12.599969 62.997799 30.93864 166.70272 35.639708 193.484689 18.851347 19.682271 91.953272 96.031147 135.060045 143.07151C872.72004 487.125473 879.307062 504.71406 876.572788 522.301623L876.572788 522.301623zM825.375755 499.085876C776.017604 445.314205 687.245791 352.977193 686.365748 352.017332c-2.942005-3.069919-4.956895-6.971785-5.676279-11.208273-0.207731-1.215688-22.193465-127.001509-36.551474-198.936865-0.799202-3.917216-4.285606-16.836457-16.196891-16.836457-3.453658 0-7.30743 1.006933-11.464099 2.942005-67.282383 31.179117-183.955662 88.180342-185.170327 88.771813-3.693112 1.790786-7.850805 2.558265-11.975752 2.01489-1.295506-0.224104-133.63765-16.165168-205.988468-23.424502-0.079818 0-0.207731 0-0.287549 0-7.30743 0-11.128455 2.89391-13.319353 5.40408-3.677762 4.124947-5.644557 9.91379-5.068436 15.110139 7.674796 72.623018 24.255427 202.934922 24.463158 204.325595 0.511653 4.109598-0.159636 8.266267-1.966795 11.960403-0.591471 1.215688-57.657164 120.04712-88.339977 187.201589-3.565199 7.754614-4.41352 14.214746-2.350534 18.131963 1.935072 3.725858 6.588045 5.820566 10.360975 6.53995 70.719668 13.718443 204.644867 36.519752 206.036563 36.727483 4.189416 0.671289 8.058536 2.686179 11.112082 5.580089 1.006933 0.87902 96.414887 91.281983 150.090367 139.889027 8.314363 7.563256 13.143345 8.106632 14.437827 8.106632 3.485381 0 8.314363-4.621251 12.727882-12.391215 36.343743-63.828724 100.011808-181.988868 100.636025-183.155437 1.983167-3.64604 5.004991-6.667863 8.650007-8.650007 1.134847-0.671289 114.418936-62.373583 178.6314-99.516528 8.698103-5.036713 14.278191-10.568706 14.94948-14.854313C834.681702 511.845481 831.49922 505.800811 825.375755 499.085876L825.375755 499.085876zM935.333076 935.670256c-4.157693 4.157693-9.689686 6.299473-15.141862 6.299473-5.548366 0-11.048637-2.142803-15.238053-6.299473l-171.915441-171.915441c-8.362458-8.394181-8.362458-21.98471 0-30.426987 8.394181-8.394181 21.98471-8.394181 30.379914 0l171.915441 171.915441C943.727257 913.684522 943.727257 927.275052 935.333076 935.670256L935.333076 935.670256z" fill=currentColor></path> </svg> </div> <div class=toolbar-label>主题切换</div> </div> <!-- 返回顶部功能 --> <div class="toolbar-item back-to-top" onclick=scrollToTop()> <div class=toolbar-icon> <svg class=back-to-top-icon viewbox="0 0 1024 1024" xmlns=http://www.w3.org/2000/svg> <path d="M882.688 624.128l-336.896-583.68c-15.872-27.136-54.784-27.136-70.656 0L138.24 624.128c-15.872 27.136 4.096 61.44 35.328 61.44H317.44c22.528 0 40.96 18.432 40.96 40.96v239.616c0 22.528 18.432 40.96 40.96 40.96h223.232c22.528 0 40.96-18.432 40.96-40.96v-239.616c0-22.528 18.432-40.96 40.96-40.96h143.872c30.208 0 50.176-34.304 34.304-61.44z"> </path> </svg> </div> <div class=toolbar-label>返回顶部</div> </div> </div> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=标签 data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../index.html class=md-tabs__link> 主页 </a> </li> <li class=md-tabs__item> <a href=../../intro/intro.html class=md-tabs__link> 网站介绍 </a> </li> <li class=md-tabs__item> <a href=../../timeline/timeline.html class=md-tabs__link> 网站时间线 </a> </li> <li class=md-tabs__item> <a href=../../c-lang/index.html class=md-tabs__link> 编程语言 </a> </li> <li class=md-tabs__item> <a href=../../data-structure/time-space-complexity/time-space-complexity.html class=md-tabs__link> 数据结构与算法 </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../options-commands/options-commands.html class=md-tabs__link> Linux </a> </li> <li class=md-tabs__item> <a href=../../html-css/html/html.html class=md-tabs__link> 前端 </a> </li> <li class=md-tabs__item> <a href=../../MySQL/JDBC/JDBC-basic/JDBC-basic.html class=md-tabs__link> MySQL </a> </li> <li class=md-tabs__item> <a href=../../JavaEE/Spring/springmvc-basic/springmvc-basic.html class=md-tabs__link> JavaEE应用开发 </a> </li> <li class=md-tabs__item> <a href=../../other/shell/shell.html class=md-tabs__link> 扩展知识 </a> </li> <li class=md-tabs__item> <a href=../../tooltips/vscode-snippets/vscode-snippets.html class=md-tabs__link> 工具帮助 </a> </li> <li class=md-tabs__item> <a href=../../test-encrypt/test-encrypt.html class=md-tabs__link> 测试加密功能 </a> </li> <li class=md-tabs__item> <a href=../../projects/boost-searching-engine/boost-searching-engine.html class=md-tabs__link> 项目 </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=导航栏 data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../index.html title=柯懒的知识库 class="md-nav__button md-logo" aria-label=柯懒的知识库 data-md-component=logo> <img src=../../assets/logo.png alt=logo> </a> 柯懒的知识库 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../index.html class=md-nav__link> <span class=md-ellipsis> 主页 </span> </a> </li> <li class=md-nav__item> <a href=../../intro/intro.html class=md-nav__link> <span class=md-ellipsis> 网站介绍 </span> </a> </li> <li class=md-nav__item> <a href=../../timeline/timeline.html class=md-nav__link> <span class=md-ellipsis> 网站时间线 </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../c-lang/index.html class=md-nav__link> <span class=md-ellipsis> 编程语言 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../data-structure/time-space-complexity/time-space-complexity.html class=md-nav__link> <span class=md-ellipsis> 数据结构与算法 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6 checked> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex> <span class=md-ellipsis> Linux </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=true> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Linux </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../options-commands/options-commands.html class=md-nav__link> <span class=md-ellipsis> Linux常用选项和指令 </span> </a> </li> <li class=md-nav__item> <a href=../permission/permission.html class=md-nav__link> <span class=md-ellipsis> Linux权限相关 </span> </a> </li> <li class=md-nav__item> <a href=../software-installation/software-installation.html class=md-nav__link> <span class=md-ellipsis> CentOS软件安装 </span> </a> </li> <li class=md-nav__item> <a href=../gcc-gdb/gcc-gdb.html class=md-nav__link> <span class=md-ellipsis> Linux下的gcc与gdb </span> </a> </li> <li class=md-nav__item> <a href=../makefile-progress-bar/makefile-progress-bar.html class=md-nav__link> <span class=md-ellipsis> Linux下的Makefile与进度条程序 </span> </a> </li> <li class=md-nav__item> <a href=../os-basic/os-basic.html class=md-nav__link> <span class=md-ellipsis> 操作系统基础知识 </span> </a> </li> <li class=md-nav__item> <a href=../process-basic/process-basic.html class=md-nav__link> <span class=md-ellipsis> Linux进程基础 </span> </a> </li> <li class=md-nav__item> <a href=../process-state-priority/process-state-priority.html class=md-nav__link> <span class=md-ellipsis> Linux进程状态与进程优先级 </span> </a> </li> <li class=md-nav__item> <a href=../process-switch-scheduling/process-switch-scheduling.html class=md-nav__link> <span class=md-ellipsis> Linux进程切换以及调度算法 </span> </a> </li> <li class=md-nav__item> <a href=../command-line-env/command-line-env.html class=md-nav__link> <span class=md-ellipsis> Linux命令行与环境变量 </span> </a> </li> <li class=md-nav__item> <a href=../process-address-space/process-address-space.html class=md-nav__link> <span class=md-ellipsis> Linux进程地址空间 </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Linux进程控制 </span> <span class="md-nav__icon md-icon"></span> </label> <a href=process-control.html class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Linux进程控制 </span> </a> <nav class="md-nav md-nav--secondary" aria-label=本节目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 本节目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#_1 class=md-nav__link> <span class=md-ellipsis> 进程创建 </span> </a> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> <span class=md-ellipsis> 进程终止 </span> </a> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> <span class=md-ellipsis> 进程回收 </span> </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> <span class=md-ellipsis> 进程退出信息 </span> </a> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> <span class=md-ellipsis> 子进程使用案例 </span> </a> </li> <li class=md-nav__item> <a href=#_6 class=md-nav__link> <span class=md-ellipsis> 阻塞与非阻塞 </span> </a> </li> <li class=md-nav__item> <a href=#_7 class=md-nav__link> <span class=md-ellipsis> 进程程序替换 </span> </a> <nav class=md-nav aria-label=进程程序替换> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_8 class=md-nav__link> <span class=md-ellipsis> 介绍 </span> </a> </li> <li class=md-nav__item> <a href=#_9 class=md-nav__link> <span class=md-ellipsis> 原理简单解释 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#shell1 class=md-nav__link> <span class=md-ellipsis> 手撕一个简单的shell（版本1） </span> </a> <nav class=md-nav aria-label=手撕一个简单的shell（版本1）> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_10 class=md-nav__link> <span class=md-ellipsis> 输出提示内容 </span> </a> </li> <li class=md-nav__item> <a href=#_11 class=md-nav__link> <span class=md-ellipsis> 获取用户输入 </span> </a> </li> <li class=md-nav__item> <a href=#_12 class=md-nav__link> <span class=md-ellipsis> 拆分用户输入 </span> </a> </li> <li class=md-nav__item> <a href=#_13 class=md-nav__link> <span class=md-ellipsis> 执行对应程序 </span> </a> </li> <li class=md-nav__item> <a href=#_14 class=md-nav__link> <span class=md-ellipsis> 内建命令处理 </span> </a> <nav class=md-nav aria-label=内建命令处理> <ul class=md-nav__list> <li class=md-nav__item> <a href=#cd class=md-nav__link> <span class=md-ellipsis> cd命令处理 </span> </a> </li> <li class=md-nav__item> <a href=#export class=md-nav__link> <span class=md-ellipsis> export命令处理 </span> </a> </li> <li class=md-nav__item> <a href=#env class=md-nav__link> <span class=md-ellipsis> env命令处理 </span> </a> </li> <li class=md-nav__item> <a href=#echo class=md-nav__link> <span class=md-ellipsis> echo命令处理 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_15 class=md-nav__link> <span class=md-ellipsis> 优化 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../linux-fileop/linux-fileop.html class=md-nav__link> <span class=md-ellipsis> Linux文件操作基础 </span> </a> </li> <li class=md-nav__item> <a href=../io-process/io-process.html class=md-nav__link> <span class=md-ellipsis> Linux中输入和输出基本过程 </span> </a> </li> <li class=md-nav__item> <a href=../file-system/file-system.html class=md-nav__link> <span class=md-ellipsis> Linux文件系统 </span> </a> </li> <li class=md-nav__item> <a href=../soft-hard-link/soft-hard-link.html class=md-nav__link> <span class=md-ellipsis> Linux软链接和硬链接 </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../com-process/com-anonymous-pipe/com-anonymous-pipe.html class=md-nav__link> <span class=md-ellipsis> Linux进程间通信 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class=md-nav__item> <a href=../signals-os-principles/signals-os-principles.html class=md-nav__link> <span class=md-ellipsis> Linux信号与操作系统原理 </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../linux-thread/thread-concept-op/thread-concept-op.html class=md-nav__link> <span class=md-ellipsis> Linux线程 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class=md-nav__item> <a href=../net-basic/net-basic.html class=md-nav__link> <span class=md-ellipsis> 网络基础知识 </span> </a> </li> <li class=md-nav__item> <a href=../socket-basic/socket-basic.html class=md-nav__link> <span class=md-ellipsis> Socket编程基础 </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../udp/udp-basic/udp-basic.html class=md-nav__link> <span class=md-ellipsis> UDP编程 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class=md-nav__item> <a href=../tcp-basic/tcp-basic.html class=md-nav__link> <span class=md-ellipsis> TCP编程接口基本使用 </span> </a> </li> <li class=md-nav__item> <a href=../serialization-net-cal/serialization-net-cal.html class=md-nav__link> <span class=md-ellipsis> 序列化和反序列化与网络计算器 </span> </a> </li> <li class=md-nav__item> <a href=../process-relationship-daemon/process-relationship-daemon.html class=md-nav__link> <span class=md-ellipsis> 进程间关系和守护进程 </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../http/http-basic-httpserver/http-basic-httpserver.html class=md-nav__link> <span class=md-ellipsis> 应用层协议HTTP </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class=md-nav__item> <a href=../udp-principles/udp-principles.html class=md-nav__link> <span class=md-ellipsis> UDP协议原理 </span> </a> </li> <li class=md-nav__item> <a href=../tcp-principles/tcp-principles.html class=md-nav__link> <span class=md-ellipsis> TCP协议原理 </span> </a> </li> <li class=md-nav__item> <a href=../tcp-connection-backlog/tcp-connection-backlog.html class=md-nav__link> <span class=md-ellipsis> 理解Linux如何看待连接以及TCP全连接队列 </span> </a> </li> <li class=md-nav__item> <a href=../ip/ip.html class=md-nav__link> <span class=md-ellipsis> 网络层IP协议 </span> </a> </li> <li class=md-nav__item> <a href=../datalink/datalink.html class=md-nav__link> <span class=md-ellipsis> 数据链路层协议 </span> </a> </li> <li class=md-nav__item> <a href=../dns-icmp/dns-icmp.html class=md-nav__link> <span class=md-ellipsis> DNS与ICMP </span> </a> </li> <li class=md-nav__item> <a href=../nat-proxy/nat-proxy.html class=md-nav__link> <span class=md-ellipsis> NAT技术、代理服务器和内网穿透 </span> </a> </li> <li class=md-nav__item> <a href=../io-model-select-poll/io-model-select-poll.html class=md-nav__link> <span class=md-ellipsis> 五种IO模型与select和poll分别实现多路转接 </span> </a> </li> <li class=md-nav__item> <a href=../epoll/epoll.html class=md-nav__link> <span class=md-ellipsis> epoll实现多路转接 </span> </a> </li> <li class=md-nav__item> <a href=../reactor-et/reactor-et.html class=md-nav__link> <span class=md-ellipsis> Reactor模式与完善基于边缘触发模式epoll实现TCP服务器 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../html-css/html/html.html class=md-nav__link> <span class=md-ellipsis> 前端 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../MySQL/JDBC/JDBC-basic/JDBC-basic.html class=md-nav__link> <span class=md-ellipsis> MySQL </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../JavaEE/Spring/springmvc-basic/springmvc-basic.html class=md-nav__link> <span class=md-ellipsis> JavaEE应用开发 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../other/shell/shell.html class=md-nav__link> <span class=md-ellipsis> 扩展知识 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../tooltips/vscode-snippets/vscode-snippets.html class=md-nav__link> <span class=md-ellipsis> 工具帮助 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../test-encrypt/test-encrypt.html class=md-nav__link> <span class=md-ellipsis> 测试加密功能 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../projects/boost-searching-engine/boost-searching-engine.html class=md-nav__link> <span class=md-ellipsis> 项目 </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=本节目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 本节目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#_1 class=md-nav__link> <span class=md-ellipsis> 进程创建 </span> </a> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> <span class=md-ellipsis> 进程终止 </span> </a> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> <span class=md-ellipsis> 进程回收 </span> </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> <span class=md-ellipsis> 进程退出信息 </span> </a> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> <span class=md-ellipsis> 子进程使用案例 </span> </a> </li> <li class=md-nav__item> <a href=#_6 class=md-nav__link> <span class=md-ellipsis> 阻塞与非阻塞 </span> </a> </li> <li class=md-nav__item> <a href=#_7 class=md-nav__link> <span class=md-ellipsis> 进程程序替换 </span> </a> <nav class=md-nav aria-label=进程程序替换> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_8 class=md-nav__link> <span class=md-ellipsis> 介绍 </span> </a> </li> <li class=md-nav__item> <a href=#_9 class=md-nav__link> <span class=md-ellipsis> 原理简单解释 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#shell1 class=md-nav__link> <span class=md-ellipsis> 手撕一个简单的shell（版本1） </span> </a> <nav class=md-nav aria-label=手撕一个简单的shell（版本1）> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_10 class=md-nav__link> <span class=md-ellipsis> 输出提示内容 </span> </a> </li> <li class=md-nav__item> <a href=#_11 class=md-nav__link> <span class=md-ellipsis> 获取用户输入 </span> </a> </li> <li class=md-nav__item> <a href=#_12 class=md-nav__link> <span class=md-ellipsis> 拆分用户输入 </span> </a> </li> <li class=md-nav__item> <a href=#_13 class=md-nav__link> <span class=md-ellipsis> 执行对应程序 </span> </a> </li> <li class=md-nav__item> <a href=#_14 class=md-nav__link> <span class=md-ellipsis> 内建命令处理 </span> </a> <nav class=md-nav aria-label=内建命令处理> <ul class=md-nav__list> <li class=md-nav__item> <a href=#cd class=md-nav__link> <span class=md-ellipsis> cd命令处理 </span> </a> </li> <li class=md-nav__item> <a href=#export class=md-nav__link> <span class=md-ellipsis> export命令处理 </span> </a> </li> <li class=md-nav__item> <a href=#env class=md-nav__link> <span class=md-ellipsis> env命令处理 </span> </a> </li> <li class=md-nav__item> <a href=#echo class=md-nav__link> <span class=md-ellipsis> echo命令处理 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_15 class=md-nav__link> <span class=md-ellipsis> 优化 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=linux>Linux进程控制<a class=headerlink href=#linux title="Permanent link">&para;</a></h1> <div style="margin-top: -30px; font-size: 0.75em; opacity: 0.7;"> <p><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10h-2a8 8 0 0 1-8 8 8 8 0 0 1-8-8 8 8 0 0 1 8-8zm6.78 1a.7.7 0 0 0-.48.2l-1.22 1.21 2.5 2.5L20.8 5.7c.26-.26.26-.7 0-.95L19.25 3.2c-.13-.13-.3-.2-.47-.2m-2.41 2.12L9 12.5V15h2.5l7.37-7.38z"/></svg></span> 约 5805 个字 <span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M392.8 1.2c-17-4.9-34.7 5-39.6 22l-128 448c-4.9 17 5 34.7 22 39.6s34.7-5 39.6-22l128-448c4.9-17-5-34.7-22-39.6m80.6 120.1c-12.5 12.5-12.5 32.8 0 45.3l89.3 89.4-89.4 89.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l112-112c12.5-12.5 12.5-32.8 0-45.3l-112-112c-12.5-12.5-32.8-12.5-45.3 0zm-306.7 0c-12.5-12.5-32.8-12.5-45.3 0l-112 112c-12.5 12.5-12.5 32.8 0 45.3l112 112c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256l89.4-89.4c12.5-12.5 12.5-32.8 0-45.3"/></svg></span> 843 行代码 <span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 17H7V3h14m0-2H7a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2M3 5H1v16a2 2 0 0 0 2 2h16v-2H3m12.96-10.71-2.75 3.54-1.96-2.36L8.5 15h11z"/></svg></span> 11 张图片 <span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 20c4.42 0 8-3.58 8-8s-3.58-8-8-8-8 3.58-8 8 3.58 8 8 8m0-18c5.5 0 10 4.5 10 10s-4.5 10-10 10C6.47 22 2 17.5 2 12S6.5 2 12 2m.5 11H11V7h1.5v4.26l3.7-2.13.75 1.3z"/></svg></span> 预计阅读时间 30 分钟</p> </div> <h2 id=_1>进程创建<a class=headerlink href=#_1 title="Permanent link">&para;</a></h2> <p>在<a href=https://www.help-doc.top/Linux/process-basic/process-basic.html>Linux进程基础篇</a>已经提到过使用<code>fork</code>函数创建一个子进程。</p> <p>回想使用<code>fork</code>函数时，其返回值当子进程创建失败时，父进程接收到-1；当子进程创建成功时，则对于子进程来说接收到的返回值为0，而父进程接收到的返回值为子进程的<code>PID</code></p> <p>其原因现在也可以解释：前面提到当子进程不修改与父进程共享的数据时，子进程和父进程拥有同一块数据空间，但是因为<code>fork</code>函数创建完子进程后，函数会对两个进程的同一块区域的数据进行修改，导致子进程拥有的是一块新的空间，并在新的空间中写入0，而父进程依旧对应原来的空间，并在原空间中写入子进程的<code>PID</code></p> <p>以上便是在代码中创建子进程的步骤</p> <h2 id=_2>进程终止<a class=headerlink href=#_2 title="Permanent link">&para;</a></h2> <p>前面在父进程中创建子进程只满足了创建，并没有满足终止。在程序中，如果想终止一个进程，可以使用三种方式：</p> <ol> <li><code>main</code>函数中<code>return</code></li> <li>在代码任何位置使用<code>exit()</code>函数，参数可以是任意整数</li> <li>在代码任何位置使用<code>_exit()</code>函数，参数可以是任意整数</li> </ol> <div class="admonition note"> <p class=admonition-title>Note</p> <p>第二个方式和第三个方式与第一个方式最大的不同：第一个方式只会结束某一个函数，而第二个方式和第三个方式会直接结束一个进程</p> </div> <p>之前C语言部分介绍过：在不同的系统和C语言标准库的实现中都规定了一些错误码，一般是放在 <code>errno.h</code> 这个头文件中说明的，C语言程序启动的时候就会使用一个全局变量<code>errno</code>来记录程序的当前错误码，只不过程序启动的时候<code>errno</code>是0，一般0表示没有错误，而非0表示存在错误。当我们在使用标准库中的函数的时候发生了某种错误，就会将对应的错误码存放在<code>errno</code>中，而一个错误码的数字是整数很难理解是什么意思，所以每一个错误码都是有对应的错误信息的，但是不同的操作系统会存在不同的错误码和错误信息，为了更方便的显示指定的错误码对应的错误信息，可以使用<code>strerror</code>函数，参数传递<code>errno</code>变量或者指定的错误码。除了标准库中已经定义的错误，也可以约定某些错误码表示某种错误</p> <p>不论是库或者系统已经提供的错误码，还是自定义的错误码都可以作为<code>exit</code>函数和<code>_exit</code>函数的参数传递</p> <p>但是，<code>exit</code>函数和<code>_exit</code>函数存在细微的差别：<code>exit</code>函数在结束进程时，会刷新进程的缓冲区，但是<code>_exit</code>函数不会，例如下面的代码：</p> <div class="language-c highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-1><span class=c1>// 使用exit函数</span>
</span><span id=__span-0-2><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;stdio.h&gt;</span>
</span><span id=__span-0-3><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;stdlib.h&gt;</span>
</span><span id=__span-0-4>
</span><span id=__span-0-5><span class=kt>void</span><span class=w> </span><span class=nf>fun</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-0-6><span class=w>    </span><span class=n>printf</span><span class=p>(</span><span class=s>&quot;函数退出&quot;</span><span class=p>);</span>
</span><span id=__span-0-7><span class=w>    </span><span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span><span id=__span-0-8><span class=p>}</span>
</span><span id=__span-0-9>
</span><span id=__span-0-10><span class=kt>int</span><span class=w> </span><span class=nf>main</span><span class=p>(){</span>
</span><span id=__span-0-11><span class=w>    </span><span class=n>fun</span><span class=p>();</span>
</span><span id=__span-0-12><span class=w>    </span><span class=n>printf</span><span class=p>(</span><span class=s>&quot;进程正常退出</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>);</span>
</span><span id=__span-0-13>
</span><span id=__span-0-14><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-0-15><span class=p>}</span>
</span><span id=__span-0-16>
</span><span id=__span-0-17><span class=n>输出结果</span><span class=err>：</span>
</span><span id=__span-0-18><span class=n>函数退出</span>
</span><span id=__span-0-19>
</span><span id=__span-0-20><span class=c1>// 使用_exit函数</span>
</span><span id=__span-0-21><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;stdio.h&gt;</span>
</span><span id=__span-0-22><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;unistd.h&gt;</span>
</span><span id=__span-0-23>
</span><span id=__span-0-24><span class=kt>void</span><span class=w> </span><span class=n>fun</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-0-25><span class=w>    </span><span class=n>printf</span><span class=p>(</span><span class=s>&quot;函数退出&quot;</span><span class=p>);</span>
</span><span id=__span-0-26><span class=w>    </span><span class=n>_exit</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span><span id=__span-0-27><span class=p>}</span>
</span><span id=__span-0-28>
</span><span id=__span-0-29><span class=kt>int</span><span class=w> </span><span class=n>main</span><span class=p>(){</span>
</span><span id=__span-0-30><span class=w>    </span><span class=n>fun</span><span class=p>();</span>
</span><span id=__span-0-31><span class=w>    </span><span class=n>printf</span><span class=p>(</span><span class=s>&quot;进程正常退出</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>);</span>
</span><span id=__span-0-32>
</span><span id=__span-0-33><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-0-34><span class=p>}</span>
</span><span id=__span-0-35>
</span><span id=__span-0-36><span class=n>无输出结果</span>
</span></code></pre></div></td></tr></table></div> <p>因为<code>exit</code>函数是基于系统调用接口的函数，属于语言层面的函数，而<code>_exit</code>函数是系统的调用接口函数，前面提到<code>\n</code>可以刷新缓冲区，所以可以推断出，此处所谓的缓冲区实际上是语言级别的缓冲区。<code>_exit</code>函数在操作系统内部运行，并不知道有缓冲区的存在，自然也就无法刷新该缓冲区，对应的<code>exit</code>函数是语言层面的函数，对应的缓冲区是语言层的缓冲区，所以可以做到缓冲区刷新</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>可以认为<code>exit</code>函数底层调用了<code>_exit</code>函数和<code>fflush</code>函数</p> </div> <p>在进程结束部分提到过，可以使用<code>echo $?</code>获取最近一次结束的进程的退出码，所以此处也可以获取到通过<code>return</code>、<code>exit</code>或者<code>_exit</code>结束的进程返回值，查看上面的代码进程的退出码如下：</p> <p><a class=glightbox href="12. Linux进程控制.assets\image.png" data-type=image data-width=100% data-height=auto data-desc-position=bottom><img src="12. Linux进程控制.assets\image.png"></a></p> <h2 id=_3>进程回收<a class=headerlink href=#_3 title="Permanent link">&para;</a></h2> <p>在前面创建子进程中，并没有提到如何回收子进程，一旦子进程在父进程结束之前结束，子进程便会一直处于僵尸状态等待父进程回收，如果一直不回收便一直处于僵尸状态导致内存泄漏。在Linux，如果需要父进程对子进程进行回收，避免持续僵尸可以使用下面的两种方式：</p> <ol> <li>使用<code>wait()</code>函数，该函数会等到任意子进程执行结束之后回收该子进程，再执行该函数后面的代码，参数传递一个用于接收子进程状态的状态变量地址，函数返回回收的子进程的<code>PID</code></li> <li>使用<code>waitpid()</code>函数，同<code>wait</code>函数，但是该函数可以指定接收的进程，第一个参数传递需要回收的子进程的<code>PID</code>，第二个参数传递用于回收的子进程状态的状态变量地址，第三个参数传递指定函数的行为，函数返回回收的子进程的<code>PID</code>。当回收失败时，返回-1，否则返回对应的<code>pid</code></li> </ol> <div class="admonition note"> <p class=admonition-title>Note</p> <p>如果<code>waitpid</code>函数第一个参数传递一个大于0的数（即子进程<code>PID</code>），则回收指定的进程，如果传递-1，则作用等同于<code>wait</code>函数</p> </div> <p>基本使用如下：</p> <div class="language-c highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-1-1><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;stdio.h&gt;</span>
</span><span id=__span-1-2><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;stdlib.h&gt;</span>
</span><span id=__span-1-3><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;unistd.h&gt;</span>
</span><span id=__span-1-4><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;sys/types.h&gt;</span>
</span><span id=__span-1-5><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;sys/wait.h&gt;</span>
</span><span id=__span-1-6>
</span><span id=__span-1-7><span class=kt>int</span><span class=w> </span><span class=nf>main</span><span class=p>(){</span>
</span><span id=__span-1-8><span class=w>    </span><span class=n>printf</span><span class=p>(</span><span class=s>&quot;父进程pid: %d</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span><span class=w> </span><span class=n>getpid</span><span class=p>());</span>
</span><span id=__span-1-9><span class=w>    </span><span class=kt>pid_t</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>fork</span><span class=p>();</span>
</span><span id=__span-1-10>
</span><span id=__span-1-11><span class=w>    </span><span class=k>if</span><span class=p>(</span><span class=n>id</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-1-12><span class=w>        </span><span class=kt>int</span><span class=w> </span><span class=n>cnt</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>5</span><span class=w> </span><span class=p>;</span>
</span><span id=__span-1-13><span class=w>        </span><span class=k>while</span><span class=p>(</span><span class=n>cnt</span><span class=o>--</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-1-14><span class=w>            </span><span class=n>printf</span><span class=p>(</span><span class=s>&quot;子进程pid: %d</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span><span class=w> </span><span class=n>getpid</span><span class=p>());</span>
</span><span id=__span-1-15><span class=w>            </span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span><span id=__span-1-16><span class=w>        </span><span class=p>}</span>
</span><span id=__span-1-17>
</span><span id=__span-1-18><span class=w>        </span><span class=n>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span><span id=__span-1-19><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-1-20><span class=w>        </span><span class=n>sleep</span><span class=p>(</span><span class=mi>10</span><span class=p>);</span>
</span><span id=__span-1-21><span class=w>        </span><span class=kt>pid_t</span><span class=w> </span><span class=n>ret</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>wait</span><span class=p>(</span><span class=nb>NULL</span><span class=p>);</span>
</span><span id=__span-1-22><span class=w>        </span><span class=k>while</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-1-23><span class=w>            </span><span class=n>printf</span><span class=p>(</span><span class=s>&quot;父进程pid: %d</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span><span class=w> </span><span class=n>getpid</span><span class=p>());</span>
</span><span id=__span-1-24><span class=w>            </span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span><span id=__span-1-25><span class=w>        </span><span class=p>}</span>
</span><span id=__span-1-26><span class=w>    </span><span class=p>}</span>
</span><span id=__span-1-27>
</span><span id=__span-1-28><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-1-29><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <p>为了更好得监视执行时子进程的变化，可以使用下面的Shell脚本每隔一秒进行一次监视：</p> <div class="language-bash highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>Bash</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-2-1><span class=k>while</span><span class=w> </span>:<span class=p>;</span><span class=w> </span><span class=k>do</span><span class=w> </span>sleep<span class=w> </span><span class=m>1</span><span class=p>;</span><span class=w> </span>ps<span class=w> </span>ajx<span class=w> </span><span class=p>|</span><span class=w> </span>head<span class=w> </span>-1<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>ps<span class=w> </span>ajx<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>process<span class=p>;</span><span class=w> </span><span class=k>done</span>
</span></code></pre></div></td></tr></table></div> <p>编译运行上面的代码后，可以看到下面的效果：</p> <p><a class=glightbox href="12. Linux进程控制.assets\image1.png" data-type=image data-width=100% data-height=auto data-desc-position=bottom><img src="12. Linux进程控制.assets\image1.png"></a></p> <p>使用<code>waitpid</code>函数可以修改为如下代码，效果同上面的代码：</p> <div class="language-c highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-3-1><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;stdio.h&gt;</span>
</span><span id=__span-3-2><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;stdlib.h&gt;</span>
</span><span id=__span-3-3><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;unistd.h&gt;</span>
</span><span id=__span-3-4><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;sys/types.h&gt;</span>
</span><span id=__span-3-5><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;sys/wait.h&gt;</span>
</span><span id=__span-3-6>
</span><span id=__span-3-7><span class=kt>int</span><span class=w> </span><span class=nf>main</span><span class=p>(){</span>
</span><span id=__span-3-8><span class=w>    </span><span class=n>printf</span><span class=p>(</span><span class=s>&quot;父进程pid: %d</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span><span class=w> </span><span class=n>getpid</span><span class=p>());</span>
</span><span id=__span-3-9><span class=w>    </span><span class=kt>pid_t</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>fork</span><span class=p>();</span>
</span><span id=__span-3-10>
</span><span id=__span-3-11><span class=w>    </span><span class=k>if</span><span class=p>(</span><span class=n>id</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-12><span class=w>        </span><span class=kt>int</span><span class=w> </span><span class=n>cnt</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>5</span><span class=w> </span><span class=p>;</span>
</span><span id=__span-3-13><span class=w>        </span><span class=k>while</span><span class=p>(</span><span class=n>cnt</span><span class=o>--</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-14><span class=w>            </span><span class=n>printf</span><span class=p>(</span><span class=s>&quot;子进程pid: %d</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span><span class=w> </span><span class=n>getpid</span><span class=p>());</span>
</span><span id=__span-3-15><span class=w>            </span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span><span id=__span-3-16><span class=w>        </span><span class=p>}</span>
</span><span id=__span-3-17>
</span><span id=__span-3-18><span class=w>        </span><span class=n>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span><span id=__span-3-19><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-20><span class=w>        </span><span class=n>sleep</span><span class=p>(</span><span class=mi>10</span><span class=p>);</span>
</span><span id=__span-3-21><span class=w>        </span><span class=kt>pid_t</span><span class=w> </span><span class=n>ret</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>waitpid</span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>);</span>
</span><span id=__span-3-22><span class=w>        </span><span class=k>while</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-23><span class=w>            </span><span class=n>printf</span><span class=p>(</span><span class=s>&quot;父进程pid: %d</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span><span class=w> </span><span class=n>getpid</span><span class=p>());</span>
</span><span id=__span-3-24><span class=w>            </span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span><span id=__span-3-25><span class=w>        </span><span class=p>}</span>
</span><span id=__span-3-26><span class=w>    </span><span class=p>}</span>
</span><span id=__span-3-27>
</span><span id=__span-3-28><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-3-29><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <p>如果需要回收子进程的状态，可以通过状态变量接收，因为<code>waitpid</code>函数的第二个参数相当于一个输出型参数：</p> <div class="language-c highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-4-1><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;stdio.h&gt;</span>
</span><span id=__span-4-2><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;stdlib.h&gt;</span>
</span><span id=__span-4-3><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;unistd.h&gt;</span>
</span><span id=__span-4-4><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;sys/types.h&gt;</span>
</span><span id=__span-4-5><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;sys/wait.h&gt;</span>
</span><span id=__span-4-6>
</span><span id=__span-4-7><span class=kt>int</span><span class=w> </span><span class=nf>main</span><span class=p>(){</span>
</span><span id=__span-4-8><span class=w>    </span><span class=n>printf</span><span class=p>(</span><span class=s>&quot;父进程pid: %d</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span><span class=w> </span><span class=n>getpid</span><span class=p>());</span>
</span><span id=__span-4-9><span class=w>    </span><span class=kt>pid_t</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>fork</span><span class=p>();</span>
</span><span id=__span-4-10><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>status</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-4-11>
</span><span id=__span-4-12><span class=w>    </span><span class=k>if</span><span class=p>(</span><span class=n>id</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-4-13><span class=w>        </span><span class=kt>int</span><span class=w> </span><span class=n>cnt</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>5</span><span class=w> </span><span class=p>;</span>
</span><span id=__span-4-14><span class=w>        </span><span class=k>while</span><span class=p>(</span><span class=n>cnt</span><span class=o>--</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-4-15><span class=w>            </span><span class=n>printf</span><span class=p>(</span><span class=s>&quot;子进程pid: %d</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span><span class=w> </span><span class=n>getpid</span><span class=p>());</span>
</span><span id=__span-4-16><span class=w>            </span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span><span id=__span-4-17><span class=w>        </span><span class=p>}</span>
</span><span id=__span-4-18>
</span><span id=__span-4-19><span class=w>        </span><span class=n>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span><span id=__span-4-20><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-4-21><span class=w>        </span><span class=n>sleep</span><span class=p>(</span><span class=mi>10</span><span class=p>);</span>
</span><span id=__span-4-22><span class=w>        </span><span class=kt>pid_t</span><span class=w> </span><span class=n>ret</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>waitpid</span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>status</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>);</span>
</span><span id=__span-4-23><span class=w>        </span><span class=k>while</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-4-24><span class=w>            </span><span class=n>printf</span><span class=p>(</span><span class=s>&quot;父进程pid: %d, status = %d</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span><span class=w> </span><span class=n>getpid</span><span class=p>(),</span><span class=w> </span><span class=n>status</span><span class=p>);</span>
</span><span id=__span-4-25><span class=w>            </span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span><span id=__span-4-26><span class=w>        </span><span class=p>}</span>
</span><span id=__span-4-27><span class=w>    </span><span class=p>}</span>
</span><span id=__span-4-28>
</span><span id=__span-4-29><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-4-30><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <p>如果上面子进程的退出码为非0，那么<code>status</code>中的值可能会有所不同，代码如下：</p> <div class="language-c highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-5-1><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;stdio.h&gt;</span>
</span><span id=__span-5-2><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;stdlib.h&gt;</span>
</span><span id=__span-5-3><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;unistd.h&gt;</span>
</span><span id=__span-5-4><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;sys/types.h&gt;</span>
</span><span id=__span-5-5><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;sys/wait.h&gt;</span>
</span><span id=__span-5-6>
</span><span id=__span-5-7><span class=kt>int</span><span class=w> </span><span class=nf>main</span><span class=p>(){</span>
</span><span id=__span-5-8><span class=w>    </span><span class=n>printf</span><span class=p>(</span><span class=s>&quot;父进程pid: %d</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span><span class=w> </span><span class=n>getpid</span><span class=p>());</span>
</span><span id=__span-5-9><span class=w>    </span><span class=kt>pid_t</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>fork</span><span class=p>();</span>
</span><span id=__span-5-10><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>status</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-5-11>
</span><span id=__span-5-12><span class=w>    </span><span class=k>if</span><span class=p>(</span><span class=n>id</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-5-13><span class=w>        </span><span class=kt>int</span><span class=w> </span><span class=n>cnt</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>5</span><span class=w> </span><span class=p>;</span>
</span><span id=__span-5-14><span class=w>        </span><span class=k>while</span><span class=p>(</span><span class=n>cnt</span><span class=o>--</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-5-15><span class=w>            </span><span class=n>printf</span><span class=p>(</span><span class=s>&quot;子进程pid: %d</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span><span class=w> </span><span class=n>getpid</span><span class=p>());</span>
</span><span id=__span-5-16><span class=w>            </span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span><span id=__span-5-17><span class=w>        </span><span class=p>}</span>
</span><span id=__span-5-18>
</span><span id=__span-5-19><span class=w>        </span><span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span><span id=__span-5-20><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-5-21><span class=w>        </span><span class=n>sleep</span><span class=p>(</span><span class=mi>10</span><span class=p>);</span>
</span><span id=__span-5-22><span class=w>        </span><span class=kt>pid_t</span><span class=w> </span><span class=n>ret</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>waitpid</span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>status</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>);</span>
</span><span id=__span-5-23><span class=w>        </span><span class=k>while</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-5-24><span class=w>            </span><span class=n>printf</span><span class=p>(</span><span class=s>&quot;父进程pid: %d, status = %d</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span><span class=w> </span><span class=n>getpid</span><span class=p>(),</span><span class=w> </span><span class=n>status</span><span class=p>);</span>
</span><span id=__span-5-25><span class=w>            </span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span><span id=__span-5-26><span class=w>        </span><span class=p>}</span>
</span><span id=__span-5-27><span class=w>    </span><span class=p>}</span>
</span><span id=__span-5-28>
</span><span id=__span-5-29><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-5-30><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <p>运行上面的代码效果如下：</p> <p><a class=glightbox href="12. Linux进程控制.assets\image2.png" data-type=image data-width=100% data-height=auto data-desc-position=bottom><img src="12. Linux进程控制.assets\image2.png"></a></p> <p>在上面的代码中，子进程的退出码是1，但是<code>status</code>中存储的却是256，因为在Linux中，一个进程退出一般不仅仅包含退出码，还有其他内容，这些内容统称为为进程退出信息。</p> <h2 id=_4>进程退出信息<a class=headerlink href=#_4 title="Permanent link">&para;</a></h2> <p>下面主要讨论两种进程退出信息：</p> <ol> <li>进程退出码</li> <li>进程退出信号</li> </ol> <p>在Linux中，存在一个整型值<code>status</code>，该值存储了进程的相关退出信息，一般情况下，一个整型值占用4个字节，所以在<code>status</code>中，低两个字节（比特位从9到15）存储的就是进程退出码（占用8-15）和进程退出信号（占用0-7），示意图如下：</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>第8位比特位存储的core dump标志，<a href=https://www.help-doc.top/Linux/signals-os-principles/signals-os-principles.html#_8>具体见Linux信号</a></p> </div> <p><a class=glightbox href="12. Linux进程控制.assets\image3.png" data-type=image data-width=100% data-height=auto data-desc-position=bottom><img src="12. Linux进程控制.assets\image3.png"></a></p> <p>所以在上面的代码中，进程退出码设置为1，实际上是在第9位比特位设置为1，即<code>0000001</code>，但是因为进程是正常退出的，所以进程信号部分为全0，core dump此时也为0，就出现了<code>000000100000000</code>，所以此时获取到的<code>status</code>就是256</p> <p>如果想要直接获取进程退出码可以使用下面的思路：</p> <div class="language-c highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-6-1><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;stdio.h&gt;</span>
</span><span id=__span-6-2><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;stdlib.h&gt;</span>
</span><span id=__span-6-3><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;unistd.h&gt;</span>
</span><span id=__span-6-4><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;sys/types.h&gt;</span>
</span><span id=__span-6-5><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;sys/wait.h&gt;</span>
</span><span id=__span-6-6>
</span><span id=__span-6-7><span class=kt>int</span><span class=w> </span><span class=nf>main</span><span class=p>(){</span>
</span><span id=__span-6-8><span class=w>    </span><span class=n>printf</span><span class=p>(</span><span class=s>&quot;父进程pid: %d</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span><span class=w> </span><span class=n>getpid</span><span class=p>());</span>
</span><span id=__span-6-9><span class=w>    </span><span class=kt>pid_t</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>fork</span><span class=p>();</span>
</span><span id=__span-6-10><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>status</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-6-11>
</span><span id=__span-6-12><span class=w>    </span><span class=k>if</span><span class=p>(</span><span class=n>id</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-6-13><span class=w>        </span><span class=kt>int</span><span class=w> </span><span class=n>cnt</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>5</span><span class=w> </span><span class=p>;</span>
</span><span id=__span-6-14><span class=w>        </span><span class=k>while</span><span class=p>(</span><span class=n>cnt</span><span class=o>--</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-6-15><span class=w>            </span><span class=n>printf</span><span class=p>(</span><span class=s>&quot;子进程pid: %d</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span><span class=w> </span><span class=n>getpid</span><span class=p>());</span>
</span><span id=__span-6-16><span class=w>            </span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span><span id=__span-6-17><span class=w>        </span><span class=p>}</span>
</span><span id=__span-6-18>
</span><span id=__span-6-19><span class=w>        </span><span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span><span id=__span-6-20><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-6-21><span class=w>        </span><span class=n>sleep</span><span class=p>(</span><span class=mi>10</span><span class=p>);</span>
</span><span id=__span-6-22><span class=w>        </span><span class=kt>pid_t</span><span class=w> </span><span class=n>ret</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>waitpid</span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>status</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>);</span>
</span><span id=__span-6-23><span class=w>        </span><span class=k>while</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-6-24><span class=w>            </span><span class=n>printf</span><span class=p>(</span><span class=s>&quot;父进程pid: %d, status = %d</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span><span class=w> </span><span class=n>getpid</span><span class=p>(),</span><span class=w> </span><span class=p>(</span><span class=n>status</span><span class=o>&gt;&gt;</span><span class=mi>8</span><span class=p>)</span><span class=o>&amp;</span><span class=mi>255</span><span class=p>);</span>
</span><span id=__span-6-25><span class=w>            </span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span><span id=__span-6-26><span class=w>        </span><span class=p>}</span>
</span><span id=__span-6-27><span class=w>    </span><span class=p>}</span>
</span><span id=__span-6-28>
</span><span id=__span-6-29><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-6-30><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <div class="admonition note"> <p class=admonition-title>Note</p> <p>上面的代码中，使用了<code>(status&gt;&gt;8)&amp;255</code>取出进程退出码，注意尽管已经将 <code>status</code> 右移 8 位把高 8 位移到低 8 位的位置，但是为了保证其他位置为0，需要与255进行<code>&amp;</code>运算</p> </div> <p>在Linux中，进程退出码一般即为0或者<code>errno</code>中的值，也可以是自定义的整数值，而进程退出信号中0表示正常退出，其他对应着不同的进程退出信号，如下图所示：</p> <p><a class=glightbox href="12. Linux进程控制.assets\image4.png" data-type=image data-width=100% data-height=auto data-desc-position=bottom><img src="12. Linux进程控制.assets\image4.png"></a></p> <p>例如信号8和信号11：</p> <div class="language-c highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-7-1><span class=c1>// 信号8</span>
</span><span id=__span-7-2><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;stdio.h&gt;</span>
</span><span id=__span-7-3>
</span><span id=__span-7-4><span class=kt>int</span><span class=w> </span><span class=nf>main</span><span class=p>()</span>
</span><span id=__span-7-5><span class=p>{</span>
</span><span id=__span-7-6><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-7-7>
</span><span id=__span-7-8><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-7-9><span class=p>}</span>
</span><span id=__span-7-10>
</span><span id=__span-7-11><span class=n>运行后</span><span class=err>：</span>
</span><span id=__span-7-12><span class=n>Floating</span><span class=w> </span><span class=n>point</span><span class=w> </span><span class=n>exception</span>
</span><span id=__span-7-13>
</span><span id=__span-7-14><span class=c1>// 信号11</span>
</span><span id=__span-7-15><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;stdio.h&gt;</span>
</span><span id=__span-7-16>
</span><span id=__span-7-17><span class=kt>int</span><span class=w> </span><span class=n>main</span><span class=p>()</span>
</span><span id=__span-7-18><span class=p>{</span>
</span><span id=__span-7-19><span class=w>    </span><span class=kt>int</span><span class=o>*</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>NULL</span><span class=p>;</span>
</span><span id=__span-7-20><span class=w>    </span><span class=o>*</span><span class=n>a</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span>
</span><span id=__span-7-21>
</span><span id=__span-7-22><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-7-23><span class=p>}</span>
</span><span id=__span-7-24>
</span><span id=__span-7-25><span class=n>运行后</span><span class=err>：</span>
</span><span id=__span-7-26><span class=n>Segmentation</span><span class=w> </span><span class=n>fault</span>
</span></code></pre></div></td></tr></table></div> <p>这些退出信号默认由操作系统检测并向进程发出，所以当用户看到进程退出信号时，其实操作系统在这之前已经终止了进程，这种进程退出也被称为进程异常退出。至此，在Linux中，进程退出一共有三种情况：</p> <ol> <li>进程代码执行完成，进程退出码为0，进程退出信号为0，正常退出</li> <li>进程代码执行完成，进程退出码为非0，进程退出信号为0，正常退出但是程序出现逻辑问题导致指定任务未完成</li> <li>进程代码未执行完成，进程退出信号为非0，进程异常退出</li> </ol> <p>对于子进程出现进程退出信号非0，也可以通过下面的方式获取对应的进程退出信号：</p> <div class="language-c highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-8-1><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;stdio.h&gt;</span>
</span><span id=__span-8-2><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;stdlib.h&gt;</span>
</span><span id=__span-8-3><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;unistd.h&gt;</span>
</span><span id=__span-8-4><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;sys/types.h&gt;</span>
</span><span id=__span-8-5><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;sys/wait.h&gt;</span>
</span><span id=__span-8-6>
</span><span id=__span-8-7><span class=kt>int</span><span class=w> </span><span class=nf>main</span><span class=p>(){</span>
</span><span id=__span-8-8><span class=w>    </span><span class=n>printf</span><span class=p>(</span><span class=s>&quot;父进程pid: %d</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span><span class=w> </span><span class=n>getpid</span><span class=p>());</span>
</span><span id=__span-8-9><span class=w>    </span><span class=kt>pid_t</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>fork</span><span class=p>();</span>
</span><span id=__span-8-10><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>status</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-8-11>
</span><span id=__span-8-12><span class=w>    </span><span class=k>if</span><span class=p>(</span><span class=n>id</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-13><span class=w>        </span><span class=kt>int</span><span class=w> </span><span class=n>cnt</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>5</span><span class=w> </span><span class=p>;</span>
</span><span id=__span-8-14><span class=w>        </span><span class=k>while</span><span class=p>(</span><span class=n>cnt</span><span class=o>--</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-15><span class=w>            </span><span class=n>printf</span><span class=p>(</span><span class=s>&quot;子进程pid: %d</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span><span class=w> </span><span class=n>getpid</span><span class=p>());</span>
</span><span id=__span-8-16><span class=w>            </span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span><span id=__span-8-17><span class=w>        </span><span class=p>}</span>
</span><span id=__span-8-18>
</span><span id=__span-8-19><span class=w>        </span><span class=kt>int</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-8-20>
</span><span id=__span-8-21><span class=w>        </span><span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span><span id=__span-8-22><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-23><span class=w>        </span><span class=n>sleep</span><span class=p>(</span><span class=mi>10</span><span class=p>);</span>
</span><span id=__span-8-24><span class=w>        </span><span class=kt>pid_t</span><span class=w> </span><span class=n>ret</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>waitpid</span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>status</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>);</span>
</span><span id=__span-8-25><span class=w>        </span><span class=k>while</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-26><span class=w>            </span><span class=n>printf</span><span class=p>(</span><span class=s>&quot;父进程pid: %d, status = %d</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span><span class=w> </span><span class=n>getpid</span><span class=p>(),</span><span class=w> </span><span class=n>status</span><span class=o>&amp;</span><span class=mi>255</span><span class=p>);</span>
</span><span id=__span-8-27><span class=w>            </span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span><span id=__span-8-28><span class=w>        </span><span class=p>}</span>
</span><span id=__span-8-29><span class=w>    </span><span class=p>}</span>
</span><span id=__span-8-30>
</span><span id=__span-8-31><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-8-32><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <p>除了操作系统可以向进程发送进程退出信号，用户也可以通过<code>kill</code>指令向进程发送对应的退出信号，使用方式与使用<code>kill</code>结束进程一致</p> <p>上面获取进程退出信息的方式稍微有点繁琐，在Linux中，有对应的宏可以帮助获取到指定的进程退出信息：</p> <p><a class=glightbox href="12. Linux进程控制.assets\image5.png" data-type=image data-width=100% data-height=auto data-desc-position=bottom><img src="12. Linux进程控制.assets\image5.png"></a></p> <p>例如下面的代码：</p> <div class="language-c highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-9-1><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;stdio.h&gt;</span>
</span><span id=__span-9-2><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;stdlib.h&gt;</span>
</span><span id=__span-9-3><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;unistd.h&gt;</span>
</span><span id=__span-9-4><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;sys/types.h&gt;</span>
</span><span id=__span-9-5><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;sys/wait.h&gt;</span>
</span><span id=__span-9-6>
</span><span id=__span-9-7><span class=kt>int</span><span class=w> </span><span class=nf>main</span><span class=p>(){</span>
</span><span id=__span-9-8><span class=w>    </span><span class=n>printf</span><span class=p>(</span><span class=s>&quot;父进程pid: %d</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span><span class=w> </span><span class=n>getpid</span><span class=p>());</span>
</span><span id=__span-9-9><span class=w>    </span><span class=kt>pid_t</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>fork</span><span class=p>();</span>
</span><span id=__span-9-10><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>status</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-9-11>
</span><span id=__span-9-12><span class=w>    </span><span class=k>if</span><span class=p>(</span><span class=n>id</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-9-13><span class=w>        </span><span class=kt>int</span><span class=w> </span><span class=n>cnt</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>5</span><span class=w> </span><span class=p>;</span>
</span><span id=__span-9-14><span class=w>        </span><span class=k>while</span><span class=p>(</span><span class=n>cnt</span><span class=o>--</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-9-15><span class=w>            </span><span class=n>printf</span><span class=p>(</span><span class=s>&quot;子进程pid: %d</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span><span class=w> </span><span class=n>getpid</span><span class=p>());</span>
</span><span id=__span-9-16><span class=w>            </span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span><span id=__span-9-17><span class=w>        </span><span class=p>}</span>
</span><span id=__span-9-18>
</span><span id=__span-9-19><span class=w>        </span><span class=c1>// int a = 1 / 0;</span>
</span><span id=__span-9-20>
</span><span id=__span-9-21><span class=w>        </span><span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span><span id=__span-9-22><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-9-23><span class=w>        </span><span class=c1>// sleep(10);</span>
</span><span id=__span-9-24><span class=w>        </span><span class=kt>pid_t</span><span class=w> </span><span class=n>ret</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>waitpid</span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>status</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>);</span>
</span><span id=__span-9-25><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>WIFEXITED</span><span class=p>(</span><span class=n>status</span><span class=p>))</span><span class=w> </span><span class=c1>// 进程正常退出时</span>
</span><span id=__span-9-26><span class=w>        </span><span class=p>{</span>
</span><span id=__span-9-27><span class=w>            </span><span class=n>printf</span><span class=p>(</span><span class=s>&quot;父进程pid: %d, status = %d</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span><span class=w> </span><span class=n>getpid</span><span class=p>(),</span><span class=w> </span><span class=n>WEXITSTATUS</span><span class=p>(</span><span class=n>status</span><span class=p>));</span><span class=w> </span><span class=c1>// 获取进程的退出码</span>
</span><span id=__span-9-28><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=k>if</span><span class=p>(</span><span class=n>WIFSIGNALED</span><span class=p>(</span><span class=n>status</span><span class=p>))</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-9-29><span class=w>            </span><span class=n>printf</span><span class=p>(</span><span class=s>&quot;父进程pid: %d, status = %d</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span><span class=w> </span><span class=n>getpid</span><span class=p>(),</span><span class=w> </span><span class=n>WTERMSIG</span><span class=p>(</span><span class=n>status</span><span class=p>));</span><span class=w> </span><span class=c1>// 否则获取进程的退出信号</span>
</span><span id=__span-9-30><span class=w>        </span><span class=p>}</span>
</span><span id=__span-9-31><span class=w>    </span><span class=p>}</span>
</span><span id=__span-9-32>
</span><span id=__span-9-33><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-9-34><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <p>在Linux源码中，PCB中存在着两个变量分别存储着进程退出码和进程退出信号：</p> <div class="language-c highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-10-1><span class=k>struct</span><span class=w> </span><span class=nc>task_struct</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-10-2><span class=w>    </span><span class=c1>// ...</span>
</span><span id=__span-10-3><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>exit_code</span><span class=p>,</span><span class=w> </span><span class=n>exit_signal</span><span class=p>;</span>
</span><span id=__span-10-4><span class=w>    </span><span class=c1>// ...</span>
</span><span id=__span-10-5><span class=p>};</span>
</span></code></pre></div></td></tr></table></div> <h2 id=_5>子进程使用案例<a class=headerlink href=#_5 title="Permanent link">&para;</a></h2> <p>前面的子进程都只是完成一些简单的打印工作，现在可以通过子进程完成一些其他工作，实现子进程执行其他任务的效果：</p> <p>目标：父进程向容器中添加数据，而子进程将数据保存到指定的文件中</p> <p>示例代码如下：</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span>
<span class=normal>45</span>
<span class=normal>46</span>
<span class=normal>47</span>
<span class=normal>48</span>
<span class=normal>49</span>
<span class=normal>50</span>
<span class=normal>51</span>
<span class=normal>52</span>
<span class=normal>53</span>
<span class=normal>54</span>
<span class=normal>55</span>
<span class=normal>56</span>
<span class=normal>57</span>
<span class=normal>58</span>
<span class=normal>59</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-11-1><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;iostream&gt;</span>
</span><span id=__span-11-2><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;vector&gt;</span>
</span><span id=__span-11-3><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;fstream&gt;</span>
</span><span id=__span-11-4><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;sstream&gt;</span>
</span><span id=__span-11-5><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;unistd.h&gt;</span>
</span><span id=__span-11-6><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;sys/types.h&gt;</span>
</span><span id=__span-11-7><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;sys/wait.h&gt;</span>
</span><span id=__span-11-8><span class=k>using</span><span class=w> </span><span class=k>namespace</span><span class=w> </span><span class=nn>std</span><span class=p>;</span>
</span><span id=__span-11-9>
</span><span id=__span-11-10><span class=c1>// 定义全局变量</span>
</span><span id=__span-11-11><span class=n>vector</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=w> </span><span class=n>data</span><span class=p>;</span>
</span><span id=__span-11-12>
</span><span id=__span-11-13><span class=kt>int</span><span class=w> </span><span class=nf>_save</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-11-14><span class=w>    </span><span class=n>ofstream</span><span class=w> </span><span class=n>ofs</span><span class=p>(</span><span class=s>&quot;content.txt&quot;</span><span class=p>,</span><span class=w> </span><span class=n>ios</span><span class=o>::</span><span class=n>out</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>ios</span><span class=o>::</span><span class=n>trunc</span><span class=p>);</span>
</span><span id=__span-11-15><span class=w>    </span><span class=n>stringstream</span><span class=w> </span><span class=n>ss</span><span class=p>;</span>
</span><span id=__span-11-16><span class=w>    </span><span class=n>string</span><span class=w> </span><span class=n>value</span><span class=p>;</span>
</span><span id=__span-11-17><span class=w>    </span><span class=c1>// 将内容转换成字符串</span>
</span><span id=__span-11-18><span class=w>    </span><span class=k>for</span><span class=p>(</span><span class=k>auto</span><span class=w> </span><span class=n>num</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>data</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-11-19><span class=w>        </span><span class=n>ss</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>num</span><span class=p>;</span>
</span><span id=__span-11-20><span class=w>        </span><span class=n>value</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=n>ss</span><span class=p>.</span><span class=n>str</span><span class=p>()</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&quot; &quot;</span><span class=p>;</span>
</span><span id=__span-11-21><span class=w>        </span><span class=n>ss</span><span class=p>.</span><span class=n>str</span><span class=p>(</span><span class=s>&quot;&quot;</span><span class=p>);</span>
</span><span id=__span-11-22><span class=w>    </span><span class=p>}</span>
</span><span id=__span-11-23>
</span><span id=__span-11-24><span class=w>    </span><span class=c1>// 写入文件</span>
</span><span id=__span-11-25><span class=w>    </span><span class=n>ofs</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>value</span><span class=p>;</span>
</span><span id=__span-11-26>
</span><span id=__span-11-27><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-11-28><span class=p>}</span>
</span><span id=__span-11-29>
</span><span id=__span-11-30><span class=kt>void</span><span class=w> </span><span class=nf>save</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-11-31><span class=w>    </span><span class=c1>// 创建子进程</span>
</span><span id=__span-11-32><span class=w>    </span><span class=kt>pid_t</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>fork</span><span class=p>();</span>
</span><span id=__span-11-33>
</span><span id=__span-11-34><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>id</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-11-35><span class=w>        </span><span class=c1>// 子进程执行保存</span>
</span><span id=__span-11-36><span class=w>        </span><span class=kt>int</span><span class=w> </span><span class=n>code</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>_save</span><span class=p>();</span>
</span><span id=__span-11-37><span class=w>        </span><span class=c1>//子进程退出</span>
</span><span id=__span-11-38><span class=w>        </span><span class=n>exit</span><span class=p>(</span><span class=n>code</span><span class=p>);</span>
</span><span id=__span-11-39><span class=w>    </span><span class=p>}</span>
</span><span id=__span-11-40>
</span><span id=__span-11-41><span class=w>    </span><span class=c1>// 父进程回收子进程</span>
</span><span id=__span-11-42><span class=w>    </span><span class=n>waitpid</span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=k>nullptr</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>);</span>
</span><span id=__span-11-43><span class=p>}</span>
</span><span id=__span-11-44>
</span><span id=__span-11-45><span class=kt>int</span><span class=w> </span><span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-11-46><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>count</span><span class=w> </span><span class=o>=</span><span class=w>  </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-11-47><span class=w>    </span><span class=c1>// 持续向容器中存入数据</span>
</span><span id=__span-11-48><span class=w>    </span><span class=k>while</span><span class=p>(</span><span class=nb>true</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-11-49><span class=w>        </span><span class=n>data</span><span class=p>.</span><span class=n>push_back</span><span class=p>(</span><span class=n>count</span><span class=o>+</span><span class=mi>1</span><span class=p>);</span>
</span><span id=__span-11-50><span class=w>        </span><span class=c1>// 如果已经添加了10次，则子进程执行保存</span>
</span><span id=__span-11-51><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>count</span><span class=o>++</span><span class=w> </span><span class=o>%</span><span class=w> </span><span class=mi>10</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-11-52><span class=w>            </span><span class=n>save</span><span class=p>();</span>
</span><span id=__span-11-53><span class=w>        </span><span class=p>}</span>
</span><span id=__span-11-54><span class=w>        </span><span class=n>cout</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>count</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>endl</span><span class=p>;</span>
</span><span id=__span-11-55><span class=w>        </span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span><span id=__span-11-56><span class=w>    </span><span class=p>}</span>
</span><span id=__span-11-57>
</span><span id=__span-11-58><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-11-59><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <h2 id=_6>阻塞与非阻塞<a class=headerlink href=#_6 title="Permanent link">&para;</a></h2> <p>在上面的子进程案例中，每一次子进程在执行任务时，父进程都需要等待子进程执行完毕后回收子进程才可以继续执行父进程的代码，这个过程中父进程处于阻塞等待状态</p> <p>但是如果希望父进程在子进程还在执行的时候一边等待子进程结束，一边执行自己的任务就需要让父进程处于非阻塞等待状态</p> <p>需要使用非阻塞状态就需要设置<code>waitpid</code>第三个参数为<code>WNOHANG</code>，此时<code>waitpid</code>的返回值从原来的两种（大于0和等于-1）变为三种（大于0、等于0和等于-1），此时大于0表示已经回收到对应的子进程的<code>PID</code>，等于0说明子进程还在执行需要继续等待，等于-1说明回收失败</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>因为非阻塞等待无法确定子进程何时退出，所以需要手动循环持续等待</p> </div> <p>使用非阻塞等待修改前面的案例代码：</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span>
<span class=normal>45</span>
<span class=normal>46</span>
<span class=normal>47</span>
<span class=normal>48</span>
<span class=normal>49</span>
<span class=normal>50</span>
<span class=normal>51</span>
<span class=normal>52</span>
<span class=normal>53</span>
<span class=normal>54</span>
<span class=normal>55</span>
<span class=normal>56</span>
<span class=normal>57</span>
<span class=normal>58</span>
<span class=normal>59</span>
<span class=normal>60</span>
<span class=normal>61</span>
<span class=normal>62</span>
<span class=normal>63</span>
<span class=normal>64</span>
<span class=normal>65</span>
<span class=normal>66</span>
<span class=normal>67</span>
<span class=normal>68</span>
<span class=normal>69</span>
<span class=normal>70</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-12-1><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;iostream&gt;</span>
</span><span id=__span-12-2><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;vector&gt;</span>
</span><span id=__span-12-3><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;fstream&gt;</span>
</span><span id=__span-12-4><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;sstream&gt;</span>
</span><span id=__span-12-5><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;unistd.h&gt;</span>
</span><span id=__span-12-6><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;sys/types.h&gt;</span>
</span><span id=__span-12-7><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;sys/wait.h&gt;</span>
</span><span id=__span-12-8><span class=k>using</span><span class=w> </span><span class=k>namespace</span><span class=w> </span><span class=nn>std</span><span class=p>;</span>
</span><span id=__span-12-9>
</span><span id=__span-12-10><span class=n>vector</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=w> </span><span class=n>data</span><span class=p>;</span>
</span><span id=__span-12-11>
</span><span id=__span-12-12><span class=kt>int</span><span class=w> </span><span class=nf>_save</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-12-13><span class=w>    </span><span class=n>ofstream</span><span class=w> </span><span class=n>ofs</span><span class=p>(</span><span class=s>&quot;content.txt&quot;</span><span class=p>,</span><span class=w> </span><span class=n>ios</span><span class=o>::</span><span class=n>out</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>ios</span><span class=o>::</span><span class=n>trunc</span><span class=p>);</span>
</span><span id=__span-12-14><span class=w>    </span><span class=n>stringstream</span><span class=w> </span><span class=n>ss</span><span class=p>;</span>
</span><span id=__span-12-15><span class=w>    </span><span class=n>string</span><span class=w> </span><span class=n>value</span><span class=p>;</span>
</span><span id=__span-12-16><span class=w>    </span><span class=c1>// 将内容转换成字符串</span>
</span><span id=__span-12-17><span class=w>    </span><span class=k>for</span><span class=p>(</span><span class=k>auto</span><span class=w> </span><span class=n>num</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>data</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-12-18><span class=w>        </span><span class=n>ss</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>num</span><span class=p>;</span>
</span><span id=__span-12-19><span class=w>        </span><span class=n>value</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=n>ss</span><span class=p>.</span><span class=n>str</span><span class=p>()</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&quot; &quot;</span><span class=p>;</span>
</span><span id=__span-12-20><span class=w>        </span><span class=n>ss</span><span class=p>.</span><span class=n>str</span><span class=p>(</span><span class=s>&quot;&quot;</span><span class=p>);</span>
</span><span id=__span-12-21><span class=w>    </span><span class=p>}</span>
</span><span id=__span-12-22>
</span><span id=__span-12-23><span class=w>    </span><span class=c1>// 写入文件</span>
</span><span id=__span-12-24><span class=w>    </span><span class=n>ofs</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>value</span><span class=p>;</span>
</span><span id=__span-12-25>
</span><span id=__span-12-26><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-12-27><span class=p>}</span>
</span><span id=__span-12-28>
</span><span id=__span-12-29><span class=kt>void</span><span class=w> </span><span class=nf>save</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-12-30><span class=w>    </span><span class=c1>// 创建子进程</span>
</span><span id=__span-12-31><span class=w>    </span><span class=kt>pid_t</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>fork</span><span class=p>();</span>
</span><span id=__span-12-32>
</span><span id=__span-12-33><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>id</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-12-34><span class=w>        </span><span class=c1>// 子进程执行保存</span>
</span><span id=__span-12-35><span class=w>        </span><span class=kt>int</span><span class=w> </span><span class=n>code</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>_save</span><span class=p>();</span>
</span><span id=__span-12-36><span class=w>        </span><span class=c1>//子进程退出</span>
</span><span id=__span-12-37><span class=w>        </span><span class=n>exit</span><span class=p>(</span><span class=n>code</span><span class=p>);</span>
</span><span id=__span-12-38><span class=w>    </span><span class=p>}</span>
</span><span id=__span-12-39>
</span><span id=__span-12-40><span class=w>    </span><span class=c1>// 使用非阻塞等待</span>
</span><span id=__span-12-41><span class=w>    </span><span class=k>while</span><span class=p>(</span><span class=nb>true</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-12-42><span class=w>        </span><span class=kt>pid_t</span><span class=w> </span><span class=n>ret</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>waitpid</span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=k>nullptr</span><span class=p>,</span><span class=w> </span><span class=n>WNOHANG</span><span class=p>);</span>
</span><span id=__span-12-43><span class=w>        </span><span class=k>if</span><span class=p>(</span><span class=n>ret</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-12-44><span class=w>            </span><span class=n>cout</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;子进程回收成功&quot;</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>endl</span><span class=p>;</span>
</span><span id=__span-12-45><span class=w>            </span><span class=k>return</span><span class=p>;</span>
</span><span id=__span-12-46><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>ret</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-12-47><span class=w>            </span><span class=n>cout</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;子进程还在运行&quot;</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>endl</span><span class=p>;</span>
</span><span id=__span-12-48><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-12-49><span class=w>            </span><span class=n>cout</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;回收失败&quot;</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>endl</span><span class=p>;</span>
</span><span id=__span-12-50><span class=w>            </span><span class=k>return</span><span class=p>;</span>
</span><span id=__span-12-51><span class=w>        </span><span class=p>}</span>
</span><span id=__span-12-52><span class=w>        </span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span><span id=__span-12-53><span class=w>    </span><span class=p>}</span>
</span><span id=__span-12-54><span class=p>}</span>
</span><span id=__span-12-55>
</span><span id=__span-12-56><span class=kt>int</span><span class=w> </span><span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-12-57><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>count</span><span class=w> </span><span class=o>=</span><span class=w>  </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-12-58><span class=w>    </span><span class=c1>// 持续向容器中存入数据</span>
</span><span id=__span-12-59><span class=w>    </span><span class=k>while</span><span class=p>(</span><span class=nb>true</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-12-60><span class=w>        </span><span class=n>data</span><span class=p>.</span><span class=n>push_back</span><span class=p>(</span><span class=n>count</span><span class=o>+</span><span class=mi>1</span><span class=p>);</span>
</span><span id=__span-12-61><span class=w>        </span><span class=c1>// 如果已经添加了10次，则子进程执行保存</span>
</span><span id=__span-12-62><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>count</span><span class=o>++</span><span class=w> </span><span class=o>%</span><span class=w> </span><span class=mi>10</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-12-63><span class=w>            </span><span class=n>save</span><span class=p>();</span>
</span><span id=__span-12-64><span class=w>        </span><span class=p>}</span>
</span><span id=__span-12-65><span class=w>        </span><span class=n>cout</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>count</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>endl</span><span class=p>;</span>
</span><span id=__span-12-66><span class=w>        </span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span><span id=__span-12-67><span class=w>    </span><span class=p>}</span>
</span><span id=__span-12-68>
</span><span id=__span-12-69><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-12-70><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <h2 id=_7>进程程序替换<a class=headerlink href=#_7 title="Permanent link">&para;</a></h2> <h3 id=_8>介绍<a class=headerlink href=#_8 title="Permanent link">&para;</a></h3> <p>前面子进程在完成任务都是基于分支语句中属于子进程的代码，而进程程序替换的作用就是为了让子进程执行其他程序的代码和数据</p> <p>在Linux中，有七个可以调用其他程序的函数（也被称为<code>exec</code>家族函数），如下：</p> <div class="language-c highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span>
<span class=normal>8</span>
<span class=normal>9</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-13-1><span class=c1>// C语言封装的接口</span>
</span><span id=__span-13-2><span class=kt>int</span><span class=w> </span><span class=nf>execl</span><span class=p>(</span><span class=k>const</span><span class=w> </span><span class=kt>char</span><span class=w> </span><span class=o>*</span><span class=n>path</span><span class=p>,</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=kt>char</span><span class=w> </span><span class=o>*</span><span class=n>arg</span><span class=p>,</span><span class=w> </span><span class=p>...);</span>
</span><span id=__span-13-3><span class=kt>int</span><span class=w> </span><span class=nf>execlp</span><span class=p>(</span><span class=k>const</span><span class=w> </span><span class=kt>char</span><span class=w> </span><span class=o>*</span><span class=n>file</span><span class=p>,</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=kt>char</span><span class=w> </span><span class=o>*</span><span class=n>arg</span><span class=p>,</span><span class=w> </span><span class=p>...);</span>
</span><span id=__span-13-4><span class=kt>int</span><span class=w> </span><span class=nf>execle</span><span class=p>(</span><span class=k>const</span><span class=w> </span><span class=kt>char</span><span class=w> </span><span class=o>*</span><span class=n>path</span><span class=p>,</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=kt>char</span><span class=w> </span><span class=o>*</span><span class=n>arg</span><span class=p>,</span><span class=w> </span><span class=p>...,</span><span class=w> </span><span class=kt>char</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=n>envp</span><span class=p>[]);</span>
</span><span id=__span-13-5><span class=kt>int</span><span class=w> </span><span class=nf>execv</span><span class=p>(</span><span class=k>const</span><span class=w> </span><span class=kt>char</span><span class=w> </span><span class=o>*</span><span class=n>path</span><span class=p>,</span><span class=w> </span><span class=kt>char</span><span class=w> </span><span class=o>*</span><span class=k>const</span><span class=w> </span><span class=n>argv</span><span class=p>[]);</span>
</span><span id=__span-13-6><span class=kt>int</span><span class=w> </span><span class=nf>execvp</span><span class=p>(</span><span class=k>const</span><span class=w> </span><span class=kt>char</span><span class=w> </span><span class=o>*</span><span class=n>file</span><span class=p>,</span><span class=w> </span><span class=kt>char</span><span class=w> </span><span class=o>*</span><span class=k>const</span><span class=w> </span><span class=n>argv</span><span class=p>[]);</span>
</span><span id=__span-13-7><span class=kt>int</span><span class=w> </span><span class=nf>execvpe</span><span class=p>(</span><span class=k>const</span><span class=w> </span><span class=kt>char</span><span class=w> </span><span class=o>*</span><span class=n>file</span><span class=p>,</span><span class=w> </span><span class=kt>char</span><span class=w> </span><span class=o>*</span><span class=k>const</span><span class=w> </span><span class=n>argv</span><span class=p>[],</span><span class=w> </span><span class=kt>char</span><span class=w> </span><span class=o>*</span><span class=k>const</span><span class=w> </span><span class=n>envp</span><span class=p>[]);</span>
</span><span id=__span-13-8><span class=c1>// 系统接口</span>
</span><span id=__span-13-9><span class=kt>int</span><span class=w> </span><span class=nf>execve</span><span class=p>(</span><span class=k>const</span><span class=w> </span><span class=kt>char</span><span class=w> </span><span class=o>*</span><span class=n>filename</span><span class=p>,</span><span class=w> </span><span class=kt>char</span><span class=w> </span><span class=o>*</span><span class=k>const</span><span class=w> </span><span class=n>argv</span><span class=p>[],</span><span class=w> </span><span class=kt>char</span><span class=w> </span><span class=o>*</span><span class=k>const</span><span class=w> </span><span class=n>envp</span><span class=p>[]);</span>
</span></code></pre></div></td></tr></table></div> <p>参数解释：</p> <ol> <li><code>const char *path</code>：执行的目标程序的路径</li> <li><code>const char *arg, ...</code>：如何执行目标程序，一般传入的内容与命令行执行对应程序时输入的内容相同，例如<code>ls -a -l</code>，参数写为<code>"ls", "-a", "-l", "nullptr/NULL"</code>（需要传入<code>nullptr</code>或者<code>NULL</code>是因为命令行参数表以<code>nullptr</code>/<code>NULL</code>结尾）</li> <li><code>char *const argv[]</code>：如何执行目标程序，与<code>const char *arg, ...</code>不同的是，<code>char *const argv[]</code>接收的是一个数组，所以需要额外创建一个数组，而数组中的内容即为命令行参数，以<code>nullptr</code>或者<code>NULL</code>作为最后一个字符串</li> <li><code>const char *file</code>或者<code>const char *filename</code>：执行的目标程序名称（不需要路径）</li> <li><code>char * const envp[]</code>：需要传递的环境变量，与<code>char *const argv[]</code>使用基本一致，一般有新的环境变量时才会使用本参数</li> </ol> <p>函数返回值解释：</p> <p>上面所有的函数当正常调用程序时，返回-1，否则没有返回值</p> <p><a class=glightbox href="12. Linux进程控制.assets\image6.png" data-type=image data-width=100% data-height=auto data-desc-position=bottom><img src="12. Linux进程控制.assets\image6.png"></a></p> <p>下面以三种函数为例：</p> <p>共用的<code>Makefile</code>文件如下：</p> <div class="language-makefile highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>Makefile</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span>
<span class=normal>8</span>
<span class=normal>9</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-14-1><span class=nv>TARGET</span><span class=o>=</span>process<span class=w> </span>
</span><span id=__span-14-2><span class=nv>SRC</span><span class=o>=</span>process.c
</span><span id=__span-14-3>
</span><span id=__span-14-4><span class=nf>$(TARGET)</span><span class=o>:</span><span class=k>$(</span><span class=nv>SRC</span><span class=k>)</span>
</span><span id=__span-14-5><span class=w>    </span>gcc<span class=w> </span>$^<span class=w> </span>-o<span class=w> </span><span class=nv>$@</span>
</span><span id=__span-14-6>
</span><span id=__span-14-7><span class=nf>.PHONT</span><span class=o>:</span><span class=n>clean</span>
</span><span id=__span-14-8><span class=nf>clean</span><span class=o>:</span>
</span><span id=__span-14-9><span class=w>    </span>rm<span class=w> </span>-f<span class=w> </span><span class=k>$(</span>TARGET<span class=k>)</span>
</span></code></pre></div></td></tr></table></div> <ol> <li> <p><code>int execl(const char *path, const char *arg, ...)</code></p> <div class="language-c highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span>
<span class=normal>8</span>
<span class=normal>9</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-15-1><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;stdio.h&gt;</span>
</span><span id=__span-15-2><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;unistd.h&gt;</span>
</span><span id=__span-15-3>
</span><span id=__span-15-4><span class=kt>int</span><span class=w> </span><span class=nf>main</span><span class=p>()</span>
</span><span id=__span-15-5><span class=p>{</span>
</span><span id=__span-15-6><span class=w>    </span><span class=n>execl</span><span class=p>(</span><span class=s>&quot;/usr/bin/ls&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;ls&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;--color&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;-a&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;-l&quot;</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>);</span>
</span><span id=__span-15-7>
</span><span id=__span-15-8><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-15-9><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <p>运行结果：</p> <p><a class=glightbox href="12. Linux进程控制.assets\image7.png" data-type=image data-width=100% data-height=auto data-desc-position=bottom><img src="12. Linux进程控制.assets\image7.png"></a></p> </li> <li> <p><code>int execvp(const char *file, char *const argv[])</code></p> <div class="language-c highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-16-1><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;stdio.h&gt;</span>
</span><span id=__span-16-2><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;unistd.h&gt;</span>
</span><span id=__span-16-3>
</span><span id=__span-16-4><span class=kt>int</span><span class=w> </span><span class=nf>main</span><span class=p>()</span>
</span><span id=__span-16-5><span class=p>{</span>
</span><span id=__span-16-6><span class=w>    </span><span class=kt>char</span><span class=o>*</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=n>argv</span><span class=p>[]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-16-7><span class=w>    </span><span class=p>(</span><span class=kt>char</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=s>&quot;ls&quot;</span><span class=p>,</span>
</span><span id=__span-16-8><span class=w>    </span><span class=p>(</span><span class=kt>char</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=s>&quot;--color&quot;</span><span class=p>,</span>
</span><span id=__span-16-9><span class=w>    </span><span class=p>(</span><span class=kt>char</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=s>&quot;-a&quot;</span><span class=p>,</span>
</span><span id=__span-16-10><span class=w>    </span><span class=p>(</span><span class=kt>char</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=s>&quot;-l&quot;</span><span class=p>,</span>
</span><span id=__span-16-11><span class=w>        </span><span class=nb>NULL</span>
</span><span id=__span-16-12><span class=w>    </span><span class=p>};</span>
</span><span id=__span-16-13><span class=w>    </span><span class=n>execvp</span><span class=p>(</span><span class=s>&quot;ls&quot;</span><span class=p>,</span><span class=w> </span><span class=n>argv</span><span class=p>);</span>
</span><span id=__span-16-14><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-16-15><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <p>运行结果：</p> <p><a class=glightbox href="12. Linux进程控制.assets\image7.png" data-type=image data-width=100% data-height=auto data-desc-position=bottom><img src="12. Linux进程控制.assets\image7.png"></a></p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>上面的代码中，使用<code>(char*)</code>是为了将字符串的类型<code>(const char*)</code>强制转换为<code>char*</code>，从而类型匹配以消除编译器警告</p> </div> <p>也可以使用下面的更安全的方式：</p> <div class="language-c highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-17-1><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;stdio.h&gt;</span>
</span><span id=__span-17-2><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;unistd.h&gt;</span>
</span><span id=__span-17-3>
</span><span id=__span-17-4><span class=kt>int</span><span class=w> </span><span class=nf>main</span><span class=p>()</span>
</span><span id=__span-17-5><span class=p>{</span>
</span><span id=__span-17-6><span class=w>    </span><span class=kt>char</span><span class=w> </span><span class=n>cmd</span><span class=p>[]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;ls&quot;</span><span class=p>;</span>
</span><span id=__span-17-7><span class=w>    </span><span class=kt>char</span><span class=w> </span><span class=n>opt1</span><span class=p>[]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;--color&quot;</span><span class=p>;</span>
</span><span id=__span-17-8><span class=w>    </span><span class=kt>char</span><span class=w> </span><span class=n>opt2</span><span class=p>[]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;-a&quot;</span><span class=p>;</span>
</span><span id=__span-17-9><span class=w>    </span><span class=kt>char</span><span class=w> </span><span class=n>opt3</span><span class=p>[]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;-l&quot;</span><span class=p>;</span>
</span><span id=__span-17-10><span class=w>    </span><span class=kt>char</span><span class=o>*</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=n>argv</span><span class=p>[]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>cmd</span><span class=p>,</span><span class=w> </span><span class=n>opt1</span><span class=p>,</span><span class=w> </span><span class=n>opt2</span><span class=p>,</span><span class=w> </span><span class=n>opt3</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=w> </span><span class=p>};</span>
</span><span id=__span-17-11>
</span><span id=__span-17-12><span class=w>    </span><span class=n>execvp</span><span class=p>(</span><span class=s>&quot;ls&quot;</span><span class=p>,</span><span class=w> </span><span class=n>argv</span><span class=p>);</span>
</span><span id=__span-17-13><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-17-14><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> </li> <li> <p><code>int execvpe(const char *file, char *const argv[], char *const envp[])</code></p> <div class="language-c highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-18-1><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;stdio.h&gt;</span>
</span><span id=__span-18-2><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;unistd.h&gt;</span>
</span><span id=__span-18-3>
</span><span id=__span-18-4><span class=kt>int</span><span class=w> </span><span class=nf>main</span><span class=p>()</span>
</span><span id=__span-18-5><span class=p>{</span>
</span><span id=__span-18-6><span class=w>    </span><span class=kt>char</span><span class=w> </span><span class=n>cmd</span><span class=p>[]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;ls&quot;</span><span class=p>;</span>
</span><span id=__span-18-7><span class=w>    </span><span class=kt>char</span><span class=w> </span><span class=n>opt1</span><span class=p>[]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;--color&quot;</span><span class=p>;</span>
</span><span id=__span-18-8><span class=w>    </span><span class=kt>char</span><span class=w> </span><span class=n>opt2</span><span class=p>[]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;-a&quot;</span><span class=p>;</span>
</span><span id=__span-18-9><span class=w>    </span><span class=kt>char</span><span class=w> </span><span class=n>opt3</span><span class=p>[]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;-l&quot;</span><span class=p>;</span>
</span><span id=__span-18-10><span class=w>    </span><span class=kt>char</span><span class=o>*</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=n>argv</span><span class=p>[]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>cmd</span><span class=p>,</span><span class=w> </span><span class=n>opt1</span><span class=p>,</span><span class=w> </span><span class=n>opt2</span><span class=p>,</span><span class=w> </span><span class=n>opt3</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=w> </span><span class=p>};</span>
</span><span id=__span-18-11>
</span><span id=__span-18-12><span class=w>    </span><span class=kt>char</span><span class=w> </span><span class=n>newEnv</span><span class=p>[]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;newEnviron=10000&quot;</span><span class=p>;</span>
</span><span id=__span-18-13>
</span><span id=__span-18-14><span class=w>    </span><span class=kt>char</span><span class=o>*</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=n>envp</span><span class=p>[]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=n>newEnv</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>};</span>
</span><span id=__span-18-15>
</span><span id=__span-18-16><span class=w>    </span><span class=n>execvpe</span><span class=p>(</span><span class=s>&quot;ls&quot;</span><span class=p>,</span><span class=w> </span><span class=n>argv</span><span class=p>,</span><span class=w> </span><span class=n>envp</span><span class=p>);</span>
</span><span id=__span-18-17>
</span><span id=__span-18-18><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-18-19><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <p>运行结果：</p> <p><a class=glightbox href="12. Linux进程控制.assets\image7.png" data-type=image data-width=100% data-height=auto data-desc-position=bottom><img src="12. Linux进程控制.assets\image7.png"></a></p> <p>如果需要添加环境变量到当前系统的环境变量并以新的系统环境变量执行，可以使用下面的代码：</p> <div class="language-c highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-19-1><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;stdio.h&gt;</span>
</span><span id=__span-19-2><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;unistd.h&gt;</span>
</span><span id=__span-19-3><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;stdlib.h&gt;</span>
</span><span id=__span-19-4>
</span><span id=__span-19-5><span class=k>extern</span><span class=w> </span><span class=kt>char</span><span class=o>**</span><span class=w> </span><span class=n>environ</span><span class=p>;</span>
</span><span id=__span-19-6>
</span><span id=__span-19-7><span class=kt>int</span><span class=w> </span><span class=nf>main</span><span class=p>()</span>
</span><span id=__span-19-8><span class=p>{</span>
</span><span id=__span-19-9><span class=w>    </span><span class=kt>char</span><span class=w> </span><span class=n>cmd</span><span class=p>[]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;ls&quot;</span><span class=p>;</span>
</span><span id=__span-19-10><span class=w>    </span><span class=kt>char</span><span class=w> </span><span class=n>opt1</span><span class=p>[]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;--color&quot;</span><span class=p>;</span>
</span><span id=__span-19-11><span class=w>    </span><span class=kt>char</span><span class=w> </span><span class=n>opt2</span><span class=p>[]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;-a&quot;</span><span class=p>;</span>
</span><span id=__span-19-12><span class=w>    </span><span class=kt>char</span><span class=w> </span><span class=n>opt3</span><span class=p>[]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;-l&quot;</span><span class=p>;</span>
</span><span id=__span-19-13><span class=w>    </span><span class=kt>char</span><span class=o>*</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=n>argv</span><span class=p>[]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>cmd</span><span class=p>,</span><span class=w> </span><span class=n>opt1</span><span class=p>,</span><span class=w> </span><span class=n>opt2</span><span class=p>,</span><span class=w> </span><span class=n>opt3</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=w> </span><span class=p>};</span>
</span><span id=__span-19-14>
</span><span id=__span-19-15><span class=w>    </span><span class=kt>char</span><span class=w> </span><span class=n>newEnv</span><span class=p>[]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;newEnviron=10000&quot;</span><span class=p>;</span>
</span><span id=__span-19-16><span class=w>    </span><span class=n>putenv</span><span class=p>(</span><span class=n>newEnv</span><span class=p>);</span>
</span><span id=__span-19-17>
</span><span id=__span-19-18><span class=w>    </span><span class=n>execvpe</span><span class=p>(</span><span class=s>&quot;ls&quot;</span><span class=p>,</span><span class=w> </span><span class=n>argv</span><span class=p>,</span><span class=w> </span><span class=n>environ</span><span class=p>);</span>
</span><span id=__span-19-19>
</span><span id=__span-19-20><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-19-21><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <div class="admonition note"> <p class=admonition-title>Note</p> <p>此处<code>char**</code>和<code>char* []</code>是兼容的类型，都表示一个指向字符串指针的指针数组，所以可以将<code>char** environ</code>传递给<code>char* const envp[]</code>参数，因为两者在内存布局上是相同的</p> </div> </li> </ol> <h3 id=_9>原理简单解释<a class=headerlink href=#_9 title="Permanent link">&para;</a></h3> <p>进程程序替换的本质是将进程对应的虚拟地址空间中的代码和数据替换为指定的程序的代码和数据，从而可以执行其他程序，示意图如下：</p> <p><a class=glightbox href="12. Linux进程控制.assets\image8.png" data-type=image data-width=100% data-height=auto data-desc-position=bottom><img src="12. Linux进程控制.assets\image8.png"></a></p> <p>因为发生了覆盖，所以一旦执行了<code>exec</code>家族的函数，则该函数后面的代码都会被覆盖从而无法再执行，除非<code>exec</code>家族函数执行失败返回-1</p> <p>但是需要注意的是，因为是直接覆盖，所以这个过程中<code>exec</code>函数并不会创建一个新进程，运行下面的代码可以证明（只要PID相同，就说明不是新进程执行的<code>exec</code>函数中的程序）：</p> <div class="language-c highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-20-1><span class=c1>// 调用程序</span>
</span><span id=__span-20-2><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;stdio.h&gt;</span>
</span><span id=__span-20-3><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;unistd.h&gt;</span>
</span><span id=__span-20-4>
</span><span id=__span-20-5><span class=kt>int</span><span class=w> </span><span class=nf>main</span><span class=p>()</span>
</span><span id=__span-20-6><span class=p>{</span>
</span><span id=__span-20-7><span class=w>    </span><span class=n>printf</span><span class=p>(</span><span class=s>&quot;当前进程pid为%d</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span><span class=w> </span><span class=n>getpid</span><span class=p>());</span>
</span><span id=__span-20-8><span class=w>    </span><span class=n>execl</span><span class=p>(</span><span class=s>&quot;./other&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;other&quot;</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>);</span><span class=w> </span>
</span><span id=__span-20-9>
</span><span id=__span-20-10><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-20-11><span class=p>}</span>
</span><span id=__span-20-12>
</span><span id=__span-20-13><span class=c1>// 被exec调用程序</span>
</span><span id=__span-20-14><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;stdio.h&gt;</span>
</span><span id=__span-20-15><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;unistd.h&gt;</span>
</span><span id=__span-20-16>
</span><span id=__span-20-17><span class=kt>int</span><span class=w> </span><span class=nf>main</span><span class=p>()</span><span class=w> </span>
</span><span id=__span-20-18><span class=p>{</span>
</span><span id=__span-20-19><span class=w>    </span><span class=n>printf</span><span class=p>(</span><span class=s>&quot;当前进程pid为%d</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span><span class=w> </span><span class=n>getpid</span><span class=p>());</span>
</span><span id=__span-20-20>
</span><span id=__span-20-21><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-20-22><span class=p>}</span>
</span><span id=__span-20-23>
</span><span id=__span-20-24><span class=n>输出结果</span><span class=err>：</span>
</span><span id=__span-20-25><span class=n>当前进程pid为4408</span>
</span><span id=__span-20-26><span class=n>当前进程pid为4408</span>
</span></code></pre></div></td></tr></table></div> <div class="admonition note"> <p class=admonition-title>Note</p> <p>需要注意，上面的<code>execl</code>第二个参数不用使用<code>./other</code>，此处只需要使用<code>other</code>即可，因为已经指定了路径</p> </div> <p>前面提到大部分运行在<code>bash</code>上的进程都是<code>bash</code>子进程，所以<code>bash</code>执行子进程的本质就是调用了<code>exec</code>家族函数，而之所以没有覆盖<code>bash</code>原有的进程，就是因为<code>bash</code>开辟了一个子进程再在子进程中调用了<code>exec</code>家族函数。所以可以模仿<code>bash</code>的方式使用多进程，让子进程执行<code>exec</code>家族函数：</p> <div class="language-c highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-21-1><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;stdio.h&gt;</span>
</span><span id=__span-21-2><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;unistd.h&gt;</span>
</span><span id=__span-21-3><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;sys/types.h&gt;</span>
</span><span id=__span-21-4><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;sys/wait.h&gt;</span>
</span><span id=__span-21-5>
</span><span id=__span-21-6><span class=kt>int</span><span class=w> </span><span class=nf>main</span><span class=p>()</span>
</span><span id=__span-21-7><span class=p>{</span>
</span><span id=__span-21-8><span class=w>    </span><span class=kt>pid_t</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>fork</span><span class=p>();</span>
</span><span id=__span-21-9><span class=w>    </span><span class=k>if</span><span class=p>(</span><span class=n>id</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-21-10><span class=w>        </span><span class=n>execl</span><span class=p>(</span><span class=s>&quot;/usr/bin/pwd&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;pwd&quot;</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>);</span>
</span><span id=__span-21-11><span class=w>        </span><span class=n>printf</span><span class=p>(</span><span class=s>&quot;正常执行exec不会执行本语句</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>);</span>
</span><span id=__span-21-12><span class=w>    </span><span class=p>}</span>
</span><span id=__span-21-13>
</span><span id=__span-21-14><span class=w>    </span><span class=n>waitpid</span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>);</span>
</span><span id=__span-21-15><span class=w>    </span><span class=n>printf</span><span class=p>(</span><span class=s>&quot;父进程代码未被覆盖</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>);</span>
</span><span id=__span-21-16>
</span><span id=__span-21-17><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-21-18><span class=p>}</span>
</span><span id=__span-21-19>
</span><span id=__span-21-20><span class=n>输出结果</span><span class=err>：</span>
</span><span id=__span-21-21><span class=o>/</span><span class=n>home</span><span class=o>/</span><span class=n>epsda</span><span class=o>/</span><span class=n>test_alter_process</span>
</span><span id=__span-21-22><span class=n>父进程代码未被覆盖</span>
</span></code></pre></div></td></tr></table></div> <p>有了进程程序替换，进程的独立性更加明显，原因如下：</p> <ol> <li>完全替换进程映像：当一个进程调用<code>exec</code>系列函数时，它的当前进程映像被新程序替换，除了进程<code>PID</code>和一些资源之外，原进程的代码、数据和堆栈都被新程序的内容替换。这意味着新程序完全独立于调用<code>exec</code>之前的程序</li> <li>资源独立性：尽管新程序继承了原进程的文件描述符和环境变量，但它使用的是自己的代码和数据，这使得程序的执行和行为是独立的，不会受到原程序的影响</li> <li>内存空间独立：<code>exec</code>调用后，新程序运行在独立的内存空间中，之前的内存内容被清除，新程序的运行不受之前程序的内存内容的影响</li> <li>进程控制：调用<code>exec</code>后，原进程的执行流被终止，新程序开始执行。控制权完全交给新程序，使得新程序在执行和资源管理上是独立的</li> </ol> <h2 id=shell1>手撕一个简单的shell（版本1）<a class=headerlink href=#shell1 title="Permanent link">&para;</a></h2> <p>在写一个shell之前，需要了解本次实现的shell在系统中做的事情：</p> <ol> <li>从硬盘中读取环境变量存储到自己的环境变量表（本次以拷贝系统shell的环境变量到模拟实现程序中为例）</li> <li>当在shell运行的过程中，如果用户输入一个指令且该指令可以对应到一个程序，则该程序会正常运行</li> </ol> <p>根据上面的描述以及系统shell的直观感受，可以将本次模拟的shell需要做的内容分为下面的几个步骤：</p> <ol> <li>输出提示内容，例如：<code>[epsda@ham-carrier ~]$</code>，后面紧跟用户输入的指令</li> <li>获取用户输入</li> <li>将用户的输入拆分成单独的有效的字符串存入命令行参数表</li> <li>创建子进程调用<code>exec</code>家族函数调用用户输入的指令执行指定的程序</li> </ol> <h3 id=_10>输出提示内容<a class=headerlink href=#_10 title="Permanent link">&para;</a></h3> <p>根据系统shell的样式<code>[epsda@ham-carrier ~]$</code>，可以看出包括下面的内容：</p> <ol> <li>用户名</li> <li><code>@</code></li> <li>主机名</li> <li>当前路径</li> <li>用户提示符<code>$</code>或者<code>#</code></li> </ol> <p>基本设计思路如下：</p> <p>在系统环境变量中，存储着当前环境的用户名、主机名和当前路径，对于用户提示符，可以考虑判断是否是root用户，如果是则打印<code>#</code>，否则打印<code>$</code></p> <p>示例代码如下：</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-22-1><span class=kt>void</span><span class=w> </span><span class=nf>printfCommandHint</span><span class=p>()</span>
</span><span id=__span-22-2><span class=p>{</span>
</span><span id=__span-22-3><span class=w>    </span><span class=c1>// 获取用户名</span>
</span><span id=__span-22-4><span class=w>    </span><span class=kt>char</span><span class=o>*</span><span class=w> </span><span class=n>user</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>getenv</span><span class=p>(</span><span class=s>&quot;USER&quot;</span><span class=p>);</span>
</span><span id=__span-22-5><span class=w>    </span><span class=c1>// 获取主机名</span>
</span><span id=__span-22-6><span class=w>    </span><span class=kt>char</span><span class=o>*</span><span class=w> </span><span class=n>hostname</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>getenv</span><span class=p>(</span><span class=s>&quot;HOSTNAME&quot;</span><span class=p>);</span>
</span><span id=__span-22-7><span class=w>    </span><span class=c1>// 获取当前工作路径</span>
</span><span id=__span-22-8><span class=w>    </span><span class=kt>char</span><span class=o>*</span><span class=w> </span><span class=n>pwd</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>getenv</span><span class=p>(</span><span class=s>&quot;PWD&quot;</span><span class=p>);</span>
</span><span id=__span-22-9><span class=w>    </span><span class=c1>// 打印信息</span>
</span><span id=__span-22-10><span class=w>    </span><span class=n>printf</span><span class=p>(</span><span class=s>&quot;[%s@%s %s]%c&quot;</span><span class=p>,</span><span class=w> </span><span class=n>user</span><span class=p>,</span><span class=w> </span><span class=n>hostname</span><span class=p>,</span><span class=w> </span><span class=n>pwd</span><span class=p>,</span>
</span><span id=__span-22-11><span class=w>            </span><span class=n>strcmp</span><span class=p>(</span><span class=n>user</span><span class=p>,</span><span class=w> </span><span class=s>&quot;root&quot;</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=sc>&#39;#&#39;</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=sc>&#39;$&#39;</span><span class=p>);</span>
</span><span id=__span-22-12><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <h3 id=_11>获取用户输入<a class=headerlink href=#_11 title="Permanent link">&para;</a></h3> <p>获取用户输入可以有很多方法，但是如果直接使用<code>scanf</code>或者<code>cin</code>则无法一次性获取到用户输入的指令和选项，所以直接使用<code>scanf</code>和<code>cin</code>是不妥的，可以考虑使用使用<code>fgets</code>或者<code>getline</code>来代替</p> <p>另外，因为不论是<code>fgets</code>还是<code>getline</code>，都默认以<code>\n</code>作为结束标志，但是需要注意，<code>fgets</code>尽管以<code>\n</code>结束，但是依旧会被读取到目标字符串中，但是<code>getline</code>不会，所以使用<code>fgets</code>一定要清除<code>\n</code></p> <p>需要注意的是，为了保证其他函数可以获取到输入的内容，可以定义一个数组存储输入的内容，但是这个数组不可以是一个局部变量，除非作为参数传递而不作为返回值，防止出现野指针问题</p> <p>下面给出两种版本：</p> <div class="tabbed-set tabbed-alternate" data-tabs=1:2><input checked=checked id=__tabbed_1_1 name=__tabbed_1 type=radio><input id=__tabbed_1_2 name=__tabbed_1 type=radio><div class=tabbed-labels><label for=__tabbed_1_1><code>fgets</code>版本</label><label for=__tabbed_1_2><code>getline</code>版本</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-23-1><span class=k>const</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>BaseSize</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1024</span><span class=p>;</span>
</span><span id=__span-23-2><span class=c1>// 存储用户的输入的数组</span>
</span><span id=__span-23-3><span class=kt>char</span><span class=w> </span><span class=n>input_arr</span><span class=p>[</span><span class=n>BaseSize</span><span class=p>];</span>
</span><span id=__span-23-4>
</span><span id=__span-23-5><span class=kt>char</span><span class=o>*</span><span class=w> </span><span class=nf>getInput</span><span class=p>()</span>
</span><span id=__span-23-6><span class=p>{</span>
</span><span id=__span-23-7><span class=w>    </span><span class=c1>// fgets以\n结束，但是会读取\n</span>
</span><span id=__span-23-8><span class=w>    </span><span class=n>fgets</span><span class=p>(</span><span class=n>input_arr</span><span class=p>,</span><span class=w> </span><span class=n>BaseSize</span><span class=p>,</span><span class=w> </span><span class=n>stdin</span><span class=p>);</span>
</span><span id=__span-23-9><span class=w>    </span><span class=c1>// 尽管可能没有输入指令。但是输入指令存在\n</span>
</span><span id=__span-23-10><span class=w>    </span><span class=kt>size_t</span><span class=w> </span><span class=n>sz</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>strlen</span><span class=p>(</span><span class=n>input_arr</span><span class=p>);</span>
</span><span id=__span-23-11><span class=w>    </span><span class=c1>// 消除\n</span>
</span><span id=__span-23-12><span class=w>    </span><span class=n>input_arr</span><span class=p>[</span><span class=n>sz</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>1</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=sc>&#39;\0&#39;</span><span class=p>;</span>
</span><span id=__span-23-13><span class=w>    </span><span class=c1>// 如果没有输入则直接返回空</span>
</span><span id=__span-23-14><span class=w>    </span><span class=k>if</span><span class=p>(</span><span class=n>sz</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>0</span><span class=p>)</span>
</span><span id=__span-23-15><span class=w>    </span><span class=p>{</span>
</span><span id=__span-23-16><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>nullptr</span><span class=p>;</span>
</span><span id=__span-23-17><span class=w>    </span><span class=p>}</span>
</span><span id=__span-23-18>
</span><span id=__span-23-19><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>input_arr</span><span class=p>;</span>
</span><span id=__span-23-20><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> </div> <div class=tabbed-block> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-24-1><span class=k>const</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>BaseSize</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1024</span><span class=p>;</span>
</span><span id=__span-24-2><span class=c1>// 存储用户的输入的数组</span>
</span><span id=__span-24-3><span class=kt>char</span><span class=w> </span><span class=n>input_arr</span><span class=p>[</span><span class=n>BaseSize</span><span class=p>];</span>
</span><span id=__span-24-4>
</span><span id=__span-24-5><span class=kt>char</span><span class=o>*</span><span class=w> </span><span class=nf>getInput</span><span class=p>()</span>
</span><span id=__span-24-6><span class=p>{</span>
</span><span id=__span-24-7><span class=w>    </span><span class=n>std</span><span class=o>::</span><span class=n>cin</span><span class=p>.</span><span class=n>getline</span><span class=p>(</span><span class=n>input_arr</span><span class=p>,</span><span class=w> </span><span class=n>BaseSize</span><span class=p>);</span>
</span><span id=__span-24-8><span class=w>    </span><span class=k>if</span><span class=p>(</span><span class=n>strlen</span><span class=p>(</span><span class=n>input_arr</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>0</span><span class=p>)</span>
</span><span id=__span-24-9><span class=w>    </span><span class=p>{</span>
</span><span id=__span-24-10><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>nullptr</span><span class=p>;</span>
</span><span id=__span-24-11><span class=w>    </span><span class=p>}</span>
</span><span id=__span-24-12>
</span><span id=__span-24-13><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>input_arr</span><span class=p>;</span>
</span><span id=__span-24-14><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> </div> </div> </div> <h3 id=_12>拆分用户输入<a class=headerlink href=#_12 title="Permanent link">&para;</a></h3> <p>所谓拆分用户输入，就是为了将用户输入的指令转换成单个字符串，因为指令和选项都是以空格分隔，所以可以考虑将空格作为分隔符，此处因为前面是使用字符数组作为存储字符串的载体，所以考虑使用C语言的<code>strtok</code>函数拆分</p> <p>拆分出来的内容即为命令行参数，所以还需要一张命令行参数表，该表需要被子进程拿到，所以需要定义为全局变量</p> <p>最后，因为是持续等待用户输入，所以下一次用户输入新的指令，需要覆盖前面的指令，所以需要对命令行参数个数和命令行参数列表全部重置</p> <p>示例代码：</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span>
<span class=normal>8</span>
<span class=normal>9</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-25-1><span class=kt>void</span><span class=w> </span><span class=nf>parseInput</span><span class=p>()</span>
</span><span id=__span-25-2><span class=p>{</span>
</span><span id=__span-25-3><span class=w>    </span><span class=c1>// 清空上一次的命令行参数和个数</span>
</span><span id=__span-25-4><span class=w>    </span><span class=n>memset</span><span class=p>(</span><span class=n>global_argv</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=n>BaseSize</span><span class=p>);</span>
</span><span id=__span-25-5><span class=w>    </span><span class=n>global_argc</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-25-6><span class=w>    </span><span class=c1>// 拆分读取的字符串</span>
</span><span id=__span-25-7><span class=w>    </span><span class=k>for</span><span class=p>(</span><span class=kt>char</span><span class=o>*</span><span class=w> </span><span class=n>ch</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>strtok</span><span class=p>(</span><span class=n>input_arr</span><span class=p>,</span><span class=w> </span><span class=s>&quot; &quot;</span><span class=p>);</span><span class=w> </span><span class=p>(</span><span class=kt>bool</span><span class=p>)</span><span class=n>ch</span><span class=p>;</span><span class=w> </span><span class=n>ch</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>strtok</span><span class=p>(</span><span class=k>nullptr</span><span class=p>,</span><span class=w> </span><span class=s>&quot; &quot;</span><span class=p>))</span>
</span><span id=__span-25-8><span class=w>       </span><span class=n>global_argv</span><span class=p>[</span><span class=n>global_argc</span><span class=o>++</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ch</span><span class=p>;</span>
</span><span id=__span-25-9><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <h3 id=_13>执行对应程序<a class=headerlink href=#_13 title="Permanent link">&para;</a></h3> <p>对于外部命令，需要创建一个子进程来执行，所以基本流程就是创建子进程，让子进程调用exec家族函数执行对应程序，这里推荐选用<code>execvp</code>函数，而对于父进程来说，只需要等待子进程执行结束回收子进程即可</p> <p>示例代码如下：</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-26-1><span class=kt>void</span><span class=w> </span><span class=nf>executeProgram</span><span class=p>()</span>
</span><span id=__span-26-2><span class=p>{</span>
</span><span id=__span-26-3><span class=w>    </span><span class=kt>pid_t</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>fork</span><span class=p>();</span>
</span><span id=__span-26-4><span class=w>    </span><span class=k>if</span><span class=p>(</span><span class=n>id</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>0</span><span class=p>)</span>
</span><span id=__span-26-5><span class=w>    </span><span class=p>{</span>
</span><span id=__span-26-6><span class=w>        </span><span class=n>execvp</span><span class=p>(</span><span class=n>global_argv</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span><span class=w> </span><span class=n>global_argv</span><span class=p>);</span>
</span><span id=__span-26-7><span class=w>        </span><span class=n>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span><span id=__span-26-8><span class=w>    </span><span class=p>}</span>
</span><span id=__span-26-9>
</span><span id=__span-26-10><span class=w>    </span><span class=c1>// 父进程等待</span>
</span><span id=__span-26-11><span class=w>    </span><span class=n>waitpid</span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=k>nullptr</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>);</span>
</span><span id=__span-26-12><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <h3 id=_14>内建命令处理<a class=headerlink href=#_14 title="Permanent link">&para;</a></h3> <p>前面四个步骤已经完成了一个基本的shell，在Linux中，绝大部分的命令都是外部命令，但是前面提到除了外部命令还有内建命令，例如<code>cd</code>、<code>echo</code>、<code>export</code>等，而内建命令是不可以交给子进程处理的，因为子进程处理只是改变子进程的状态，不会影响父进程，而<code>cd</code>、<code>echo</code>、<code>export</code>这些命令本质修改的就是当前父进程的属性，所以为了保证这些内建命令生效，需要单独对这些命令进行处理</p> <p>最简单的处理方式就是在子进程执行前进行判断，如果是内建命令就直接由当前进程执行，而不交给子进程，本次分别处理下面的内建命令：</p> <ol> <li><code>cd</code>命令</li> <li><code>export</code>命令</li> <li><code>env</code>命令</li> </ol> <h4 id=cd><code>cd</code>命令处理<a class=headerlink href=#cd title="Permanent link">&para;</a></h4> <p><code>cd</code>命令的主要作用是更改当前的工作路径，所以当用户执行<code>cd</code>命令时，程序内部需要执行<code>chdir</code>函数来更改当前的工作路径<code>cwd</code>，示例代码如下：</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-27-1><span class=kt>bool</span><span class=w> </span><span class=nf>checkIfBuiltInAndExecute</span><span class=p>()</span>
</span><span id=__span-27-2><span class=p>{</span>
</span><span id=__span-27-3><span class=w>   </span><span class=k>if</span><span class=p>(</span><span class=n>strcmp</span><span class=p>(</span><span class=n>global_argv</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span><span class=w> </span><span class=s>&quot;cd&quot;</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>0</span><span class=p>)</span>
</span><span id=__span-27-4><span class=w>   </span><span class=p>{</span>
</span><span id=__span-27-5><span class=w>       </span><span class=c1>// 判断是否有两个参数防止越界访问</span>
</span><span id=__span-27-6><span class=w>       </span><span class=k>if</span><span class=p>(</span><span class=n>global_argc</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>2</span><span class=p>)</span>
</span><span id=__span-27-7><span class=w>       </span><span class=p>{</span>
</span><span id=__span-27-8><span class=w>           </span><span class=n>chdir</span><span class=p>(</span><span class=n>global_argv</span><span class=p>[</span><span class=mi>1</span><span class=p>]);</span>
</span><span id=__span-27-9><span class=w>           </span><span class=k>return</span><span class=w> </span><span class=nb>true</span><span class=p>;</span>
</span><span id=__span-27-10><span class=w>       </span><span class=p>}</span>
</span><span id=__span-27-11><span class=w>   </span><span class=p>}</span>
</span><span id=__span-27-12>
</span><span id=__span-27-13><span class=w>   </span><span class=k>return</span><span class=w> </span><span class=nb>false</span><span class=p>;</span>
</span><span id=__span-27-14><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <p>处理完<code>cd</code>命令可以发现尽管更改了工作路径，但是终端提示内容没有改变，原因是当前终端提示内容是程序加载时从父进程（系统<code>shell</code>）继承的环境变量，此时不论多少次获取，都只会读取到程序启动时的继承环境变量，所以<code>pwd</code>的值自始至终都是最开始启动的值，为了解决这个问题，可以将<code>getenv</code>函数换成<code>getcwd</code>函数</p> <p>示例代码如下：</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-28-1><span class=kt>void</span><span class=w> </span><span class=nf>printfCommandHint</span><span class=p>()</span>
</span><span id=__span-28-2><span class=p>{</span>
</span><span id=__span-28-3><span class=w>    </span><span class=c1>// 存储当前工作路径</span>
</span><span id=__span-28-4><span class=w>    </span><span class=kt>char</span><span class=w> </span><span class=n>current_wd</span><span class=p>[</span><span class=n>BaseSize</span><span class=p>];</span>
</span><span id=__span-28-5><span class=w>    </span><span class=c1>// 获取用户名</span>
</span><span id=__span-28-6><span class=w>    </span><span class=kt>char</span><span class=o>*</span><span class=w> </span><span class=n>user</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>getenv</span><span class=p>(</span><span class=s>&quot;USER&quot;</span><span class=p>);</span>
</span><span id=__span-28-7><span class=w>    </span><span class=c1>// 获取主机名</span>
</span><span id=__span-28-8><span class=w>    </span><span class=kt>char</span><span class=o>*</span><span class=w> </span><span class=n>hostname</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>getenv</span><span class=p>(</span><span class=s>&quot;HOSTNAME&quot;</span><span class=p>);</span>
</span><span id=__span-28-9><span class=w>    </span><span class=c1>// 获取当前工作路径</span>
</span><span id=__span-28-10><span class=w>    </span><span class=n>getcwd</span><span class=p>(</span><span class=n>current_wd</span><span class=p>,</span><span class=w> </span><span class=n>BaseSize</span><span class=p>);</span>
</span><span id=__span-28-11><span class=w>    </span><span class=c1>// 打印信息</span>
</span><span id=__span-28-12><span class=w>    </span><span class=n>printf</span><span class=p>(</span><span class=s>&quot;[%s@%s %s]%c &quot;</span><span class=p>,</span><span class=w> </span><span class=n>user</span><span class=p>,</span><span class=w> </span><span class=n>hostname</span><span class=p>,</span><span class=w> </span><span class=n>current_wd</span><span class=p>,</span>
</span><span id=__span-28-13><span class=w>            </span><span class=n>strcmp</span><span class=p>(</span><span class=n>user</span><span class=p>,</span><span class=w> </span><span class=s>&quot;root&quot;</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=sc>&#39;#&#39;</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=sc>&#39;$&#39;</span><span class=p>);</span>
</span><span id=__span-28-14><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <p>单独处理回到家目录的情况：</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-29-1><span class=kt>bool</span><span class=w> </span><span class=nf>checkIfBuiltInAndExecute</span><span class=p>()</span>
</span><span id=__span-29-2><span class=p>{</span>
</span><span id=__span-29-3><span class=w>   </span><span class=k>if</span><span class=p>(</span><span class=n>strcmp</span><span class=p>(</span><span class=n>global_argv</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span><span class=w> </span><span class=s>&quot;cd&quot;</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>0</span><span class=p>)</span>
</span><span id=__span-29-4><span class=w>   </span><span class=p>{</span>
</span><span id=__span-29-5><span class=w>       </span><span class=c1>// 判断是否有两个参数防止越界访问</span>
</span><span id=__span-29-6><span class=w>       </span><span class=k>if</span><span class=p>(</span><span class=n>global_argc</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>2</span><span class=p>)</span>
</span><span id=__span-29-7><span class=w>       </span><span class=p>{</span>
</span><span id=__span-29-8><span class=w>           </span><span class=c1>// 处理cd ~</span>
</span><span id=__span-29-9><span class=w>           </span><span class=k>if</span><span class=p>(</span><span class=n>strcmp</span><span class=p>(</span><span class=n>global_argv</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span><span class=w> </span><span class=s>&quot;~&quot;</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>0</span><span class=p>)</span>
</span><span id=__span-29-10><span class=w>           </span><span class=p>{</span>
</span><span id=__span-29-11><span class=w>               </span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=w> </span><span class=n>user</span><span class=p>(</span><span class=n>getenv</span><span class=p>(</span><span class=s>&quot;USER&quot;</span><span class=p>));</span>
</span><span id=__span-29-12><span class=w>               </span><span class=k>if</span><span class=p>(</span><span class=n>user</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&quot;root&quot;</span><span class=p>)</span>
</span><span id=__span-29-13><span class=w>               </span><span class=p>{</span>
</span><span id=__span-29-14><span class=w>                    </span><span class=n>chdir</span><span class=p>(</span><span class=s>&quot;/root&quot;</span><span class=p>);</span>
</span><span id=__span-29-15><span class=w>               </span><span class=p>}</span>
</span><span id=__span-29-16><span class=w>               </span><span class=k>else</span><span class=w> </span>
</span><span id=__span-29-17><span class=w>               </span><span class=p>{</span>
</span><span id=__span-29-18><span class=w>                    </span><span class=n>chdir</span><span class=p>(</span><span class=n>getenv</span><span class=p>(</span><span class=s>&quot;HOME&quot;</span><span class=p>));</span>
</span><span id=__span-29-19><span class=w>               </span><span class=p>}</span>
</span><span id=__span-29-20><span class=w>           </span><span class=p>}</span>
</span><span id=__span-29-21><span class=w>           </span><span class=k>else</span><span class=w> </span>
</span><span id=__span-29-22><span class=w>           </span><span class=p>{</span>
</span><span id=__span-29-23><span class=w>                </span><span class=n>chdir</span><span class=p>(</span><span class=n>global_argv</span><span class=p>[</span><span class=mi>1</span><span class=p>]);</span>
</span><span id=__span-29-24><span class=w>           </span><span class=p>}</span>
</span><span id=__span-29-25><span class=w>           </span><span class=k>return</span><span class=w> </span><span class=nb>true</span><span class=p>;</span>
</span><span id=__span-29-26><span class=w>       </span><span class=p>}</span>
</span><span id=__span-29-27><span class=w>   </span><span class=p>}</span>
</span><span id=__span-29-28>
</span><span id=__span-29-29><span class=w>   </span><span class=k>return</span><span class=w> </span><span class=nb>false</span><span class=p>;</span>
</span><span id=__span-29-30><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <h4 id=export><code>export</code>命令处理<a class=headerlink href=#export title="Permanent link">&para;</a></h4> <p><code>export</code>命令是将指定的环境变量导入到当前进程对应的环境变量表，所以也不可以交给子进程处理，当前模拟的shell所有的环境变量均是与系统shell共享的，因为并没有修改，一旦修改，就会发生写时拷贝，为了让模拟的shell拥有自己的环境变量，可以在程序启动时，加载父进程的环境变量到当前的模拟shell程序中，再处理<code>export</code>命令</p> <p>模拟的shell复制系统shell的环境变量示例代码如下：</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-30-1><span class=c1>// 环境变量表</span>
</span><span id=__span-30-2><span class=kt>char</span><span class=o>*</span><span class=w> </span><span class=n>global_env</span><span class=p>[</span><span class=n>BaseSize</span><span class=p>];</span>
</span><span id=__span-30-3><span class=c1>// 声明父进程的环境变量表</span>
</span><span id=__span-30-4><span class=k>extern</span><span class=w> </span><span class=kt>char</span><span class=o>**</span><span class=w> </span><span class=n>environ</span><span class=p>;</span>
</span><span id=__span-30-5>
</span><span id=__span-30-6><span class=kt>void</span><span class=w> </span><span class=nf>initShell</span><span class=p>()</span>
</span><span id=__span-30-7><span class=p>{</span>
</span><span id=__span-30-8><span class=w>    </span><span class=c1>// 拷贝父进程的环境变量表</span>
</span><span id=__span-30-9><span class=w>    </span><span class=k>for</span><span class=p>(</span><span class=kt>size_t</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=n>environ</span><span class=p>[</span><span class=n>i</span><span class=p>];</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span><span id=__span-30-10><span class=w>    </span><span class=p>{</span>
</span><span id=__span-30-11><span class=w>        </span><span class=n>global_env</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>environ</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
</span><span id=__span-30-12><span class=w>    </span><span class=p>}</span>
</span><span id=__span-30-13><span class=w>    </span><span class=c1>// 最后一个位置置为空</span>
</span><span id=__span-30-14><span class=w>    </span><span class=n>global_env</span><span class=p>[</span><span class=n>strlen</span><span class=p>(</span><span class=o>*</span><span class=p>(</span><span class=n>environ</span><span class=p>))]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>nullptr</span><span class=p>;</span>
</span><span id=__span-30-15><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <p>处理<code>export</code>命令如下：</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-31-1><span class=kt>bool</span><span class=w> </span><span class=nf>checkIfBuiltInAndExecute</span><span class=p>()</span>
</span><span id=__span-31-2><span class=p>{</span>
</span><span id=__span-31-3><span class=w>   </span><span class=c1>// ...</span>
</span><span id=__span-31-4><span class=w>   </span><span class=k>else</span><span class=w> </span><span class=k>if</span><span class=p>(</span><span class=n>strcmp</span><span class=p>(</span><span class=n>global_argv</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span><span class=w> </span><span class=s>&quot;export&quot;</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>0</span><span class=p>)</span>
</span><span id=__span-31-5><span class=w>   </span><span class=p>{</span>
</span><span id=__span-31-6><span class=w>       </span><span class=k>if</span><span class=p>(</span><span class=n>global_argc</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>2</span><span class=p>)</span>
</span><span id=__span-31-7><span class=w>       </span><span class=p>{</span>
</span><span id=__span-31-8><span class=w>           </span><span class=kt>size_t</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-31-9><span class=w>           </span><span class=c1>// 先找到环境变量表为空位置</span>
</span><span id=__span-31-10><span class=w>           </span><span class=k>for</span><span class=p>(;</span><span class=w> </span><span class=n>global_env</span><span class=p>[</span><span class=n>i</span><span class=p>];</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>);</span>
</span><span id=__span-31-11><span class=w>           </span><span class=c1>// 添加新的环境变量，不考虑重复，理论上不会出现空间不足导致越界</span>
</span><span id=__span-31-12><span class=w>           </span><span class=n>global_env</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=kt>char</span><span class=o>*</span><span class=p>)</span><span class=n>malloc</span><span class=p>(</span><span class=k>sizeof</span><span class=p>(</span><span class=n>strlen</span><span class=p>(</span><span class=n>global_argv</span><span class=p>[</span><span class=mi>1</span><span class=p>])));</span>
</span><span id=__span-31-13><span class=w>           </span><span class=n>strncpy</span><span class=p>(</span><span class=n>global_env</span><span class=p>[</span><span class=n>i</span><span class=p>],</span><span class=w> </span><span class=n>global_argv</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span><span class=w> </span><span class=p>(</span><span class=n>strlen</span><span class=p>(</span><span class=n>global_argv</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=p>));</span>
</span><span id=__span-31-14><span class=w>           </span><span class=n>global_env</span><span class=p>[</span><span class=o>++</span><span class=n>i</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>nullptr</span><span class=p>;</span>
</span><span id=__span-31-15><span class=w>           </span><span class=k>return</span><span class=w> </span><span class=nb>true</span><span class=p>;</span>
</span><span id=__span-31-16><span class=w>       </span><span class=p>}</span>
</span><span id=__span-31-17><span class=w>   </span><span class=p>}</span>
</span><span id=__span-31-18>
</span><span id=__span-31-19><span class=w>   </span><span class=k>return</span><span class=w> </span><span class=nb>false</span><span class=p>;</span>
</span><span id=__span-31-20><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <h4 id=env><code>env</code>命令处理<a class=headerlink href=#env title="Permanent link">&para;</a></h4> <p><code>env</code>本质就是遍历当前进程的环境变量，因为当前模拟的shell进程的环境变量表已经拷贝完成，所以只需要遍历拷贝后的环境变量表</p> <p>示例代码如下：</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-32-1><span class=kt>bool</span><span class=w> </span><span class=nf>checkIfBuiltInAndExecute</span><span class=p>()</span>
</span><span id=__span-32-2><span class=p>{</span>
</span><span id=__span-32-3><span class=w>   </span><span class=c1>// ...</span>
</span><span id=__span-32-4><span class=w>   </span><span class=k>else</span><span class=w> </span><span class=k>if</span><span class=p>(</span><span class=n>strcmp</span><span class=p>(</span><span class=n>global_argv</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span><span class=w> </span><span class=s>&quot;env&quot;</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>0</span><span class=p>)</span>
</span><span id=__span-32-5><span class=w>   </span><span class=p>{</span>
</span><span id=__span-32-6><span class=w>       </span><span class=k>for</span><span class=p>(</span><span class=kt>size_t</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=n>global_env</span><span class=p>[</span><span class=n>i</span><span class=p>];</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span><span id=__span-32-7><span class=w>       </span><span class=p>{</span>
</span><span id=__span-32-8><span class=w>           </span><span class=n>printf</span><span class=p>(</span><span class=s>&quot;%s</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span><span class=w> </span><span class=n>global_env</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span><span id=__span-32-9><span class=w>       </span><span class=p>}</span>
</span><span id=__span-32-10><span class=w>       </span><span class=k>return</span><span class=w> </span><span class=nb>true</span><span class=p>;</span>
</span><span id=__span-32-11><span class=w>   </span><span class=p>}</span>
</span><span id=__span-32-12>
</span><span id=__span-32-13><span class=w>   </span><span class=k>return</span><span class=w> </span><span class=nb>false</span><span class=p>;</span>
</span><span id=__span-32-14><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <h4 id=echo><code>echo</code>命令处理<a class=headerlink href=#echo title="Permanent link">&para;</a></h4> <p>本次修改的echo主要考虑两种情况：</p> <ol> <li><code>echo $?</code>：打印上一次进程的退出信息码</li> <li><code>echo 字符串</code>：打印指定字符串</li> </ol> <p>对于第一种，考虑创建一个全局变量接收每一个指令执行后的退出码，对于内建命令使用自定义退出码，对于外部命令通过<code>status</code>变量和相关的宏操作获取</p> <p>对于第二种，考虑直接打印字符串即可</p> <p>示例代码如下：</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span>
<span class=normal>45</span>
<span class=normal>46</span>
<span class=normal>47</span>
<span class=normal>48</span>
<span class=normal>49</span>
<span class=normal>50</span>
<span class=normal>51</span>
<span class=normal>52</span>
<span class=normal>53</span>
<span class=normal>54</span>
<span class=normal>55</span>
<span class=normal>56</span>
<span class=normal>57</span>
<span class=normal>58</span>
<span class=normal>59</span>
<span class=normal>60</span>
<span class=normal>61</span>
<span class=normal>62</span>
<span class=normal>63</span>
<span class=normal>64</span>
<span class=normal>65</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-33-1><span class=c1>// 添加退出码位置与echo命令设置</span>
</span><span id=__span-33-2><span class=kt>bool</span><span class=w> </span><span class=nf>checkIfBuiltInAndExecute</span><span class=p>()</span>
</span><span id=__span-33-3><span class=p>{</span>
</span><span id=__span-33-4><span class=w>   </span><span class=k>if</span><span class=p>(</span><span class=n>strcmp</span><span class=p>(</span><span class=n>global_argv</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span><span class=w> </span><span class=s>&quot;cd&quot;</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>0</span><span class=p>)</span>
</span><span id=__span-33-5><span class=w>   </span><span class=p>{</span>
</span><span id=__span-33-6><span class=w>       </span><span class=c1>// ...</span>
</span><span id=__span-33-7><span class=w>       </span><span class=n>exitCode</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>NORMAL</span><span class=p>;</span>
</span><span id=__span-33-8><span class=w>       </span><span class=k>return</span><span class=w> </span><span class=nb>true</span><span class=p>;</span>
</span><span id=__span-33-9><span class=w>   </span><span class=p>}</span>
</span><span id=__span-33-10><span class=w>   </span><span class=k>else</span><span class=w> </span><span class=k>if</span><span class=p>(</span><span class=n>strcmp</span><span class=p>(</span><span class=n>global_argv</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span><span class=w> </span><span class=s>&quot;export&quot;</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>0</span><span class=p>)</span>
</span><span id=__span-33-11><span class=w>   </span><span class=p>{</span>
</span><span id=__span-33-12><span class=w>       </span><span class=c1>// ...</span>
</span><span id=__span-33-13><span class=w>       </span><span class=n>exitCode</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>NORMAL</span><span class=p>;</span>
</span><span id=__span-33-14><span class=w>       </span><span class=k>return</span><span class=w> </span><span class=nb>true</span><span class=p>;</span>
</span><span id=__span-33-15><span class=w>   </span><span class=p>}</span>
</span><span id=__span-33-16><span class=w>   </span><span class=k>else</span><span class=w> </span><span class=k>if</span><span class=p>(</span><span class=n>strcmp</span><span class=p>(</span><span class=n>global_argv</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span><span class=w> </span><span class=s>&quot;env&quot;</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>0</span><span class=p>)</span>
</span><span id=__span-33-17><span class=w>   </span><span class=p>{</span>
</span><span id=__span-33-18><span class=w>       </span><span class=c1>// ...</span>
</span><span id=__span-33-19><span class=w>       </span><span class=n>exitCode</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>NORMAL</span><span class=p>;</span>
</span><span id=__span-33-20><span class=w>       </span><span class=k>return</span><span class=w> </span><span class=nb>true</span><span class=p>;</span>
</span><span id=__span-33-21><span class=w>   </span><span class=p>}</span>
</span><span id=__span-33-22><span class=w>   </span><span class=k>else</span><span class=w> </span><span class=k>if</span><span class=p>(</span><span class=n>strcmp</span><span class=p>(</span><span class=n>global_argv</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span><span class=w> </span><span class=s>&quot;echo&quot;</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>0</span><span class=p>)</span>
</span><span id=__span-33-23><span class=w>   </span><span class=p>{</span>
</span><span id=__span-33-24><span class=w>       </span><span class=c1>// 获取第二个参数的第一个字符和第二个字符</span>
</span><span id=__span-33-25><span class=w>       </span><span class=k>if</span><span class=p>(</span><span class=n>global_argv</span><span class=p>[</span><span class=mi>1</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=sc>&#39;$&#39;</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>global_argv</span><span class=p>[</span><span class=mi>1</span><span class=p>][</span><span class=mi>1</span><span class=p>])</span>
</span><span id=__span-33-26><span class=w>       </span><span class=p>{</span>
</span><span id=__span-33-27><span class=w>           </span><span class=n>printf</span><span class=p>(</span><span class=s>&quot;%d</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span><span class=w> </span><span class=n>exitCode</span><span class=p>);</span>
</span><span id=__span-33-28><span class=w>       </span><span class=p>}</span>
</span><span id=__span-33-29><span class=w>       </span><span class=k>else</span><span class=w> </span>
</span><span id=__span-33-30><span class=w>       </span><span class=p>{</span>
</span><span id=__span-33-31><span class=w>           </span><span class=c1>// 直接输出字符串</span>
</span><span id=__span-33-32><span class=w>           </span><span class=n>printf</span><span class=p>(</span><span class=s>&quot;%s</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span><span class=w> </span><span class=n>global_argv</span><span class=p>[</span><span class=mi>1</span><span class=p>]);</span>
</span><span id=__span-33-33><span class=w>       </span><span class=p>}</span>
</span><span id=__span-33-34><span class=w>       </span><span class=c1>// 将上一次的退出码置为0</span>
</span><span id=__span-33-35><span class=w>       </span><span class=n>exitCode</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>NORMAL</span><span class=p>;</span>
</span><span id=__span-33-36><span class=w>       </span><span class=k>return</span><span class=w> </span><span class=nb>true</span><span class=p>;</span>
</span><span id=__span-33-37><span class=w>   </span><span class=p>}</span>
</span><span id=__span-33-38><span class=w>   </span><span class=n>exitCode</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>FAILED</span><span class=p>;</span>
</span><span id=__span-33-39><span class=w>   </span><span class=k>return</span><span class=w> </span><span class=nb>false</span><span class=p>;</span>
</span><span id=__span-33-40><span class=p>}</span>
</span><span id=__span-33-41>
</span><span id=__span-33-42><span class=c1>// 其他位置</span>
</span><span id=__span-33-43><span class=kt>void</span><span class=w> </span><span class=nf>executeProgram</span><span class=p>()</span>
</span><span id=__span-33-44><span class=p>{</span>
</span><span id=__span-33-45><span class=w>    </span><span class=c1>// ...</span>
</span><span id=__span-33-46>
</span><span id=__span-33-47><span class=w>    </span><span class=c1>// 存储进程退出码</span>
</span><span id=__span-33-48><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>status</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-33-49><span class=w>    </span><span class=c1>// 父进程等待</span>
</span><span id=__span-33-50><span class=w>    </span><span class=kt>pid_t</span><span class=w> </span><span class=n>rid</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>waitpid</span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>status</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>);</span>
</span><span id=__span-33-51><span class=w>    </span><span class=c1>// 正常回收情况下</span>
</span><span id=__span-33-52><span class=w>    </span><span class=k>if</span><span class=p>(</span><span class=n>rid</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>0</span><span class=p>)</span>
</span><span id=__span-33-53><span class=w>    </span><span class=p>{</span>
</span><span id=__span-33-54><span class=w>        </span><span class=k>if</span><span class=p>(</span><span class=n>WIFEXITED</span><span class=p>(</span><span class=n>status</span><span class=p>))</span>
</span><span id=__span-33-55><span class=w>        </span><span class=p>{</span>
</span><span id=__span-33-56><span class=w>            </span><span class=c1>// 正常退出码</span>
</span><span id=__span-33-57><span class=w>            </span><span class=n>exitCode</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>WEXITSTATUS</span><span class=p>(</span><span class=n>status</span><span class=p>);</span>
</span><span id=__span-33-58><span class=w>        </span><span class=p>}</span>
</span><span id=__span-33-59><span class=w>        </span><span class=k>else</span><span class=w> </span><span class=k>if</span><span class=p>(</span><span class=n>WIFSIGNALED</span><span class=p>(</span><span class=n>status</span><span class=p>))</span><span class=w> </span>
</span><span id=__span-33-60><span class=w>        </span><span class=p>{</span>
</span><span id=__span-33-61><span class=w>            </span><span class=c1>// 被信号终止</span>
</span><span id=__span-33-62><span class=w>            </span><span class=n>exitCode</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>WTERMSIG</span><span class=p>(</span><span class=n>status</span><span class=p>);</span>
</span><span id=__span-33-63><span class=w>        </span><span class=p>}</span>
</span><span id=__span-33-64><span class=w>    </span><span class=p>}</span>
</span><span id=__span-33-65><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <h3 id=_15>优化<a class=headerlink href=#_15 title="Permanent link">&para;</a></h3> <p>修改了父进程的环境变量后，子进程应该拿到的是当前父进程的环境变量，所以将开始的execvp函数改为<code>execvpe</code>函数：</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-34-1><span class=kt>void</span><span class=w> </span><span class=nf>executeProgram</span><span class=p>()</span>
</span><span id=__span-34-2><span class=p>{</span>
</span><span id=__span-34-3><span class=w>    </span><span class=c1>// ...</span>
</span><span id=__span-34-4><span class=w>    </span><span class=n>execvpe</span><span class=p>(</span><span class=n>global_argv</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span><span class=w> </span><span class=n>global_argv</span><span class=p>,</span><span class=w> </span><span class=n>global_env</span><span class=p>);</span>
</span><span id=__span-34-5><span class=w>    </span><span class=c1>// ...</span>
</span><span id=__span-34-6><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <p>观察终端提示符可以发现，模拟的shell程序会显示从根路径一直到当前路径，为了尽可能还原，可以考虑将获取到的字符串按照<code>/</code>进行截取，一共分为两种情况：</p> <ol> <li>在根目录：路径只有一个<code>/</code></li> <li>不在根目录：最后一个目录是所需</li> </ol> <p>所以可以考虑将最后一个<code>/</code>作为标志，反向取出字符，直到遇到最后一个<code>/</code>，单独处理根目录的情况即可，示例代码如下：</p> <div class="tabbed-set tabbed-alternate" data-tabs=2:2><input checked=checked id=__tabbed_2_1 name=__tabbed_2 type=radio><input id=__tabbed_2_2 name=__tabbed_2 type=radio><div class=tabbed-labels><label for=__tabbed_2_1>反向迭代器+反转字符串</label><label for=__tabbed_2_2>反向查找+查找子串</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-35-1><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=w> </span><span class=nf>getCwd</span><span class=p>()</span>
</span><span id=__span-35-2><span class=p>{</span>
</span><span id=__span-35-3><span class=w>    </span><span class=kt>char</span><span class=w> </span><span class=n>current_wd</span><span class=p>[</span><span class=n>BaseSize</span><span class=p>];</span>
</span><span id=__span-35-4><span class=w>    </span><span class=n>getcwd</span><span class=p>(</span><span class=n>current_wd</span><span class=p>,</span><span class=w> </span><span class=n>BaseSize</span><span class=p>);</span>
</span><span id=__span-35-5><span class=w>    </span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=w> </span><span class=n>s1</span><span class=p>(</span><span class=n>current_wd</span><span class=p>);</span>
</span><span id=__span-35-6><span class=w>    </span><span class=k>if</span><span class=p>(</span><span class=n>s1</span><span class=p>.</span><span class=n>size</span><span class=p>()</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>1</span><span class=p>)</span>
</span><span id=__span-35-7><span class=w>    </span><span class=p>{</span>
</span><span id=__span-35-8><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>s1</span><span class=p>;</span>
</span><span id=__span-35-9><span class=w>    </span><span class=p>}</span>
</span><span id=__span-35-10><span class=w>    </span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=w> </span><span class=n>ret</span><span class=p>;</span>
</span><span id=__span-35-11><span class=w>    </span><span class=c1>// 反向遍历字符串，直到遇到反向第一个/</span>
</span><span id=__span-35-12><span class=w>    </span><span class=k>auto</span><span class=w> </span><span class=n>rit</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>s1</span><span class=p>.</span><span class=n>rbegin</span><span class=p>();</span>
</span><span id=__span-35-13><span class=w>    </span><span class=k>while</span><span class=p>(</span><span class=n>rit</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>s1</span><span class=p>.</span><span class=n>rend</span><span class=p>())</span>
</span><span id=__span-35-14><span class=w>    </span><span class=p>{</span>
</span><span id=__span-35-15><span class=w>        </span><span class=k>if</span><span class=p>((</span><span class=o>*</span><span class=n>rit</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=sc>&#39;/&#39;</span><span class=p>)</span>
</span><span id=__span-35-16><span class=w>        </span><span class=p>{</span>
</span><span id=__span-35-17><span class=w>            </span><span class=k>break</span><span class=p>;</span>
</span><span id=__span-35-18><span class=w>        </span><span class=p>}</span>
</span><span id=__span-35-19><span class=w>        </span><span class=n>ret</span><span class=p>.</span><span class=n>push_back</span><span class=p>((</span><span class=o>*</span><span class=n>rit</span><span class=p>));</span>
</span><span id=__span-35-20><span class=w>        </span><span class=o>++</span><span class=n>rit</span><span class=p>;</span>
</span><span id=__span-35-21><span class=w>    </span><span class=p>}</span>
</span><span id=__span-35-22>
</span><span id=__span-35-23><span class=w>    </span><span class=c1>// 反转字符串</span>
</span><span id=__span-35-24><span class=w>    </span><span class=n>reverse</span><span class=p>(</span><span class=n>ret</span><span class=p>.</span><span class=n>begin</span><span class=p>(),</span><span class=w> </span><span class=n>ret</span><span class=p>.</span><span class=n>end</span><span class=p>());</span><span class=w> </span>
</span><span id=__span-35-25>
</span><span id=__span-35-26><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>ret</span><span class=p>;</span>
</span><span id=__span-35-27><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> </div> <div class=tabbed-block> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-36-1><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=w> </span><span class=nf>getCwd</span><span class=p>()</span>
</span><span id=__span-36-2><span class=p>{</span><span class=w>    </span>
</span><span id=__span-36-3><span class=w>    </span><span class=kt>char</span><span class=w> </span><span class=n>current_wd</span><span class=p>[</span><span class=n>BaseSize</span><span class=p>];</span>
</span><span id=__span-36-4><span class=w>    </span><span class=n>getcwd</span><span class=p>(</span><span class=n>current_wd</span><span class=p>,</span><span class=w> </span><span class=n>BaseSize</span><span class=p>);</span>
</span><span id=__span-36-5><span class=w>    </span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=w> </span><span class=n>user</span><span class=p>(</span><span class=n>current_wd</span><span class=p>);</span>
</span><span id=__span-36-6><span class=w>    </span><span class=c1>// 如果是根目录，直接返回/</span>
</span><span id=__span-36-7><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>user</span><span class=p>.</span><span class=n>size</span><span class=p>()</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>1</span><span class=p>)</span>
</span><span id=__span-36-8><span class=w>    </span><span class=p>{</span>
</span><span id=__span-36-9><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>user</span><span class=p>;</span>
</span><span id=__span-36-10><span class=w>    </span><span class=p>}</span>
</span><span id=__span-36-11>
</span><span id=__span-36-12><span class=w>    </span><span class=c1>// 否则从末尾向前找倒数第一个/</span>
</span><span id=__span-36-13><span class=w>    </span><span class=kt>size_t</span><span class=w> </span><span class=n>pos</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>user</span><span class=p>.</span><span class=n>rfind</span><span class=p>(</span><span class=s>&quot;/&quot;</span><span class=p>);</span>
</span><span id=__span-36-14><span class=w>    </span><span class=c1>// 返回找到后的字符串进行截取</span>
</span><span id=__span-36-15><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>user</span><span class=p>.</span><span class=n>substr</span><span class=p>(</span><span class=n>pos</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=p>);</span>
</span><span id=__span-36-16><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> </div> </div> </div> <p><strong>手撕一个简单的shell（版本2）在<a href=https://www.help-doc.top/Linux/io-process/io-process.html#shell2>Linux中输入和输出基本过程</a>中，版本2主要添加了重定向功能</strong></p> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title=最后更新> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">2025年7月30日</span> </span> </aside> <form class=md-feedback name=feedback hidden> <fieldset> <legend class=md-feedback__title> 页面有帮助吗？ </legend> <div class=md-feedback__inner> <div class=md-feedback__list> <button class="md-feedback__icon md-icon" type=submit title=页面对我有帮助 data-md-value=1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M5 9v12H1V9zm4 12a2 2 0 0 1-2-2V9c0-.55.22-1.05.59-1.41L14.17 1l1.06 1.06c.27.27.44.64.44 1.05l-.03.32L14.69 8H21a2 2 0 0 1 2 2v2c0 .26-.05.5-.14.73l-3.02 7.05C19.54 20.5 18.83 21 18 21zm0-2h9.03L21 12v-2h-8.79l1.13-5.32L9 9.03z"/></svg> </button> <button class="md-feedback__icon md-icon" type=submit title=页面没有帮助到我 data-md-value=0> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 15V3h4v12zM15 3a2 2 0 0 1 2 2v10c0 .55-.22 1.05-.59 1.41L9.83 23l-1.06-1.06c-.27-.27-.44-.64-.44-1.06l.03-.31.95-4.57H3a2 2 0 0 1-2-2v-2c0-.26.05-.5.14-.73l3.02-7.05C4.46 3.5 5.17 3 6 3zm0 2H5.97L3 12v2h8.78l-1.13 5.32L15 14.97z"/></svg> </button> </div> <div class=md-feedback__note> <div data-md-value=1 hidden> 谢谢你的反馈！ </div> <div data-md-value=0 hidden> 谢谢你的反馈！联系<a href=https://www.help-doc.top/author/contact/contact.html>作者</a>提供更详细的信息 </div> </div> </div> </fieldset> </form> <!-- Waline 评论系统 --> <div id=waline></div> <!-- 阅读进度条 - 直接在HTML中定义 --> <div class=reading-progress></div> <!-- 滚动指示器 - 直接在HTML中定义 --> <div class=scroll-indicator></div> <!-- 评论系统 --> <!-- Waline 评论系统 --> <div id=waline></div> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <!--
  Copyright (c) 2016-2024 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
--> <!-- Footer --> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2024-2025 柯懒不是柯南 </div> </div> <div class="md-footer-love md-typeset"> 一闪一闪亮晶晶，不及<span class=love-highlight>小亮</span><span class=love-heart>♥</span>照我心。To Li Liang </div> <div class=md-social> <a href=https://github.com/H0308 target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> <a href=https://www.help-doc.top/author/contact/contact.html target=_blank rel=noopener title=www.help-doc.top class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M433.754 420.445c-11.526 1.393-44.86-52.741-44.86-52.741 0 31.345-16.136 72.247-51.051 101.786 16.842 5.192 54.843 19.167 45.803 34.421-7.316 12.343-125.51 7.881-159.632 4.037-34.122 3.844-152.316 8.306-159.632-4.037-9.045-15.25 28.918-29.214 45.783-34.415-34.92-29.539-51.059-70.445-51.059-101.792 0 0-33.334 54.134-44.859 52.741-5.37-.65-12.424-29.644 9.347-99.704 10.261-33.024 21.995-60.478 40.144-105.779C60.683 98.063 108.982.006 224 0c113.737.006 163.156 96.133 160.264 214.963 18.118 45.223 29.912 72.85 40.144 105.778 21.768 70.06 14.716 99.053 9.346 99.704"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.indexes", "navigation.prune", "navigation.tabs", "search.highlight", "content.code.copy"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script> <script src=../../assets/javascripts/bundle.c8b220af.min.js></script> <script src=../../javascripts/katex.min.js></script> <script src=../../javascripts/other.min.js></script> <script src=../../javascripts/copyright.min.js></script> <script src=../../javascripts/waline.min.js></script> <script src=https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.js></script> <script src=https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/contrib/auto-render.min.js></script> <script src=https://cdn.jsdelivr.net/npm/mermaid@11.5.0/dist/mermaid.min.js></script> <script src=../../assets/javascripts/toggle-sidebar.js async></script> <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body> </html>