<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=canonical href=https://www.help-doc.top/cpp/type-cast/type-cast.html><link rel=prev href=../special-class-design/special-class-design.html><link rel=next href=../cppio/cppio.html><link rel=icon href=../../images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.12"><title>C++中的类型转换 - 柯懒的知识库</title><link rel=stylesheet href=../../assets/stylesheets/main.2afb09e1.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><link rel=stylesheet href=../../css/timeline.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-9XWRGNRRSY"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-9XWRGNRRSY",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-9XWRGNRRSY",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script><link rel=stylesheet href=../../stylesheets/colors.min.css><link rel=stylesheet href=../../stylesheets/theme2.min.css media="screen and (max-width: 1199px)"><link rel=stylesheet href=../../stylesheets/theme2.min.css media="screen and (min-width: 1200px)" id=theme2-desktop><link rel=stylesheet href=../../stylesheets/theme1.min.css media="screen and (min-width: 1200px)" id=theme1-desktop><link rel=stylesheet href=../../stylesheets/print.min.css><link rel=stylesheet href=../../stylesheets/font-dongguanti.min.css id=font-dongguanti><link rel=stylesheet href=../../stylesheets/font-oppoti.min.css id=font-oppoti disabled><link rel=stylesheet href=../../stylesheets/font-jiangchengti.min.css id=font-jiangchengti disabled><link rel=stylesheet href=../../stylesheets/font-lxgw.min.css id=font-lxgw disabled><link rel=stylesheet href=../../stylesheets/code-font-dejavu-sans-mono.min.css id=code-font-dejavu-sans-mono><link rel=stylesheet href=../../stylesheets/code-font-zsft-hk.min.css id=code-font-zsft-hk disabled><link rel=stylesheet href=../../stylesheets/code-font-google-sans-code.min.css id=code-font-google-sans-code disabled><link rel=stylesheet href=https://unpkg.com/@waline/client@v3/dist/waline.css><link rel=stylesheet href=../../stylesheets/waline.min.css><script src=../../javascripts/start.min.js></script><script defer src=https://cloud.umami.is/script.js data-website-id=02f9b8b7-93d4-4026-bdd8-221f2fcea2cf></script> <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../assets/javascripts/glightbox.min.js"></script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=white data-md-color-accent=cyan> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#c class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=页眉> <a href=../../index.html title=柯懒的知识库 class="md-header__button md-logo" aria-label=柯懒的知识库 data-md-component=logo> <img src=../../assets/logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> 柯懒的知识库 </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> C++中的类型转换 </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=white data-md-color-accent=cyan aria-label type=radio name=__palette id=__palette_1> </form> <div class=header-avatar> <img src=../../author/作者.assets/20250206-200653.jpg alt=头像> <div class=avatar-dropdown> <p><strong>柯懒不是柯南</strong></p> <a href=../../author/contact/contact.html class=avatar-dropdown-item>联系作者</a> <div class=avatar-dropdown-divider></div> <a href=../../author/about/about.html class=avatar-dropdown-item>关于作者</a> <div class=avatar-dropdown-divider></div> <a href=https://github.com/H0308 class=avatar-dropdown-item>Github仓库</a> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=查找> <button type=reset class="md-search__icon md-icon" title=清空当前内容 aria-label=清空当前内容 tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 正在初始化搜索引擎 </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> </nav> </header> <div class=toolbar-toggle-btn id=toolbarToggleBtn onclick=toggleToolbar()> <div class=toggle-icon> <svg class=toggle-arrow-icon viewbox="0 0 1024 1024" version=1.1 xmlns=http://www.w3.org/2000/svg width=16 height=16> <path d="M346.538667 1024L170.666667 853.333333l341.333333-341.333333-341.333333-341.333333 175.872-170.666667L853.333333 512z" fill=currentColor></path> </svg> </div> </div> <div class=floating-toolbar id=floatingToolbar> <div class="toolbar-item font-switcher"> <div class=toolbar-icon> <svg class=font-icon viewbox="0 0 1024 1024" version=1.1 xmlns=http://www.w3.org/2000/svg width=20 height=20> <path d="M913.408 1024l-66.56 0q-29.696 0-51.2-5.12t-36.864-15.872-26.112-27.136-19.968-37.888q-15.36-38.912-28.16-70.656t-22.016-55.296q-11.264-26.624-20.48-49.152l-254.976 0q-7.168 23.552-17.408 51.2-8.192 23.552-21.504 56.832t-30.72 72.192q-20.48 46.08-47.104 63.488t-60.416 17.408l-70.656 0q-45.056 0-60.928-19.968t2.56-68.096q18.432-46.08 43.008-108.544t52.224-132.608 57.344-143.872 57.344-144.384q65.536-164.864 137.216-343.04 7.168-17.408 18.432-31.744 10.24-11.264 27.136-21.504t42.496-10.24q26.624 0 43.52 10.752t28.16 24.064q12.288 15.36 19.456 33.792 72.704 180.224 138.24 345.088 27.648 70.656 57.344 143.872t56.832 142.336 51.2 129.536 41.472 104.448q14.336 34.816 4.096 62.464t-43.008 27.648zM616.448 634.88l-97.28-347.136-1.024 0-108.544 347.136 206.848 0z" fill=currentColor></path> </svg> </div> <div class=toolbar-label>内容字体</div> <div class=font-dropdown-toolbar> <div class=font-current-toolbar onclick=toggleFontDropdownToolbar()> <span class=current-font-name-toolbar>东观体</span> <svg class=dropdown-arrow-icon viewbox="0 0 1024 1024" version=1.1 xmlns=http://www.w3.org/2000/svg width=12 height=12> <path d="M878.592 250.88q29.696 0 48.128 11.264t24.576 29.696 0 41.472-26.624 45.568q-82.944 92.16-159.744 180.224t-148.48 164.864q-19.456 20.48-45.568 31.744t-53.76 11.776-53.248-8.704-43.008-28.672q-39.936-44.032-82.944-90.112l-88.064-92.16q-43.008-46.08-85.504-90.624t-79.36-86.528q-17.408-19.456-22.528-40.448t1.024-38.4 23.552-28.672 45.056-11.264q35.84 0 98.816-0.512t137.728-0.512l153.6 0 150.528 0 125.952 0 79.872 0z" fill=currentColor></path> </svg> </div> <div class=font-options-toolbar> <div class=font-option-toolbar data-font=dongguanti onclick="selectFontToolbar('dongguanti')">上图东观体 </div> <div class=font-option-toolbar data-font=oppoti onclick="selectFontToolbar('oppoti')">OPPO Sans </div> <div class=font-option-toolbar data-font=jiangchengti onclick="selectFontToolbar('jiangchengti')"> 江城黑体</div> <div class=font-option-toolbar data-font=lxgw onclick="selectFontToolbar('lxgw')">霞鹜臻楷</div> </div> </div> </div> <div class="toolbar-item code-font-switcher"> <div class=toolbar-icon> <svg t=1753672111433 class="icon code-font-icon" viewbox="0 0 1024 1024" version=1.1 xmlns=http://www.w3.org/2000/svg p-id=5148 width=20 height=20> <path d="M941.709938 0H82.290062A82.290062 82.290062 0 0 0 0 82.290062v859.419876A82.290062 82.290062 0 0 0 82.290062 1022.53923h859.419876A82.290062 82.290062 0 0 0 1022.53923 941.709938V82.290062A82.290062 82.290062 0 0 0 941.709938 0zM188.439372 553.631954a40.901569 40.901569 0 0 1-29.215406-70.116975L292.154066 351.558726 159.223966 218.628626a40.901569 40.901569 0 0 1 58.430813-57.94389l160.197813 162.145507a40.901569 40.901569 0 0 1 0 57.943889l-160.197813 160.684736a40.901569 40.901569 0 0 1-29.215407 12.173086z m443.587257 0H405.120304a40.901569 40.901569 0 0 1 0-82.290061H633.000476a40.901569 40.901569 0 0 1 0 82.290061z" fill=currentColor p-id=5149></path> </svg> </div> <div class=toolbar-label>代码字体</div> <div class=code-font-dropdown-toolbar> <div class=code-font-current-toolbar onclick=toggleCodeFontDropdownToolbar()> <span class=current-code-font-name-toolbar>DejaVu Sans Mono</span> <svg class=dropdown-arrow-icon viewbox="0 0 1024 1024" version=1.1 xmlns=http://www.w3.org/2000/svg width=12 height=12> <path d="M878.592 250.88q29.696 0 48.128 11.264t24.576 29.696 0 41.472-26.624 45.568q-82.944 92.16-159.744 180.224t-148.48 164.864q-19.456 20.48-45.568 31.744t-53.76 11.776-53.248-8.704-43.008-28.672q-39.936-44.032-82.944-90.112l-88.064-92.16q-43.008-46.08-85.504-90.624t-79.36-86.528q-17.408-19.456-22.528-40.448t1.024-38.4 23.552-28.672 45.056-11.264q35.84 0 98.816-0.512t137.728-0.512l153.6 0 150.528 0 125.952 0 79.872 0z" fill=currentColor></path> </svg> </div> <div class=code-font-options-toolbar> <div class=code-font-option-toolbar data-code-font=dejavu onclick="selectCodeFontToolbar('dejavu')"> DejaVu Sans Mono</div> <div class=code-font-option-toolbar data-code-font=google-sans-code onclick="selectCodeFontToolbar('google-sans-code')"> Google Sans Code</div> <div class=code-font-option-toolbar data-code-font=zsft onclick="selectCodeFontToolbar('zsft')"> JetBrains Mono</div> </div> </div> </div> <div class="toolbar-item theme-switcher" onclick=switchTheme()> <div class=toolbar-icon> <svg class=theme-icon viewbox="0 0 1024 1024" version=1.1 xmlns=http://www.w3.org/2000/svg width=20 height=20> <path d="M876.572788 522.301623c-1.886977 12.375865-9.657964 30.331819-35.880185 45.48903-56.489572 32.697703-150.21828 83.990926-174.010149 96.958262-13.143345 24.431435-66.067718 122.221646-98.141204 178.503487-16.117073 28.124548-36.055171 34.041304-50.030463 34.041304-0.031722 0-0.031722 0-0.031722 0-14.613836 0-29.1806-6.460132-43.234687-19.218714-47.183626-42.643216-125.994576-117.105115-146.013515-136.083351-27.757181-4.732791-138.338718-23.743774-200.584388-35.752272-17.924231-3.533476-32.649608-14.07046-40.372499-29.084409-5.78782-11.256368-10.281157-30.05962 1.471514-55.658647 26.989701-59.047838 74.126254-157.557432 85.957721-182.196599-3.437286-27.117614-16.996093-135.060045-23.760147-198.905142-1.886977-17.460674 3.901867-35.096333 15.829524-48.351218 12.791327-14.278191 30.667463-21.48943 49.854455-19.426445 63.669088 6.332219 173.259042 19.426445 200.584388 22.705118 24.335245-11.879562 121.085776-58.936297 180.133613-86.34146 9.91379-4.573155 19.85828-6.92369 29.596062-6.92369 28.748764 0 52.172243 20.642133 58.328453 51.421136 12.599969 62.997799 30.93864 166.70272 35.639708 193.484689 18.851347 19.682271 91.953272 96.031147 135.060045 143.07151C872.72004 487.125473 879.307062 504.71406 876.572788 522.301623L876.572788 522.301623zM825.375755 499.085876C776.017604 445.314205 687.245791 352.977193 686.365748 352.017332c-2.942005-3.069919-4.956895-6.971785-5.676279-11.208273-0.207731-1.215688-22.193465-127.001509-36.551474-198.936865-0.799202-3.917216-4.285606-16.836457-16.196891-16.836457-3.453658 0-7.30743 1.006933-11.464099 2.942005-67.282383 31.179117-183.955662 88.180342-185.170327 88.771813-3.693112 1.790786-7.850805 2.558265-11.975752 2.01489-1.295506-0.224104-133.63765-16.165168-205.988468-23.424502-0.079818 0-0.207731 0-0.287549 0-7.30743 0-11.128455 2.89391-13.319353 5.40408-3.677762 4.124947-5.644557 9.91379-5.068436 15.110139 7.674796 72.623018 24.255427 202.934922 24.463158 204.325595 0.511653 4.109598-0.159636 8.266267-1.966795 11.960403-0.591471 1.215688-57.657164 120.04712-88.339977 187.201589-3.565199 7.754614-4.41352 14.214746-2.350534 18.131963 1.935072 3.725858 6.588045 5.820566 10.360975 6.53995 70.719668 13.718443 204.644867 36.519752 206.036563 36.727483 4.189416 0.671289 8.058536 2.686179 11.112082 5.580089 1.006933 0.87902 96.414887 91.281983 150.090367 139.889027 8.314363 7.563256 13.143345 8.106632 14.437827 8.106632 3.485381 0 8.314363-4.621251 12.727882-12.391215 36.343743-63.828724 100.011808-181.988868 100.636025-183.155437 1.983167-3.64604 5.004991-6.667863 8.650007-8.650007 1.134847-0.671289 114.418936-62.373583 178.6314-99.516528 8.698103-5.036713 14.278191-10.568706 14.94948-14.854313C834.681702 511.845481 831.49922 505.800811 825.375755 499.085876L825.375755 499.085876zM935.333076 935.670256c-4.157693 4.157693-9.689686 6.299473-15.141862 6.299473-5.548366 0-11.048637-2.142803-15.238053-6.299473l-171.915441-171.915441c-8.362458-8.394181-8.362458-21.98471 0-30.426987 8.394181-8.394181 21.98471-8.394181 30.379914 0l171.915441 171.915441C943.727257 913.684522 943.727257 927.275052 935.333076 935.670256L935.333076 935.670256z" fill=currentColor></path> </svg> </div> <div class=toolbar-label>主题切换</div> </div> <div class="toolbar-item back-to-top" onclick=scrollToTop()> <div class=toolbar-icon> <svg class=back-to-top-icon viewbox="0 0 1024 1024" xmlns=http://www.w3.org/2000/svg> <path d="M882.688 624.128l-336.896-583.68c-15.872-27.136-54.784-27.136-70.656 0L138.24 624.128c-15.872 27.136 4.096 61.44 35.328 61.44H317.44c22.528 0 40.96 18.432 40.96 40.96v239.616c0 22.528 18.432 40.96 40.96 40.96h223.232c22.528 0 40.96-18.432 40.96-40.96v-239.616c0-22.528 18.432-40.96 40.96-40.96h143.872c30.208 0 50.176-34.304 34.304-61.44z"> </path> </svg> </div> <div class=toolbar-label>返回顶部</div> </div> </div> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=标签 data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../index.html class=md-tabs__link> 主页 </a> </li> <li class=md-tabs__item> <a href=../../intro/intro.html class=md-tabs__link> 网站介绍 </a> </li> <li class=md-tabs__item> <a href=../../timeline/timeline.html class=md-tabs__link> 网站时间线 </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../../languages/index.html class=md-tabs__link> 编程语言 </a> </li> <li class=md-tabs__item> <a href=../../data-structure-algo/index.html class=md-tabs__link> 数据结构与算法 </a> </li> <li class=md-tabs__item> <a href=../../Linux/index.html class=md-tabs__link> Linux </a> </li> <li class=md-tabs__item> <a href=../../front-end/index.html class=md-tabs__link> 前端 </a> </li> <li class=md-tabs__item> <a href=../../MySQL/index.html class=md-tabs__link> MySQL </a> </li> <li class=md-tabs__item> <a href=../../JavaEE/index.html class=md-tabs__link> JavaEE应用开发 </a> </li> <li class=md-tabs__item> <a href=../../software-test/index.html class=md-tabs__link> 软件测试 </a> </li> <li class=md-tabs__item> <a href=../../other/index.html class=md-tabs__link> 扩展知识 </a> </li> <li class=md-tabs__item> <a href=../../tooltips/index.html class=md-tabs__link> 工具帮助 </a> </li> <li class=md-tabs__item> <a href=../../test-encrypt/test-encrypt.html class=md-tabs__link> 测试加密功能 </a> </li> <li class=md-tabs__item> <a href=../../projects/index.html class=md-tabs__link> 项目 </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=导航栏 data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../index.html title=柯懒的知识库 class="md-nav__button md-logo" aria-label=柯懒的知识库 data-md-component=logo> <img src=../../assets/logo.png alt=logo> </a> 柯懒的知识库 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../index.html class=md-nav__link> <span class=md-ellipsis> 主页 </span> </a> </li> <li class=md-nav__item> <a href=../../intro/intro.html class=md-nav__link> <span class=md-ellipsis> 网站介绍 </span> </a> </li> <li class=md-nav__item> <a href=../../timeline/timeline.html class=md-nav__link> <span class=md-ellipsis> 网站时间线 </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4 checked> <div class="md-nav__link md-nav__container"> <a href=../../languages/index.html class="md-nav__link "> <span class=md-ellipsis> 编程语言 </span> </a> <label class="md-nav__link " for=__nav_4 id=__nav_4_label tabindex> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=true> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> 编程语言 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../c-lang/index.html class=md-nav__link> <span class=md-ellipsis> C语言 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_3 checked> <div class="md-nav__link md-nav__container"> <a href=../index.html class="md-nav__link "> <span class=md-ellipsis> C++ </span> </a> <label class="md-nav__link " for=__nav_4_3 id=__nav_4_3_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_3_label aria-expanded=true> <label class=md-nav__title for=__nav_4_3> <span class="md-nav__icon md-icon"></span> C++ </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../c-to-cpp/c-to-cpp.html class=md-nav__link> <span class=md-ellipsis> C语言过渡C++基础知识 </span> </a> </li> <li class=md-nav__item> <a href=../class-obj/class-obj.html class=md-nav__link> <span class=md-ellipsis> C++类和对象 </span> </a> </li> <li class=md-nav__item> <a href=../member-func/member-func.html class=md-nav__link> <span class=md-ellipsis> C++默认成员函数 </span> </a> </li> <li class=md-nav__item> <a href=../class-obj-other/class-obj-other.html class=md-nav__link> <span class=md-ellipsis> C++类和对象相关内容 </span> </a> </li> <li class=md-nav__item> <a href=../memory/memory.html class=md-nav__link> <span class=md-ellipsis> C++内存管理 </span> </a> </li> <li class=md-nav__item> <a href=../template/template.html class=md-nav__link> <span class=md-ellipsis> C++模版 </span> </a> </li> <li class=md-nav__item> <a href=../stl-intro-string/stl-intro-string.html class=md-nav__link> <span class=md-ellipsis> C++STL简介与string类 </span> </a> </li> <li class=md-nav__item> <a href=../sim-string/sim-string.html class=md-nav__link> <span class=md-ellipsis> string类模拟实现 </span> </a> </li> <li class=md-nav__item> <a href=../vector/vector.html class=md-nav__link> <span class=md-ellipsis> vector类 </span> </a> </li> <li class=md-nav__item> <a href=../sim-vector/sim-vector.html class=md-nav__link> <span class=md-ellipsis> vector类模拟实现 </span> </a> </li> <li class=md-nav__item> <a href=../list/list.html class=md-nav__link> <span class=md-ellipsis> list类 </span> </a> </li> <li class=md-nav__item> <a href=../sim-list/sim-list.html class=md-nav__link> <span class=md-ellipsis> list类模拟实现 </span> </a> </li> <li class=md-nav__item> <a href=../stack/stack.html class=md-nav__link> <span class=md-ellipsis> stack类 </span> </a> </li> <li class=md-nav__item> <a href=../queue-priority-queue/queue-priority-queue.html class=md-nav__link> <span class=md-ellipsis> queue与priority_queue类 </span> </a> </li> <li class=md-nav__item> <a href=../sim-stack-queue/sim-stack-queue.html class=md-nav__link> <span class=md-ellipsis> stack和queue模拟实现 </span> </a> </li> <li class=md-nav__item> <a href=../sim-priority-queue/sim-priority-queue.html class=md-nav__link> <span class=md-ellipsis> priority_queue模拟实现 </span> </a> </li> <li class=md-nav__item> <a href=../reverse-iterator/reverse-iterator.html class=md-nav__link> <span class=md-ellipsis> 反向迭代器设计 </span> </a> </li> <li class=md-nav__item> <a href=../extend/extend.html class=md-nav__link> <span class=md-ellipsis> C++继承 </span> </a> </li> <li class=md-nav__item> <a href=../polymorphic/polymorphic.html class=md-nav__link> <span class=md-ellipsis> C++多态 </span> </a> </li> <li class=md-nav__item> <a href=../set/set.html class=md-nav__link> <span class=md-ellipsis> set类 </span> </a> </li> <li class=md-nav__item> <a href=../map/map.html class=md-nav__link> <span class=md-ellipsis> map类 </span> </a> </li> <li class=md-nav__item> <a href=../sim-map-set/sim-map-set.html class=md-nav__link> <span class=md-ellipsis> map和set类模拟实现 </span> </a> </li> <li class=md-nav__item> <a href=../sim-unordered-map-set/sim-unordered-map-set.html class=md-nav__link> <span class=md-ellipsis> unordered_map和unordered_set类模拟实现 </span> </a> </li> <li class=md-nav__item> <a href=../bitset/bitset.html class=md-nav__link> <span class=md-ellipsis> bitset类 </span> </a> </li> <li class=md-nav__item> <a href=../initializer-list/initializer-list.html class=md-nav__link> <span class=md-ellipsis> initializer_list类 </span> </a> </li> <li class=md-nav__item> <a href=../new-in-cpp11/new-in-cpp11.html class=md-nav__link> <span class=md-ellipsis> C++ 11相关新特性 </span> </a> </li> <li class=md-nav__item> <a href=../exception/exception.html class=md-nav__link> <span class=md-ellipsis> C++异常 </span> </a> </li> <li class=md-nav__item> <a href=../smart-ptr/smart-ptr.html class=md-nav__link> <span class=md-ellipsis> C++智能指针 </span> </a> </li> <li class=md-nav__item> <a href=../special-class-design/special-class-design.html class=md-nav__link> <span class=md-ellipsis> 特殊类设计 </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> C++中的类型转换 </span> <span class="md-nav__icon md-icon"></span> </label> <a href=type-cast.html class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> C++中的类型转换 </span> </a> <nav class="md-nav md-nav--secondary" aria-label=本节目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 本节目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#_1 class=md-nav__link> <span class=md-ellipsis> 引入 </span> </a> </li> <li class=md-nav__item> <a href=#c_1 class=md-nav__link> <span class=md-ellipsis> C++中的三种类型转换 </span> </a> <nav class=md-nav aria-label=C++中的三种类型转换> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_2 class=md-nav__link> <span class=md-ellipsis> 内置类型与内置类型相互转换 </span> </a> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> <span class=md-ellipsis> 内置类型与自定义类型相互转换 </span> </a> <nav class=md-nav aria-label=内置类型与自定义类型相互转换> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_4 class=md-nav__link> <span class=md-ellipsis> 内置类型转换为自定义类型 </span> </a> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> <span class=md-ellipsis> 自定义类型转换为内置类型 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_6 class=md-nav__link> <span class=md-ellipsis> 自定义类型与自定义类型相互转换 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#c_2 class=md-nav__link> <span class=md-ellipsis> C++中的四种类型转换模版 </span> </a> <nav class=md-nav aria-label=C++中的四种类型转换模版> <ul class=md-nav__list> <li class=md-nav__item> <a href=#static_cast class=md-nav__link> <span class=md-ellipsis> static_cast </span> </a> </li> <li class=md-nav__item> <a href=#reinterpret_cast class=md-nav__link> <span class=md-ellipsis> reinterpret_cast </span> </a> </li> <li class=md-nav__item> <a href=#const_cast class=md-nav__link> <span class=md-ellipsis> const_cast </span> </a> </li> <li class=md-nav__item> <a href=#dynamic_castdynamic_pointer_cast class=md-nav__link> <span class=md-ellipsis> dynamic_cast和dynamic_pointer_cast </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../cppio/cppio.html class=md-nav__link> <span class=md-ellipsis> C++ IO流 </span> </a> </li> <li class=md-nav__item> <a href=../new-in-cpp17/new-in-cpp17.html class=md-nav__link> <span class=md-ellipsis> C++ 17相关新特性 </span> </a> </li> <li class=md-nav__item> <a href=../time-rand/time-rand.html class=md-nav__link> <span class=md-ellipsis> C++时间和随机数相关库 </span> </a> </li> <li class=md-nav__item> <a href=../multi-thread/multi-thread.html class=md-nav__link> <span class=md-ellipsis> C++并发支持库 </span> </a> </li> <li class=md-nav__item> <a href=../format/format.html class=md-nav__link> <span class=md-ellipsis> C++中的格式化字符串 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../Java/index.html class=md-nav__link> <span class=md-ellipsis> Java </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../python/index.html class=md-nav__link> <span class=md-ellipsis> Python </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../data-structure-algo/index.html class=md-nav__link> <span class=md-ellipsis> 数据结构与算法 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../Linux/index.html class=md-nav__link> <span class=md-ellipsis> Linux </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../front-end/index.html class=md-nav__link> <span class=md-ellipsis> 前端 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../MySQL/index.html class=md-nav__link> <span class=md-ellipsis> MySQL </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../JavaEE/index.html class=md-nav__link> <span class=md-ellipsis> JavaEE应用开发 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../software-test/index.html class=md-nav__link> <span class=md-ellipsis> 软件测试 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../other/index.html class=md-nav__link> <span class=md-ellipsis> 扩展知识 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../tooltips/index.html class=md-nav__link> <span class=md-ellipsis> 工具帮助 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../test-encrypt/test-encrypt.html class=md-nav__link> <span class=md-ellipsis> 测试加密功能 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../projects/index.html class=md-nav__link> <span class=md-ellipsis> 项目 </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=本节目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 本节目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#_1 class=md-nav__link> <span class=md-ellipsis> 引入 </span> </a> </li> <li class=md-nav__item> <a href=#c_1 class=md-nav__link> <span class=md-ellipsis> C++中的三种类型转换 </span> </a> <nav class=md-nav aria-label=C++中的三种类型转换> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_2 class=md-nav__link> <span class=md-ellipsis> 内置类型与内置类型相互转换 </span> </a> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> <span class=md-ellipsis> 内置类型与自定义类型相互转换 </span> </a> <nav class=md-nav aria-label=内置类型与自定义类型相互转换> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_4 class=md-nav__link> <span class=md-ellipsis> 内置类型转换为自定义类型 </span> </a> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> <span class=md-ellipsis> 自定义类型转换为内置类型 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_6 class=md-nav__link> <span class=md-ellipsis> 自定义类型与自定义类型相互转换 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#c_2 class=md-nav__link> <span class=md-ellipsis> C++中的四种类型转换模版 </span> </a> <nav class=md-nav aria-label=C++中的四种类型转换模版> <ul class=md-nav__list> <li class=md-nav__item> <a href=#static_cast class=md-nav__link> <span class=md-ellipsis> static_cast </span> </a> </li> <li class=md-nav__item> <a href=#reinterpret_cast class=md-nav__link> <span class=md-ellipsis> reinterpret_cast </span> </a> </li> <li class=md-nav__item> <a href=#const_cast class=md-nav__link> <span class=md-ellipsis> const_cast </span> </a> </li> <li class=md-nav__item> <a href=#dynamic_castdynamic_pointer_cast class=md-nav__link> <span class=md-ellipsis> dynamic_cast和dynamic_pointer_cast </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=c>C++中的类型转换<a class=headerlink href=#c title="Permanent link">&para;</a></h1> <div style="margin-top: -30px; font-size: 0.75em; opacity: 0.7;"> <p><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10h-2a8 8 0 0 1-8 8 8 8 0 0 1-8-8 8 8 0 0 1 8-8zm6.78 1a.7.7 0 0 0-.48.2l-1.22 1.21 2.5 2.5L20.8 5.7c.26-.26.26-.7 0-.95L19.25 3.2c-.13-.13-.3-.2-.47-.2m-2.41 2.12L9 12.5V15h2.5l7.37-7.38z"/></svg></span> 约 1981 个字 <span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M392.8 1.2c-17-4.9-34.7 5-39.6 22l-128 448c-4.9 17 5 34.7 22 39.6s34.7-5 39.6-22l128-448c4.9-17-5-34.7-22-39.6m80.6 120.1c-12.5 12.5-12.5 32.8 0 45.3l89.3 89.4-89.4 89.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l112-112c12.5-12.5 12.5-32.8 0-45.3l-112-112c-12.5-12.5-32.8-12.5-45.3 0zm-306.7 0c-12.5-12.5-32.8-12.5-45.3 0l-112 112c-12.5 12.5-12.5 32.8 0 45.3l112 112c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256l89.4-89.4c12.5-12.5 12.5-32.8 0-45.3"/></svg></span> 555 行代码 <span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 17H7V3h14m0-2H7a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2M3 5H1v16a2 2 0 0 0 2 2h16v-2H3m12.96-10.71-2.75 3.54-1.96-2.36L8.5 15h11z"/></svg></span> 1 张图片 <span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 20c4.42 0 8-3.58 8-8s-3.58-8-8-8-8 3.58-8 8 3.58 8 8 8m0-18c5.5 0 10 4.5 10 10s-4.5 10-10 10C6.47 22 2 17.5 2 12S6.5 2 12 2m.5 11H11V7h1.5v4.26l3.7-2.13.75 1.3z"/></svg></span> 预计阅读时间 14 分钟</p> </div> <h2 id=_1>引入<a class=headerlink href=#_1 title="Permanent link">&para;</a></h2> <p>C语言中的类型转换 ：</p> <p>在C语言中，如果赋值运算符左右两侧类型不同，或者形参与实参类型不匹配，或者返回值类型与接收返回值类型不一致时，就需要发生类型转化</p> <p>C语言中总共有两种形式的类型转换：</p> <ol> <li>隐式类型转换：编译器在编译阶段自动进行，能转就转，不能转就编译失败</li> <li>显式类型转换：需要用户自己处理，也称强制类型转换</li> </ol> <p>缺陷：</p> <p>转换的可视性比较差，所有的转换形式都是以一种相同形式书写，难以跟踪错误的转换</p> <p>例如下面的代码：</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-1><span class=kt>void</span><span class=w> </span><span class=nf>Test</span><span class=w> </span><span class=p>()</span>
</span><span id=__span-0-2><span class=p>{</span>
</span><span id=__span-0-3><span class=w>     </span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span>
</span><span id=__span-0-4><span class=w>     </span><span class=c1>// 隐式类型转换</span>
</span><span id=__span-0-5><span class=w>     </span><span class=kt>double</span><span class=w> </span><span class=n>d</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>i</span><span class=p>;</span>
</span><span id=__span-0-6><span class=w>     </span><span class=n>printf</span><span class=p>(</span><span class=s>&quot;%d, %.2f</span><span class=se>\n</span><span class=s>&quot;</span><span class=w> </span><span class=p>,</span><span class=w> </span><span class=n>i</span><span class=p>,</span><span class=w> </span><span class=n>d</span><span class=p>);</span>
</span><span id=__span-0-7><span class=w>     </span><span class=kt>int</span><span class=o>*</span><span class=w> </span><span class=n>p</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=n>i</span><span class=p>;</span>
</span><span id=__span-0-8><span class=w>     </span><span class=c1>// 显示的强制类型转换</span>
</span><span id=__span-0-9><span class=w>     </span><span class=kt>int</span><span class=w> </span><span class=n>address</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=p>)</span><span class=w> </span><span class=n>p</span><span class=p>;</span>
</span><span id=__span-0-10><span class=w>     </span><span class=n>printf</span><span class=p>(</span><span class=s>&quot;%x, %d</span><span class=se>\n</span><span class=s>&quot;</span><span class=w> </span><span class=p>,</span><span class=w> </span><span class=n>p</span><span class=p>,</span><span class=w> </span><span class=n>address</span><span class=p>);</span>
</span><span id=__span-0-11><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <h2 id=c_1>C++中的三种类型转换<a class=headerlink href=#c_1 title="Permanent link">&para;</a></h2> <p>C++中的类型转换可以分为三种：</p> <ol> <li>内置类型与内置类型相互转换</li> <li>内置类型与自定义类型相互转换</li> <li>自定义类型和自定义类型相互转换</li> </ol> <h3 id=_2>内置类型与内置类型相互转换<a class=headerlink href=#_2 title="Permanent link">&para;</a></h3> <p>内置类型一般情况下支持隐式类型转换，例如<code>double</code>类型转换为<code>int</code>类型等</p> <p>但是如果是指针类型转换成普通的数值类型，需要进行强制类型转换，例如<code>int*</code>类型转换为<code>int</code>类型，之所以可以转换是因为指针类型本身是地址，地址值都是数，所以指针类型与数值类型存在一定的关系</p> <h3 id=_3>内置类型与自定义类型相互转换<a class=headerlink href=#_3 title="Permanent link">&para;</a></h3> <h4 id=_4>内置类型转换为自定义类型<a class=headerlink href=#_4 title="Permanent link">&para;</a></h4> <p>内置类型如果想转换为自定义类型需要通过自定义类型的构造函数并且对应的构造函数没有被<code>explicit</code>关键字修饰，这一过程也属于隐式类型转换，例如下面的代码：</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-1-1><span class=c1>// 内置类型与自定义类型相互转换</span>
</span><span id=__span-1-2><span class=k>class</span><span class=w> </span><span class=nc>A</span>
</span><span id=__span-1-3><span class=p>{</span>
</span><span id=__span-1-4><span class=k>public</span><span class=o>:</span>
</span><span id=__span-1-5><span class=w>    </span><span class=n>A</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>a</span><span class=p>)</span>
</span><span id=__span-1-6><span class=w>        </span><span class=o>:</span><span class=n>_a</span><span class=p>(</span><span class=n>a</span><span class=p>)</span>
</span><span id=__span-1-7><span class=w>    </span><span class=p>{}</span>
</span><span id=__span-1-8>
</span><span id=__span-1-9>
</span><span id=__span-1-10><span class=k>private</span><span class=o>:</span>
</span><span id=__span-1-11><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>_a</span><span class=p>;</span>
</span><span id=__span-1-12><span class=p>};</span>
</span><span id=__span-1-13>
</span><span id=__span-1-14><span class=kt>int</span><span class=w> </span><span class=nf>main</span><span class=p>()</span>
</span><span id=__span-1-15><span class=p>{</span>
</span><span id=__span-1-16><span class=w>    </span><span class=c1>// 隐式类型转换--通过构造函数实现内置类型转自定义类型</span>
</span><span id=__span-1-17><span class=w>    </span><span class=n>A</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>10</span><span class=p>;</span>
</span><span id=__span-1-18>
</span><span id=__span-1-19><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-1-20><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <p>如果想要实现类的构造函数被声明为<code>explicit</code>时，只代表不可以隐式类型转换，不代表不可以使用强制类型转换将内置类型转换为自定义类型，例如下面的代码：</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-2-1><span class=c1>// 内置类型与自定义类型相互转换</span>
</span><span id=__span-2-2><span class=k>class</span><span class=w> </span><span class=nc>A</span>
</span><span id=__span-2-3><span class=p>{</span>
</span><span id=__span-2-4><span class=k>public</span><span class=o>:</span>
</span><span id=__span-2-5><span class=w>    </span><span class=k>explicit</span><span class=w> </span><span class=n>A</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>a</span><span class=p>)</span>
</span><span id=__span-2-6><span class=w>        </span><span class=o>:</span><span class=n>_a</span><span class=p>(</span><span class=n>a</span><span class=p>)</span>
</span><span id=__span-2-7><span class=w>    </span><span class=p>{}</span>
</span><span id=__span-2-8>
</span><span id=__span-2-9>
</span><span id=__span-2-10><span class=k>private</span><span class=o>:</span>
</span><span id=__span-2-11><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>_a</span><span class=p>;</span>
</span><span id=__span-2-12><span class=p>};</span>
</span><span id=__span-2-13>
</span><span id=__span-2-14><span class=kt>int</span><span class=w> </span><span class=nf>main</span><span class=p>()</span>
</span><span id=__span-2-15><span class=p>{</span>
</span><span id=__span-2-16><span class=w>    </span><span class=c1>// 修饰为explicit后，禁止隐式类型转换，但是可以显示类型转换</span>
</span><span id=__span-2-17><span class=w>    </span><span class=n>A</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>A</span><span class=p>)</span><span class=mi>10</span><span class=p>;</span>
</span><span id=__span-2-18>
</span><span id=__span-2-19><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-2-20><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <h4 id=_5>自定义类型转换为内置类型<a class=headerlink href=#_5 title="Permanent link">&para;</a></h4> <p>自定义类型如果想要转换为内置类型默认情况下是不可以的，但是可以通过重载强制类型转换实现</p> <p>重载强制类型转换不可以重载<code>()</code>，尽管类型转换的操作符是<code>()</code>，因为<code>()</code>被仿函数占用了，所以需要重载强制转换后的类型，并且重载类型的函数没有返回值类型，例如下面的代码：</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-3-1><span class=c1>// 内置类型与自定义类型相互转换</span>
</span><span id=__span-3-2><span class=k>class</span><span class=w> </span><span class=nc>A</span>
</span><span id=__span-3-3><span class=p>{</span>
</span><span id=__span-3-4><span class=k>public</span><span class=o>:</span>
</span><span id=__span-3-5><span class=w>    </span><span class=c1>// 重载强制类型转换</span>
</span><span id=__span-3-6><span class=w>    </span><span class=k>operator</span><span class=w> </span><span class=kt>int</span><span class=p>()</span>
</span><span id=__span-3-7><span class=w>    </span><span class=p>{</span>
</span><span id=__span-3-8><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>_a</span><span class=p>;</span>
</span><span id=__span-3-9><span class=w>    </span><span class=p>}</span>
</span><span id=__span-3-10>
</span><span id=__span-3-11><span class=k>private</span><span class=o>:</span>
</span><span id=__span-3-12><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>_a</span><span class=p>;</span>
</span><span id=__span-3-13><span class=p>};</span>
</span><span id=__span-3-14>
</span><span id=__span-3-15><span class=kt>int</span><span class=w> </span><span class=nf>main</span><span class=p>()</span>
</span><span id=__span-3-16><span class=p>{</span>
</span><span id=__span-3-17><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=p>)</span><span class=n>A</span><span class=p>();</span>
</span><span id=__span-3-18>
</span><span id=__span-3-19><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-3-20><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <p>上面的代码也可以不需要写成显示类型转换，因为当重载了强制类型转换后，当需要转换时，会自动调用<code>operator int()</code>，所以也可以写成<code>int a = A();</code></p> <p>同样，如果将<code>operator int()</code>声明为<code>explicit</code>，就必须显式类型转换</p> <p>实际上，将自定义类型转换为内置类型的行为在标准库中也存在一定的应用，例如istream和ostream中重载了<code>operator bool()</code>、shared_ptr中重载了<code>operator bool()</code>等</p> <h3 id=_6>自定义类型与自定义类型相互转换<a class=headerlink href=#_6 title="Permanent link">&para;</a></h3> <p>自定义类型转换为自定义类型默认情况下也是不支持的，最典型的例子就是<code>const_iterator</code>和<code>iterator</code>，首先看模拟实现中的list</p> <details class=quote> <summary>模拟实现list</summary> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>  1</span>
<span class=normal>  2</span>
<span class=normal>  3</span>
<span class=normal>  4</span>
<span class=normal>  5</span>
<span class=normal>  6</span>
<span class=normal>  7</span>
<span class=normal>  8</span>
<span class=normal>  9</span>
<span class=normal> 10</span>
<span class=normal> 11</span>
<span class=normal> 12</span>
<span class=normal> 13</span>
<span class=normal> 14</span>
<span class=normal> 15</span>
<span class=normal> 16</span>
<span class=normal> 17</span>
<span class=normal> 18</span>
<span class=normal> 19</span>
<span class=normal> 20</span>
<span class=normal> 21</span>
<span class=normal> 22</span>
<span class=normal> 23</span>
<span class=normal> 24</span>
<span class=normal> 25</span>
<span class=normal> 26</span>
<span class=normal> 27</span>
<span class=normal> 28</span>
<span class=normal> 29</span>
<span class=normal> 30</span>
<span class=normal> 31</span>
<span class=normal> 32</span>
<span class=normal> 33</span>
<span class=normal> 34</span>
<span class=normal> 35</span>
<span class=normal> 36</span>
<span class=normal> 37</span>
<span class=normal> 38</span>
<span class=normal> 39</span>
<span class=normal> 40</span>
<span class=normal> 41</span>
<span class=normal> 42</span>
<span class=normal> 43</span>
<span class=normal> 44</span>
<span class=normal> 45</span>
<span class=normal> 46</span>
<span class=normal> 47</span>
<span class=normal> 48</span>
<span class=normal> 49</span>
<span class=normal> 50</span>
<span class=normal> 51</span>
<span class=normal> 52</span>
<span class=normal> 53</span>
<span class=normal> 54</span>
<span class=normal> 55</span>
<span class=normal> 56</span>
<span class=normal> 57</span>
<span class=normal> 58</span>
<span class=normal> 59</span>
<span class=normal> 60</span>
<span class=normal> 61</span>
<span class=normal> 62</span>
<span class=normal> 63</span>
<span class=normal> 64</span>
<span class=normal> 65</span>
<span class=normal> 66</span>
<span class=normal> 67</span>
<span class=normal> 68</span>
<span class=normal> 69</span>
<span class=normal> 70</span>
<span class=normal> 71</span>
<span class=normal> 72</span>
<span class=normal> 73</span>
<span class=normal> 74</span>
<span class=normal> 75</span>
<span class=normal> 76</span>
<span class=normal> 77</span>
<span class=normal> 78</span>
<span class=normal> 79</span>
<span class=normal> 80</span>
<span class=normal> 81</span>
<span class=normal> 82</span>
<span class=normal> 83</span>
<span class=normal> 84</span>
<span class=normal> 85</span>
<span class=normal> 86</span>
<span class=normal> 87</span>
<span class=normal> 88</span>
<span class=normal> 89</span>
<span class=normal> 90</span>
<span class=normal> 91</span>
<span class=normal> 92</span>
<span class=normal> 93</span>
<span class=normal> 94</span>
<span class=normal> 95</span>
<span class=normal> 96</span>
<span class=normal> 97</span>
<span class=normal> 98</span>
<span class=normal> 99</span>
<span class=normal>100</span>
<span class=normal>101</span>
<span class=normal>102</span>
<span class=normal>103</span>
<span class=normal>104</span>
<span class=normal>105</span>
<span class=normal>106</span>
<span class=normal>107</span>
<span class=normal>108</span>
<span class=normal>109</span>
<span class=normal>110</span>
<span class=normal>111</span>
<span class=normal>112</span>
<span class=normal>113</span>
<span class=normal>114</span>
<span class=normal>115</span>
<span class=normal>116</span>
<span class=normal>117</span>
<span class=normal>118</span>
<span class=normal>119</span>
<span class=normal>120</span>
<span class=normal>121</span>
<span class=normal>122</span>
<span class=normal>123</span>
<span class=normal>124</span>
<span class=normal>125</span>
<span class=normal>126</span>
<span class=normal>127</span>
<span class=normal>128</span>
<span class=normal>129</span>
<span class=normal>130</span>
<span class=normal>131</span>
<span class=normal>132</span>
<span class=normal>133</span>
<span class=normal>134</span>
<span class=normal>135</span>
<span class=normal>136</span>
<span class=normal>137</span>
<span class=normal>138</span>
<span class=normal>139</span>
<span class=normal>140</span>
<span class=normal>141</span>
<span class=normal>142</span>
<span class=normal>143</span>
<span class=normal>144</span>
<span class=normal>145</span>
<span class=normal>146</span>
<span class=normal>147</span>
<span class=normal>148</span>
<span class=normal>149</span>
<span class=normal>150</span>
<span class=normal>151</span>
<span class=normal>152</span>
<span class=normal>153</span>
<span class=normal>154</span>
<span class=normal>155</span>
<span class=normal>156</span>
<span class=normal>157</span>
<span class=normal>158</span>
<span class=normal>159</span>
<span class=normal>160</span>
<span class=normal>161</span>
<span class=normal>162</span>
<span class=normal>163</span>
<span class=normal>164</span>
<span class=normal>165</span>
<span class=normal>166</span>
<span class=normal>167</span>
<span class=normal>168</span>
<span class=normal>169</span>
<span class=normal>170</span>
<span class=normal>171</span>
<span class=normal>172</span>
<span class=normal>173</span>
<span class=normal>174</span>
<span class=normal>175</span>
<span class=normal>176</span>
<span class=normal>177</span>
<span class=normal>178</span>
<span class=normal>179</span>
<span class=normal>180</span>
<span class=normal>181</span>
<span class=normal>182</span>
<span class=normal>183</span>
<span class=normal>184</span>
<span class=normal>185</span>
<span class=normal>186</span>
<span class=normal>187</span>
<span class=normal>188</span>
<span class=normal>189</span>
<span class=normal>190</span>
<span class=normal>191</span>
<span class=normal>192</span>
<span class=normal>193</span>
<span class=normal>194</span>
<span class=normal>195</span>
<span class=normal>196</span>
<span class=normal>197</span>
<span class=normal>198</span>
<span class=normal>199</span>
<span class=normal>200</span>
<span class=normal>201</span>
<span class=normal>202</span>
<span class=normal>203</span>
<span class=normal>204</span>
<span class=normal>205</span>
<span class=normal>206</span>
<span class=normal>207</span>
<span class=normal>208</span>
<span class=normal>209</span>
<span class=normal>210</span>
<span class=normal>211</span>
<span class=normal>212</span>
<span class=normal>213</span>
<span class=normal>214</span>
<span class=normal>215</span>
<span class=normal>216</span>
<span class=normal>217</span>
<span class=normal>218</span>
<span class=normal>219</span>
<span class=normal>220</span>
<span class=normal>221</span>
<span class=normal>222</span>
<span class=normal>223</span>
<span class=normal>224</span>
<span class=normal>225</span>
<span class=normal>226</span>
<span class=normal>227</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-4-1><span class=cp>#pragma once</span>
</span><span id=__span-4-2>
</span><span id=__span-4-3><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;iostream&gt;</span>
</span><span id=__span-4-4><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;assert.h&gt;</span>
</span><span id=__span-4-5><span class=k>using</span><span class=w> </span><span class=k>namespace</span><span class=w> </span><span class=nn>std</span><span class=p>;</span>
</span><span id=__span-4-6>
</span><span id=__span-4-7><span class=k>namespace</span><span class=w> </span><span class=nn>simulate_list</span>
</span><span id=__span-4-8><span class=p>{</span>
</span><span id=__span-4-9><span class=w>    </span><span class=k>template</span><span class=o>&lt;</span><span class=k>class</span><span class=w> </span><span class=nc>T</span><span class=o>&gt;</span>
</span><span id=__span-4-10><span class=w>    </span><span class=k>struct</span><span class=w> </span><span class=nc>ListNode</span>
</span><span id=__span-4-11><span class=w>    </span><span class=p>{</span>
</span><span id=__span-4-12><span class=w>        </span><span class=n>ListNode</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;*</span><span class=w> </span><span class=n>_next</span><span class=p>;</span>
</span><span id=__span-4-13><span class=w>        </span><span class=n>ListNode</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;*</span><span class=w> </span><span class=n>_prev</span><span class=p>;</span>
</span><span id=__span-4-14>
</span><span id=__span-4-15><span class=w>        </span><span class=n>T</span><span class=w> </span><span class=n>_data</span><span class=p>;</span>
</span><span id=__span-4-16>
</span><span id=__span-4-17><span class=w>        </span><span class=n>ListNode</span><span class=p>(</span><span class=k>const</span><span class=w> </span><span class=n>T</span><span class=o>&amp;</span><span class=w> </span><span class=n>data</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>T</span><span class=p>())</span>
</span><span id=__span-4-18><span class=w>            </span><span class=o>:</span><span class=n>_next</span><span class=p>(</span><span class=k>nullptr</span><span class=p>)</span>
</span><span id=__span-4-19><span class=w>            </span><span class=p>,</span><span class=w> </span><span class=n>_prev</span><span class=p>(</span><span class=k>nullptr</span><span class=p>)</span>
</span><span id=__span-4-20><span class=w>            </span><span class=p>,</span><span class=w> </span><span class=n>_data</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
</span><span id=__span-4-21><span class=w>        </span><span class=p>{}</span>
</span><span id=__span-4-22><span class=w>    </span><span class=p>};</span>
</span><span id=__span-4-23>
</span><span id=__span-4-24><span class=w>    </span><span class=k>template</span><span class=o>&lt;</span><span class=k>class</span><span class=w> </span><span class=nc>T</span><span class=p>,</span><span class=w> </span><span class=k>class</span><span class=w> </span><span class=nc>Ref</span><span class=p>,</span><span class=w> </span><span class=k>class</span><span class=w> </span><span class=nc>Ptr</span><span class=o>&gt;</span>
</span><span id=__span-4-25><span class=w>    </span><span class=k>struct</span><span class=w> </span><span class=nc>ListIterator</span>
</span><span id=__span-4-26><span class=w>    </span><span class=p>{</span>
</span><span id=__span-4-27><span class=w>        </span><span class=k>typedef</span><span class=w> </span><span class=n>ListNode</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=w> </span><span class=n>Node</span><span class=p>;</span>
</span><span id=__span-4-28><span class=w>        </span><span class=k>typedef</span><span class=w> </span><span class=n>ListIterator</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span><span class=w> </span><span class=n>Ref</span><span class=p>,</span><span class=w> </span><span class=n>Ptr</span><span class=o>&gt;</span><span class=w> </span><span class=n>Self</span><span class=p>;</span>
</span><span id=__span-4-29><span class=w>        </span><span class=n>Node</span><span class=o>*</span><span class=w> </span><span class=n>_node</span><span class=p>;</span>
</span><span id=__span-4-30>
</span><span id=__span-4-31><span class=w>        </span><span class=n>ListIterator</span><span class=p>(</span><span class=n>Node</span><span class=o>*</span><span class=w> </span><span class=n>node</span><span class=p>)</span>
</span><span id=__span-4-32><span class=w>            </span><span class=o>:</span><span class=n>_node</span><span class=p>(</span><span class=n>node</span><span class=p>)</span>
</span><span id=__span-4-33><span class=w>        </span><span class=p>{}</span>
</span><span id=__span-4-34>
</span><span id=__span-4-35><span class=w>        </span><span class=c1>// ++it;</span>
</span><span id=__span-4-36><span class=w>        </span><span class=n>Self</span><span class=o>&amp;</span><span class=w> </span><span class=k>operator</span><span class=o>++</span><span class=p>()</span>
</span><span id=__span-4-37><span class=w>        </span><span class=p>{</span>
</span><span id=__span-4-38><span class=w>            </span><span class=n>_node</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>_node</span><span class=o>-&gt;</span><span class=n>_next</span><span class=p>;</span>
</span><span id=__span-4-39><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=o>*</span><span class=k>this</span><span class=p>;</span>
</span><span id=__span-4-40><span class=w>        </span><span class=p>}</span>
</span><span id=__span-4-41>
</span><span id=__span-4-42><span class=w>        </span><span class=n>Self</span><span class=o>&amp;</span><span class=w> </span><span class=k>operator</span><span class=o>--</span><span class=p>()</span>
</span><span id=__span-4-43><span class=w>        </span><span class=p>{</span>
</span><span id=__span-4-44><span class=w>            </span><span class=n>_node</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>_node</span><span class=o>-&gt;</span><span class=n>_prev</span><span class=p>;</span>
</span><span id=__span-4-45><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=o>*</span><span class=k>this</span><span class=p>;</span>
</span><span id=__span-4-46><span class=w>        </span><span class=p>}</span>
</span><span id=__span-4-47>
</span><span id=__span-4-48><span class=w>        </span><span class=n>Self</span><span class=w> </span><span class=k>operator</span><span class=o>++</span><span class=p>(</span><span class=kt>int</span><span class=p>)</span>
</span><span id=__span-4-49><span class=w>        </span><span class=p>{</span>
</span><span id=__span-4-50><span class=w>            </span><span class=n>Self</span><span class=w> </span><span class=nf>tmp</span><span class=p>(</span><span class=o>*</span><span class=k>this</span><span class=p>);</span>
</span><span id=__span-4-51><span class=w>            </span><span class=n>_node</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>_node</span><span class=o>-&gt;</span><span class=n>_next</span><span class=p>;</span>
</span><span id=__span-4-52>
</span><span id=__span-4-53><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>tmp</span><span class=p>;</span>
</span><span id=__span-4-54><span class=w>        </span><span class=p>}</span>
</span><span id=__span-4-55>
</span><span id=__span-4-56><span class=w>        </span><span class=n>Self</span><span class=o>&amp;</span><span class=w> </span><span class=k>operator</span><span class=o>--</span><span class=p>(</span><span class=kt>int</span><span class=p>)</span>
</span><span id=__span-4-57><span class=w>        </span><span class=p>{</span>
</span><span id=__span-4-58><span class=w>            </span><span class=n>Self</span><span class=w> </span><span class=nf>tmp</span><span class=p>(</span><span class=o>*</span><span class=k>this</span><span class=p>);</span>
</span><span id=__span-4-59><span class=w>            </span><span class=n>_node</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>_node</span><span class=o>-&gt;</span><span class=n>_prev</span><span class=p>;</span>
</span><span id=__span-4-60>
</span><span id=__span-4-61><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>tmp</span><span class=p>;</span>
</span><span id=__span-4-62><span class=w>        </span><span class=p>}</span>
</span><span id=__span-4-63>
</span><span id=__span-4-64><span class=w>        </span><span class=n>Ref</span><span class=w> </span><span class=k>operator</span><span class=o>*</span><span class=p>()</span>
</span><span id=__span-4-65><span class=w>        </span><span class=p>{</span>
</span><span id=__span-4-66><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>_node</span><span class=o>-&gt;</span><span class=n>_data</span><span class=p>;</span>
</span><span id=__span-4-67><span class=w>        </span><span class=p>}</span>
</span><span id=__span-4-68>
</span><span id=__span-4-69><span class=w>        </span><span class=n>Ptr</span><span class=w> </span><span class=k>operator</span><span class=o>-&gt;</span><span class=p>()</span>
</span><span id=__span-4-70><span class=w>        </span><span class=p>{</span>
</span><span id=__span-4-71><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=o>&amp;</span><span class=n>_node</span><span class=o>-&gt;</span><span class=n>_data</span><span class=p>;</span>
</span><span id=__span-4-72><span class=w>        </span><span class=p>}</span>
</span><span id=__span-4-73>
</span><span id=__span-4-74><span class=w>        </span><span class=kt>bool</span><span class=w> </span><span class=k>operator</span><span class=o>!=</span><span class=p>(</span><span class=k>const</span><span class=w> </span><span class=n>Self</span><span class=o>&amp;</span><span class=w> </span><span class=n>it</span><span class=p>)</span>
</span><span id=__span-4-75><span class=w>        </span><span class=p>{</span>
</span><span id=__span-4-76><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>_node</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>it</span><span class=p>.</span><span class=n>_node</span><span class=p>;</span>
</span><span id=__span-4-77><span class=w>        </span><span class=p>}</span>
</span><span id=__span-4-78>
</span><span id=__span-4-79><span class=w>        </span><span class=kt>bool</span><span class=w> </span><span class=k>operator</span><span class=o>==</span><span class=p>(</span><span class=k>const</span><span class=w> </span><span class=n>Self</span><span class=o>&amp;</span><span class=w> </span><span class=n>it</span><span class=p>)</span>
</span><span id=__span-4-80><span class=w>        </span><span class=p>{</span>
</span><span id=__span-4-81><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>_node</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>it</span><span class=p>.</span><span class=n>_node</span><span class=p>;</span>
</span><span id=__span-4-82><span class=w>        </span><span class=p>}</span>
</span><span id=__span-4-83><span class=w>    </span><span class=p>};</span>
</span><span id=__span-4-84>
</span><span id=__span-4-85><span class=w>    </span><span class=k>template</span><span class=o>&lt;</span><span class=k>class</span><span class=w> </span><span class=nc>T</span><span class=o>&gt;</span>
</span><span id=__span-4-86><span class=w>    </span><span class=k>class</span><span class=w> </span><span class=nc>list</span>
</span><span id=__span-4-87><span class=w>    </span><span class=p>{</span>
</span><span id=__span-4-88><span class=w>        </span><span class=k>typedef</span><span class=w> </span><span class=n>ListNode</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=w> </span><span class=n>Node</span><span class=p>;</span>
</span><span id=__span-4-89><span class=w>    </span><span class=k>public</span><span class=o>:</span>
</span><span id=__span-4-90>
</span><span id=__span-4-91><span class=w>        </span><span class=k>typedef</span><span class=w> </span><span class=n>ListIterator</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span><span class=w> </span><span class=n>T</span><span class=o>&amp;</span><span class=p>,</span><span class=w> </span><span class=n>T</span><span class=o>*&gt;</span><span class=w> </span><span class=n>iterator</span><span class=p>;</span>
</span><span id=__span-4-92><span class=w>        </span><span class=k>typedef</span><span class=w> </span><span class=n>ListIterator</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=n>T</span><span class=o>&amp;</span><span class=p>,</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=n>T</span><span class=o>*&gt;</span><span class=w> </span><span class=n>const_iterator</span><span class=p>;</span>
</span><span id=__span-4-93>
</span><span id=__span-4-94><span class=w>        </span><span class=n>iterator</span><span class=w> </span><span class=nf>begin</span><span class=p>()</span>
</span><span id=__span-4-95><span class=w>        </span><span class=p>{</span>
</span><span id=__span-4-96><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>iterator</span><span class=p>(</span><span class=n>_head</span><span class=o>-&gt;</span><span class=n>_next</span><span class=p>);</span>
</span><span id=__span-4-97><span class=w>        </span><span class=p>}</span>
</span><span id=__span-4-98>
</span><span id=__span-4-99><span class=w>        </span><span class=n>const_iterator</span><span class=w> </span><span class=nf>begin</span><span class=p>()</span><span class=w> </span><span class=k>const</span>
</span><span id=__span-4-100><span class=w>        </span><span class=p>{</span>
</span><span id=__span-4-101><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>const_iterator</span><span class=p>(</span><span class=n>_head</span><span class=o>-&gt;</span><span class=n>_next</span><span class=p>);</span>
</span><span id=__span-4-102><span class=w>        </span><span class=p>}</span>
</span><span id=__span-4-103>
</span><span id=__span-4-104><span class=w>        </span><span class=n>iterator</span><span class=w> </span><span class=nf>end</span><span class=p>()</span>
</span><span id=__span-4-105><span class=w>        </span><span class=p>{</span>
</span><span id=__span-4-106><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>iterator</span><span class=p>(</span><span class=n>_head</span><span class=p>);</span>
</span><span id=__span-4-107><span class=w>        </span><span class=p>}</span>
</span><span id=__span-4-108>
</span><span id=__span-4-109><span class=w>        </span><span class=n>const_iterator</span><span class=w> </span><span class=nf>end</span><span class=p>()</span><span class=w> </span><span class=k>const</span>
</span><span id=__span-4-110><span class=w>        </span><span class=p>{</span>
</span><span id=__span-4-111><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>const_iterator</span><span class=p>(</span><span class=n>_head</span><span class=p>);</span>
</span><span id=__span-4-112><span class=w>        </span><span class=p>}</span>
</span><span id=__span-4-113>
</span><span id=__span-4-114><span class=w>        </span><span class=kt>void</span><span class=w> </span><span class=nf>empty_init</span><span class=p>()</span>
</span><span id=__span-4-115><span class=w>        </span><span class=p>{</span>
</span><span id=__span-4-116><span class=w>            </span><span class=n>_head</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Node</span><span class=p>();</span>
</span><span id=__span-4-117><span class=w>            </span><span class=n>_head</span><span class=o>-&gt;</span><span class=n>_next</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>_head</span><span class=p>;</span>
</span><span id=__span-4-118><span class=w>            </span><span class=n>_head</span><span class=o>-&gt;</span><span class=n>_prev</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>_head</span><span class=p>;</span>
</span><span id=__span-4-119><span class=w>        </span><span class=p>}</span>
</span><span id=__span-4-120>
</span><span id=__span-4-121><span class=w>        </span><span class=n>list</span><span class=p>()</span>
</span><span id=__span-4-122><span class=w>        </span><span class=p>{</span>
</span><span id=__span-4-123><span class=w>            </span><span class=n>empty_init</span><span class=p>();</span>
</span><span id=__span-4-124><span class=w>        </span><span class=p>}</span>
</span><span id=__span-4-125>
</span><span id=__span-4-126><span class=w>        </span><span class=n>list</span><span class=p>(</span><span class=n>initializer_list</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=w> </span><span class=n>il</span><span class=p>)</span>
</span><span id=__span-4-127><span class=w>        </span><span class=p>{</span>
</span><span id=__span-4-128><span class=w>            </span><span class=n>empty_init</span><span class=p>();</span>
</span><span id=__span-4-129>
</span><span id=__span-4-130><span class=w>            </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=k>const</span><span class=w> </span><span class=k>auto</span><span class=o>&amp;</span><span class=w> </span><span class=n>e</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>il</span><span class=p>)</span>
</span><span id=__span-4-131><span class=w>            </span><span class=p>{</span>
</span><span id=__span-4-132><span class=w>                </span><span class=n>push_back</span><span class=p>(</span><span class=n>e</span><span class=p>);</span>
</span><span id=__span-4-133><span class=w>            </span><span class=p>}</span>
</span><span id=__span-4-134><span class=w>        </span><span class=p>}</span>
</span><span id=__span-4-135>
</span><span id=__span-4-136><span class=w>        </span><span class=c1>// lt2(lt1)</span>
</span><span id=__span-4-137><span class=w>        </span><span class=n>list</span><span class=p>(</span><span class=k>const</span><span class=w> </span><span class=n>list</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;&amp;</span><span class=w> </span><span class=n>lt</span><span class=p>)</span>
</span><span id=__span-4-138><span class=w>        </span><span class=p>{</span>
</span><span id=__span-4-139><span class=w>            </span><span class=n>empty_init</span><span class=p>();</span>
</span><span id=__span-4-140>
</span><span id=__span-4-141><span class=w>            </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=k>const</span><span class=w> </span><span class=k>auto</span><span class=o>&amp;</span><span class=w> </span><span class=n>e</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>lt</span><span class=p>)</span>
</span><span id=__span-4-142><span class=w>            </span><span class=p>{</span>
</span><span id=__span-4-143><span class=w>                </span><span class=n>push_back</span><span class=p>(</span><span class=n>e</span><span class=p>);</span>
</span><span id=__span-4-144><span class=w>            </span><span class=p>}</span>
</span><span id=__span-4-145><span class=w>        </span><span class=p>}</span>
</span><span id=__span-4-146>
</span><span id=__span-4-147><span class=w>        </span><span class=c1>// lt1 = lt3</span>
</span><span id=__span-4-148><span class=w>        </span><span class=n>list</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;&amp;</span><span class=w> </span><span class=k>operator</span><span class=o>=</span><span class=p>(</span><span class=n>list</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=w> </span><span class=n>lt</span><span class=p>)</span>
</span><span id=__span-4-149><span class=w>        </span><span class=p>{</span>
</span><span id=__span-4-150><span class=w>            </span><span class=n>swap</span><span class=p>(</span><span class=n>_head</span><span class=p>,</span><span class=w> </span><span class=n>lt</span><span class=p>.</span><span class=n>_head</span><span class=p>);</span>
</span><span id=__span-4-151>
</span><span id=__span-4-152><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=o>*</span><span class=k>this</span><span class=p>;</span>
</span><span id=__span-4-153><span class=w>        </span><span class=p>}</span>
</span><span id=__span-4-154>
</span><span id=__span-4-155><span class=w>        </span><span class=o>~</span><span class=n>list</span><span class=p>()</span>
</span><span id=__span-4-156><span class=w>        </span><span class=p>{</span>
</span><span id=__span-4-157><span class=w>            </span><span class=n>clear</span><span class=p>();</span>
</span><span id=__span-4-158><span class=w>            </span><span class=k>delete</span><span class=w> </span><span class=n>_head</span><span class=p>;</span>
</span><span id=__span-4-159><span class=w>            </span><span class=n>_head</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>nullptr</span><span class=p>;</span>
</span><span id=__span-4-160><span class=w>        </span><span class=p>}</span>
</span><span id=__span-4-161>
</span><span id=__span-4-162><span class=w>        </span><span class=kt>void</span><span class=w> </span><span class=n>clear</span><span class=p>()</span>
</span><span id=__span-4-163><span class=w>        </span><span class=p>{</span>
</span><span id=__span-4-164><span class=w>            </span><span class=k>auto</span><span class=w> </span><span class=n>it</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>begin</span><span class=p>();</span>
</span><span id=__span-4-165><span class=w>            </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>it</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>end</span><span class=p>())</span>
</span><span id=__span-4-166><span class=w>            </span><span class=p>{</span>
</span><span id=__span-4-167><span class=w>                </span><span class=n>it</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>erase</span><span class=p>(</span><span class=n>it</span><span class=p>);</span>
</span><span id=__span-4-168><span class=w>            </span><span class=p>}</span>
</span><span id=__span-4-169><span class=w>        </span><span class=p>}</span>
</span><span id=__span-4-170>
</span><span id=__span-4-171><span class=w>        </span><span class=kt>void</span><span class=w> </span><span class=n>push_back</span><span class=p>(</span><span class=k>const</span><span class=w> </span><span class=n>T</span><span class=o>&amp;</span><span class=w> </span><span class=n>x</span><span class=p>)</span>
</span><span id=__span-4-172><span class=w>        </span><span class=p>{</span>
</span><span id=__span-4-173><span class=w>            </span><span class=n>insert</span><span class=p>(</span><span class=n>end</span><span class=p>(),</span><span class=w> </span><span class=n>x</span><span class=p>);</span>
</span><span id=__span-4-174><span class=w>        </span><span class=p>}</span>
</span><span id=__span-4-175>
</span><span id=__span-4-176><span class=w>        </span><span class=kt>void</span><span class=w> </span><span class=n>pop_back</span><span class=p>()</span>
</span><span id=__span-4-177><span class=w>        </span><span class=p>{</span>
</span><span id=__span-4-178><span class=w>            </span><span class=n>erase</span><span class=p>(</span><span class=o>--</span><span class=n>end</span><span class=p>());</span>
</span><span id=__span-4-179><span class=w>        </span><span class=p>}</span>
</span><span id=__span-4-180>
</span><span id=__span-4-181><span class=w>        </span><span class=kt>void</span><span class=w> </span><span class=n>push_front</span><span class=p>(</span><span class=k>const</span><span class=w> </span><span class=n>T</span><span class=o>&amp;</span><span class=w> </span><span class=n>x</span><span class=p>)</span>
</span><span id=__span-4-182><span class=w>        </span><span class=p>{</span>
</span><span id=__span-4-183><span class=w>            </span><span class=n>insert</span><span class=p>(</span><span class=n>begin</span><span class=p>(),</span><span class=w> </span><span class=n>x</span><span class=p>);</span>
</span><span id=__span-4-184><span class=w>        </span><span class=p>}</span>
</span><span id=__span-4-185>
</span><span id=__span-4-186><span class=w>        </span><span class=kt>void</span><span class=w> </span><span class=n>pop_front</span><span class=p>()</span>
</span><span id=__span-4-187><span class=w>        </span><span class=p>{</span>
</span><span id=__span-4-188><span class=w>            </span><span class=n>erase</span><span class=p>(</span><span class=n>begin</span><span class=p>());</span>
</span><span id=__span-4-189><span class=w>        </span><span class=p>}</span>
</span><span id=__span-4-190>
</span><span id=__span-4-191><span class=w>        </span><span class=c1>// 没有iterator失效</span>
</span><span id=__span-4-192><span class=w>        </span><span class=n>iterator</span><span class=w> </span><span class=n>insert</span><span class=p>(</span><span class=n>iterator</span><span class=w> </span><span class=n>pos</span><span class=p>,</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=n>T</span><span class=o>&amp;</span><span class=w> </span><span class=n>x</span><span class=p>)</span>
</span><span id=__span-4-193><span class=w>        </span><span class=p>{</span>
</span><span id=__span-4-194><span class=w>            </span><span class=n>Node</span><span class=o>*</span><span class=w> </span><span class=n>cur</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>pos</span><span class=p>.</span><span class=n>_node</span><span class=p>;</span>
</span><span id=__span-4-195><span class=w>            </span><span class=n>Node</span><span class=o>*</span><span class=w> </span><span class=n>newnode</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Node</span><span class=p>(</span><span class=n>x</span><span class=p>);</span>
</span><span id=__span-4-196><span class=w>            </span><span class=n>Node</span><span class=o>*</span><span class=w> </span><span class=n>prev</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>cur</span><span class=o>-&gt;</span><span class=n>_prev</span><span class=p>;</span>
</span><span id=__span-4-197>
</span><span id=__span-4-198><span class=w>            </span><span class=c1>// prev  newnode  cur</span>
</span><span id=__span-4-199><span class=w>            </span><span class=n>prev</span><span class=o>-&gt;</span><span class=n>_next</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>newnode</span><span class=p>;</span>
</span><span id=__span-4-200><span class=w>            </span><span class=n>newnode</span><span class=o>-&gt;</span><span class=n>_prev</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>prev</span><span class=p>;</span>
</span><span id=__span-4-201><span class=w>            </span><span class=n>newnode</span><span class=o>-&gt;</span><span class=n>_next</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>cur</span><span class=p>;</span>
</span><span id=__span-4-202><span class=w>            </span><span class=n>cur</span><span class=o>-&gt;</span><span class=n>_prev</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>newnode</span><span class=p>;</span>
</span><span id=__span-4-203>
</span><span id=__span-4-204><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>iterator</span><span class=p>(</span><span class=n>newnode</span><span class=p>);</span>
</span><span id=__span-4-205><span class=w>        </span><span class=p>}</span>
</span><span id=__span-4-206>
</span><span id=__span-4-207><span class=w>        </span><span class=c1>// erase 后 pos失效了，pos指向节点被释放了</span>
</span><span id=__span-4-208><span class=w>        </span><span class=n>iterator</span><span class=w> </span><span class=n>erase</span><span class=p>(</span><span class=n>iterator</span><span class=w> </span><span class=n>pos</span><span class=p>)</span>
</span><span id=__span-4-209><span class=w>        </span><span class=p>{</span>
</span><span id=__span-4-210><span class=w>            </span><span class=n>assert</span><span class=p>(</span><span class=n>pos</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>end</span><span class=p>());</span>
</span><span id=__span-4-211>
</span><span id=__span-4-212><span class=w>            </span><span class=n>Node</span><span class=o>*</span><span class=w> </span><span class=n>cur</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>pos</span><span class=p>.</span><span class=n>_node</span><span class=p>;</span>
</span><span id=__span-4-213><span class=w>            </span><span class=n>Node</span><span class=o>*</span><span class=w> </span><span class=n>prev</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>cur</span><span class=o>-&gt;</span><span class=n>_prev</span><span class=p>;</span>
</span><span id=__span-4-214><span class=w>            </span><span class=n>Node</span><span class=o>*</span><span class=w> </span><span class=n>next</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>cur</span><span class=o>-&gt;</span><span class=n>_next</span><span class=p>;</span>
</span><span id=__span-4-215>
</span><span id=__span-4-216><span class=w>            </span><span class=n>prev</span><span class=o>-&gt;</span><span class=n>_next</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>next</span><span class=p>;</span>
</span><span id=__span-4-217><span class=w>            </span><span class=n>next</span><span class=o>-&gt;</span><span class=n>_prev</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>prev</span><span class=p>;</span>
</span><span id=__span-4-218>
</span><span id=__span-4-219><span class=w>            </span><span class=k>delete</span><span class=w> </span><span class=n>cur</span><span class=p>;</span>
</span><span id=__span-4-220>
</span><span id=__span-4-221><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>iterator</span><span class=p>(</span><span class=n>next</span><span class=p>);</span>
</span><span id=__span-4-222><span class=w>        </span><span class=p>}</span>
</span><span id=__span-4-223>
</span><span id=__span-4-224><span class=w>    </span><span class=k>private</span><span class=o>:</span>
</span><span id=__span-4-225><span class=w>        </span><span class=n>Node</span><span class=o>*</span><span class=w> </span><span class=n>_head</span><span class=p>;</span>
</span><span id=__span-4-226><span class=w>    </span><span class=p>};</span>
</span><span id=__span-4-227><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> </details> <p>下面是测试的代码：</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-5-1><span class=cp>#include</span><span class=w> </span><span class=cpf>&quot;list.h&quot;</span>
</span><span id=__span-5-2><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;list&gt;</span>
</span><span id=__span-5-3>
</span><span id=__span-5-4><span class=kt>int</span><span class=w> </span><span class=nf>main</span><span class=p>()</span>
</span><span id=__span-5-5><span class=p>{</span>
</span><span id=__span-5-6><span class=w>    </span><span class=n>simulate_list</span><span class=o>::</span><span class=n>list</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=w> </span><span class=n>l1</span><span class=p>{</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>4</span><span class=p>,</span><span class=mi>5</span><span class=w> </span><span class=p>};</span>
</span><span id=__span-5-7>
</span><span id=__span-5-8><span class=w>    </span><span class=c1>// 使用自定义的list的const迭代器接收非const的begin()--不可以</span>
</span><span id=__span-5-9><span class=w>    </span><span class=n>simulate_list</span><span class=o>::</span><span class=n>list</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;::</span><span class=n>const_iterator</span><span class=w> </span><span class=n>it</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>l1</span><span class=p>.</span><span class=n>begin</span><span class=p>();</span>
</span><span id=__span-5-10>
</span><span id=__span-5-11><span class=w>    </span><span class=n>list</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=w> </span><span class=n>l2</span><span class=p>{</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>4</span><span class=p>,</span><span class=mi>5</span><span class=w> </span><span class=p>};</span>
</span><span id=__span-5-12><span class=w>    </span><span class=c1>// 使用标准库的list的const迭代器接收非const的begin()--可以</span>
</span><span id=__span-5-13><span class=w>    </span><span class=n>list</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;::</span><span class=n>const_iterator</span><span class=w> </span><span class=n>it2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>l2</span><span class=p>.</span><span class=n>begin</span><span class=p>();</span>
</span><span id=__span-5-14>
</span><span id=__span-5-15><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-5-16><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <p>在模拟实现的list中，如果将非<code>const</code>的<code>begin()</code>传递给<code>const</code>的迭代器时，编译器会报错为无法转换，此时并不是权限缩小和放大问题，因为<code>const_iterator</code>和<code>iterator</code>本身就是两个类型，如果两个不同的自定义类型需要进行转换则必须通过构造函数来实现，先看下面两个简单例子理解如何通过构造函数实现自定义类型的相互转换</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-6-1><span class=k>class</span><span class=w> </span><span class=nc>A</span>
</span><span id=__span-6-2><span class=p>{</span>
</span><span id=__span-6-3><span class=k>public</span><span class=o>:</span>
</span><span id=__span-6-4><span class=w>    </span><span class=n>A</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>a</span><span class=p>)</span>
</span><span id=__span-6-5><span class=w>        </span><span class=o>:</span><span class=w> </span><span class=n>_a</span><span class=p>(</span><span class=n>a</span><span class=p>)</span>
</span><span id=__span-6-6><span class=w>    </span><span class=p>{}</span>
</span><span id=__span-6-7><span class=k>private</span><span class=o>:</span>
</span><span id=__span-6-8><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>_a</span><span class=p>;</span>
</span><span id=__span-6-9><span class=p>};</span>
</span><span id=__span-6-10>
</span><span id=__span-6-11><span class=k>class</span><span class=w> </span><span class=nc>B</span>
</span><span id=__span-6-12><span class=p>{</span>
</span><span id=__span-6-13><span class=k>public</span><span class=o>:</span>
</span><span id=__span-6-14><span class=w>    </span><span class=n>B</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>b</span><span class=p>)</span>
</span><span id=__span-6-15><span class=w>        </span><span class=o>:</span><span class=n>_b</span><span class=p>(</span><span class=n>b</span><span class=p>)</span>
</span><span id=__span-6-16><span class=w>    </span><span class=p>{}</span>
</span><span id=__span-6-17><span class=k>private</span><span class=o>:</span>
</span><span id=__span-6-18><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>_b</span><span class=p>;</span>
</span><span id=__span-6-19><span class=p>};</span>
</span><span id=__span-6-20>
</span><span id=__span-6-21><span class=kt>int</span><span class=w> </span><span class=nf>main</span><span class=p>()</span>
</span><span id=__span-6-22><span class=p>{</span>
</span><span id=__span-6-23><span class=w>    </span><span class=c1>// 默认情况下，A类型与B类型属于不同类型，无法相互转换</span>
</span><span id=__span-6-24><span class=w>    </span><span class=n>A</span><span class=w> </span><span class=n>a</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span><span id=__span-6-25><span class=w>    </span><span class=n>B</span><span class=w> </span><span class=n>b</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>a</span><span class=p>;</span><span class=c1>// 默认情况下错误</span>
</span><span id=__span-6-26><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-6-27><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <p>但是如果在<code>B</code>中实现用<code>A</code>对象中的值来构造则可以实现<code>A</code>类型转换为<code>B</code>类型</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-7-1><span class=k>class</span><span class=w> </span><span class=nc>A</span>
</span><span id=__span-7-2><span class=p>{</span>
</span><span id=__span-7-3><span class=k>public</span><span class=o>:</span>
</span><span id=__span-7-4><span class=w>    </span><span class=n>A</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>a</span><span class=p>)</span>
</span><span id=__span-7-5><span class=w>        </span><span class=o>:</span><span class=w> </span><span class=n>_a</span><span class=p>(</span><span class=n>a</span><span class=p>)</span>
</span><span id=__span-7-6><span class=w>    </span><span class=p>{}</span>
</span><span id=__span-7-7>
</span><span id=__span-7-8><span class=w>    </span><span class=c1>// 通过get函数获取私有成员_a的值</span>
</span><span id=__span-7-9><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>getA</span><span class=p>()</span>
</span><span id=__span-7-10><span class=w>    </span><span class=p>{</span>
</span><span id=__span-7-11><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>_a</span><span class=p>;</span>
</span><span id=__span-7-12><span class=w>    </span><span class=p>}</span>
</span><span id=__span-7-13><span class=k>private</span><span class=o>:</span>
</span><span id=__span-7-14><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>_a</span><span class=p>;</span>
</span><span id=__span-7-15><span class=p>};</span>
</span><span id=__span-7-16>
</span><span id=__span-7-17><span class=k>class</span><span class=w> </span><span class=nc>B</span>
</span><span id=__span-7-18><span class=p>{</span>
</span><span id=__span-7-19><span class=k>public</span><span class=o>:</span>
</span><span id=__span-7-20><span class=w>    </span><span class=n>B</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>b</span><span class=p>)</span>
</span><span id=__span-7-21><span class=w>        </span><span class=o>:</span><span class=n>_b</span><span class=p>(</span><span class=n>b</span><span class=p>)</span>
</span><span id=__span-7-22><span class=w>    </span><span class=p>{}</span>
</span><span id=__span-7-23>
</span><span id=__span-7-24><span class=w>    </span><span class=c1>// 通过构造函数实现A类型转换为B类型</span>
</span><span id=__span-7-25><span class=w>    </span><span class=n>B</span><span class=p>(</span><span class=n>A</span><span class=o>&amp;</span><span class=w> </span><span class=n>a</span><span class=p>)</span>
</span><span id=__span-7-26><span class=w>        </span><span class=o>:</span><span class=n>_b</span><span class=p>(</span><span class=n>a</span><span class=p>.</span><span class=n>getA</span><span class=p>())</span>
</span><span id=__span-7-27><span class=w>    </span><span class=p>{}</span>
</span><span id=__span-7-28><span class=k>private</span><span class=o>:</span>
</span><span id=__span-7-29><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>_b</span><span class=p>;</span>
</span><span id=__span-7-30><span class=p>};</span>
</span><span id=__span-7-31>
</span><span id=__span-7-32><span class=kt>int</span><span class=w> </span><span class=nf>main</span><span class=p>()</span>
</span><span id=__span-7-33><span class=p>{</span>
</span><span id=__span-7-34><span class=w>    </span><span class=n>A</span><span class=w> </span><span class=n>a</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span><span id=__span-7-35><span class=w>    </span><span class=n>B</span><span class=w> </span><span class=n>b</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>a</span><span class=p>;</span><span class=w> </span><span class=c1>// 通过非explicit构造函数隐式从A类型转换为B类型</span>
</span><span id=__span-7-36>
</span><span id=__span-7-37><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-7-38><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <p>再回到开始的问题，如果希望使<code>const</code>迭代器能够接受返回非<code>const</code>迭代器的<code>begin()</code>就需要在<code>const</code>迭代器中增加使用非<code>const</code>迭代器构造出<code>const</code>迭代器的构造函数，当然可以直接写一个构造函数针对这个问题，例如下面的代码：</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-8-1><span class=n>const_iterator</span><span class=p>(</span><span class=k>const</span><span class=w> </span><span class=n>iterator</span><span class=o>&amp;</span><span class=w> </span><span class=n>it</span><span class=p>)</span>
</span><span id=__span-8-2><span class=w>    </span><span class=o>:</span><span class=n>_node</span><span class=p>(</span><span class=n>it</span><span class=p>.</span><span class=n>_node</span><span class=p>)</span>
</span><span id=__span-8-3><span class=p>{}</span>
</span></code></pre></div></td></tr></table></div> <p>但是上面的写法仅限于只使用<code>const_iterator</code>类，实际上在使用时既需要考虑<code>iterator</code>还需要考虑<code>const_iterator</code>，所以需要考虑第二种方法，这种方法也是标准库处理二者直接转换的方法，首先先看标准库的处理方式：</p> <p><a class=glightbox href="29. C++中的类型转换.assets\image.png" data-type=image data-width=100% data-height=auto data-desc-position=bottom><img src="29. C++中的类型转换.assets\image.png"></a></p> <p>首先因为<code>__list_iterator</code>是主类，而<code>iterator</code>和<code>const_iterator</code>只是不同的实例版本</p> <p>当实例化为<code>iterator</code>时，则实现的就是普通的迭代器拷贝构造函数，即函数声明部分为<code>__list_iterator&lt;T, T&amp;, T*&gt;(const iterator&amp; x)</code>，其中<code>__list_iterator&lt;T, T&amp;, T*&gt;</code>即为实例化后的<code>iterator</code></p> <p>当实例化为<code>const_iterator</code>时，则实现的就是使用普通的迭代器构造一个<code>const</code>迭代器，即函数声明部分为<code>__list_iterator&lt;T, const T&amp;, const T*&gt;(const iterator&amp; x)</code>，其中<code>__list_iterator&lt;T, const T&amp;, const T*&gt;</code>即为实例化后的<code>const_iterator</code></p> <p>所以，根据上面的思路，可以对原来模拟实现的list中迭代器的部分进行修改，如下：</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-9-1><span class=k>namespace</span><span class=w> </span><span class=nn>simulate_list</span>
</span><span id=__span-9-2><span class=p>{</span>
</span><span id=__span-9-3><span class=w>    </span><span class=c1>// ...</span>
</span><span id=__span-9-4>
</span><span id=__span-9-5><span class=w>    </span><span class=k>template</span><span class=o>&lt;</span><span class=k>class</span><span class=w> </span><span class=nc>T</span><span class=p>,</span><span class=w> </span><span class=k>class</span><span class=w> </span><span class=nc>Ref</span><span class=p>,</span><span class=w> </span><span class=k>class</span><span class=w> </span><span class=nc>Ptr</span><span class=o>&gt;</span>
</span><span id=__span-9-6><span class=w>    </span><span class=k>struct</span><span class=w> </span><span class=nc>ListIterator</span>
</span><span id=__span-9-7><span class=w>    </span><span class=p>{</span>
</span><span id=__span-9-8><span class=w>        </span><span class=k>typedef</span><span class=w> </span><span class=n>ListNode</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=w> </span><span class=n>Node</span><span class=p>;</span>
</span><span id=__span-9-9><span class=w>        </span><span class=k>typedef</span><span class=w> </span><span class=n>ListIterator</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span><span class=w> </span><span class=n>T</span><span class=o>&amp;</span><span class=p>,</span><span class=w> </span><span class=n>T</span><span class=o>*&gt;</span><span class=w> </span><span class=n>iterator</span><span class=p>;</span>
</span><span id=__span-9-10><span class=w>        </span><span class=k>typedef</span><span class=w> </span><span class=n>ListIterator</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=n>T</span><span class=o>&amp;</span><span class=p>,</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=n>T</span><span class=o>*&gt;</span><span class=w> </span><span class=n>const_iterator</span><span class=p>;</span>
</span><span id=__span-9-11><span class=w>        </span><span class=k>typedef</span><span class=w> </span><span class=n>ListIterator</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span><span class=w> </span><span class=n>Ref</span><span class=p>,</span><span class=w> </span><span class=n>Ptr</span><span class=o>&gt;</span><span class=w> </span><span class=n>Self</span><span class=p>;</span>
</span><span id=__span-9-12><span class=w>        </span><span class=n>Node</span><span class=o>*</span><span class=w> </span><span class=n>_node</span><span class=p>;</span>
</span><span id=__span-9-13>
</span><span id=__span-9-14><span class=w>        </span><span class=c1>// ...</span>
</span><span id=__span-9-15>
</span><span id=__span-9-16><span class=w>        </span><span class=c1>// 支持iterator向const_iterator的隐式类型转换</span>
</span><span id=__span-9-17><span class=w>        </span><span class=n>ListIterator</span><span class=p>(</span><span class=k>const</span><span class=w> </span><span class=n>iterator</span><span class=o>&amp;</span><span class=w> </span><span class=n>it</span><span class=p>)</span>
</span><span id=__span-9-18><span class=w>            </span><span class=o>:</span><span class=n>_node</span><span class=p>(</span><span class=n>it</span><span class=p>.</span><span class=n>_node</span><span class=p>)</span>
</span><span id=__span-9-19><span class=w>        </span><span class=p>{}</span>
</span><span id=__span-9-20>
</span><span id=__span-9-21><span class=w>        </span><span class=c1>// ...</span>
</span><span id=__span-9-22><span class=w>    </span><span class=p>};</span>
</span><span id=__span-9-23><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <h2 id=c_2>C++中的四种类型转换模版<a class=headerlink href=#c_2 title="Permanent link">&para;</a></h2> <p>标准C++为了加强类型转换的可视性，引入了四种命名的强制类型转换操作符：<code>static_cast</code>、<code>reinterpret_cast</code>、<code>const_cast</code>和<code>dynamic_cast</code></p> <h3 id=static_cast><code>static_cast</code><a class=headerlink href=#static_cast title="Permanent link">&para;</a></h3> <p><code>static_cast</code>相当于隐式类型转换，只是显式写，例如下面的代码：</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span>
<span class=normal>8</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-10-1><span class=kt>int</span><span class=w> </span><span class=nf>main</span><span class=p>()</span>
</span><span id=__span-10-2><span class=p>{</span>
</span><span id=__span-10-3><span class=w>    </span><span class=kt>double</span><span class=w> </span><span class=n>d</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>1.1</span><span class=p>;</span>
</span><span id=__span-10-4><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>static_cast</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>(</span><span class=n>d</span><span class=p>);</span>
</span><span id=__span-10-5><span class=w>    </span><span class=n>cout</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>endl</span><span class=p>;</span>
</span><span id=__span-10-6>
</span><span id=__span-10-7><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-10-8><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <h3 id=reinterpret_cast><code>reinterpret_cast</code><a class=headerlink href=#reinterpret_cast title="Permanent link">&para;</a></h3> <p><code>reinterpret_cast</code>相当于强制类型转换，例如下面的代码：</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-11-1><span class=kt>int</span><span class=w> </span><span class=nf>main</span><span class=p>()</span>
</span><span id=__span-11-2><span class=p>{</span>
</span><span id=__span-11-3><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span>
</span><span id=__span-11-4>
</span><span id=__span-11-5><span class=w>    </span><span class=kt>int</span><span class=o>*</span><span class=w> </span><span class=n>p</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=n>a</span><span class=p>;</span>
</span><span id=__span-11-6>
</span><span id=__span-11-7><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>a1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>reinterpret_cast</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>(</span><span class=n>p</span><span class=p>);</span>
</span><span id=__span-11-8><span class=w>    </span><span class=n>cout</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>a1</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>endl</span><span class=p>;</span>
</span><span id=__span-11-9>
</span><span id=__span-11-10><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-11-11><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <h3 id=const_cast><code>const_cast</code><a class=headerlink href=#const_cast title="Permanent link">&para;</a></h3> <p><code>const_cast</code>支持将一个<code>const</code>的变量的<code>const</code>属性取消并赋值给非<code>const</code>变量，但是这个行为是不安全的，并且非<code>const</code>变量如果是指针，并且对<code>const</code>变量进行修改，默认情况下是不会影响到<code>const</code>变量中的值，因为<code>const</code>变量的值一般情况下本身被存到了寄存器中，当需要使用时将从寄存器加载，不会从内存中加载，而指针尝试对<code>const</code>变量修改的行为发生在内存，所以就算修改了也不会影响在寄存器中的值，如果想让<code>const</code>变量在使用时从内存中加载，可以使用<code>volatile</code>关键字，其作用是告诉编译器不要对该变量进行优化，并且每次访问时都要从内存中读取最新的值，例如下面的代码：</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-12-1><span class=kt>int</span><span class=w> </span><span class=nf>main</span><span class=p>()</span>
</span><span id=__span-12-2><span class=p>{</span>
</span><span id=__span-12-3><span class=w>    </span><span class=c1>// 不使用volatile时从寄存器取，不会影响a的值</span>
</span><span id=__span-12-4><span class=w>    </span><span class=k>const</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=p>;</span>
</span><span id=__span-12-5><span class=w>    </span><span class=kt>int</span><span class=o>*</span><span class=w> </span><span class=n>p</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>const_cast</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>*&gt;</span><span class=p>(</span><span class=o>&amp;</span><span class=n>a</span><span class=p>);</span>
</span><span id=__span-12-6><span class=w>    </span><span class=o>*</span><span class=n>p</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>3</span><span class=p>;</span>
</span><span id=__span-12-7><span class=w>    </span><span class=n>cout</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=o>*</span><span class=n>p</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>endl</span><span class=p>;</span>
</span><span id=__span-12-8><span class=w>    </span><span class=n>cout</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>endl</span><span class=p>;</span>
</span><span id=__span-12-9>
</span><span id=__span-12-10><span class=w>    </span><span class=c1>// 使用volatile时从内存取，会影响a1的值</span>
</span><span id=__span-12-11><span class=w>    </span><span class=k>volatile</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>a1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=p>;</span>
</span><span id=__span-12-12><span class=w>    </span><span class=kt>int</span><span class=o>*</span><span class=w> </span><span class=n>p1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>const_cast</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>*&gt;</span><span class=p>(</span><span class=o>&amp;</span><span class=n>a1</span><span class=p>);</span>
</span><span id=__span-12-13><span class=w>    </span><span class=o>*</span><span class=n>p1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>3</span><span class=p>;</span>
</span><span id=__span-12-14><span class=w>    </span><span class=n>cout</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=o>*</span><span class=n>p</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>endl</span><span class=p>;</span>
</span><span id=__span-12-15><span class=w>    </span><span class=n>cout</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>a1</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>endl</span><span class=p>;</span>
</span><span id=__span-12-16>
</span><span id=__span-12-17><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-12-18><span class=p>}</span>
</span><span id=__span-12-19>
</span><span id=__span-12-20><span class=n>输出结果</span><span class=err>：</span>
</span><span id=__span-12-21><span class=mi>3</span>
</span><span id=__span-12-22><span class=mi>2</span>
</span><span id=__span-12-23><span class=mi>3</span>
</span><span id=__span-12-24><span class=mi>3</span>
</span></code></pre></div></td></tr></table></div> <h3 id=dynamic_castdynamic_pointer_cast><code>dynamic_cast</code>和<code>dynamic_pointer_cast</code><a class=headerlink href=#dynamic_castdynamic_pointer_cast title="Permanent link">&para;</a></h3> <p><code>dynamic_cast</code>用于将一个父类对象的指针/引用转换为子类对象的指针或引用（动态转换）</p> <p>向上转型：（子类对象指针/引用被父类指针/引用接收）子类对象指针/引用-&gt;父类指针/引用（不需要转换，赋值兼容规则）</p> <p>向下转型：（父类对象指针/引用被子类指针/引用接收）父类对象指针/引用-&gt;子类指针/引用（用<code>dynamic_cast</code>转型是安全的）</p> <p>注意：</p> <ol> <li><code>dynamic_cast</code>只能用于父类含有虚函数的类（必须满足多态）</li> <li><code>dynamic_cast</code>会先检查是否能转换成功，能成功则转换，不能则返回<code>NULL</code></li> </ol> <div class="admonition note"> <p class=admonition-title>Note</p> <p>如果直接将父类对象强制转换给子类指针/引用可能会引发非法访问而出现的随机值</p> </div> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span>
<span class=normal>45</span>
<span class=normal>46</span>
<span class=normal>47</span>
<span class=normal>48</span>
<span class=normal>49</span>
<span class=normal>50</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-13-1><span class=k>class</span><span class=w> </span><span class=nc>A</span>
</span><span id=__span-13-2><span class=p>{</span>
</span><span id=__span-13-3><span class=k>public</span><span class=o>:</span>
</span><span id=__span-13-4><span class=w>    </span><span class=k>virtual</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=n>f</span><span class=p>()</span><span class=w> </span><span class=p>{}</span>
</span><span id=__span-13-5>
</span><span id=__span-13-6><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>_a</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span>
</span><span id=__span-13-7><span class=p>};</span>
</span><span id=__span-13-8>
</span><span id=__span-13-9><span class=k>class</span><span class=w> </span><span class=nc>B</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=k>public</span><span class=w> </span><span class=n>A</span>
</span><span id=__span-13-10><span class=p>{</span>
</span><span id=__span-13-11><span class=k>public</span><span class=o>:</span>
</span><span id=__span-13-12><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>_b</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=p>;</span>
</span><span id=__span-13-13><span class=p>};</span>
</span><span id=__span-13-14>
</span><span id=__span-13-15><span class=kt>void</span><span class=w> </span><span class=nf>fun</span><span class=p>(</span><span class=n>A</span><span class=o>*</span><span class=w> </span><span class=n>pa</span><span class=p>)</span>
</span><span id=__span-13-16><span class=p>{</span>
</span><span id=__span-13-17><span class=w>    </span><span class=n>B</span><span class=o>*</span><span class=w> </span><span class=n>pb1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>dynamic_cast</span><span class=o>&lt;</span><span class=n>B</span><span class=o>*&gt;</span><span class=p>(</span><span class=n>pa</span><span class=p>);</span>
</span><span id=__span-13-18><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>pb1</span><span class=p>)</span>
</span><span id=__span-13-19><span class=w>    </span><span class=p>{</span>
</span><span id=__span-13-20><span class=w>        </span><span class=n>cout</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;pb1:&quot;</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>pb1</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>endl</span><span class=p>;</span>
</span><span id=__span-13-21><span class=w>        </span><span class=n>cout</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>pb1</span><span class=o>-&gt;</span><span class=n>_a</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>endl</span><span class=p>;</span>
</span><span id=__span-13-22><span class=w>        </span><span class=n>cout</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>pb1</span><span class=o>-&gt;</span><span class=n>_b</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>endl</span><span class=p>;</span>
</span><span id=__span-13-23><span class=w>        </span><span class=n>pb1</span><span class=o>-&gt;</span><span class=n>_a</span><span class=o>++</span><span class=p>;</span>
</span><span id=__span-13-24><span class=w>        </span><span class=n>pb1</span><span class=o>-&gt;</span><span class=n>_b</span><span class=o>++</span><span class=p>;</span>
</span><span id=__span-13-25><span class=w>        </span><span class=n>cout</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>pb1</span><span class=o>-&gt;</span><span class=n>_a</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>endl</span><span class=p>;</span>
</span><span id=__span-13-26><span class=w>        </span><span class=n>cout</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>pb1</span><span class=o>-&gt;</span><span class=n>_b</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>endl</span><span class=p>;</span>
</span><span id=__span-13-27><span class=w>    </span><span class=p>}</span>
</span><span id=__span-13-28><span class=w>    </span><span class=k>else</span>
</span><span id=__span-13-29><span class=w>    </span><span class=p>{</span>
</span><span id=__span-13-30><span class=w>        </span><span class=n>cout</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;转换失败&quot;</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>endl</span><span class=p>;</span>
</span><span id=__span-13-31><span class=w>    </span><span class=p>}</span>
</span><span id=__span-13-32><span class=p>}</span>
</span><span id=__span-13-33>
</span><span id=__span-13-34><span class=kt>int</span><span class=w> </span><span class=nf>main</span><span class=p>()</span>
</span><span id=__span-13-35><span class=p>{</span>
</span><span id=__span-13-36><span class=w>    </span><span class=n>A</span><span class=w> </span><span class=n>a</span><span class=p>;</span>
</span><span id=__span-13-37><span class=w>    </span><span class=n>B</span><span class=w> </span><span class=n>b</span><span class=p>;</span>
</span><span id=__span-13-38><span class=w>    </span><span class=n>fun</span><span class=p>(</span><span class=o>&amp;</span><span class=n>a</span><span class=p>);</span><span class=w> </span><span class=c1>// 父类对象的父类指针转型给子类指针</span>
</span><span id=__span-13-39><span class=w>    </span><span class=n>fun</span><span class=p>(</span><span class=o>&amp;</span><span class=n>b</span><span class=p>);</span><span class=w> </span><span class=c1>// 子类对象的父类指针转型给子类指针</span>
</span><span id=__span-13-40>
</span><span id=__span-13-41><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-13-42><span class=p>}</span>
</span><span id=__span-13-43>
</span><span id=__span-13-44><span class=n>输出结果</span><span class=err>：</span>
</span><span id=__span-13-45><span class=n>转换失败</span>
</span><span id=__span-13-46><span class=nl>pb1</span><span class=p>:</span><span class=mf>000000E0</span><span class=n>D293F9A8</span>
</span><span id=__span-13-47><span class=mi>1</span>
</span><span id=__span-13-48><span class=mi>2</span>
</span><span id=__span-13-49><span class=mi>2</span>
</span><span id=__span-13-50><span class=mi>3</span>
</span></code></pre></div></td></tr></table></div> <p>总结：只有当父类指针指向子类对象时，使用<code>dynamic_cast</code>将父类指针转型给子类指针时是成功的，从而保证转型的安全性</p> <p>需要注意的是，<code>dynamic_cast</code>不能用于将父类对象的智能指针转换为子类对象的智能指针，而如果需要转化，则要使用<code>dynamic_pointer_cast</code>：</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span>
<span class=normal>45</span>
<span class=normal>46</span>
<span class=normal>47</span>
<span class=normal>48</span>
<span class=normal>49</span>
<span class=normal>50</span>
<span class=normal>51</span>
<span class=normal>52</span>
<span class=normal>53</span>
<span class=normal>54</span>
<span class=normal>55</span>
<span class=normal>56</span>
<span class=normal>57</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-14-1><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;iostream&gt;</span>
</span><span id=__span-14-2><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;memory&gt;</span>
</span><span id=__span-14-3>
</span><span id=__span-14-4><span class=k>class</span><span class=w> </span><span class=nc>A</span><span class=w> </span>
</span><span id=__span-14-5><span class=p>{</span>
</span><span id=__span-14-6><span class=k>public</span><span class=o>:</span>
</span><span id=__span-14-7><span class=w>    </span><span class=k>virtual</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=n>f</span><span class=p>()</span><span class=w> </span><span class=p>{}</span>
</span><span id=__span-14-8><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>_a</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span>
</span><span id=__span-14-9><span class=w>    </span><span class=k>virtual</span><span class=w> </span><span class=o>~</span><span class=n>A</span><span class=p>()</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>default</span><span class=p>;</span><span class=w> </span><span class=c1>// 确保正确的多态行为，虚析构函数很重要</span>
</span><span id=__span-14-10><span class=p>};</span>
</span><span id=__span-14-11>
</span><span id=__span-14-12><span class=k>class</span><span class=w> </span><span class=nc>B</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=k>public</span><span class=w> </span><span class=n>A</span><span class=w> </span>
</span><span id=__span-14-13><span class=p>{</span>
</span><span id=__span-14-14><span class=k>public</span><span class=o>:</span>
</span><span id=__span-14-15><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>_b</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=p>;</span>
</span><span id=__span-14-16><span class=p>};</span>
</span><span id=__span-14-17>
</span><span id=__span-14-18><span class=c1>// 使用智能指针版本的函数</span>
</span><span id=__span-14-19><span class=kt>void</span><span class=w> </span><span class=nf>fun</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>shared_ptr</span><span class=o>&lt;</span><span class=n>A</span><span class=o>&gt;</span><span class=w> </span><span class=n>pa</span><span class=p>)</span><span class=w> </span>
</span><span id=__span-14-20><span class=p>{</span>
</span><span id=__span-14-21><span class=w>    </span><span class=c1>// 使用dynamic_pointer_cast将父类智能指针转换为子类智能指针</span>
</span><span id=__span-14-22><span class=w>    </span><span class=n>std</span><span class=o>::</span><span class=n>shared_ptr</span><span class=o>&lt;</span><span class=n>B</span><span class=o>&gt;</span><span class=w> </span><span class=n>pb</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>dynamic_pointer_cast</span><span class=o>&lt;</span><span class=n>B</span><span class=o>&gt;</span><span class=p>(</span><span class=n>pa</span><span class=p>);</span>
</span><span id=__span-14-23>
</span><span id=__span-14-24><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>pb</span><span class=p>)</span><span class=w> </span>
</span><span id=__span-14-25><span class=w>    </span><span class=p>{</span>
</span><span id=__span-14-26><span class=w>        </span><span class=n>std</span><span class=o>::</span><span class=n>cout</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;转换成功&quot;</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span><span id=__span-14-27><span class=w>        </span><span class=n>std</span><span class=o>::</span><span class=n>cout</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;pb指向的地址: &quot;</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>pb</span><span class=p>.</span><span class=n>get</span><span class=p>()</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span><span id=__span-14-28><span class=w>        </span><span class=n>std</span><span class=o>::</span><span class=n>cout</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;_a = &quot;</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>pb</span><span class=o>-&gt;</span><span class=n>_a</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span><span id=__span-14-29><span class=w>        </span><span class=n>std</span><span class=o>::</span><span class=n>cout</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;_b = &quot;</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>pb</span><span class=o>-&gt;</span><span class=n>_b</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span><span id=__span-14-30>
</span><span id=__span-14-31><span class=w>        </span><span class=c1>// 修改值</span>
</span><span id=__span-14-32><span class=w>        </span><span class=n>pb</span><span class=o>-&gt;</span><span class=n>_a</span><span class=o>++</span><span class=p>;</span>
</span><span id=__span-14-33><span class=w>        </span><span class=n>pb</span><span class=o>-&gt;</span><span class=n>_b</span><span class=o>++</span><span class=p>;</span>
</span><span id=__span-14-34>
</span><span id=__span-14-35><span class=w>        </span><span class=n>std</span><span class=o>::</span><span class=n>cout</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;修改后 _a = &quot;</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>pb</span><span class=o>-&gt;</span><span class=n>_a</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span><span id=__span-14-36><span class=w>        </span><span class=n>std</span><span class=o>::</span><span class=n>cout</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;修改后 _b = &quot;</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>pb</span><span class=o>-&gt;</span><span class=n>_b</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span><span id=__span-14-37><span class=w>    </span><span class=p>}</span><span class=w> </span>
</span><span id=__span-14-38><span class=w>    </span><span class=k>else</span><span class=w> </span>
</span><span id=__span-14-39><span class=w>        </span><span class=n>std</span><span class=o>::</span><span class=n>cout</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;转换失败&quot;</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span><span id=__span-14-40><span class=p>}</span>
</span><span id=__span-14-41>
</span><span id=__span-14-42><span class=kt>int</span><span class=w> </span><span class=nf>main</span><span class=p>()</span><span class=w> </span>
</span><span id=__span-14-43><span class=p>{</span>
</span><span id=__span-14-44><span class=w>    </span><span class=c1>// 创建父类对象的智能指针</span>
</span><span id=__span-14-45><span class=w>    </span><span class=n>std</span><span class=o>::</span><span class=n>shared_ptr</span><span class=o>&lt;</span><span class=n>A</span><span class=o>&gt;</span><span class=w> </span><span class=n>pa1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>make_shared</span><span class=o>&lt;</span><span class=n>A</span><span class=o>&gt;</span><span class=p>();</span>
</span><span id=__span-14-46>
</span><span id=__span-14-47><span class=w>    </span><span class=c1>// 创建子类对象的智能指针</span>
</span><span id=__span-14-48><span class=w>    </span><span class=n>std</span><span class=o>::</span><span class=n>shared_ptr</span><span class=o>&lt;</span><span class=n>A</span><span class=o>&gt;</span><span class=w> </span><span class=n>pa2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>make_shared</span><span class=o>&lt;</span><span class=n>B</span><span class=o>&gt;</span><span class=p>();</span>
</span><span id=__span-14-49>
</span><span id=__span-14-50><span class=w>    </span><span class=n>std</span><span class=o>::</span><span class=n>cout</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;测试父类对象的智能指针转换:&quot;</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span><span id=__span-14-51><span class=w>    </span><span class=n>fun</span><span class=p>(</span><span class=n>pa1</span><span class=p>);</span><span class=w> </span><span class=c1>// 父类对象的智能指针转换为子类智能指针（应该失败）</span>
</span><span id=__span-14-52>
</span><span id=__span-14-53><span class=w>    </span><span class=n>std</span><span class=o>::</span><span class=n>cout</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;</span><span class=se>\n</span><span class=s>测试子类对象的智能指针转换:&quot;</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span><span id=__span-14-54><span class=w>    </span><span class=n>fun</span><span class=p>(</span><span class=n>pa2</span><span class=p>);</span><span class=w> </span><span class=c1>// 子类对象的智能指针转换为子类智能指针（应该成功）</span>
</span><span id=__span-14-55>
</span><span id=__span-14-56><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-14-57><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title=最后更新> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">2025年5月22日</span> </span> </aside> <form class=md-feedback name=feedback hidden> <fieldset> <legend class=md-feedback__title> 页面有帮助吗？ </legend> <div class=md-feedback__inner> <div class=md-feedback__list> <button class="md-feedback__icon md-icon" type=submit title=页面对我有帮助 data-md-value=1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M5 9v12H1V9zm4 12a2 2 0 0 1-2-2V9c0-.55.22-1.05.59-1.41L14.17 1l1.06 1.06c.27.27.44.64.44 1.05l-.03.32L14.69 8H21a2 2 0 0 1 2 2v2c0 .26-.05.5-.14.73l-3.02 7.05C19.54 20.5 18.83 21 18 21zm0-2h9.03L21 12v-2h-8.79l1.13-5.32L9 9.03z"/></svg> </button> <button class="md-feedback__icon md-icon" type=submit title=页面没有帮助到我 data-md-value=0> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 15V3h4v12zM15 3a2 2 0 0 1 2 2v10c0 .55-.22 1.05-.59 1.41L9.83 23l-1.06-1.06c-.27-.27-.44-.64-.44-1.06l.03-.31.95-4.57H3a2 2 0 0 1-2-2v-2c0-.26.05-.5.14-.73l3.02-7.05C4.46 3.5 5.17 3 6 3zm0 2H5.97L3 12v2h8.78l-1.13 5.32L15 14.97z"/></svg> </button> </div> <div class=md-feedback__note> <div data-md-value=1 hidden> 谢谢你的反馈！ </div> <div data-md-value=0 hidden> 谢谢你的反馈！联系<a href=https://www.help-doc.top/author/contact/contact.html>作者</a>提供更详细的信息 </div> </div> </div> </fieldset> </form> <!-- Waline 评论系统 --> <div id=waline></div> <!-- 评论系统 --> <!-- Waline 评论系统 --> <div id=waline></div> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2024-2025 柯懒不是柯南 </div> </div> <div class="md-footer-love md-typeset"> 一闪一闪亮晶晶，不及<span class=love-highlight>小亮</span><span class=love-heart>♥</span>照我心。To Li Liang </div> <div class=md-social> <a href=https://github.com/H0308 target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> <a href=https://www.help-doc.top/author/contact/contact.html target=_blank rel=noopener title=www.help-doc.top class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M433.754 420.445c-11.526 1.393-44.86-52.741-44.86-52.741 0 31.345-16.136 72.247-51.051 101.786 16.842 5.192 54.843 19.167 45.803 34.421-7.316 12.343-125.51 7.881-159.632 4.037-34.122 3.844-152.316 8.306-159.632-4.037-9.045-15.25 28.918-29.214 45.783-34.415-34.92-29.539-51.059-70.445-51.059-101.792 0 0-33.334 54.134-44.859 52.741-5.37-.65-12.424-29.644 9.347-99.704 10.261-33.024 21.995-60.478 40.144-105.779C60.683 98.063 108.982.006 224 0c113.737.006 163.156 96.133 160.264 214.963 18.118 45.223 29.912 72.85 40.144 105.778 21.768 70.06 14.716 99.053 9.346 99.704"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.indexes", "navigation.prune", "navigation.tabs", "search.highlight", "content.code.copy"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script> <script src=../../assets/javascripts/bundle.c8b220af.min.js></script> <script src=../../javascripts/katex.min.js></script> <script src=../../javascripts/other.min.js></script> <script src=../../javascripts/copyright.min.js></script> <script src=../../javascripts/waline.min.js></script> <script src=https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.js></script> <script src=https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/contrib/auto-render.min.js></script> <script src=https://cdn.jsdelivr.net/npm/mermaid@11.5.0/dist/mermaid.min.js></script> <script src=../../assets/javascripts/toggle-sidebar.js async></script> <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body> </html>