# JavaScript函数

## 函数定义

在JavaScript中，函数也属于对象，所以函数也具备一般对象所具有的功能，定义函数以及调用语法如下：

```JavaScript
// 定义函数语法如下
function 函数名(形参列表) {
    // 函数体
}

// 调用函数语法如下
函数名();
```

除了上面提到的最基本的定义函数的方式，JavaScript中还有两种定义函数的方式：

1. 匿名函数，一般需要使用变量接收匿名函数对象，调用时使用变量调用对应的函数对象
2. 箭头函数，匿名函数对象的变体，一般需要使用变量接收匿名函数对象，调用时使用变量调用对应的函数对象

基本语法如下：

```JavaScript
// 匿名函数
let/const 变量名 = function (形参列表) {
    // 函数体
}

// 箭头函数
let/const 变量名 = (形参列表) => {
    // 函数体
}
```

基本使用如下：

```JavaScript
function fn(){
    console.log("函数声明所定义的函数");
}

const fn2 = function(){
    console.log("函数表达式");
}

const fn3 = () => {
    console.log("箭头函数");
}

console.log(typeof fn);
console.log(typeof fn2);
console.log(typeof fn3);
```

一般情况下，函数对象不会被修改，也不希望被修改，所以推荐使用`const`变量接收匿名函数对象或者箭头函数对象

## 函数参数

因为JavaScript属于动态弱类型语言，所以函数的形式参数不需要指定具体的类型，例如下面的代码：

```JavaScript
function sum(a, b) {
    console.log(a + b);
}

sum(1, 2);
```

另外，与其他强类型语言不同的是，JavaScript中的函数可以在调用时，实参个数与形参个数不匹配，具体分为两种情况：

1. 实参多于形参：当实参多于形参时，多余的实参不会被使用
2. 实参少于形参：当实参少于形参时，依次按照传参顺序，没有实参对应的形参被设置为`undefined`

例如下面的代码：

```JavaScript
function fn(a, b) {
    console.log(a);
    console.log(b);
}

// 实参多于形参
fn(1,2,3);
// 实参少于形参
fn(1);

输出结果：
1
2
1
undefined
```

除了前面的原始值作为函数参数以外，还可以将对象作为函数参数，包括函数对象

在JavaScript中，所有对象传给函数形参的方式都是引用传递，所以在函数中对形参接收到的对象中的内容进行修改会影响到实参，例如下面的代码：

```JavaScript
function fn(a) {
    console.log(a);
    a.name = "lisi";
}

// 对象作为函数参数
let obj = {
    name: "zhangsan",
    age: 18
}

fn(obj);
console.log(obj);

输出结果：
{ name: 'zhangsan', age: 18 }
{ name: 'lisi', age: 18 }
```

当函数参数接收的是一个函数对象，此时一个作为参数传递给另一个函数的函数就称为回调函数。当外部函数完成某些操作后，它会回调这个传入的函数，以此来通知内部函数操作已经完成，例如下面的代码：

```JavaScript
function fn(a) {
    console.log("a = ", a);
    console.log("This is fn");
}

function fn1() {
    console.log("This is fn1");
}

// 函数对象作为参数，参数的函数称为回调函数
fn(fn1);

输出结果：
a =  [Function: fn1]
This is fn
```

在实际开发中，对应函数体比较简短的函数会直接使用箭头函数作为函数实际参数传递给形参，此时的箭头函数即为回调函数

## 函数返回值

因为JavaScript是动态弱类型语言，所以函数返回值不需要指定具体类型，函数体内部使用`return`关键字加上返回内容即可代表该函数具有返回值

> `return`后面也可以不接内容，此时只是结束函数，但是如果使用变量接收这种函数的返回值时，变量此时为`undefined`，与默认情况下函数没有`return`语句效果一致

例如下面的代码：

```JavaScript
function sum(a, b){
    return a+b;
}

let sum1 = sum(1,2);
console.log(sum1);
```

## 箭头函数的特点

前面提到的都是普通函数的情况，接下来讨论箭头函数的特点

在JavaScript中，箭头函数也包括函数形式参数、函数体和函数返回值，与普通函数不同的是，箭头函数有以下几个特点：

1. 函数形式参数：如果箭头函数只有形式参数，则可以省略形参列表的括号
2. 函数体：如果箭头函数的函数体只有一条语句，则可以省略包裹函数体的大括号
3. 函数返回值：如果箭头函数的函数体只有一条语句，且这条语句是`return`语句，此时可以省略大括号和`return`关键字

例如下面的代码：

```JavaScript
// 只有一个函数形式参数且只有一条语句
let fn = a => console.log(a);
fn(1);

// 只有一个返回语句
let fn1 = b => b;
let ret = fn1(2);
console.log(ret);
```

需要注意的是，当箭头函数的返回值是用大括号包裹的对象且函数体只有一条`return`语句时，需要使用小括号包裹返回的对象，例如下面的代码：

```JavaScript
let fn2 = c => ({name:"lisi"});
console.log(fn2());

输出结果：
{ name: 'lisi' }
```

## 作用域

在JavaScript中，作用域分为两种：

1. 全局作用域：直接位于整个`script`标签或者`.js`后缀文件中
2. 局部作用域：位于代码块中，包括函数代码块和普通代码块

例如下面的代码：

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>作用域</title>
</head>
<script>
    // a 和 b都位于全局作用域，任何位置都可以访问a和b
    let a = 1;
    var b = 2;

    {
        let c = 1; // c位于局部作用域
    }
    console.log(c);// 外部不能访问c

    function fn(){
        let d = 1; // d位于局部作用域
    }

    console.log(d);// 外部不能访问d
</script>
<body>

</body>
</html>
```

注意，如果在局部作用域中使用`var`声明变量，则该变量依旧可以访问，例如下面的代码：

```javascript
{
    var a = 1; // 使用var创建变量，尽管处于局部作用域也可以在外部访问
}

console.log(a);

输出结果：
1
```

在JavaScript中，多个`<script>`标签共享同一个全局作用域。因此，在一个`<script>`标签中声明的变量可以在后续的`<script>`标签中访问，例如下面的代码：

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>测试多个script标签变量的作用域</title>
</head>
<script>
    // a 和 b都位于全局作用域，任何位置都可以访问a和b
    let a = 1;
    var b = 2;
</script>
<body>

</body>
<script>
    console.log(a); // 1
    console.log(b); // 2
</script>
</html>
```

## 作用域链

所谓作用域链，即当使用一个变量时，JS解释器会优先在当前作用域中寻找变量，如果找到了则直接使用，如果没找到，则去上一层作用域中寻找，找到了则使用，如果没找到，则继续去上一层寻找，以此类推。如果一直到全局作用域都没找到，则报错为变量未定义，例如下面的代码：

```JavaScript
let b = 33;

function fn(){
    let b = 44;

    function f1(){
    let b = 55;
    console.log(b); // 先访问最近的55，假设此时55不在，就找到44，假设44不在，就找到33，再往上就报错
    }

    f1(); // 打印55

}

fn(); // 打印55
```

## 对象的方法

对象的方法是函数的一种，只是这个函数属于对象中的一个成员，创建对象的方法的方式与创建对象属性基本一致，例如下面的代码：

```JavaScript
// 函数也可以成为一个对象的属性
obj.sayHello = function(){
    console.log("hello");
}

console.log(obj);

obj.sayHello();

输出结果：
{ sayHello: [Function (anonymous)] }
hello
```

