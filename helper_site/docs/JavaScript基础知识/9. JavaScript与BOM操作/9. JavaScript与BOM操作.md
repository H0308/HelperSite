# JavaScript与BOM操作

## BOM对象

在[BOM介绍]部分已经详细介绍了什么是BOM，这里不再赘述，下面主要介绍BOM中`window`对象的子对象：

1. Navigator对象（`navigator`）：浏览器的对象，可以用来识别浏览器
2. Location对象（`location`）：浏览器的地址栏信息
3. History对象（`history`）：浏览器的历史记录，控制浏览器前进后退
4. Screen对象（`screen`）：屏幕的信息

因为上面的对象都是`window`对象的子对象，所以可以直接调用，例如下面的代码：

```javascript
console.log(navigator);
console.log(history);
console.log(screen);
console.log(location);
```

后面的三个主题将简单介绍`navigator`、`location`和`history`对象的基本操作，详细的内容见对应的官方文档即可

## Navigator对象

浏览器的对象，可以用来识别浏览器，一般会将其作为浏览器类型用于处理兼容性问题，例如官方提供的一段代码，用于判断用户的浏览器品牌和引擎

```javascript
let sBrowser
const sUsrAg = navigator.userAgent

// The order matters here, and this may report false positives for unlisted browsers.

if (sUsrAg.indexOf("Firefox") > -1) {
    sBrowser = "Mozilla Firefox";
    // "Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:61.0) Gecko/20100101 Firefox/61.0"
} else if (sUsrAg.indexOf("SamsungBrowser") > -1) {
    sBrowser = "Samsung Internet";
    // "Mozilla/5.0 (Linux; Android 9; SAMSUNG SM-G955F Build/PPR1.180610.011) AppleWebKit/537.36 (KHTML, like Gecko) SamsungBrowser/9.4 Chrome/67.0.3396.87 Mobile Safari/537.36
} else if (
    sUsrAg.indexOf("Opera") > -1 ||
    sUsrAg.indexOf("OPR") > -1
) {
    sBrowser = "Opera";
    // "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.102 Safari/537.36 OPR/57.0.3098.106"
} else if (sUsrAg.indexOf("Trident") > -1) {
    sBrowser = "Microsoft Internet Explorer";
    // "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; .NET4.0C; .NET4.0E; Zoom 3.6.0; wbx 1.0.0; rv:11.0) like Gecko"
} else if (sUsrAg.indexOf("Edge") > -1) {
    sBrowser = "Microsoft Edge (Legacy)";
    // "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36 Edge/16.16299"
} else if (sUsrAg.indexOf("Edg") > -1) {
    sBrowser = "Microsoft Edge (Chromium)";
    // Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36 Edg/91.0.864.64
} else if (sUsrAg.indexOf("Chrome") > -1) {
    sBrowser = "Google Chrome or Chromium";
    // "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Ubuntu Chromium/66.0.3359.181 Chrome/66.0.3359.181 Safari/537.36"
} else if (sUsrAg.indexOf("Safari") > -1) {
    sBrowser = "Apple Safari";
    // "Mozilla/5.0 (iPhone; CPU iPhone OS 11_4 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/11.0 Mobile/15E148 Safari/604.1 980x1306"
} else {
    sBrowser = "unknown";
}

console.log(`You are using: ${sBrowser}`); // You are using: Google Chrome or Chromium
```

## Location对象

`location`表示的是浏览器地址栏的信息

`location`对象中有下面几个常见的属性和方法：

1. `assign()`：将地址栏的地址修改为新的地址，参数传递一个网页地址字符串
2. `replace()`：使用新的地址替换已有的地址，参数传递一个网页地址字符串
3. `reload()`：刷新页面，参数可以传递一个`true`来强制清缓存刷新
4. `href`：获取当前页面的地址值

例如下面的代码：

=== "HTML"

    ```html
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Title</title>
    </head>
    <body>
        <button id="btn">点击跳转</button>
    </body>
    <script src="test.js"></script>
    </html>
    ```

=== "JavaScipt"

    ```javascript
    let btn = document.getElementById("btn");
    btn.addEventListener("click", ()=>{
        // location.assign("http://www.baidu.com");
        console.log(location.href);
    });
    ```

## History对象

History对象是浏览器的历史记录，控制浏览器前进后退，其常见的方法有：

1. `back()`：返回上一个网页
2. `forward()`：返回下一个网页
3. `go()`：前往指定的网页。注意这个方法并不是直接传递一个表示网页地址的字符串，因为是history对象的方法，所以只能访问历史访问过的网站，并且是按照数值进行跳转，所以参数传递一个数值，正数表示前进指定个数的网页，负数表示后退指定个数的网页；如果参数传递0，则其效果与`location`对象的`reload`方法效果一样

## 定时器

前面简单了解了`window`对象的三个子对象，但是一般情况下不会经常使用这三个对象，所以做个了解即可，下面主要介绍BOM中重要的功能：定时器

定时器，就是控制某一个行为执行的时间，在BOM中，有两种设置定时器的方式：

1. `setTimeOut()`：直接调用，该函数设置的定时器只能在指定的时间后执行**一次**回调函数中的代码，该函数有两个参数：
   
   1. 第一个参数传递一个回调函数，回调函数中即为指定要执行的代码
   2. 第二个参数表示间隔时间（单位是毫秒），即多久之后执行回调函数中的代码

2. `setInterval()`：直接调用，该函数设置的定时器可以在指定的时间间隔结束后执行**若干次**回调函数中的代码，该函数也有两个参数：
   
   1. 第一个参数传递一个回调函数，回调函数中即为指定要执行的代码
   2. 第二个参数表示间隔时间（单位是毫秒），即间隔多久执行一次回调函数中的代码

介绍完设置定时器的方式，下面介绍关闭定时器的方式：

1. 对于`setTimeOut()`来说，关闭定时器需要利用到`setTimeOut()`函数的返回值，该函数返回值为计时器的序号，是一个数值类型，用于指定是哪一个计时器，将该返回值传递给`clearTimeout()`函数即可关闭指定的定时器
2. 对于`setInterval()`来说，关闭定时器需要利用到`setInterval()`函数的返回值，将该返回值传递给`clearInterval()`函数即可关闭指定的定时器

!!! note
    需要注意，`setInterval()`函数不会考虑是否已经有定时器存在，所以如果创建了多个定时器，可能导致一些不符合预期的效果，`setTimeOut()`也不会考虑是否已经有定时器存在，但是因为其一次只会执行一次回调函数中的代码，所以一般情况下不会产生影响

`setTimeOut()`和`clearTimeOut()`基本使用如下：

=== "HTML"

    ```html
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Title</title>
    </head>
    <body>
        <h1 id="countdown"></h1>
    </body>
    <script src="test.js"></script>
    </html>
    ```

=== "JavaScript"

    ```javascript
    let countdown = document.getElementById("countdown");
    let count = 10;

    countdown.innerText = count;

    // 调用setTimeOut()，1秒进行一次count--操作
    const timer = setTimeout(() => {
        countdown.innerText = --count;
    }, 1000);

    // 关闭定时器
    clearTimeout(timer);
    ```

`setInterval()`和`clearInterVal()`基本使用如下：

=== "HTML"

    ```html
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Title</title>
    </head>
    <body>
        <h1 id="countdown"></h1>
    </body>
    <script src="test.js"></script>
    </html>
    ```

=== "JavaScript"

    ```javascript
    let countdown = document.getElementById("countdown");
    let count = 10;

    countdown.innerText = count;

    // 调用setInterval()，间隔1秒进行一次--count操作
    const timer = setInterval(() => {
        countdown.innerText = --count;

        if(count == 0)
            clearInterval(timer);
    }, 1000);
    ```