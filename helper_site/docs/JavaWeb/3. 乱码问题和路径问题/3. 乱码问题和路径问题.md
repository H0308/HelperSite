# 乱码问题和路径问题

## 乱码问题

在Java基础部分已经提到过[字符编码](https://www.help-doc.top/Java/16.%20Java%E7%9A%84IO%E6%B5%81/16.%20Java%E7%9A%84IO%E6%B5%81.html#_18)，而所谓的乱码就是编码时使用的[字符集](https://www.help-doc.top/Java/16.%20Java%E7%9A%84IO%E6%B5%81/16.%20Java%E7%9A%84IO%E6%B5%81.html#_19)和解码时使用的字符集不同，所以解决乱码的唯一方式就是确保编码和解码使用的是同一个编码

在Web开发阶段，有下面几种乱码的情况：

1. HTML乱码
2. Tomcat控制台乱码
3. 请求乱码问题

      1. GET请求乱码
      2. POST方式请求乱码
4. 响应乱码问题

### HTML乱码问题

设置项目文件的字符集要使用一个支持中文的字符集

1. 查看当前文件的字符集

    <img src="3. 乱码问题和路径问题.assets/1682325817829.png"/>

2. 查看项目字符集配置，将`Global Encoding`全局字符集，`Project Encoding`项目字符集，`Properties Files`属性配置文件字符集设置为UTF-8

    <img src="3. 乱码问题和路径问题.assets\1682326229063.png">

HTML文件的字符集通过`<meta charset="UTF-8">`来告知浏览器通过什么字符集来解析当前文件，例如下面的文件：

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
    中文
</body>
</html>
```

在IDEA中，如果更改了`<meta charset="UTF-8">`中的UTF-8，那么IDEA会自动更改当前文件的编码

### Tomcat控制台乱码问题

在Tomcat10这个版本中，修改`tomcat->conf->logging.properties`中，所有的UTF-8为GBK即可

修改前：

<img src="3. 乱码问题和路径问题.assets\1681443202115.png">

修改后：

<img src="3. 乱码问题和路径问题.assets\1681443273573.png">

如果遇到使用`System.out.prinln()`输出乱码，则需要告诉JVM虚拟机以什么字符集进行解码。在编写文件时，IDEA会根据文件的字符集将当前的`.java`文件编译成对应字符集的`.class`文件，但是解码时，IDEA并没有告知JVM使用何种字符集进行解码，所以此时需要进行下面的设置：

<img src="3. 乱码问题和路径问题.assets\1695189588009.png">

### GET请求乱码问题

GET请求方式乱码原因分析：

GET方式提交参数的方式是将参数放到URL后面，如果使用的不是UTF-8，那么会对参数进行URL编码处理，而HTML中的`<meta charset='字符集'/>`影响了GET方式提交参数的URL编码，在Tomcat10中，URI编码默认为UTF-8，当GET方式提交的参数URL编码和Tomcat10默认的URI编码不一致时就会出现乱码

GET请求乱码问题解决方式如下：

方式1：设置GET方式提交的编码和Tomcat的URI默认解析编码一致即可 (推荐)

<img src="3. 乱码问题和路径问题.assets\1682386298048.png">

方式2：设置Tomcat10的URI解析字符集和GET请求发送时所使用URL转码时的字符集一致即可，修改`conf/server.xml`中`Connecter`添加`URIEncoding="GBK"`（不推荐）

!!! note

    之所以不推荐这种方式，是因为这种方式取决于Tomcat所运行的系统环境，如果另一台服务器的编码不是GBK，则此时的Tomcat在放到该服务器时就会出现乱码

<img src="3. 乱码问题和路径问题.assets\1682386551684.png">

<img src="3. 乱码问题和路径问题.assets\1682386611945.png">

### POST方式请求乱码问题

POST请求方式乱码原因分析：

POST请求将参数放在请求体中进行发送，请求体使用的字符集受到了`<meta charset="字符集"/>`的影响，而Tomcat10默认使用UTF-8字符集对请求体进行解析，如果请求体的URL转码和Tomcat的请求体解析编码不一致就容易出现乱码

POST请求方式乱码解决方式如下：

方式1：请求时，使用UTF-8字符集提交请求体（推荐）

<img src="3. 乱码问题和路径问题.assets\1682387836615.png">

<img src="3. 乱码问题和路径问题.assets\1682387857587.png">

方式2：后端在获取参数前，设置解析请求体使用的字符集和请求发送时使用的字符集一致（不推荐）

<img src="3. 乱码问题和路径问题.assets\1682388026978.png">

### 响应乱码问题

响应乱码原因分析：

在Tomcat10中，向响应体中放入的数据默认使用了工程编码为UTF-8，浏览器在接收响应信息时，使用了不同的字符集或者是不支持中文的字符集就会出现乱码

响应乱码解决方式：

方式1：手动设定浏览器对本次响应体解析时使用的字符集（不推荐），因为Edge和Chrome浏览器都没有提供直接的比较方便的入口，不方便

方式2：后端通过设置响应体的字符集和浏览器解析响应体的默认字符集一致（不推荐）

<img src="3. 乱码问题和路径问题.assets\1682388026978.png">

方式3：通过设置`Content-Type`响应头告诉浏览器以指定的字符集解析响应体（推荐）

<img src="3. 乱码问题和路径问题.assets\1682389263627.png">

<img src="3. 乱码问题和路径问题.assets\1682389317234.png">

## 路径问题

