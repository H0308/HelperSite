# 4.Linux下的gcc与gdb

# Linux下的gcc

在前面C语言的编译与链接章节中学到了C语言的可执行程序是如何从代码一步一步生成的，下面是前面用到的指令

## 代码编译与链接

代码编译预处理

```shell
gcc -E test.c -o test.i
```

- 选项`-E`,该选项的作用是让gcc在预处理结束后停止编译过程
- 选项`-o`是指目标文件,`.i`文件为已经过预处理的C原始程序

预处理生成汇编

```shell
gcc -S test.c -o test.s
```

> 如果已经在前面执行了编译预处理生成了`test.i`文件，则可以直接用`test.i`文件而不是`test.c`文件

- 用户可以使用`-S`选项来进行查看,该选项只进行编译而不进行汇编,生成汇编代码

汇编生成二进制文件

```shell
gcc -c test.c -o test.o
```

> 如果已经在前面执行了编译预处理生成了`test.s`文件，则可以直接用`test.s`文件而不是`test.c`文件

- 使用选项`-c`就可看到汇编代码已转化为`.o`的二进制目标代码，`.o`文件也被称为可重定位目标文件

二进制文件链接生成可执行程序

```shell
gcc test.c -o test
```

> 如果已经在前面执行了编译预处理生成了`test.o`文件，则可以直接用`test.o`文件而不是`test.c`文件

## 函数库

函数库一般分为静态库和动态库两种

1. 静态库：编译链接时把库文件的代码全部加入到可执行文件中，因此生成的文件比较大，在运行时不再需要库文件了。其后缀名一般为`.a`
2. 动态库：在编译链接时并没有把库文件的代码加入到可执行文件中，而是在程序执行时由运行时链接文件加载库,这样可以节省系统的开销。动态库一般后缀名为`.so`。gcc在编译时默认使用动态库。完成了链接之后，gcc就可以生成可执行文件

直接编译时选择动态库：`gcc test.c -o test`

使用静态编译选项-static时选择静态库：`gcc -o test test.c -static`