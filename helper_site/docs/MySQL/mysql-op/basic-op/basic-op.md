# MySQL基础操作

## 文档约定

1. 在MySQL中并不区分大小写，后续关于MySQL的代码都以小写为主

## MySQL中的注释

MySQL中支持两种注释：

1. 单行注释：使用`--`或者`#`。**需要注意，使用`--`时后面必须跟一个空格才能被识别为注释**
2. 多行注释：使用`/**/`

## 显示当前数据库

操作如下：

```sql
show databases;
```

## 创建数据库

基本语法如下：

```sql
create database 数据库名;
```

!!! note

    数据库名不能和已有的数据库名重复，数据库名在Windows下不区分大小写，但是Linux下区分大小写，因为数据库本身实际上就是一个文件。如果数据库名与SQL中的关键字重名，则在创建数据库时可以使用反引号包裹数据库名，例如：

    ```sql
    -- 创建名为order的数据库
    create database `order`;
    ```

在MySQL 5.7中，数据库默认的字符集为拉丁文，如果存储中文数据就会出现乱码，解决方式就是在创建数据库时指定字符集：

```sql
-- 指定字符集为UTF-8
create database 数据库名 charset utf8;
-- charset也可以写作character set
```

在MySQL8.0中，默认的字符集就是UTF-8，所以可以不用额外指定字符集

但是需要注意的是，MySQL中的UTF-8是“残血版”，即一部分UTF-8中的字符并不支持，所以MySQL还提供`utf8mb4`，但是这个字符集是MySQL独有的，如果是其他数据库，则无法正常识别该字符集

创建数据库时还可以指定条件：如果创建的数据库已经存在，则不继续创建并提示`database exists`（不指定条件时会报错为`database exists`），否则就创建，这个条件就可以使用`if not exists`来表示，语法如下：

```sql
create database if not exists 数据库名;
```

例如创建一个`test`数据库：

```sql
create database if not exists test;
```

## 使用数据库

操作如下：

```sql
use 数据库名;
```

## 删除数据库

基本语法如下：

```sql
drop database 数据库名;
```

也可以指定简单的条件：如果删除的数据库存在，则删除，否则不处理并提示`database doesn't exist`（不指定条件时会报错`database doesn't exist`），这个条件就可以使用`if exists`来表示，语法如下：

```sql
drop database if exists 数据库名;
```

例如删除`test`数据库：

```sql
drop database if exists test;
```

!!! warning

    删除数据库是非常危险的操作，数据库一旦删除，就无法通过代码恢复

## MySQL中常用的数据类型

在MySQL中，数据类型分为三种：

1. 数值类型（整型和浮点型）
2. 字符串类型
3. 日期类型

每一种类型包含的具体类型如下表：

=== "数值类型"

    | 数据类型       | 大小               | 说明                                             | 对应Java包装类型                                    |
    | -------------- | ------------------ | ------------------------------------------------ | ----------------------------------------------- |
    | `BIT(M)`       | `M`指定位数，默认为1 | 二进制数，`M`范围从1到64，存储数值范围从0到$2^M - 1$   | 常用`Boolean`对应`BIT`，此时默认是1位，即只能存0和1 |
    | `TINYINT`      | 1字节              |                                                  | `Byte`                                            |
    | `SMALLINT`     | 2字节              |                                                  | `Short`                                           |
    | `INT`          | 4字节              |                                                  | `Integer`                                         |
    | `BIGINT`       | 8字节              |                                                  | `Long`                                            |
    | `FLOAT(M,D)`   | 4字节              | 单精度，`M`指定长度，`D`指定小数位数。会发生精度丢失 | `Float`                                           |
    | `DOUBLE(M,D)`  | 8字节              |                                                  | `Double`                                          |
    | `DECIMAL(M,D)` | `(M, D)`可以表示的最大值，例如`DECIMAL(5, 2)`最大值为999.99        | 双精度，`M`指定长度，`D`表示小数点位数。精确数值     | `BigDecimal`                                      |
    | `NUMERIC(M,D)` | `(M, D)`可以表示的最大值        | 和`DECIMAL`一样                                    | `BigDecimal`                                      |

=== "字符串类型"

    | 数据类型        | 大小           | 说明                   | 对应Java类型 |
    | --------------- | -------------- | ---------------------- | ------------ |
    | `VARCHAR(SIZE)` | 0-65,535字节   | 可变长度字符串         | `String`       |
    | `TEXT`          | 0-65,535字节   | 长文本数据             | `String`       |
    | `MEDIUMTEXT`    | 0-16777215字节 | 中等长度文本数据       | `String`       |
    | `BLOB`          | 0-65,535字节   | 二进制形式的长文本数据 | `byte[]`       |

    !!! note

        注意，`VARCHAR(SIZE)`中的`SIZE`单位为字符而不是字节，例如`varchar(5)`表示可以存储5个字符

=== "日期类型"

    | 数据类型    | 大小  | 说明                                             | 对应Java类型                       |
    | ----------- | ----- | ------------------------------------------------ | ---------------------------------- |
    | `DATETIME`  | 8字节 | 范围从1000到9999年，不会进行时区的检索及转换   | `java.util.Date`、`java.sql.Timestamp` |
    | `TIMESTAMP` | 4字节 | 范围从1970到2038年，自动检索当前时区并进行转换 | `java.util.Date`、`java.sql.Timestamp` |

## 显示数据库中的表

操作如下：

```sql
-- 需要先使用数据库
show tables;
```

## 查看表结构

操作如下：

```sql
desc 表名;
```

## 创建表

基本语法如下：

```sql
create table 表名(列名1 类型, 列名2 类型, ...);
```

可以在创建表时使用`comment`指定注释：

```sql
create table 表名(
    列名1 类型 comment '注释内容', 
    列名2 类型 comment '注释内容', 
    ...
);
```

例如创建一个`student`表：

```sql
create table student(
    id int comment '学生id',
    name varchar(20) comment '学生姓名',
    age int comment '学生年龄',
    gender varchar(10) comment '学生性别'
);
```

创建表时也可以指定简单的条件：不存在指定的表就创建，否则不创建（不指定条件时报错`Table '表名' already exists`），可以使用`if not exists`表示该条件，如下：

```sql
create table if not exists 表名(
    列名1 类型 comment '注释内容', 
    列名2 类型 comment '注释内容', 
    ...
);
```

## 删除表

基本语法如下：

```sql
drop table 表名;
```

也可以指定简单的条件：存在指定的表就删除，否则不删除（不指定条件时报错`Unknown table '数据库名.表名'`），可以使用`if exists`表示该条件，如下：

```sql
drop table if exists 表名;
```

可以删除多个表：

```sql
drop table if exists 表名1, 表名2, ...;
```

## 表中新增数据

基本语法如下：

```sql
insert into 表名 values('数据', '数据', '数据', ...);
-- 单列数据values可以用value代替
```

在这种写法下，MySQL会自动将数据插入到对应的列中

对于插入的数据类型来说，满足或者可以隐式类型转换到列类型，例如列类型为整型，数据类型可以为整型数据或者可以转换为整型的字符串（例如`'123'`，注意不可以是`123aa`等包含无法转换为数字的字符）

也可以指定插入的列：

```sql
insert into 表名 (列名1, 列名2, 列名3) values('数据', '数据', '数据', ...);
```

在这种写法下，MySQL数据对应的列是指定的列

例如针对下面的数据库：

```
+---------+-------------+------+-----+---------+-------+
| Field   | Type        | Null | Key | Default | Extra |
+---------+-------------+------+-----+---------+-------+
| id      | int         | YES  |     | NULL    |       |
| sn      | int         | YES  |     | NULL    |       |
| name    | varchar(20) | YES  |     | NULL    |       |
| qq_mail | varchar(20) | YES  |     | NULL    |       |
+---------+-------------+------+-----+---------+-------+
```

使用下面的代码插入数据：

```sql
-- 不指定列
insert into student values (1, 20210001, '张三', '123@qq.com');
-- 指定列
insert into student (id, name, sn, qq_mail) values (2, '李四', 20210002, '456@qq.com');
```

也可以一次插入指定多行数据：

```sql
insert into student values 
('数据', '数据', '数据'),
('数据', '数据', '数据'),
('数据', '数据', '数据');
```

## 表中查询数据

基本语法如下：

```sql
select 列名/表达式/通配符/聚合函数 from 表名;
```

以下面的表为例：

```
+---------+--------------+------+-----+---------+-------+
| Field   | Type         | Null | Key | Default | Extra |
+---------+--------------+------+-----+---------+-------+
| id      | int          | YES  |     | NULL    |       |
| name    | varchar(20)  | YES  |     | NULL    |       |
| chinese | decimal(3,1) | YES  |     | NULL    |       |
| math    | decimal(3,1) | YES  |     | NULL    |       |
| english | decimal(3,1) | YES  |     | NULL    |       |
+---------+--------------+------+-----+---------+-------+
```

插入以下数据：

```sql
insert into exam_result (id, name, chinese, math, english) values
      (1,'唐三藏', 67, 98, 56),
      (2,'孙悟空', 87.5, 78, 77),
      (3,'猪悟能', 88, 98.5, 90),
      (4,'曹孟德', 82, 84, 67),
      (5,'刘玄德', 55.5, 85, 45),
      (6,'孙权', 70, 73, 78.5),
      (7,'宋公明', 75, 65, 30);
```

### 全列查询

操作如下：

```sql
select * from exam_result;
```

结果如下：

```
+------+--------+---------+------+---------+
| id   | name   | chinese | math | english |
+------+--------+---------+------+---------+
|    1 | 唐三藏 |    67.0 | 98.0 |    56.0 |
|    2 | 孙悟空 |    87.5 | 78.0 |    77.0 |
|    3 | 猪悟能 |    88.0 | 98.5 |    90.0 |
|    4 | 曹孟德 |    82.0 | 84.0 |    67.0 |
|    5 | 刘玄德 |    55.5 | 85.0 |    45.0 |
|    6 | 孙权   |    70.0 | 73.0 |    78.5 |
|    7 | 宋公明 |    75.0 | 65.0 |    30.0 |
+------+--------+---------+------+---------+
```

### 指定列查询

例如：

```sql
select id, name from exam_result;
```

结果如下：

```
+------+--------+
| id   | name   |
+------+--------+
|    1 | 唐三藏 |
|    2 | 孙悟空 |
|    3 | 猪悟能 |
|    4 | 曹孟德 |
|    5 | 刘玄德 |
|    6 | 孙权   |
|    7 | 宋公明 |
+------+--------+
```

### 查询字段为表达式

例如：

```sql
select id, name, chinese + math + english from exam_result;
```

结果如下：

```
+------+--------+--------------------------+
| id   | name   | chinese + math + english |
+------+--------+--------------------------+
|    1 | 唐三藏 |                    221.0 |
|    2 | 孙悟空 |                    242.5 |
|    3 | 猪悟能 |                    276.5 |
|    4 | 曹孟德 |                    233.0 |
|    5 | 刘玄德 |                    185.5 |
|    6 | 孙权   |                    221.5 |
|    7 | 宋公明 |                    170.0 |
+------+--------+--------------------------+
```

### 别名

可以在查询时给列、表达式或者聚合函数指定别名，语法如下：

```sql
-- 使用as
select id as stu_id, name from exam_result;
-- 省略as
select id stu_id, name from exam_result;
```

结果如下：

```
+--------+--------+
| stu_id | name   |
+--------+--------+
|      1 | 唐三藏 |
|      2 | 孙悟空 |
|      3 | 猪悟能 |
|      4 | 曹孟德 |
|      5 | 刘玄德 |
|      6 | 孙权   |
|      7 | 宋公明 |
+--------+--------+
```

### 查询结果去重

