<script defer src="/javascripts/waline.min.js"></script>
<link rel="stylesheet" href="https://unpkg.com/@waline/client@v3/dist/waline.css" />
<link rel="stylesheet" href="/stylesheets/waline.min.css" />

# 接口自动化测试

## 接口测试概念

接口测试是测试系统组件间接口的一种测试。接口测试主要用于检测外部系统与系统之间以及内部各个子系统之间的交互点。测试的重点是要检查数据的交换，传递和控制管理过程，以及系统间的相互逻辑依赖关系等

简而言之，所谓接口测试就是通过测试不同情况下的入参与之相应的出参信息来判断接口是否符合或满足相应的功能性、安全性要求

## 接口测试重要性

比如测试用户注册功能，规定用户名为[6, 18]个字符，包含字母（区分大小写）、数字、下划线。首先功能测试时肯定会对用户名规则进行测试时，比如输入20个字符、输入特殊字符等，但这些可能只是在前端做了校验，后端可能没做校验，如果有人通过抓包绕过前端校验直接发送到后端怎么办呢？试想一下，如果用户名和密码未在后端做校验，而有人又绕过前端校验的话，那用户名和密码不就可以随便输了吗？如果是登录可能会通过SQL注入等手段来随意登录，甚至可以获取管理员权限，那这样不是很恐怖？

所以，接口测试的必要性就体现出来了：

- 可以发现很多在页面上操作发现不了的bug
- 检查系统的异常处理能力
- 检查系统的安全性、稳定性
- 前端随便变，接口测好了，后端不用变

## 如何执行接口测试

接口测试分两步走：通过接口设计用例 + 结合业务逻辑来设计用例

接口测试用例一般可以进行下面几个方面：

1. 通过性验证：接口可以通过输入参数得到正确的输出结果
2. 参数组合：将多个输入参数的不同取值进行系统性组合，以验证系统在各种参数配置下的行为和功能正确性的测试方法。
3. 接口安全：通过身份验证、权限控制、数据加密、输入验证等技术手段，保护API接口免受未授权访问、数据泄露、恶意攻击等安全威胁的综合防护体系
4. 异常验证：通过输入非法数据、边界值、空值等异常情况来验证系统的错误处理机制和容错能力，确保系统在异常情况下能够正确响应并保持稳定运行

## 接口自动化测试概念

接口自动化是通过对接口进行测试和模拟，以确保软件系统内部的各个组件能够正确地相互通信和交换数据。接口自动化测试可以显著提高测试效率和准确性。因为接口测试专注于测试系统内部的逻辑和数据传输，而不是像UI测试那样关注用户的操作和交互。同时，由于接口测试直接针对系统内部的结构和功能，可以更容易地发现和定位问题，减少测试成本和时间

## 接口自动化测试流程

接口自动化测试流程一般包含：

1. 需求分析：通过分析接口文档、业务需求和系统架构，明确接口的功能、输入输出参数、数据格式、业务逻辑和异常处理等测试要求，为制定测试策略和设计测试用例提供准确依据
2. 挑选自动化接口：根据接口的稳定性、重要性、复杂度、执行频率等因素，筛选出适合进行自动化测试的接口，以最大化自动化测试的投入产出比和测试覆盖率
3. 设计自动化测试用例：根据接口需求和测试策略，设计包含正常场景、边界值、异常情况等多种测试场景的用例，明确输入数据、预期结果和断言条件，为自动化脚本编写提供详细的测试规范
4. 搭建自动化测试环境：配置和部署包含测试框架、工具库、数据库、服务器等必要组件的完整测试基础设施，为自动化测试脚本的开发、执行和维护提供稳定可靠的运行平台
5. 设计自动化执行框架：构建一个统一的测试执行平台，包含测试用例管理、执行调度、结果收集、报告生成等核心模块，实现测试脚本的批量执行、并行处理、失败重试和结果统计，提高测试执行效率和可维护性
6. 编写代码：根据测试用例设计和自动化框架架构，使用编程语言实现具体的测试脚本，包括接口调用、数据处理、断言验证、异常处理等功能模块，将测试逻辑转化为可执行的自动化测试程序
7. 执行用例：运行已编写完成的自动化测试脚本，通过测试框架按照预定的执行策略和顺序调用测试用例，验证接口功能是否符合预期，并收集测试结果和日志信息
8. 生产测试报告：将测试执行过程中收集的测试结果、通过率、失败用例、错误日志、性能数据等信息进行汇总分析，使用工具（例如Allure）生成结构化的测试报告文档，为项目质量评估和决策提供数据支撑

## `requests`模块介绍与基本操作

### 模块介绍与简单测试

`requests`库是Python中最流行的HTTP客户端库，提供简洁优雅的API接口，用于发送HTTP请求、处理响应数据、管理会话和认证，是进行API测试和网络编程的首选工具

例如，使用`requests`模块请求百度：

```py
# 对百度发起请求
import requests

ret = requests.get("https://www.baidu.com")
print(ret) # 返回Response对象<Response [200]>
```

### `requests`发起请求

在`requests`中可以通过专用的请求方法发起请求，例如`GET`和`POST`请求：

1. `GET`请求：使用`requests.get(url, params=None, **kwargs)`
2. `POST`请求：使用`reqeusts.post(url, data=None, json=None, **kwargs)`

也可以使用通用方法`requests.request(method, url, **kwargs)`：

```py
ret = requests.request(url="http://www.baidu.com", method="get")
```

`request`方法可以传递下面的参数：

参数名 | 描述 |
| --- | --- |
| `url` | 请求的接口 |
| `headers` | 一个字典，包含要发送的HTTP头 |
| `cookies` | 一个字典、列表或者`RequestsCookieJar`对象，包含要发送的Cookie |
| `files` | 一个字典，包含要上传的文件 |
| `data` | 一个字典、列表或者字节串，包含要发送的请求体数据 | 
| `json` | 一个字典，将被转换为JSON格式并发送，此时`Content-Type`会被设置为`application/json` |
| `params` | 一个字典、列表或者字节串，将作为查询字符串附加到URL上 |
| `auth` | 一个元组，包含用户名和密码，用于HTTP认证 |
| `timeout` | 一个浮点数或元组，指定请求的超时时间 |
| `proxies` | 一个字典，包含代理服务器的信息 |
| `verify` | 一个布尔值或字符串，指定是否验证SSL证书 |

例如：

```py
# 设置参数可以通过传递字典
param = {
    "参数1": "值1",
    "参数2": "值2",
}
ret = requests.request(url="http://www.baidu.com", method="get", params=param)
# 对于请求头、JSON数据和表单数据都可以通过字典设置
```

这些方法返回的都是`Repsonse`对象，在该对象的中可以获取到以下的信息（假设`r`为`Repsonse`实例）：

| 属性/方法 | 描述 |
|-----------|------|
| `r.status_code` | 响应状态码 |
| `r.content` | 字节方式的响应体，会自动解码gzip和deflate压缩 |
| `r.headers` | 以字典对象存储服务器响应头，若键不存在则返回None |
| `r.json()` | Requests内置的JSON解析方法，将响应体解析为JSON格式（需要注意，如果返回内容不是JSON的使用该方法会抛出异常） |
| `r.url` | 获取实际请求的URL |
| `r.encoding` | 编码格式，根据响应头部的字符编码确定 |
| `r.cookies` | 获取服务器设置的Cookie |
| `r.raw` | 返回原始响应体，不进行任何处理 |
| `r.text` | 字符串方式的响应体，会自动根据响应头部的字符编码进行解码 |
| `r.raise_for_status()` | 失败请求(非200响应)抛出异常 |

例如：

```py
ret = requests.get("https://www.baidu.com") 
print(ret.text) # 可以打印非JSON的数据，例如HTML网页
print(ret.status_code) # 返回响应状态码
```

## 自动化框架`pytest`介绍与基本操作

