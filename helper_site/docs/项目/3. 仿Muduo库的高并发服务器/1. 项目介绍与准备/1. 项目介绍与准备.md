# 项目介绍与准备

## 项目介绍

在[关于Muduo库](https://www.help-doc.top/%E5%85%B6%E5%AE%83/%E5%85%B3%E4%BA%8EMuduo%E5%BA%93/%E5%85%B3%E4%BA%8EMuduo%E5%BA%93.html)文档中已经对Muduo进行了一个基本的介绍，但是为了更好得理解它的实现原理，本次项目将基于该网络库的实现思路自主实现一个高性能服务器，从底层去了解为什么Muduo库高效

在本次项目中，主要实现基于TCP协议的高性能服务器的服务端而不实现对应的客户端，另外还会基于一个高性能服务器的框架搭建一个基于HTTP协议的Web服务器

## 设计思想

实现的一个基于TCP的网络服务器实际上需要的就是两个功能：

1. 接收客户端的连接
2. 处理客户端发送的数据

在实现这两个功能中，有下面几种常见的思路：

!!! note

    此处只考虑使用多路转接的方式

1. **一个服务器进程有一个`epoll`，既进行监听套接字事件监听，也进行通信描述符事件监听，并同时进行数据处理**：这种思路实现方式很简单，不需要考虑线程安全或者进程间通信问题，但是缺点也很明显，如果有很多客户端连接时，会出现明显的性能瓶颈
2. **一个服务器进程有一个`epoll`，既进行监听套接字事件监听，也进行通信描述符事件监听，但是数据压入线程池等待处理**：这种思路和上一个思路最大的区别就是充分利用了多核CPU的资源，但是缺点就是在`epoll`对两种描述符进行监听，在高并发情况下，可能就绪的事件非常多，从而依旧会出现明显性能瓶颈
3. **一个服务器进程有一个`epoll`，但是这个`epoll`只对监听套接字进行事件监听，而一旦有一个客户端建立连接，就将其数据通信描述符交给对应线程的`epoll`进行监听，数据也交给该线程去处理**：这种思路就是将主Reactor模型（负责监听套接字监控和处理）和从Reactor模型（负责数据通信描述符监控和处理）进行分离，从而保证高效进行连接获取和数据处理
4. **一个服务器进程有一个`epoll`，但是这个`epoll`只对监听套接字进行事件监听，而一旦有一个客户端建立连接，就将其数据通信描述符交给对应线程的`epoll`进行监听，数据压入线程池等待处理**：这种方式与上一种方式比较类似，只是进一步将数据描述符的监听和数据处理分开，但是这种设计思路中线程的数量会比较多，CPU频繁切换导致效率就会不高

基于上面的四种情况分析，本次项目实现的思路就是第三种：一个服务器进程有一个`epoll`，但是这个`epoll`只对监听套接字进行事件监听，而一旦有一个客户端建立连接，就将其数据通信描述符交给对应线程的`epoll`进行监听，数据也交给该线程去处理。这种思路也被称为One Thread One Loop，既一个线程拥有一个时间监控。示意图如下：

<img src="1. 项目介绍与准备.assets\download.png">

## 项目模块介绍

了解了基本的设计思想之后，下面基于该思想设计本次项目的模块：

