<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=canonical href=https://www.help-doc.top/Java/multi-thread/multi-thread.html><link rel=prev href=../string-constant-pool/string-constant-pool.html><link rel=next href=../javaio/javaio.html><link rel=icon href=../../images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.12"><title>Java多线程 - 柯懒的知识库</title><link rel=stylesheet href=../../assets/stylesheets/main.2afb09e1.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><link rel=stylesheet href=../../css/timeline.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-9XWRGNRRSY"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-9XWRGNRRSY",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-9XWRGNRRSY",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script><link rel=stylesheet href=../../stylesheets/colors.min.css><link rel=stylesheet href=../../stylesheets/theme2.min.css media="screen and (max-width: 1199px)"><link rel=stylesheet href=../../stylesheets/theme2.min.css media="screen and (min-width: 1200px)" id=theme2-desktop><link rel=stylesheet href=../../stylesheets/theme1.min.css media="screen and (min-width: 1200px)" id=theme1-desktop><link rel=stylesheet href=../../stylesheets/print.min.css><link rel=stylesheet href=../../stylesheets/font-dongguanti.min.css id=font-dongguanti><link rel=stylesheet href=../../stylesheets/font-oppoti.min.css id=font-oppoti disabled><link rel=stylesheet href=../../stylesheets/font-jiangchengti.min.css id=font-jiangchengti disabled><link rel=stylesheet href=../../stylesheets/font-lxgw.min.css id=font-lxgw disabled><link rel=stylesheet href=../../stylesheets/code-font-dejavu-sans-mono.min.css id=code-font-dejavu-sans-mono><link rel=stylesheet href=../../stylesheets/code-font-zsft-hk.min.css id=code-font-zsft-hk disabled><link rel=stylesheet href=https://unpkg.com/@waline/client@v3/dist/waline.css><link rel=stylesheet href=../../stylesheets/waline.min.css><script src=https://cdn.jsdelivr.net/npm/mermaid@11.5.0/dist/mermaid.min.js></script><script src=../../javascripts/start.min.js></script><script type=module src=../../javascripts/waline.min.js></script> <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../assets/javascripts/glightbox.min.js"></script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=white data-md-color-accent=cyan> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#java class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=页眉> <a href=../../index.html title=柯懒的知识库 class="md-header__button md-logo" aria-label=柯懒的知识库 data-md-component=logo> <img src=../../assets/logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> 柯懒的知识库 </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Java多线程 </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=white data-md-color-accent=cyan aria-label type=radio name=__palette id=__palette_1> </form> <!-- 头像元素 - 直接在HTML中定义 --> <div class=header-avatar> <img src=../../author/作者.assets/20250206-200653.jpg alt=头像> <div class=avatar-dropdown> <p><strong>柯懒不是柯南</strong></p> <a href=../../author/contact/contact.html class=avatar-dropdown-item>吵醒柯懒</a> <div class=avatar-dropdown-divider></div> <a href=../../author/about/about.html class=avatar-dropdown-item>柯懒自传</a> <div class=avatar-dropdown-divider></div> <a href=https://github.com/H0308 class=avatar-dropdown-item>柯懒的零食库</a> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=查找> <button type=reset class="md-search__icon md-icon" title=清空当前内容 aria-label=清空当前内容 tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 正在初始化搜索引擎 </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> </nav> </header> <!-- 独立的切换按钮 --> <div class=toolbar-toggle-btn id=toolbarToggleBtn onclick=toggleToolbar()> <div class=toggle-icon> <svg class=toggle-arrow-icon viewbox="0 0 1024 1024" version=1.1 xmlns=http://www.w3.org/2000/svg width=16 height=16> <path d="M346.538667 1024L170.666667 853.333333l341.333333-341.333333-341.333333-341.333333 175.872-170.666667L853.333333 512z" fill=currentColor></path> </svg> </div> </div> <!-- 右侧固定功能条 - 独立于内容区 --> <div class=floating-toolbar id=floatingToolbar> <!-- 字体切换功能 --> <div class="toolbar-item font-switcher"> <div class=toolbar-icon> <svg class=font-icon viewbox="0 0 1024 1024" version=1.1 xmlns=http://www.w3.org/2000/svg width=20 height=20> <path d="M913.408 1024l-66.56 0q-29.696 0-51.2-5.12t-36.864-15.872-26.112-27.136-19.968-37.888q-15.36-38.912-28.16-70.656t-22.016-55.296q-11.264-26.624-20.48-49.152l-254.976 0q-7.168 23.552-17.408 51.2-8.192 23.552-21.504 56.832t-30.72 72.192q-20.48 46.08-47.104 63.488t-60.416 17.408l-70.656 0q-45.056 0-60.928-19.968t2.56-68.096q18.432-46.08 43.008-108.544t52.224-132.608 57.344-143.872 57.344-144.384q65.536-164.864 137.216-343.04 7.168-17.408 18.432-31.744 10.24-11.264 27.136-21.504t42.496-10.24q26.624 0 43.52 10.752t28.16 24.064q12.288 15.36 19.456 33.792 72.704 180.224 138.24 345.088 27.648 70.656 57.344 143.872t56.832 142.336 51.2 129.536 41.472 104.448q14.336 34.816 4.096 62.464t-43.008 27.648zM616.448 634.88l-97.28-347.136-1.024 0-108.544 347.136 206.848 0z" fill=currentColor></path> </svg> </div> <div class=toolbar-label>内容字体</div> <div class=font-dropdown-toolbar> <div class=font-current-toolbar onclick=toggleFontDropdownToolbar()> <span class=current-font-name-toolbar>东观体</span> <svg class=dropdown-arrow-icon viewbox="0 0 1024 1024" version=1.1 xmlns=http://www.w3.org/2000/svg width=12 height=12> <path d="M878.592 250.88q29.696 0 48.128 11.264t24.576 29.696 0 41.472-26.624 45.568q-82.944 92.16-159.744 180.224t-148.48 164.864q-19.456 20.48-45.568 31.744t-53.76 11.776-53.248-8.704-43.008-28.672q-39.936-44.032-82.944-90.112l-88.064-92.16q-43.008-46.08-85.504-90.624t-79.36-86.528q-17.408-19.456-22.528-40.448t1.024-38.4 23.552-28.672 45.056-11.264q35.84 0 98.816-0.512t137.728-0.512l153.6 0 150.528 0 125.952 0 79.872 0z" fill=currentColor></path> </svg> </div> <div class=font-options-toolbar> <div class=font-option-toolbar data-font=dongguanti onclick="selectFontToolbar('dongguanti')">上图东观体 </div> <div class=font-option-toolbar data-font=oppoti onclick="selectFontToolbar('oppoti')">OPPO Sans </div> <div class=font-option-toolbar data-font=jiangchengti onclick="selectFontToolbar('jiangchengti')"> 江城黑体</div> <div class=font-option-toolbar data-font=lxgw onclick="selectFontToolbar('lxgw')">霞鹜臻楷</div> </div> </div> </div> <!-- 代码字体切换功能 --> <div class="toolbar-item code-font-switcher"> <div class=toolbar-icon> <svg t=1753672111433 class="icon code-font-icon" viewbox="0 0 1024 1024" version=1.1 xmlns=http://www.w3.org/2000/svg p-id=5148 width=20 height=20> <path d="M941.709938 0H82.290062A82.290062 82.290062 0 0 0 0 82.290062v859.419876A82.290062 82.290062 0 0 0 82.290062 1022.53923h859.419876A82.290062 82.290062 0 0 0 1022.53923 941.709938V82.290062A82.290062 82.290062 0 0 0 941.709938 0zM188.439372 553.631954a40.901569 40.901569 0 0 1-29.215406-70.116975L292.154066 351.558726 159.223966 218.628626a40.901569 40.901569 0 0 1 58.430813-57.94389l160.197813 162.145507a40.901569 40.901569 0 0 1 0 57.943889l-160.197813 160.684736a40.901569 40.901569 0 0 1-29.215407 12.173086z m443.587257 0H405.120304a40.901569 40.901569 0 0 1 0-82.290061H633.000476a40.901569 40.901569 0 0 1 0 82.290061z" fill=currentColor p-id=5149></path> </svg> </div> <div class=toolbar-label>代码字体</div> <div class=code-font-dropdown-toolbar> <div class=code-font-current-toolbar onclick=toggleCodeFontDropdownToolbar()> <span class=current-code-font-name-toolbar>DejaVu Sans Mono</span> <svg class=dropdown-arrow-icon viewbox="0 0 1024 1024" version=1.1 xmlns=http://www.w3.org/2000/svg width=12 height=12> <path d="M878.592 250.88q29.696 0 48.128 11.264t24.576 29.696 0 41.472-26.624 45.568q-82.944 92.16-159.744 180.224t-148.48 164.864q-19.456 20.48-45.568 31.744t-53.76 11.776-53.248-8.704-43.008-28.672q-39.936-44.032-82.944-90.112l-88.064-92.16q-43.008-46.08-85.504-90.624t-79.36-86.528q-17.408-19.456-22.528-40.448t1.024-38.4 23.552-28.672 45.056-11.264q35.84 0 98.816-0.512t137.728-0.512l153.6 0 150.528 0 125.952 0 79.872 0z" fill=currentColor></path> </svg> </div> <div class=code-font-options-toolbar> <div class=code-font-option-toolbar data-code-font=dejavu onclick="selectCodeFontToolbar('dejavu')"> DejaVu Sans Mono</div> <div class=code-font-option-toolbar data-code-font=zsft onclick="selectCodeFontToolbar('zsft')"> JetBrains Mono</div> </div> </div> </div> <!-- 主题切换功能 --> <div class="toolbar-item theme-switcher" onclick=switchTheme()> <div class=toolbar-icon> <svg class=theme-icon viewbox="0 0 1024 1024" version=1.1 xmlns=http://www.w3.org/2000/svg width=20 height=20> <path d="M876.572788 522.301623c-1.886977 12.375865-9.657964 30.331819-35.880185 45.48903-56.489572 32.697703-150.21828 83.990926-174.010149 96.958262-13.143345 24.431435-66.067718 122.221646-98.141204 178.503487-16.117073 28.124548-36.055171 34.041304-50.030463 34.041304-0.031722 0-0.031722 0-0.031722 0-14.613836 0-29.1806-6.460132-43.234687-19.218714-47.183626-42.643216-125.994576-117.105115-146.013515-136.083351-27.757181-4.732791-138.338718-23.743774-200.584388-35.752272-17.924231-3.533476-32.649608-14.07046-40.372499-29.084409-5.78782-11.256368-10.281157-30.05962 1.471514-55.658647 26.989701-59.047838 74.126254-157.557432 85.957721-182.196599-3.437286-27.117614-16.996093-135.060045-23.760147-198.905142-1.886977-17.460674 3.901867-35.096333 15.829524-48.351218 12.791327-14.278191 30.667463-21.48943 49.854455-19.426445 63.669088 6.332219 173.259042 19.426445 200.584388 22.705118 24.335245-11.879562 121.085776-58.936297 180.133613-86.34146 9.91379-4.573155 19.85828-6.92369 29.596062-6.92369 28.748764 0 52.172243 20.642133 58.328453 51.421136 12.599969 62.997799 30.93864 166.70272 35.639708 193.484689 18.851347 19.682271 91.953272 96.031147 135.060045 143.07151C872.72004 487.125473 879.307062 504.71406 876.572788 522.301623L876.572788 522.301623zM825.375755 499.085876C776.017604 445.314205 687.245791 352.977193 686.365748 352.017332c-2.942005-3.069919-4.956895-6.971785-5.676279-11.208273-0.207731-1.215688-22.193465-127.001509-36.551474-198.936865-0.799202-3.917216-4.285606-16.836457-16.196891-16.836457-3.453658 0-7.30743 1.006933-11.464099 2.942005-67.282383 31.179117-183.955662 88.180342-185.170327 88.771813-3.693112 1.790786-7.850805 2.558265-11.975752 2.01489-1.295506-0.224104-133.63765-16.165168-205.988468-23.424502-0.079818 0-0.207731 0-0.287549 0-7.30743 0-11.128455 2.89391-13.319353 5.40408-3.677762 4.124947-5.644557 9.91379-5.068436 15.110139 7.674796 72.623018 24.255427 202.934922 24.463158 204.325595 0.511653 4.109598-0.159636 8.266267-1.966795 11.960403-0.591471 1.215688-57.657164 120.04712-88.339977 187.201589-3.565199 7.754614-4.41352 14.214746-2.350534 18.131963 1.935072 3.725858 6.588045 5.820566 10.360975 6.53995 70.719668 13.718443 204.644867 36.519752 206.036563 36.727483 4.189416 0.671289 8.058536 2.686179 11.112082 5.580089 1.006933 0.87902 96.414887 91.281983 150.090367 139.889027 8.314363 7.563256 13.143345 8.106632 14.437827 8.106632 3.485381 0 8.314363-4.621251 12.727882-12.391215 36.343743-63.828724 100.011808-181.988868 100.636025-183.155437 1.983167-3.64604 5.004991-6.667863 8.650007-8.650007 1.134847-0.671289 114.418936-62.373583 178.6314-99.516528 8.698103-5.036713 14.278191-10.568706 14.94948-14.854313C834.681702 511.845481 831.49922 505.800811 825.375755 499.085876L825.375755 499.085876zM935.333076 935.670256c-4.157693 4.157693-9.689686 6.299473-15.141862 6.299473-5.548366 0-11.048637-2.142803-15.238053-6.299473l-171.915441-171.915441c-8.362458-8.394181-8.362458-21.98471 0-30.426987 8.394181-8.394181 21.98471-8.394181 30.379914 0l171.915441 171.915441C943.727257 913.684522 943.727257 927.275052 935.333076 935.670256L935.333076 935.670256z" fill=currentColor></path> </svg> </div> <div class=toolbar-label>主题切换</div> </div> <!-- 返回顶部功能 --> <div class="toolbar-item back-to-top" onclick=scrollToTop()> <div class=toolbar-icon> <svg class=back-to-top-icon viewbox="0 0 1024 1024" xmlns=http://www.w3.org/2000/svg> <path d="M882.688 624.128l-336.896-583.68c-15.872-27.136-54.784-27.136-70.656 0L138.24 624.128c-15.872 27.136 4.096 61.44 35.328 61.44H317.44c22.528 0 40.96 18.432 40.96 40.96v239.616c0 22.528 18.432 40.96 40.96 40.96h223.232c22.528 0 40.96-18.432 40.96-40.96v-239.616c0-22.528 18.432-40.96 40.96-40.96h143.872c30.208 0 50.176-34.304 34.304-61.44z"> </path> </svg> </div> <div class=toolbar-label>返回顶部</div> </div> </div> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=标签 data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../index.html class=md-tabs__link> 主页 </a> </li> <li class=md-tabs__item> <a href=../../intro/intro.html class=md-tabs__link> 网站介绍 </a> </li> <li class=md-tabs__item> <a href=../../timeline/timeline.html class=md-tabs__link> 网站时间线 </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../../c-lang/index.html class=md-tabs__link> 编程语言 </a> </li> <li class=md-tabs__item> <a href=../../data-structure/time-space-complexity/time-space-complexity.html class=md-tabs__link> 数据结构与算法 </a> </li> <li class=md-tabs__item> <a href=../../Linux/options-commands/options-commands.html class=md-tabs__link> Linux </a> </li> <li class=md-tabs__item> <a href=../../html-css/html/html.html class=md-tabs__link> 前端 </a> </li> <li class=md-tabs__item> <a href=../../MySQL/JDBC/JDBC-basic/JDBC-basic.html class=md-tabs__link> MySQL </a> </li> <li class=md-tabs__item> <a href=../../JavaEE/Spring/springmvc-basic/springmvc-basic.html class=md-tabs__link> JavaEE应用开发 </a> </li> <li class=md-tabs__item> <a href=../../other/shell/shell.html class=md-tabs__link> 扩展知识 </a> </li> <li class=md-tabs__item> <a href=../../tooltips/vscode-snippets/vscode-snippets.html class=md-tabs__link> 工具帮助 </a> </li> <li class=md-tabs__item> <a href=../../projects/boost-searching-engine/boost-searching-engine.html class=md-tabs__link> 项目 </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=导航栏 data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../index.html title=柯懒的知识库 class="md-nav__button md-logo" aria-label=柯懒的知识库 data-md-component=logo> <img src=../../assets/logo.png alt=logo> </a> 柯懒的知识库 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../index.html class=md-nav__link> <span class=md-ellipsis> 主页 </span> </a> </li> <li class=md-nav__item> <a href=../../intro/intro.html class=md-nav__link> <span class=md-ellipsis> 网站介绍 </span> </a> </li> <li class=md-nav__item> <a href=../../timeline/timeline.html class=md-nav__link> <span class=md-ellipsis> 网站时间线 </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4 checked> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex> <span class=md-ellipsis> 编程语言 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=true> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> 编程语言 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../c-lang/index.html class=md-nav__link> <span class=md-ellipsis> C语言 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../cpp/index.html class=md-nav__link> <span class=md-ellipsis> C++ </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_3 checked> <label class=md-nav__link for=__nav_4_3 id=__nav_4_3_label tabindex=0> <span class=md-ellipsis> Java </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_3_label aria-expanded=true> <label class=md-nav__title for=__nav_4_3> <span class="md-nav__icon md-icon"></span> Java </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../java-basic/java-basic.html class=md-nav__link> <span class=md-ellipsis> Java基础知识 </span> </a> </li> <li class=md-nav__item> <a href=../java-array/java-array.html class=md-nav__link> <span class=md-ellipsis> Java数组类型 </span> </a> </li> <li class=md-nav__item> <a href=../obj-oriented-and-method/obj-oriented-and-method.html class=md-nav__link> <span class=md-ellipsis> Java面向对象与方法 </span> </a> </li> <li class=md-nav__item> <a href=../obj-oriented-and-encapsulation/obj-oriented-and-encapsulation.html class=md-nav__link> <span class=md-ellipsis> Java面向对象与封装 </span> </a> </li> <li class=md-nav__item> <a href=../obj-oriented-and-inheritance/obj-oriented-and-inheritance.html class=md-nav__link> <span class=md-ellipsis> Java面向对象与继承 </span> </a> </li> <li class=md-nav__item> <a href=../obj-oriented-and-interface/obj-oriented-and-interface.html class=md-nav__link> <span class=md-ellipsis> Java面向对象与接口 </span> </a> </li> <li class=md-nav__item> <a href=../obj-oriented-and-polymorphic/obj-oriented-and-polymorphic.html class=md-nav__link> <span class=md-ellipsis> Java面向对象与多态 </span> </a> </li> <li class=md-nav__item> <a href=../permission-modifier-final-internal-class/permission-modifier-final-internal-class.html class=md-nav__link> <span class=md-ellipsis> Java面向对象与权限修饰符、final、代码块及内部类 </span> </a> </li> <li class=md-nav__item> <a href=../obj-oriented-and-exception/obj-oriented-and-exception.html class=md-nav__link> <span class=md-ellipsis> Java异常类 </span> </a> </li> <li class=md-nav__item> <a href=../object-class-method-interface/object-class-method-interface.html class=md-nav__link> <span class=md-ellipsis> Java中的Object类和常用方法、经典接口 </span> </a> </li> <li class=md-nav__item> <a href=../string-stringbuilder/string-stringbuilder.html class=md-nav__link> <span class=md-ellipsis> Java.lang中的String类和StringBuilder类介绍和常用方法 </span> </a> </li> <li class=md-nav__item> <a href=../common-class-packed-class/common-class-packed-class.html class=md-nav__link> <span class=md-ellipsis> Java中的常用类及包装类 </span> </a> </li> <li class=md-nav__item> <a href=../generic/generic.html class=md-nav__link> <span class=md-ellipsis> Java中的泛型 </span> </a> </li> <li class=md-nav__item> <a href=../collection/collection.html class=md-nav__link> <span class=md-ellipsis> Java单列集合 </span> </a> </li> <li class=md-nav__item> <a href=../map/map.html class=md-nav__link> <span class=md-ellipsis> Java双列集合 </span> </a> </li> <li class=md-nav__item> <a href=../string-constant-pool/string-constant-pool.html class=md-nav__link> <span class=md-ellipsis> 了解Java字符串常量池 </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Java多线程 </span> <span class="md-nav__icon md-icon"></span> </label> <a href=multi-thread.html class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Java多线程 </span> </a> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#_1 class=md-nav__link> <span class=md-ellipsis> 线程与进程基本介绍 </span> </a> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> <span class=md-ellipsis> 并发和并行基本介绍 </span> </a> </li> <li class=md-nav__item> <a href=#cpu class=md-nav__link> <span class=md-ellipsis> CPU调度基本介绍 </span> </a> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> <span class=md-ellipsis> 主线程基本介绍 </span> </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> <span class=md-ellipsis> 创建线程对象与相关方法 </span> </a> <nav class=md-nav aria-label=创建线程对象与相关方法> <ul class=md-nav__list> <li class=md-nav__item> <a href=#thread class=md-nav__link> <span class=md-ellipsis> （一）继承Thread类创建线程对象 </span> </a> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> <span class=md-ellipsis> 多线程在内存中运行的原理 </span> </a> </li> <li class=md-nav__item> <a href=#thread_1 class=md-nav__link> <span class=md-ellipsis> Thread类中常用的方法 </span> </a> </li> <li class=md-nav__item> <a href=#thread_2 class=md-nav__link> <span class=md-ellipsis> Thread类中关于线程优先级的方法 </span> </a> </li> <li class=md-nav__item> <a href=#thread_3 class=md-nav__link> <span class=md-ellipsis> 守护线程与Thread类中关于守护线程的方法 </span> </a> </li> <li class=md-nav__item> <a href=#thread_4 class=md-nav__link> <span class=md-ellipsis> 礼让线程与Thread类中关于礼让线程的方法 </span> </a> </li> <li class=md-nav__item> <a href=#thread_5 class=md-nav__link> <span class=md-ellipsis> 插入线程与Thread类中关于插入线程的方法 </span> </a> </li> <li class=md-nav__item> <a href=#runnable class=md-nav__link> <span class=md-ellipsis> （二）实现Runnable接口创建线程对象 </span> </a> </li> <li class=md-nav__item> <a href=#_6 class=md-nav__link> <span class=md-ellipsis> 使用匿名内部类创建线程对象 </span> </a> </li> <li class=md-nav__item> <a href=#orrunnable class=md-nav__link> <span class=md-ellipsis> 使用继承or实现Runnable接口创建线程对象 </span> </a> </li> <li class=md-nav__item> <a href=#callable class=md-nav__link> <span class=md-ellipsis> （三）实现Callable接口创建线程对象 </span> </a> </li> <li class=md-nav__item> <a href=#_7 class=md-nav__link> <span class=md-ellipsis> （四）使用线程池创建线程对象 </span> </a> <nav class=md-nav aria-label=（四）使用线程池创建线程对象> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_8 class=md-nav__link> <span class=md-ellipsis> 线程池引入 </span> </a> </li> <li class=md-nav__item> <a href=#_9 class=md-nav__link> <span class=md-ellipsis> 创建线程池 </span> </a> </li> <li class=md-nav__item> <a href=#_10 class=md-nav__link> <span class=md-ellipsis> 执行线程池任务 </span> </a> </li> <li class=md-nav__item> <a href=#_11 class=md-nav__link> <span class=md-ellipsis> 关闭线程池 </span> </a> </li> <li class=md-nav__item> <a href=#_12 class=md-nav__link> <span class=md-ellipsis> 基本使用实例 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_13 class=md-nav__link> <span class=md-ellipsis> 线程安全 </span> </a> <nav class=md-nav aria-label=线程安全> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_14 class=md-nav__link> <span class=md-ellipsis> 线程安全引入 </span> </a> </li> <li class=md-nav__item> <a href=#_15 class=md-nav__link> <span class=md-ellipsis> 解决线程安全 </span> </a> <nav class=md-nav aria-label=解决线程安全> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_16 class=md-nav__link> <span class=md-ellipsis> 同步代码块解决线程不安全 </span> </a> </li> <li class=md-nav__item> <a href=#_17 class=md-nav__link> <span class=md-ellipsis> 同步方法解决线程不安全 </span> </a> </li> <li class=md-nav__item> <a href=#lock class=md-nav__link> <span class=md-ellipsis> 使用lock锁解决线程不安全 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_18 class=md-nav__link> <span class=md-ellipsis> 死锁 </span> </a> </li> <li class=md-nav__item> <a href=#_19 class=md-nav__link> <span class=md-ellipsis> 线程状态 </span> </a> <nav class=md-nav aria-label=线程状态> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_20 class=md-nav__link> <span class=md-ellipsis> 线程状态常用方法 </span> </a> </li> <li class=md-nav__item> <a href=#_21 class=md-nav__link> <span class=md-ellipsis> 线程状态常用方法使用实例（线程间的通信） </span> </a> <nav class=md-nav aria-label=线程状态常用方法使用实例（线程间的通信）> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_22 class=md-nav__link> <span class=md-ellipsis> 实例实现（使用同步代码块） </span> </a> </li> <li class=md-nav__item> <a href=#_23 class=md-nav__link> <span class=md-ellipsis> 实例实现（使用同步方法） </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_24 class=md-nav__link> <span class=md-ellipsis> 定时器（了解） </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../javaio/javaio.html class=md-nav__link> <span class=md-ellipsis> Java的IO流 </span> </a> </li> <li class=md-nav__item> <a href=../net-reg-design-lombok/net-reg-design-lombok.html class=md-nav__link> <span class=md-ellipsis> Java网络编程、正则表达式、设计模式与Lombok </span> </a> </li> <li class=md-nav__item> <a href=../new-jdk8-and-after/new-jdk8-and-after.html class=md-nav__link> <span class=md-ellipsis> Java中的JDK8及后续的重要新特性 </span> </a> </li> <li class=md-nav__item> <a href=../junit-reflect-annotation-enum/junit-reflect-annotation-enum.html class=md-nav__link> <span class=md-ellipsis> Java中的Junit、类加载时机与机制、反射、注解及枚举 </span> </a> </li> <li class=md-nav__item> <a href=../json-in-java/json-in-java.html class=md-nav__link> <span class=md-ellipsis> （补充）JSON在后端的应用 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../python/python-basic/python-basic.html class=md-nav__link> <span class=md-ellipsis> Python </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../data-structure/time-space-complexity/time-space-complexity.html class=md-nav__link> <span class=md-ellipsis> 数据结构与算法 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../Linux/options-commands/options-commands.html class=md-nav__link> <span class=md-ellipsis> Linux </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../html-css/html/html.html class=md-nav__link> <span class=md-ellipsis> 前端 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../MySQL/JDBC/JDBC-basic/JDBC-basic.html class=md-nav__link> <span class=md-ellipsis> MySQL </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../JavaEE/Spring/springmvc-basic/springmvc-basic.html class=md-nav__link> <span class=md-ellipsis> JavaEE应用开发 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../other/shell/shell.html class=md-nav__link> <span class=md-ellipsis> 扩展知识 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../tooltips/vscode-snippets/vscode-snippets.html class=md-nav__link> <span class=md-ellipsis> 工具帮助 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../projects/boost-searching-engine/boost-searching-engine.html class=md-nav__link> <span class=md-ellipsis> 项目 </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#_1 class=md-nav__link> <span class=md-ellipsis> 线程与进程基本介绍 </span> </a> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> <span class=md-ellipsis> 并发和并行基本介绍 </span> </a> </li> <li class=md-nav__item> <a href=#cpu class=md-nav__link> <span class=md-ellipsis> CPU调度基本介绍 </span> </a> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> <span class=md-ellipsis> 主线程基本介绍 </span> </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> <span class=md-ellipsis> 创建线程对象与相关方法 </span> </a> <nav class=md-nav aria-label=创建线程对象与相关方法> <ul class=md-nav__list> <li class=md-nav__item> <a href=#thread class=md-nav__link> <span class=md-ellipsis> （一）继承Thread类创建线程对象 </span> </a> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> <span class=md-ellipsis> 多线程在内存中运行的原理 </span> </a> </li> <li class=md-nav__item> <a href=#thread_1 class=md-nav__link> <span class=md-ellipsis> Thread类中常用的方法 </span> </a> </li> <li class=md-nav__item> <a href=#thread_2 class=md-nav__link> <span class=md-ellipsis> Thread类中关于线程优先级的方法 </span> </a> </li> <li class=md-nav__item> <a href=#thread_3 class=md-nav__link> <span class=md-ellipsis> 守护线程与Thread类中关于守护线程的方法 </span> </a> </li> <li class=md-nav__item> <a href=#thread_4 class=md-nav__link> <span class=md-ellipsis> 礼让线程与Thread类中关于礼让线程的方法 </span> </a> </li> <li class=md-nav__item> <a href=#thread_5 class=md-nav__link> <span class=md-ellipsis> 插入线程与Thread类中关于插入线程的方法 </span> </a> </li> <li class=md-nav__item> <a href=#runnable class=md-nav__link> <span class=md-ellipsis> （二）实现Runnable接口创建线程对象 </span> </a> </li> <li class=md-nav__item> <a href=#_6 class=md-nav__link> <span class=md-ellipsis> 使用匿名内部类创建线程对象 </span> </a> </li> <li class=md-nav__item> <a href=#orrunnable class=md-nav__link> <span class=md-ellipsis> 使用继承or实现Runnable接口创建线程对象 </span> </a> </li> <li class=md-nav__item> <a href=#callable class=md-nav__link> <span class=md-ellipsis> （三）实现Callable接口创建线程对象 </span> </a> </li> <li class=md-nav__item> <a href=#_7 class=md-nav__link> <span class=md-ellipsis> （四）使用线程池创建线程对象 </span> </a> <nav class=md-nav aria-label=（四）使用线程池创建线程对象> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_8 class=md-nav__link> <span class=md-ellipsis> 线程池引入 </span> </a> </li> <li class=md-nav__item> <a href=#_9 class=md-nav__link> <span class=md-ellipsis> 创建线程池 </span> </a> </li> <li class=md-nav__item> <a href=#_10 class=md-nav__link> <span class=md-ellipsis> 执行线程池任务 </span> </a> </li> <li class=md-nav__item> <a href=#_11 class=md-nav__link> <span class=md-ellipsis> 关闭线程池 </span> </a> </li> <li class=md-nav__item> <a href=#_12 class=md-nav__link> <span class=md-ellipsis> 基本使用实例 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_13 class=md-nav__link> <span class=md-ellipsis> 线程安全 </span> </a> <nav class=md-nav aria-label=线程安全> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_14 class=md-nav__link> <span class=md-ellipsis> 线程安全引入 </span> </a> </li> <li class=md-nav__item> <a href=#_15 class=md-nav__link> <span class=md-ellipsis> 解决线程安全 </span> </a> <nav class=md-nav aria-label=解决线程安全> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_16 class=md-nav__link> <span class=md-ellipsis> 同步代码块解决线程不安全 </span> </a> </li> <li class=md-nav__item> <a href=#_17 class=md-nav__link> <span class=md-ellipsis> 同步方法解决线程不安全 </span> </a> </li> <li class=md-nav__item> <a href=#lock class=md-nav__link> <span class=md-ellipsis> 使用lock锁解决线程不安全 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_18 class=md-nav__link> <span class=md-ellipsis> 死锁 </span> </a> </li> <li class=md-nav__item> <a href=#_19 class=md-nav__link> <span class=md-ellipsis> 线程状态 </span> </a> <nav class=md-nav aria-label=线程状态> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_20 class=md-nav__link> <span class=md-ellipsis> 线程状态常用方法 </span> </a> </li> <li class=md-nav__item> <a href=#_21 class=md-nav__link> <span class=md-ellipsis> 线程状态常用方法使用实例（线程间的通信） </span> </a> <nav class=md-nav aria-label=线程状态常用方法使用实例（线程间的通信）> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_22 class=md-nav__link> <span class=md-ellipsis> 实例实现（使用同步代码块） </span> </a> </li> <li class=md-nav__item> <a href=#_23 class=md-nav__link> <span class=md-ellipsis> 实例实现（使用同步方法） </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_24 class=md-nav__link> <span class=md-ellipsis> 定时器（了解） </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=java>Java多线程<a class=headerlink href=#java title="Permanent link">&para;</a></h1> <div style="margin-top: -30px; font-size: 0.75em; opacity: 0.7;"> <p><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10h-2a8 8 0 0 1-8 8 8 8 0 0 1-8-8 8 8 0 0 1 8-8zm6.78 1a.7.7 0 0 0-.48.2l-1.22 1.21 2.5 2.5L20.8 5.7c.26-.26.26-.7 0-.95L19.25 3.2c-.13-.13-.3-.2-.47-.2m-2.41 2.12L9 12.5V15h2.5l7.37-7.38z"/></svg></span> 约 5654 个字 <span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M392.8 1.2c-17-4.9-34.7 5-39.6 22l-128 448c-4.9 17 5 34.7 22 39.6s34.7-5 39.6-22l128-448c4.9-17-5-34.7-22-39.6m80.6 120.1c-12.5 12.5-12.5 32.8 0 45.3l89.3 89.4-89.4 89.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l112-112c12.5-12.5 12.5-32.8 0-45.3l-112-112c-12.5-12.5-32.8-12.5-45.3 0zm-306.7 0c-12.5-12.5-32.8-12.5-45.3 0l-112 112c-12.5 12.5-12.5 32.8 0 45.3l112 112c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256l89.4-89.4c12.5-12.5 12.5-32.8 0-45.3"/></svg></span> 811 行代码 <span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 17H7V3h14m0-2H7a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2M3 5H1v16a2 2 0 0 0 2 2h16v-2H3m12.96-10.71-2.75 3.54-1.96-2.36L8.5 15h11z"/></svg></span> 6 张图片 <span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 20c4.42 0 8-3.58 8-8s-3.58-8-8-8-8 3.58-8 8 3.58 8 8 8m0-18c5.5 0 10 4.5 10 10s-4.5 10-10 10C6.47 22 2 17.5 2 12S6.5 2 12 2m.5 11H11V7h1.5v4.26l3.7-2.13.75 1.3z"/></svg></span> 预计阅读时间 29 分钟</p> </div> <div class="admonition note"> <p class=admonition-title>Note</p> <p>本章中的概念部分都只是为了后面的程序执行更好理解，更深层的概念移步到<a href=https://www.help-doc.top/Linux/process-basic/process-basic.html>Linux进程部分</a></p> </div> <h2 id=_1>线程与进程基本介绍<a class=headerlink href=#_1 title="Permanent link">&para;</a></h2> <p>进程：在内存中运行的程序实例，一般一个程序代表一个进程</p> <p>线程：进程中最小的执行单元，一般线程负责进程中程序的运行，一个线程至少存在一个线程，也可以有多个线程，当存在多个线程时，一般称为多线程程序</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>可以简单理解为：当一个程序加载到内存中后就会开启一个进程，当程序需要执行某一个功能时就会开辟一个线程，该线程就是程序与CPU交流的通道，一个功能对应着一个线程，一个线程对应着一个通道</p> </div> <h2 id=_2>并发和并行基本介绍<a class=headerlink href=#_2 title="Permanent link">&para;</a></h2> <p>并行：在同一个时刻，多个CPU（多核CPU）同时执行指令任务</p> <p>并发：在同一个时刻，一个CPU执行多个指令任务</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>在CPU是单核时，CPU看似在同一时刻执行多个任务，实际上是CPU在执行任务中进行的高速切换，因为速度快所以人很难感知到任务执行的先后顺序</p> <p>现在CPU基本上都是多核，可以理解为多个CPU，所以可以同一时间处理多个任务，每一个CPU管一个任务，但是依旧存在着高速切换，只是频率相对于单核CPU会变小，所以现在的CPU在执行指令时一般都是并行和并发同时存在</p> </div> <h2 id=cpu>CPU调度基本介绍<a class=headerlink href=#cpu title="Permanent link">&para;</a></h2> <p>CPU调用一般分为两种：</p> <ol> <li>分时调度：让所有线程轮流获取到CPU的调度权，并且相对平均分配每个线程占用的CPU时间片</li> <li>抢占式调度：多个线程轮流抢占CPU的使用权（哪个线程抢到了CPU的使用权，哪个线程先执行），一般都是优先级高的线程抢到的概率大，但不代表使用权一定属于优先级高的线程</li> </ol> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Java程序都是抢占式调用</p> </div> <h2 id=_3>主线程基本介绍<a class=headerlink href=#_3 title="Permanent link">&para;</a></h2> <p>主线程：CPU和内存之间专门为Java中的<code>main</code>函数服务开辟的线程</p> <h2 id=_4>创建线程对象与相关方法<a class=headerlink href=#_4 title="Permanent link">&para;</a></h2> <p>在Java中，创建线程对象一共有两种方式：</p> <ol> <li>普通类继承<code>Thread</code>类，重写<code>Thread</code>中的<code>run</code>方法</li> <li>普通类实现<code>Runnable</code>接口，重写接口中的<code>run</code>方法</li> </ol> <h3 id=thread>（一）继承<code>Thread</code>类创建线程对象<a class=headerlink href=#thread title="Permanent link">&para;</a></h3> <p>继承<code>Thread</code>类后重写<code>Thread</code>中的<code>run</code>方法，该方法用于线程中执行的任务，例如循环等。创建完自定义线程类后就可以通过自定义类创建一个线程对象，使用该对象调用<code>start()</code>方法启动线程，例如：</p> <div class="language-java highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>Java</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-1><span class=c1>// 自定义线程类</span>
</span><span id=__span-0-2><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Thread01</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>Thread</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-0-3><span class=w>    </span><span class=nd>@Override</span>
</span><span id=__span-0-4><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>run</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-0-5><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>10</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-0-6><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;Thread01...&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>i</span><span class=p>);</span>
</span><span id=__span-0-7><span class=w>        </span><span class=p>}</span>
</span><span id=__span-0-8><span class=w>    </span><span class=p>}</span>
</span><span id=__span-0-9><span class=p>}</span>
</span><span id=__span-0-10>
</span><span id=__span-0-11><span class=c1>// 主线程</span>
</span><span id=__span-0-12><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Test</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-0-13><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-0-14><span class=w>        </span><span class=c1>// 创建自定义线程类对象</span>
</span><span id=__span-0-15><span class=w>        </span><span class=n>Thread01</span><span class=w> </span><span class=n>t1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Thread01</span><span class=p>();</span>
</span><span id=__span-0-16><span class=w>        </span><span class=c1>// 调用start方法启动线程</span>
</span><span id=__span-0-17><span class=w>        </span><span class=n>t1</span><span class=p>.</span><span class=na>start</span><span class=p>();</span>
</span><span id=__span-0-18>
</span><span id=__span-0-19><span class=w>        </span><span class=c1>// 在主线程中执行其他任务</span>
</span><span id=__span-0-20><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>10</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-0-21><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;main...&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>i</span><span class=p>);</span>
</span><span id=__span-0-22><span class=w>        </span><span class=p>}</span>
</span><span id=__span-0-23><span class=w>    </span><span class=p>}</span>
</span><span id=__span-0-24><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <p>因为Java程序都是抢占式调用，所以会出现交替执行的情况，也会出现主线程先执行完，再执行自定义线程的任务</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>需要注意，不要对同一个线程对象多次调用<code>start</code>方法，也不要显式调用<code>run</code>方法，直接调用<code>run</code>方法就不会被认为是线程启动执行任务</p> </div> <h3 id=_5>多线程在内存中运行的原理<a class=headerlink href=#_5 title="Permanent link">&para;</a></h3> <p>在Java程序中，当存在多个线程时，对于主线程来说是一个栈空间，而其余线程相当于其他的栈空间，如下图所示：</p> <p><a class=glightbox href="13. Java多线程.assets\image.png" data-type=image data-width=100% data-height=auto data-desc-position=bottom><img src="13. Java多线程.assets\image.png"></a></p> <p>两个线程相互抢占使用权，但是因为<code>main</code>函数有更大的概率抢到，所以可能出现主线程任务先执行完再执行自定义线程任务</p> <h3 id=thread_1><code>Thread</code>类中常用的方法<a class=headerlink href=#thread_1 title="Permanent link">&para;</a></h3> <ol> <li><code>void start()</code>方法：启动进程，JVM会自动调用对应线程的<code>run</code>方法</li> <li><code>void run()</code>方法：设置线程中的任务，该方法是<code>Thread</code>类实现了<code>Runnable</code>接口后重写的方法</li> <li><code>String getName()</code>方法：获取调用对象的线程名称，默认情况下线程名称组成为：<code>Thread+编号</code></li> <li><code>void setName(String name)</code>方法：设置调用对象的线程名称</li> <li><code>static Thread currentThread()</code>：获取当前已经获取到CPU使用权的线程</li> <li><code>static void sleep(long millis)</code>：设置线程睡眠，参数表示睡眠毫秒数</li> </ol> <div class="admonition note"> <p class=admonition-title>Note</p> <p>需要注意，<code>Thread</code>中的<code>sleep</code>方法会抛出异常，如果在自定义线程类中使用<code>sleep</code>方法时，不可以使用<code>throws</code>处理异常，只能使用<code>try...catch</code>，但是如果在主线程则可以直接使用</p> </div> <p>基本使用实例：</p> <div class="language-java highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>Java</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-1-1><span class=c1>// 自定义线程</span>
</span><span id=__span-1-2><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Thread01</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>Thread</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-1-3><span class=w>    </span><span class=nd>@Override</span>
</span><span id=__span-1-4><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>run</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-1-5><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>10</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-1-6><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>getName</span><span class=p>()</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&quot;...&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>i</span><span class=p>);</span>
</span><span id=__span-1-7><span class=w>        </span><span class=p>}</span>
</span><span id=__span-1-8><span class=w>    </span><span class=p>}</span>
</span><span id=__span-1-9><span class=p>}</span>
</span><span id=__span-1-10>
</span><span id=__span-1-11><span class=c1>// 主线程</span>
</span><span id=__span-1-12><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Test</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-1-13><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>InterruptedException</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-1-14><span class=w>        </span><span class=c1>// 创建自定义线程类对象</span>
</span><span id=__span-1-15><span class=w>        </span><span class=n>Thread01</span><span class=w> </span><span class=n>t1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Thread01</span><span class=p>();</span>
</span><span id=__span-1-16><span class=w>        </span><span class=c1>// 调用start方法启动线程</span>
</span><span id=__span-1-17><span class=w>        </span><span class=n>t1</span><span class=p>.</span><span class=na>start</span><span class=p>();</span>
</span><span id=__span-1-18>
</span><span id=__span-1-19><span class=w>        </span><span class=c1>// 在主线程中执行其他任务</span>
</span><span id=__span-1-20><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>10</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-1-21><span class=w>            </span><span class=n>Thread</span><span class=p>.</span><span class=na>sleep</span><span class=p>(</span><span class=mi>1000L</span><span class=p>);</span>
</span><span id=__span-1-22><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>Thread01</span><span class=p>.</span><span class=na>currentThread</span><span class=p>().</span><span class=na>getName</span><span class=p>()</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&quot;...&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>i</span><span class=p>);</span>
</span><span id=__span-1-23><span class=w>        </span><span class=p>}</span>
</span><span id=__span-1-24><span class=w>    </span><span class=p>}</span>
</span><span id=__span-1-25><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <h3 id=thread_2><code>Thread</code>类中关于线程优先级的方法<a class=headerlink href=#thread_2 title="Permanent link">&para;</a></h3> <ol> <li><code>void setPriority(int newPriority)</code>：设置调用对象的线程优先级，线程优先级越高，抢到CPU使用权的概率越大，但是概率大不代表一定可以抢到。Java中线程优先级有10个等级，其中1表示最小优先级，10表示最大优先级，默认优先级为5</li> <li><code>int getPriority()</code>：获取调用对象的线程优先级</li> </ol> <p>基本使用示例：</p> <div class="language-java highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>Java</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-2-1><span class=c1>// 自定义线程类</span>
</span><span id=__span-2-2><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Thread01</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>Thread</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-2-3><span class=w>    </span><span class=nd>@Override</span>
</span><span id=__span-2-4><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>run</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-2-5><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>10</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-2-6><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>getName</span><span class=p>()</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&quot;...&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>i</span><span class=p>);</span>
</span><span id=__span-2-7><span class=w>        </span><span class=p>}</span>
</span><span id=__span-2-8><span class=w>    </span><span class=p>}</span>
</span><span id=__span-2-9><span class=p>}</span>
</span><span id=__span-2-10>
</span><span id=__span-2-11><span class=c1>// 主线程</span>
</span><span id=__span-2-12><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Test</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-2-13><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>InterruptedException</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-2-14><span class=w>        </span><span class=c1>// 创建自定义线程类对象</span>
</span><span id=__span-2-15><span class=w>        </span><span class=n>Thread01</span><span class=w> </span><span class=n>t1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Thread01</span><span class=p>();</span>
</span><span id=__span-2-16><span class=w>        </span><span class=n>Thread01</span><span class=w> </span><span class=n>t2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Thread01</span><span class=p>();</span>
</span><span id=__span-2-17><span class=w>        </span><span class=c1>// 设置/获取线程优先级</span>
</span><span id=__span-2-18><span class=w>        </span><span class=n>t1</span><span class=p>.</span><span class=na>setPriority</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span><span id=__span-2-19><span class=w>        </span><span class=n>t2</span><span class=p>.</span><span class=na>setPriority</span><span class=p>(</span><span class=mi>10</span><span class=p>);</span>
</span><span id=__span-2-20><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;t1.getPriority() = &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>t1</span><span class=p>.</span><span class=na>getPriority</span><span class=p>());</span>
</span><span id=__span-2-21><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;t2.getPriority() = &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>t2</span><span class=p>.</span><span class=na>getPriority</span><span class=p>());</span>
</span><span id=__span-2-22><span class=w>        </span><span class=c1>// 调用start方法启动线程</span>
</span><span id=__span-2-23><span class=w>        </span><span class=n>t1</span><span class=p>.</span><span class=na>start</span><span class=p>();</span>
</span><span id=__span-2-24><span class=w>        </span><span class=n>t2</span><span class=p>.</span><span class=na>start</span><span class=p>();</span>
</span><span id=__span-2-25><span class=w>    </span><span class=p>}</span>
</span><span id=__span-2-26><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <h3 id=thread_3>守护线程与<code>Thread</code>类中关于守护线程的方法<a class=headerlink href=#thread_3 title="Permanent link">&para;</a></h3> <p>守护进程：守护线程表示当前线程的任务会随着所有非守护线程结束而结束，但是在非守护线程结束时，守护线程一般不会是立即结束，因为在非守护线程结束时需要与守护线程进行结束信号的通信，这段时间中守护线程依旧在执行</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>需要注意，当出现一个守护线程，多个非守护线程时，守护线程会等到所有非守护线程结束才会结束</p> </div> <p>在Java中，可以使用<code>void setDaemon(boolean on)</code>将调用对象所在的线程设置为守护线程或者取消设置守护线程，参数取值只有两种：<code>true</code>（开启守护线程）和<code>false</code>（关闭守护线程）</p> <p>基本使用实例：</p> <div class="language-java highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>Java</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-3-1><span class=c1>// 自定义线程</span>
</span><span id=__span-3-2><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Thread01</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>Thread</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-3><span class=w>    </span><span class=nd>@Override</span>
</span><span id=__span-3-4><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>run</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-5><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>100</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-6>
</span><span id=__span-3-7><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>getName</span><span class=p>()</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&quot;...&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>i</span><span class=p>);</span>
</span><span id=__span-3-8><span class=w>        </span><span class=p>}</span>
</span><span id=__span-3-9><span class=w>    </span><span class=p>}</span>
</span><span id=__span-3-10><span class=p>}</span>
</span><span id=__span-3-11>
</span><span id=__span-3-12><span class=c1>// 主线程</span>
</span><span id=__span-3-13><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Test</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-14><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>InterruptedException</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-15><span class=w>        </span><span class=c1>// 创建自定义线程类对象</span>
</span><span id=__span-3-16><span class=w>        </span><span class=n>Thread01</span><span class=w> </span><span class=n>t1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Thread01</span><span class=p>();</span>
</span><span id=__span-3-17><span class=w>        </span><span class=n>Thread01</span><span class=w> </span><span class=n>t2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Thread01</span><span class=p>();</span>
</span><span id=__span-3-18>
</span><span id=__span-3-19><span class=w>        </span><span class=c1>// 设置t1进程为守护进程</span>
</span><span id=__span-3-20><span class=w>        </span><span class=n>t1</span><span class=p>.</span><span class=na>setDaemon</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span>
</span><span id=__span-3-21><span class=w>        </span><span class=c1>// 调用start方法启动线程</span>
</span><span id=__span-3-22><span class=w>        </span><span class=n>t1</span><span class=p>.</span><span class=na>start</span><span class=p>();</span>
</span><span id=__span-3-23><span class=w>        </span><span class=n>t2</span><span class=p>.</span><span class=na>start</span><span class=p>();</span>
</span><span id=__span-3-24>
</span><span id=__span-3-25><span class=w>        </span><span class=c1>// 在主线程中执行其他任务</span>
</span><span id=__span-3-26><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>10</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-27><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>Thread01</span><span class=p>.</span><span class=na>currentThread</span><span class=p>().</span><span class=na>getName</span><span class=p>()</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&quot;...&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>i</span><span class=p>);</span>
</span><span id=__span-3-28><span class=w>        </span><span class=p>}</span>
</span><span id=__span-3-29><span class=w>    </span><span class=p>}</span>
</span><span id=__span-3-30><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <h3 id=thread_4>礼让线程与<code>Thread</code>类中关于礼让线程的方法<a class=headerlink href=#thread_4 title="Permanent link">&para;</a></h3> <p>礼让线程：默认情况下Java的线程对CPU使用权是抢占式，而礼让线程是为了让正在抢夺使用权的线程尽可能相对平衡（不是绝对平衡），从而达到二者交替执行</p> <p>在Java中，设置礼让线程的方法为：<code>static void yield()</code></p> <p>基本使用实例：</p> <div class="language-java highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>Java</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-4-1><span class=c1>// 自定义线程</span>
</span><span id=__span-4-2><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Thread01</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>Thread</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-4-3><span class=w>    </span><span class=nd>@Override</span>
</span><span id=__span-4-4><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>run</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-4-5><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>10</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-4-6><span class=w>            </span><span class=c1>// 设置礼让线程</span>
</span><span id=__span-4-7><span class=w>            </span><span class=n>Thread</span><span class=p>.</span><span class=na>yield</span><span class=p>();</span>
</span><span id=__span-4-8><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>getName</span><span class=p>()</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&quot;...&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>i</span><span class=p>);</span>
</span><span id=__span-4-9><span class=w>        </span><span class=p>}</span>
</span><span id=__span-4-10><span class=w>    </span><span class=p>}</span>
</span><span id=__span-4-11><span class=p>}</span>
</span><span id=__span-4-12>
</span><span id=__span-4-13><span class=c1>// 主线程</span>
</span><span id=__span-4-14><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Test</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-4-15><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>InterruptedException</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-4-16><span class=w>        </span><span class=c1>// 创建自定义线程类对象</span>
</span><span id=__span-4-17><span class=w>        </span><span class=n>Thread01</span><span class=w> </span><span class=n>t1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Thread01</span><span class=p>();</span>
</span><span id=__span-4-18><span class=w>        </span><span class=n>Thread01</span><span class=w> </span><span class=n>t2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Thread01</span><span class=p>();</span>
</span><span id=__span-4-19><span class=w>        </span><span class=c1>// 调用start方法启动线程</span>
</span><span id=__span-4-20><span class=w>        </span><span class=n>t1</span><span class=p>.</span><span class=na>start</span><span class=p>();</span>
</span><span id=__span-4-21><span class=w>        </span><span class=n>t2</span><span class=p>.</span><span class=na>start</span><span class=p>();</span>
</span><span id=__span-4-22><span class=w>    </span><span class=p>}</span>
</span><span id=__span-4-23><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <h3 id=thread_5>插入线程与<code>Thread</code>类中关于插入线程的方法<a class=headerlink href=#thread_5 title="Permanent link">&para;</a></h3> <p>插入线程：让调用对象所在线程尽可能优先执行完，再执行其他进程</p> <p>在Java中对应插入线程的方法为：<code>void join()</code></p> <p>基本使用实例：</p> <div class="language-java highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>Java</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-5-1><span class=c1>// 自定义线程</span>
</span><span id=__span-5-2><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Thread01</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>Thread</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-5-3><span class=w>    </span><span class=nd>@Override</span>
</span><span id=__span-5-4><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>run</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-5-5><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>10</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-5-6><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>getName</span><span class=p>()</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&quot;...&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>i</span><span class=p>);</span>
</span><span id=__span-5-7><span class=w>        </span><span class=p>}</span>
</span><span id=__span-5-8><span class=w>    </span><span class=p>}</span>
</span><span id=__span-5-9><span class=p>}</span>
</span><span id=__span-5-10>
</span><span id=__span-5-11><span class=c1>// 主线程</span>
</span><span id=__span-5-12><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Test</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-5-13><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>InterruptedException</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-5-14><span class=w>        </span><span class=c1>// 创建自定义线程类对象</span>
</span><span id=__span-5-15><span class=w>        </span><span class=n>Thread01</span><span class=w> </span><span class=n>t1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Thread01</span><span class=p>();</span>
</span><span id=__span-5-16><span class=w>        </span><span class=n>Thread01</span><span class=w> </span><span class=n>t2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Thread01</span><span class=p>();</span>
</span><span id=__span-5-17>
</span><span id=__span-5-18><span class=w>        </span><span class=c1>// 调用start方法启动线程</span>
</span><span id=__span-5-19><span class=w>        </span><span class=n>t1</span><span class=p>.</span><span class=na>start</span><span class=p>();</span>
</span><span id=__span-5-20><span class=w>        </span><span class=c1>// 阻塞当前线程，等待t1线程执行完毕</span>
</span><span id=__span-5-21><span class=w>        </span><span class=n>t1</span><span class=p>.</span><span class=na>join</span><span class=p>();</span>
</span><span id=__span-5-22>
</span><span id=__span-5-23><span class=w>        </span><span class=c1>// 在主线程中执行其他任务</span>
</span><span id=__span-5-24><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>10</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-5-25><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>Thread01</span><span class=p>.</span><span class=na>currentThread</span><span class=p>().</span><span class=na>getName</span><span class=p>()</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&quot;...&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>i</span><span class=p>);</span>
</span><span id=__span-5-26><span class=w>        </span><span class=p>}</span>
</span><span id=__span-5-27><span class=w>    </span><span class=p>}</span>
</span><span id=__span-5-28><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <h3 id=runnable>（二）实现<code>Runnable</code>接口创建线程对象<a class=headerlink href=#runnable title="Permanent link">&para;</a></h3> <p>本方法创建线程对象与继承<code>Thread</code>方式类似，但因为<code>Runnable</code>是接口，所以必须重写对应的<code>run</code>方法，使用实现类创建对象（目前不是线程对象），将该对象使用<code>Thread</code>中的构造方法：<code>Thread(Runnable target)</code>创建线程对象</p> <div class="language-java highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>Java</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-6-1><span class=c1>// 自定义线程</span>
</span><span id=__span-6-2><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Runnable01</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>Runnable</span><span class=p>{</span>
</span><span id=__span-6-3><span class=w>    </span><span class=nd>@Override</span>
</span><span id=__span-6-4><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>run</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-6-5><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>10</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-6-6><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>Thread</span><span class=p>.</span><span class=na>currentThread</span><span class=p>().</span><span class=na>getName</span><span class=p>()</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&quot;...&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>i</span><span class=p>);</span>
</span><span id=__span-6-7><span class=w>        </span><span class=p>}</span>
</span><span id=__span-6-8><span class=w>    </span><span class=p>}</span>
</span><span id=__span-6-9><span class=p>}</span>
</span><span id=__span-6-10>
</span><span id=__span-6-11><span class=c1>// 主线程</span>
</span><span id=__span-6-12><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Test01</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-6-13><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-6-14><span class=w>        </span><span class=c1>// 创建实现类对象</span>
</span><span id=__span-6-15><span class=w>        </span><span class=n>Runnable01</span><span class=w> </span><span class=n>r</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Runnable01</span><span class=p>();</span>
</span><span id=__span-6-16><span class=w>        </span><span class=c1>// 实现类通过Thread构造函数创建线程类对象</span>
</span><span id=__span-6-17><span class=w>        </span><span class=n>Thread</span><span class=w> </span><span class=n>t1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Thread</span><span class=p>(</span><span class=n>r</span><span class=p>);</span>
</span><span id=__span-6-18>
</span><span id=__span-6-19><span class=w>        </span><span class=n>t1</span><span class=p>.</span><span class=na>start</span><span class=p>();</span>
</span><span id=__span-6-20>
</span><span id=__span-6-21><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>10</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-6-22><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>Thread</span><span class=p>.</span><span class=na>currentThread</span><span class=p>().</span><span class=na>getName</span><span class=p>()</span><span class=o>+</span><span class=s>&quot;...&quot;</span><span class=o>+</span><span class=n>i</span><span class=p>);</span>
</span><span id=__span-6-23><span class=w>        </span><span class=p>}</span>
</span><span id=__span-6-24><span class=w>    </span><span class=p>}</span>
</span><span id=__span-6-25><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <p>如果想为线程设置名字，可以使用<code>void setName(String name)</code>方法，也可以使用构造函数，例如：</p> <div class="language-java highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>Java</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-7-1><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Test01</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-7-2><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-7-3><span class=w>        </span><span class=c1>// 创建实现类对象</span>
</span><span id=__span-7-4><span class=w>        </span><span class=n>Thread02</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Thread02</span><span class=p>();</span>
</span><span id=__span-7-5><span class=w>        </span><span class=c1>// 实现类通过Thread构造函数创建线程类对象</span>
</span><span id=__span-7-6><span class=w>        </span><span class=n>Thread</span><span class=w> </span><span class=n>t1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Thread</span><span class=p>(</span><span class=n>t</span><span class=p>,</span><span class=w> </span><span class=s>&quot;线程1&quot;</span><span class=p>);</span>
</span><span id=__span-7-7>
</span><span id=__span-7-8><span class=w>        </span><span class=n>t1</span><span class=p>.</span><span class=na>start</span><span class=p>();</span>
</span><span id=__span-7-9>
</span><span id=__span-7-10><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>10</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-7-11><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>Thread</span><span class=p>.</span><span class=na>currentThread</span><span class=p>().</span><span class=na>getName</span><span class=p>()</span><span class=o>+</span><span class=s>&quot;...&quot;</span><span class=o>+</span><span class=n>i</span><span class=p>);</span>
</span><span id=__span-7-12><span class=w>        </span><span class=p>}</span>
</span><span id=__span-7-13><span class=w>    </span><span class=p>}</span>
</span><span id=__span-7-14><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <h3 id=_6>使用匿名内部类创建线程对象<a class=headerlink href=#_6 title="Permanent link">&para;</a></h3> <p>基本使用方式如下：</p> <div class="language-java highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>Java</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-8-1><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Test02</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-2><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-3><span class=w>        </span><span class=c1>// 使用对象名调用start方法</span>
</span><span id=__span-8-4><span class=w>        </span><span class=n>Runnable</span><span class=w> </span><span class=n>r</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Runnable</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-5><span class=w>            </span><span class=nd>@Override</span>
</span><span id=__span-8-6><span class=w>            </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>run</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-7><span class=w>                </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>10</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-8><span class=w>                    </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>Thread</span><span class=p>.</span><span class=na>currentThread</span><span class=p>().</span><span class=na>getName</span><span class=p>()</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&quot;...&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>i</span><span class=p>);</span>
</span><span id=__span-8-9><span class=w>                </span><span class=p>}</span>
</span><span id=__span-8-10><span class=w>            </span><span class=p>}</span>
</span><span id=__span-8-11><span class=w>        </span><span class=p>};</span>
</span><span id=__span-8-12>
</span><span id=__span-8-13><span class=w>        </span><span class=n>Thread</span><span class=w> </span><span class=n>t1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Thread</span><span class=p>(</span><span class=n>r</span><span class=p>);</span>
</span><span id=__span-8-14><span class=w>        </span><span class=n>t1</span><span class=p>.</span><span class=na>start</span><span class=p>();</span>
</span><span id=__span-8-15>
</span><span id=__span-8-16><span class=w>        </span><span class=c1>// 使用匿名内部类</span>
</span><span id=__span-8-17><span class=w>        </span><span class=k>new</span><span class=w> </span><span class=n>Thread</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>Runnable</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-18><span class=w>            </span><span class=nd>@Override</span>
</span><span id=__span-8-19><span class=w>            </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>run</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-20><span class=w>                </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>10</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-21><span class=w>                    </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>Thread</span><span class=p>.</span><span class=na>currentThread</span><span class=p>().</span><span class=na>getName</span><span class=p>()</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&quot;...&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>i</span><span class=p>);</span>
</span><span id=__span-8-22><span class=w>                </span><span class=p>}</span>
</span><span id=__span-8-23><span class=w>            </span><span class=p>}</span>
</span><span id=__span-8-24><span class=w>        </span><span class=p>}).</span><span class=na>start</span><span class=p>();</span>
</span><span id=__span-8-25>
</span><span id=__span-8-26><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>10</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-27><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>Thread</span><span class=p>.</span><span class=na>currentThread</span><span class=p>().</span><span class=na>getName</span><span class=p>()</span><span class=o>+</span><span class=s>&quot;...&quot;</span><span class=o>+</span><span class=n>i</span><span class=p>);</span>
</span><span id=__span-8-28><span class=w>        </span><span class=p>}</span>
</span><span id=__span-8-29><span class=w>    </span><span class=p>}</span>
</span><span id=__span-8-30><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <h3 id=orrunnable>使用继承or实现<code>Runnable</code>接口创建线程对象<a class=headerlink href=#orrunnable title="Permanent link">&para;</a></h3> <p>如果当前自定义线程类已经继承了其他类，则选择通过实现<code>Runnable</code>接口创建线程对象，否则使用继承创建线程对象，因为Java不支持多继承</p> <p>如果需要多个线程对象使用共享同一个资源时，可以考虑使用实现<code>Runnable</code>接口的方式创建线程对象</p> <h3 id=callable>（三）实现<code>Callable</code>接口创建线程对象<a class=headerlink href=#callable title="Permanent link">&para;</a></h3> <p><code>Callable&lt;T&gt;</code>接口类似于<code>Runnable</code>接口，都可以用于创建线程对象。</p> <p>在该接口中，有一个<code>call()</code>方法，与<code>Runnable</code>接口中的<code>run()</code>类似，但是<code>call()</code>方法存在返回值，该返回值有<code>Callable&lt;T&gt;</code>接口的泛型<code>&lt;T&gt;</code>决定，并且<code>call()</code>方法在接口<code>Callable&lt;T&gt;</code>中抛出了异常，则实现类重写的<code>call()</code>方法也可以抛异常</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>需要注意，Java中的泛型只能写引用类型，具体会在<a href=#>Java集合</a>章节介绍</p> </div> <p>当需要接收<code>call()</code>方法的返回值时，需要使用到<code>FutureTask&lt;T&gt;</code>（实现<code>Future&lt;T&gt;</code>接口）中的<code>get()</code>方法（重写<code>Future&lt;T&gt;</code>接口中的<code>get()</code>方法），该方法返回值也是泛型<code>&lt;T&gt;</code></p> <p>创建线程时，使用<code>Thread</code>中的<code>Thread(Runnable target)</code> ，因为<code>FutureTask&lt;T&gt;</code>也是<code>Runnable</code>的实现类</p> <p>基本使用如下：</p> <div class="language-java highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>Java</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-9-1><span class=c1>// 自定义线程类</span>
</span><span id=__span-9-2><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Thread08</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>Callable</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-9-3><span class=w>    </span><span class=nd>@Override</span>
</span><span id=__span-9-4><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>call</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-9-5><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;重写Callable接口中的call方法&quot;</span><span class=p>);</span>
</span><span id=__span-9-6><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=s>&quot;重写Callable接口中的call方法&quot;</span><span class=p>;</span>
</span><span id=__span-9-7><span class=w>    </span><span class=p>}</span>
</span><span id=__span-9-8><span class=p>}</span>
</span><span id=__span-9-9>
</span><span id=__span-9-10><span class=c1>// 主线程</span>
</span><span id=__span-9-11><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Test06</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-9-12><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>ExecutionException</span><span class=p>,</span><span class=w> </span><span class=n>InterruptedException</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-9-13><span class=w>        </span><span class=n>Thread08</span><span class=w> </span><span class=n>thread08</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Thread08</span><span class=p>();</span>
</span><span id=__span-9-14><span class=w>        </span><span class=n>FutureTask</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=n>stringFutureTask</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>FutureTask</span><span class=o>&lt;&gt;</span><span class=p>(</span><span class=n>thread08</span><span class=p>);</span>
</span><span id=__span-9-15><span class=w>        </span><span class=n>Thread</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Thread</span><span class=p>(</span><span class=n>stringFutureTask</span><span class=p>);</span>
</span><span id=__span-9-16><span class=w>        </span><span class=n>t</span><span class=p>.</span><span class=na>start</span><span class=p>();</span>
</span><span id=__span-9-17>
</span><span id=__span-9-18><span class=w>        </span><span class=c1>// 打印call方法返回值</span>
</span><span id=__span-9-19><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>stringFutureTask</span><span class=p>.</span><span class=na>get</span><span class=p>());</span>
</span><span id=__span-9-20><span class=w>    </span><span class=p>}</span>
</span><span id=__span-9-21><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <h3 id=_7>（四）使用线程池创建线程对象<a class=headerlink href=#_7 title="Permanent link">&para;</a></h3> <h4 id=_8>线程池引入<a class=headerlink href=#_8 title="Permanent link">&para;</a></h4> <p>之所以需要线程池，是因为前面每一次使用线程时就需要创建一次线程对象，多次创建对象会有时间和空间的消耗，为了尽量减少这种消耗，可以提前创建好线程对象，使用时在其中获取即可，而创建好的线程对象所在位置就称为线程池</p> <p>使用线程池中的对象时遵循特点：当线程池有足够的线程对象使用时，可以正常获取到线程对象使用，使用完后归还给线程池，而当线程池中没有线程对象可用，则新线程进入等待，直到有新线程对象在线程池中并处于空闲状态</p> <h4 id=_9>创建线程池<a class=headerlink href=#_9 title="Permanent link">&para;</a></h4> <p>使用工具类Executors中的静态方法：<code>static ExecutorService newFixedThreadPool(int nThreads)</code>获取线程池对象，返回值<code>ExecutorService</code>就是管理线程池的对象，参数代表线程池中的线程对象个数</p> <h4 id=_10>执行线程池任务<a class=headerlink href=#_10 title="Permanent link">&para;</a></h4> <p>使用<code>ExecutorService</code>中的两个方法可以提交线程任务，使用<code>ExecutorService</code>对象调用：</p> <ol> <li>提交<code>Runnable</code>线程任务：<code>Future&lt;?&gt; submit(Runnable task)</code></li> <li>提交<code>Callable</code>线程任务：<code>Future&lt;T&gt; submit(Callable&lt;T&gt; task)</code></li> </ol> <p>上面的两个<code>submit</code>方法只有「提交<code>Callable</code>线程任务」的方法有返回值，该返回值由<code>FutureTask&lt;T&gt;</code>类对象接收</p> <p>使用<code>FutureTask&lt;T&gt;</code>中的<code>get</code>方法可以接收「提交<code>Callable</code>线程任务」的方法的返回值</p> <h4 id=_11>关闭线程池<a class=headerlink href=#_11 title="Permanent link">&para;</a></h4> <p>使用<code>ExecutorService</code>中的<code>void shutdown()</code>方法，可以依次关闭线程池，如果有任务执行，会等待所有任务执行完毕后关闭线程池，不再接收任何线程任务</p> <h4 id=_12>基本使用实例<a class=headerlink href=#_12 title="Permanent link">&para;</a></h4> <div class="language-java highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>Java</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-10-1><span class=c1>// 主线程</span>
</span><span id=__span-10-2><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Test07</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-10-3><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>ExecutionException</span><span class=p>,</span><span class=w> </span><span class=n>InterruptedException</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-10-4><span class=w>        </span><span class=c1>// Callable接口实现类对象</span>
</span><span id=__span-10-5><span class=w>        </span><span class=n>Thread08</span><span class=w> </span><span class=n>t1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Thread08</span><span class=p>();</span>
</span><span id=__span-10-6><span class=w>        </span><span class=c1>// Runnable接口实现类对象</span>
</span><span id=__span-10-7><span class=w>        </span><span class=n>Thread07</span><span class=w> </span><span class=n>t2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Thread07</span><span class=p>();</span>
</span><span id=__span-10-8>
</span><span id=__span-10-9><span class=w>        </span><span class=c1>// 创建线程池</span>
</span><span id=__span-10-10><span class=w>        </span><span class=n>ExecutorService</span><span class=w> </span><span class=n>executorService</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Executors</span><span class=p>.</span><span class=na>newFixedThreadPool</span><span class=p>(</span><span class=mi>2</span><span class=p>);</span>
</span><span id=__span-10-11><span class=w>        </span><span class=c1>// 提交线程池任务</span>
</span><span id=__span-10-12><span class=w>        </span><span class=n>Future</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=n>submit</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>executorService</span><span class=p>.</span><span class=na>submit</span><span class=p>(</span><span class=n>t1</span><span class=p>);</span>
</span><span id=__span-10-13><span class=w>        </span><span class=n>executorService</span><span class=p>.</span><span class=na>submit</span><span class=p>(</span><span class=n>t2</span><span class=p>);</span>
</span><span id=__span-10-14>
</span><span id=__span-10-15><span class=w>        </span><span class=c1>// 获取Callable实现类对象的返回值</span>
</span><span id=__span-10-16><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>submit</span><span class=p>.</span><span class=na>get</span><span class=p>());</span>
</span><span id=__span-10-17><span class=w>    </span><span class=p>}</span>
</span><span id=__span-10-18><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <h2 id=_13>线程安全<a class=headerlink href=#_13 title="Permanent link">&para;</a></h2> <h3 id=_14>线程安全引入<a class=headerlink href=#_14 title="Permanent link">&para;</a></h3> <p>当同一个数据被多个线程获取到时，就会出现线程安全问题</p> <p>例如，在买票的过程中，一共有三个人一起买票，如果至少两个人同时拿到同一张票就代表出现了线程不安全</p> <div class="language-java highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>Java</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-11-1><span class=c1>// 自定义线程类</span>
</span><span id=__span-11-2><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Thread03</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>Thread</span><span class=p>{</span>
</span><span id=__span-11-3><span class=w>    </span><span class=kd>static</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>tickets</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>10</span><span class=p>;</span>
</span><span id=__span-11-4>
</span><span id=__span-11-5><span class=w>    </span><span class=nd>@Override</span>
</span><span id=__span-11-6><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>run</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-11-7><span class=w>        </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>tickets</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-11-8><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;线程&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>Thread</span><span class=p>.</span><span class=na>currentThread</span><span class=p>().</span><span class=na>getName</span><span class=p>()</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&quot;获取到第&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>tickets</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&quot;张票&quot;</span><span class=p>);</span>
</span><span id=__span-11-9><span class=w>            </span><span class=n>tickets</span><span class=o>--</span><span class=p>;</span>
</span><span id=__span-11-10><span class=w>        </span><span class=p>}</span>
</span><span id=__span-11-11><span class=w>    </span><span class=p>}</span>
</span><span id=__span-11-12><span class=p>}</span>
</span><span id=__span-11-13>
</span><span id=__span-11-14><span class=c1>// 主线程</span>
</span><span id=__span-11-15><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Test03</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-11-16><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-11-17><span class=w>        </span><span class=n>Thread03</span><span class=w> </span><span class=n>t1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Thread03</span><span class=p>();</span>
</span><span id=__span-11-18><span class=w>        </span><span class=n>Thread03</span><span class=w> </span><span class=n>t2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Thread03</span><span class=p>();</span>
</span><span id=__span-11-19><span class=w>        </span><span class=n>Thread03</span><span class=w> </span><span class=n>t3</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Thread03</span><span class=p>();</span>
</span><span id=__span-11-20>
</span><span id=__span-11-21><span class=w>        </span><span class=n>t1</span><span class=p>.</span><span class=na>start</span><span class=p>();</span>
</span><span id=__span-11-22><span class=w>        </span><span class=n>t2</span><span class=p>.</span><span class=na>start</span><span class=p>();</span>
</span><span id=__span-11-23><span class=w>        </span><span class=n>t3</span><span class=p>.</span><span class=na>start</span><span class=p>();</span>
</span><span id=__span-11-24><span class=w>    </span><span class=p>}</span>
</span><span id=__span-11-25><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <p>例如下面的情况：</p> <p><a class=glightbox href="13. Java多线程.assets\image1.png" data-type=image data-width=100% data-height=auto data-desc-position=bottom><img src="13. Java多线程.assets\image1.png"></a></p> <h3 id=_15>解决线程安全<a class=headerlink href=#_15 title="Permanent link">&para;</a></h3> <p>在Java中，解决线程安全的方式就是给有线程不安全的代码加锁，并且必须是同一把锁，否则该锁无效。给线程加锁的方式有两种：</p> <ol> <li> <p>使用同步代码块，使用格式如下：</p> <div class="language-java highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>Java</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-12-1><span class=kd>synchronized</span><span class=w> </span><span class=p>(</span><span class=n>唯一任意对象</span><span class=p>){</span>
</span><span id=__span-12-2><span class=w>    </span><span class=c1>// 出现线程不安全的代码</span>
</span><span id=__span-12-3><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> </li> <li> <p>同步方法：包括静态同步方法和非静态同步方法，使用格式如下：</p> <div class="language-java highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>Java</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span>
<span class=normal>8</span>
<span class=normal>9</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-13-1><span class=c1>// 静态方法</span>
</span><span id=__span-13-2><span class=n>权限修饰符</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kd>synchronized</span><span class=w> </span><span class=n>返回值类型</span><span class=w> </span><span class=n>方法名</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-13-3><span class=w>    </span><span class=c1>// 方法体</span>
</span><span id=__span-13-4><span class=p>}</span>
</span><span id=__span-13-5>
</span><span id=__span-13-6><span class=c1>// 非静态方法</span>
</span><span id=__span-13-7><span class=n>权限修饰符</span><span class=w> </span><span class=kd>synchronized</span><span class=w> </span><span class=n>返回值类型</span><span class=w> </span><span class=n>方法名</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-13-8><span class=w>    </span><span class=c1>// 方法体</span>
</span><span id=__span-13-9><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> </li> </ol> <p>给线程不安全的代码加锁后，当一个线程进入后就会「加锁」，此时其他线程无法再进入对应的代码，当前面的线程执行完毕后离开，该锁就会「解锁」，此时其他线程就会进入重复上面的过程，在此过程中，哪一个线程先执行取决于哪一个线程先抢到CPU的使用权</p> <h4 id=_16>同步代码块解决线程不安全<a class=headerlink href=#_16 title="Permanent link">&para;</a></h4> <p>以前面的买票为例，解决方案如下：</p> <div class="language-java highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>Java</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-14-1><span class=c1>// 修改后的自定义线程类（使用继承+同步代码块）</span>
</span><span id=__span-14-2><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Thread03</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>Thread</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-14-3><span class=w>    </span><span class=kd>static</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>tickets</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>100</span><span class=p>;</span>
</span><span id=__span-14-4><span class=w>    </span><span class=c1>// 任意对象加锁</span>
</span><span id=__span-14-5><span class=w>    </span><span class=kd>static</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=n>obj</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Object</span><span class=p>();</span>
</span><span id=__span-14-6>
</span><span id=__span-14-7><span class=w>    </span><span class=nd>@Override</span>
</span><span id=__span-14-8><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>run</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-14-9><span class=w>        </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=kc>true</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-14-10><span class=w>            </span><span class=kd>synchronized</span><span class=w> </span><span class=p>(</span><span class=n>obj</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-14-11><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>tickets</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-14-12><span class=w>                    </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>Thread</span><span class=p>.</span><span class=na>currentThread</span><span class=p>().</span><span class=na>getName</span><span class=p>()</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&quot;...&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>tickets</span><span class=p>);</span>
</span><span id=__span-14-13><span class=w>                    </span><span class=n>tickets</span><span class=o>--</span><span class=p>;</span>
</span><span id=__span-14-14><span class=w>                </span><span class=p>}</span>
</span><span id=__span-14-15><span class=w>                </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-14-16><span class=w>                    </span><span class=k>break</span><span class=p>;</span>
</span><span id=__span-14-17><span class=w>                </span><span class=p>}</span>
</span><span id=__span-14-18><span class=w>            </span><span class=p>}</span>
</span><span id=__span-14-19><span class=w>        </span><span class=p>}</span>
</span><span id=__span-14-20><span class=w>    </span><span class=p>}</span>
</span><span id=__span-14-21><span class=p>}</span>
</span><span id=__span-14-22>
</span><span id=__span-14-23><span class=c1>// 主线程</span>
</span><span id=__span-14-24><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Test03</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-14-25><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-14-26><span class=w>        </span><span class=n>Thread03</span><span class=w> </span><span class=n>t1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Thread03</span><span class=p>();</span>
</span><span id=__span-14-27><span class=w>        </span><span class=n>Thread03</span><span class=w> </span><span class=n>t2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Thread03</span><span class=p>();</span>
</span><span id=__span-14-28><span class=w>        </span><span class=n>Thread03</span><span class=w> </span><span class=n>t3</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Thread03</span><span class=p>();</span>
</span><span id=__span-14-29>
</span><span id=__span-14-30><span class=w>        </span><span class=n>t1</span><span class=p>.</span><span class=na>start</span><span class=p>();</span>
</span><span id=__span-14-31><span class=w>        </span><span class=n>t2</span><span class=p>.</span><span class=na>start</span><span class=p>();</span>
</span><span id=__span-14-32><span class=w>        </span><span class=n>t3</span><span class=p>.</span><span class=na>start</span><span class=p>();</span>
</span><span id=__span-14-33><span class=w>    </span><span class=p>}</span>
</span><span id=__span-14-34><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <p>修改后的代码就可以解决线程不安全的问题</p> <p>上面的代码也可以通过实现<code>Runnable</code>类的方式创建线程对象实现，例如下面的代码：</p> <div class="language-java highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>Java</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-15-1><span class=c1>// 使用接口实现+同步代码块</span>
</span><span id=__span-15-2><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Thread04</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>Runnable</span><span class=p>{</span>
</span><span id=__span-15-3><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>tickets</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>100</span><span class=p>;</span>
</span><span id=__span-15-4><span class=w>    </span><span class=n>Object</span><span class=w> </span><span class=n>obj</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Object</span><span class=p>();</span>
</span><span id=__span-15-5><span class=w>    </span><span class=nd>@Override</span>
</span><span id=__span-15-6><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>run</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-15-7><span class=w>        </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=kc>true</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-15-8><span class=w>            </span><span class=kd>synchronized</span><span class=w> </span><span class=p>(</span><span class=n>obj</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-15-9><span class=w>                </span><span class=k>if</span><span class=p>(</span><span class=n>tickets</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-15-10><span class=w>                    </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>Thread</span><span class=p>.</span><span class=na>currentThread</span><span class=p>().</span><span class=na>getName</span><span class=p>()</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&quot;...&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>tickets</span><span class=p>);</span>
</span><span id=__span-15-11><span class=w>                    </span><span class=n>tickets</span><span class=o>--</span><span class=p>;</span>
</span><span id=__span-15-12><span class=w>                </span><span class=p>}</span>
</span><span id=__span-15-13><span class=w>                </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-15-14><span class=w>                    </span><span class=k>break</span><span class=p>;</span>
</span><span id=__span-15-15><span class=w>                </span><span class=p>}</span>
</span><span id=__span-15-16><span class=w>            </span><span class=p>}</span>
</span><span id=__span-15-17><span class=w>        </span><span class=p>}</span>
</span><span id=__span-15-18><span class=w>    </span><span class=p>}</span>
</span><span id=__span-15-19><span class=p>}</span>
</span><span id=__span-15-20>
</span><span id=__span-15-21><span class=c1>// 主进程</span>
</span><span id=__span-15-22><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Test03</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-15-23><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-15-24><span class=w>        </span><span class=c1>// 使用实现+同步代码块</span>
</span><span id=__span-15-25><span class=w>        </span><span class=n>Thread04</span><span class=w> </span><span class=n>tickets</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Thread04</span><span class=p>();</span>
</span><span id=__span-15-26><span class=w>        </span><span class=k>new</span><span class=w> </span><span class=n>Thread</span><span class=p>(</span><span class=n>tickets</span><span class=p>).</span><span class=na>start</span><span class=p>();</span>
</span><span id=__span-15-27><span class=w>        </span><span class=k>new</span><span class=w> </span><span class=n>Thread</span><span class=p>(</span><span class=n>tickets</span><span class=p>).</span><span class=na>start</span><span class=p>();</span>
</span><span id=__span-15-28><span class=w>        </span><span class=k>new</span><span class=w> </span><span class=n>Thread</span><span class=p>(</span><span class=n>tickets</span><span class=p>).</span><span class=na>start</span><span class=p>();</span>
</span><span id=__span-15-29><span class=w>    </span><span class=p>}</span>
</span><span id=__span-15-30><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <p>使用接口实现与继承的不同的是，锁对象和票成员不需要使用<code>static</code>修饰，因为此时三个线程共用一个<code>tickets</code>和<code>obj</code>成员，示意图如下：</p> <p><a class=glightbox href="13. Java多线程.assets\image2.png" data-type=image data-width=100% data-height=auto data-desc-position=bottom><img src="13. Java多线程.assets\image2.png"></a></p> <h4 id=_17>同步方法解决线程不安全<a class=headerlink href=#_17 title="Permanent link">&para;</a></h4> <ul> <li>静态同步方法</li> </ul> <div class="admonition note"> <p class=admonition-title>Note</p> <p>以继承+同步方法为例</p> </div> <p>对于静态同步方法来说，其默认锁是对象类</p> <div class="language-java highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>Java</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-16-1><span class=c1>// 使用继承+静态同步方法</span>
</span><span id=__span-16-2><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Thread05</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>Thread</span><span class=p>{</span>
</span><span id=__span-16-3><span class=w>    </span><span class=kd>static</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>tickets</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>100</span><span class=p>;</span>
</span><span id=__span-16-4>
</span><span id=__span-16-5><span class=w>    </span><span class=c1>// 静态方法</span>
</span><span id=__span-16-6><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kd>synchronized</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>sale</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-16-7><span class=w>        </span><span class=k>if</span><span class=p>(</span><span class=n>tickets</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-16-8><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>Thread</span><span class=p>.</span><span class=na>currentThread</span><span class=p>().</span><span class=na>getName</span><span class=p>()</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&quot;...&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>tickets</span><span class=p>);</span>
</span><span id=__span-16-9><span class=w>            </span><span class=n>tickets</span><span class=o>--</span><span class=p>;</span>
</span><span id=__span-16-10><span class=w>        </span><span class=p>}</span>
</span><span id=__span-16-11><span class=w>    </span><span class=p>}</span>
</span><span id=__span-16-12><span class=w>    </span><span class=nd>@Override</span>
</span><span id=__span-16-13><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>run</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-16-14><span class=w>        </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=kc>true</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-16-15><span class=w>            </span><span class=n>sale</span><span class=p>();</span>
</span><span id=__span-16-16><span class=w>            </span><span class=k>if</span><span class=p>(</span><span class=n>tickets</span><span class=w> </span><span class=o>&lt;=</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-16-17><span class=w>                </span><span class=k>break</span><span class=p>;</span>
</span><span id=__span-16-18><span class=w>            </span><span class=p>}</span>
</span><span id=__span-16-19><span class=w>        </span><span class=p>}</span>
</span><span id=__span-16-20><span class=w>    </span><span class=p>}</span>
</span><span id=__span-16-21><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <ul> <li>非静态同步方法</li> </ul> <div class="admonition note"> <p class=admonition-title>Note</p> <p>非静态同步方法只能使用接口的方式创建线程对象，因为使用继承无法保证<code>this</code>只指向一个对象</p> </div> <p>对于非静态同步方法，其默认锁是<code>this</code></p> <div class="language-java highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>Java</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-17-1><span class=c1>// 使用实现+非静态同步方法</span>
</span><span id=__span-17-2><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Thread06</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>Runnable</span><span class=p>{</span>
</span><span id=__span-17-3><span class=w>    </span><span class=kd>static</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>tickets</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>100</span><span class=p>;</span>
</span><span id=__span-17-4>
</span><span id=__span-17-5><span class=w>    </span><span class=c1>// 非静态同步方法</span>
</span><span id=__span-17-6><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>synchronized</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>sale</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-17-7><span class=w>        </span><span class=k>if</span><span class=p>(</span><span class=n>tickets</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-17-8><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>Thread</span><span class=p>.</span><span class=na>currentThread</span><span class=p>().</span><span class=na>getName</span><span class=p>()</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&quot;...&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>tickets</span><span class=p>);</span>
</span><span id=__span-17-9><span class=w>            </span><span class=n>tickets</span><span class=o>--</span><span class=p>;</span>
</span><span id=__span-17-10><span class=w>        </span><span class=p>}</span>
</span><span id=__span-17-11><span class=w>    </span><span class=p>}</span>
</span><span id=__span-17-12>
</span><span id=__span-17-13><span class=w>    </span><span class=nd>@Override</span>
</span><span id=__span-17-14><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>run</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-17-15><span class=w>        </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=kc>true</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-17-16><span class=w>            </span><span class=n>sale</span><span class=p>();</span>
</span><span id=__span-17-17><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>tickets</span><span class=w> </span><span class=o>&lt;=</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-17-18><span class=w>                </span><span class=k>break</span><span class=p>;</span>
</span><span id=__span-17-19><span class=w>            </span><span class=p>}</span>
</span><span id=__span-17-20><span class=w>        </span><span class=p>}</span>
</span><span id=__span-17-21><span class=w>    </span><span class=p>}</span>
</span><span id=__span-17-22><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <h4 id=lock>使用<code>lock</code>锁解决线程不安全<a class=headerlink href=#lock title="Permanent link">&para;</a></h4> <p>前面使用<code>synchronized</code>同步代码块和使用<code>synchronized</code>修饰方法的方式都有一个比较明显的缺点：不够灵活</p> <ul> <li>对于同步代码块来说，只有在执行完同步代码块后才会释放锁对象</li> <li>对于方法来说，调用该方法执行完才会释放锁</li> </ul> <p>为了解决这个问题，引入了<code>lock</code>锁</p> <p>在标准中，<code>lock</code>是一个接口，对应有一个实现类<code>ReentrantLock</code>，在该实现类中有两个方法，通过这两个方法控制同步代码块：</p> <ol> <li>无参构造：<code>lock()</code></li> <li>无参方法释放锁：<code>unlock()</code></li> </ol> <p>使用时，使用<code>lock()</code>放在出现线程不安全问题的代码块开始处加锁，执行完线程不安全问题的代码块后在最后一句代码后方添加<code>unlock()</code>方法释放锁</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>使用需要导包<code>util.concurrent.locks.Lock</code>和<code>util.concurrent.locks.ReentrantLock</code></p> </div> <p>使用示例：</p> <div class="language-java highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>Java</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-18-1><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Thread07</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>Runnable</span><span class=p>{</span>
</span><span id=__span-18-2><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>tickets</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>100</span><span class=p>;</span>
</span><span id=__span-18-3><span class=w>    </span><span class=c1>// 创建共用锁对象</span>
</span><span id=__span-18-4><span class=w>    </span><span class=n>Lock</span><span class=w> </span><span class=n>lock</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ReentrantLock</span><span class=p>();</span>
</span><span id=__span-18-5><span class=w>    </span><span class=nd>@Override</span>
</span><span id=__span-18-6><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>run</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-18-7><span class=w>        </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=kc>true</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-18-8><span class=w>            </span><span class=c1>// 加锁</span>
</span><span id=__span-18-9><span class=w>            </span><span class=n>lock</span><span class=p>.</span><span class=na>lock</span><span class=p>();</span>
</span><span id=__span-18-10><span class=w>            </span><span class=k>if</span><span class=p>(</span><span class=n>tickets</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-18-11><span class=w>                </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>Thread</span><span class=p>.</span><span class=na>currentThread</span><span class=p>().</span><span class=na>getName</span><span class=p>()</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&quot;...&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>tickets</span><span class=p>);</span>
</span><span id=__span-18-12><span class=w>                </span><span class=n>tickets</span><span class=o>--</span><span class=p>;</span>
</span><span id=__span-18-13><span class=w>            </span><span class=p>}</span>
</span><span id=__span-18-14><span class=w>            </span><span class=c1>// 释放锁</span>
</span><span id=__span-18-15><span class=w>            </span><span class=n>lock</span><span class=p>.</span><span class=na>unlock</span><span class=p>();</span>
</span><span id=__span-18-16><span class=w>        </span><span class=p>}</span>
</span><span id=__span-18-17><span class=w>    </span><span class=p>}</span>
</span><span id=__span-18-18><span class=p>}</span>
</span><span id=__span-18-19>
</span><span id=__span-18-20><span class=c1>// 主线程</span>
</span><span id=__span-18-21><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Test05</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-18-22><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-18-23><span class=w>        </span><span class=n>Thread07</span><span class=w> </span><span class=n>tickets</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Thread07</span><span class=p>();</span>
</span><span id=__span-18-24><span class=w>        </span><span class=k>new</span><span class=w> </span><span class=n>Thread</span><span class=p>(</span><span class=n>tickets</span><span class=p>).</span><span class=na>start</span><span class=p>();</span>
</span><span id=__span-18-25><span class=w>        </span><span class=k>new</span><span class=w> </span><span class=n>Thread</span><span class=p>(</span><span class=n>tickets</span><span class=p>).</span><span class=na>start</span><span class=p>();</span>
</span><span id=__span-18-26><span class=w>        </span><span class=k>new</span><span class=w> </span><span class=n>Thread</span><span class=p>(</span><span class=n>tickets</span><span class=p>).</span><span class=na>start</span><span class=p>();</span>
</span><span id=__span-18-27><span class=w>    </span><span class=p>}</span>
</span><span id=__span-18-28><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <div class="admonition note"> <p class=admonition-title>Note</p> <p>使用细节：如果出现了<code>try...catch</code>，可以考虑将<code>unlock()</code>方法放入<code>finally</code>中</p> </div> <h2 id=_18>死锁<a class=headerlink href=#_18 title="Permanent link">&para;</a></h2> <p>前面解决线程安全时涉及到加锁，但是如果出现锁嵌套，就容易出现死锁问题，例如下图：</p> <p><a class=glightbox href="13. Java多线程.assets\image3.png" data-type=image data-width=100% data-height=auto data-desc-position=bottom><img src="13. Java多线程.assets\image3.png"></a></p> <p>代码实现：</p> <div class="language-java highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>Java</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span>
<span class=normal>45</span>
<span class=normal>46</span>
<span class=normal>47</span>
<span class=normal>48</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-19-1><span class=c1>// 锁1</span>
</span><span id=__span-19-2><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>LockA</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-19-3><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>LockA</span><span class=w> </span><span class=n>lockA</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>LockA</span><span class=p>();</span>
</span><span id=__span-19-4><span class=p>}</span>
</span><span id=__span-19-5>
</span><span id=__span-19-6><span class=c1>// 锁2</span>
</span><span id=__span-19-7><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>LockB</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-19-8><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>LockB</span><span class=w> </span><span class=n>lockB</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>LockB</span><span class=p>();</span>
</span><span id=__span-19-9><span class=p>}</span>
</span><span id=__span-19-10>
</span><span id=__span-19-11><span class=c1>// 死锁</span>
</span><span id=__span-19-12><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>DieLock</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>Runnable</span><span class=p>{</span>
</span><span id=__span-19-13><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=n>flag</span><span class=p>;</span>
</span><span id=__span-19-14>
</span><span id=__span-19-15><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>DieLock</span><span class=p>(</span><span class=kt>boolean</span><span class=w> </span><span class=n>flag</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-19-16><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>flag</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>flag</span><span class=p>;</span>
</span><span id=__span-19-17><span class=w>    </span><span class=p>}</span>
</span><span id=__span-19-18>
</span><span id=__span-19-19><span class=w>    </span><span class=nd>@Override</span>
</span><span id=__span-19-20><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>run</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-19-21><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>flag</span><span class=p>){</span>
</span><span id=__span-19-22><span class=w>            </span><span class=kd>synchronized</span><span class=w> </span><span class=p>(</span><span class=n>LockA</span><span class=p>.</span><span class=na>lockA</span><span class=p>){</span>
</span><span id=__span-19-23><span class=w>                </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;if...lockA&quot;</span><span class=p>);</span>
</span><span id=__span-19-24><span class=w>                </span><span class=kd>synchronized</span><span class=w> </span><span class=p>(</span><span class=n>LockB</span><span class=p>.</span><span class=na>lockB</span><span class=p>){</span>
</span><span id=__span-19-25><span class=w>                    </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;if...lockB&quot;</span><span class=p>);</span>
</span><span id=__span-19-26><span class=w>                </span><span class=p>}</span>
</span><span id=__span-19-27><span class=w>            </span><span class=p>}</span>
</span><span id=__span-19-28><span class=w>        </span><span class=p>}</span><span class=k>else</span><span class=p>{</span>
</span><span id=__span-19-29><span class=w>            </span><span class=kd>synchronized</span><span class=w> </span><span class=p>(</span><span class=n>LockB</span><span class=p>.</span><span class=na>lockB</span><span class=p>){</span>
</span><span id=__span-19-30><span class=w>                </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;else...lockB&quot;</span><span class=p>);</span>
</span><span id=__span-19-31><span class=w>                </span><span class=kd>synchronized</span><span class=w> </span><span class=p>(</span><span class=n>LockA</span><span class=p>.</span><span class=na>lockA</span><span class=p>){</span>
</span><span id=__span-19-32><span class=w>                    </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;else...lockA&quot;</span><span class=p>);</span>
</span><span id=__span-19-33><span class=w>                </span><span class=p>}</span>
</span><span id=__span-19-34><span class=w>            </span><span class=p>}</span>
</span><span id=__span-19-35><span class=w>        </span><span class=p>}</span>
</span><span id=__span-19-36><span class=w>    </span><span class=p>}</span>
</span><span id=__span-19-37><span class=p>}</span>
</span><span id=__span-19-38>
</span><span id=__span-19-39><span class=c1>// 主线程</span>
</span><span id=__span-19-40><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Test05</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-19-41><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-19-42><span class=w>        </span><span class=n>DieLock</span><span class=w> </span><span class=n>dieLock1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>DieLock</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span>
</span><span id=__span-19-43><span class=w>        </span><span class=n>DieLock</span><span class=w> </span><span class=n>dieLock2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>DieLock</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
</span><span id=__span-19-44>
</span><span id=__span-19-45><span class=w>        </span><span class=k>new</span><span class=w> </span><span class=n>Thread</span><span class=p>(</span><span class=n>dieLock1</span><span class=p>).</span><span class=na>start</span><span class=p>();</span>
</span><span id=__span-19-46><span class=w>        </span><span class=k>new</span><span class=w> </span><span class=n>Thread</span><span class=p>(</span><span class=n>dieLock2</span><span class=p>).</span><span class=na>start</span><span class=p>();</span>
</span><span id=__span-19-47><span class=w>    </span><span class=p>}</span>
</span><span id=__span-19-48><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <h2 id=_19>线程状态<a class=headerlink href=#_19 title="Permanent link">&para;</a></h2> <p>在Java中，并不是所有进程都在开始运行之后直接进入运行状态，常见的状态有6种，见下面表格：</p> <table> <thead> <tr> <th>线程状态</th> <th>导致状态发生条件</th> </tr> </thead> <tbody> <tr> <td><code>NEW</code>(新建)</td> <td>线程刚被创建，但是并未启动。还没调用<code>start</code>方法。</td> </tr> <tr> <td><code>Runnable</code>(可运行)</td> <td>线程可以在Java虚拟机中运行的状态，可能正在运行自己代码，也可能没有，这取决于操作系统处理器。</td> </tr> <tr> <td><code>Blocked</code>(锁阻塞)</td> <td>当一个线程试图获取一个对象锁，而该对象锁被其他的线程持有，则该线程进入<code>Blocked</code>状态；当该线程持有锁时，该线程将变成<code>Runnable</code>状态。</td> </tr> <tr> <td><code>Waiting</code>(无限等待)</td> <td>一个线程在等待另一个线程执行一个（唤醒）动作时，该线程进入<code>Waiting</code>状态。进入这个状态后是不能自动唤醒的，必须等待另一个线程调用<code>notify</code>或者<code>notifyAll</code>方法才能够唤醒。</td> </tr> <tr> <td><code>Timed Waiting</code>(计时等待)</td> <td>同<code>waiting</code>状态，有几个方法有超时参数，调用他们将进入<code>Timed Waiting</code>状态。这一状态将一直保持到超时期满或者接收到唤醒通知。带有超时参数的常用方法有<code>Thread.sleep</code>、<code>Object.wait</code>。</td> </tr> <tr> <td><code>Terminated</code>(被终止)</td> <td>因为<code>run</code>方法正常退出而死亡，或者因为没有捕获的异常终止了<code>run</code>方法而死亡，也可以调用过时方法<code>stop()</code></td> </tr> </tbody> </table> <p>对应状态图如下：</p> <p><a class=glightbox href="13. Java多线程.assets\image4.png" data-type=image data-width=100% data-height=auto data-desc-position=bottom><img src="13. Java多线程.assets\image4.png"></a></p> <h3 id=_20>线程状态常用方法<a class=headerlink href=#_20 title="Permanent link">&para;</a></h3> <ol> <li>无参线程释放锁等待：<code>void wait()</code>，注意，本方法会抛异常</li> <li>随机唤醒一个正在等待的线程：<code>void notify()</code></li> <li>唤醒所有正在等待的线程：<code>void notifyAll()</code></li> <li>有参线程释放锁等待：<code>void wait(long timeout)</code>，参数为等待毫秒值</li> </ol> <div class="admonition note"> <p class=admonition-title>Note</p> <p>上面的方法所在类都是<code>Object</code>，但是因为所有类都继承自<code>Object</code>，所以所有子类都可以使用上面的方法</p> </div> <h3 id=_21>线程状态常用方法使用实例（线程间的通信）<a class=headerlink href=#_21 title="Permanent link">&para;</a></h3> <p>在前面的线程程序中，如果涉及到多个线程，就会根据「哪一个线程先抢到CPU使用权哪一个线程先执行」的原则，而不是线程之间相互交替执行。当需要线程之间的相互交替执行，可以使用<code>wait()</code>方法和<code>notify()</code>方法相互协调控制线程的执行，而多个线程之间协调控制线程的执行则称为线程间的通信</p> <h4 id=_22>实例实现（使用同步代码块）<a class=headerlink href=#_22 title="Permanent link">&para;</a></h4> <p>例如下面的使用实例：</p> <p>在一个程序中生产和消费产品，两个行为分别对应着两个线程，一个线程负责生产，一个线程负责消费，并且消费模式为：生产一个产品紧接着消费一个产品，不可以产生同时生产和同时消费，使用代码实现对应的效果</p> <p>首先分析本题的要求：</p> <ol> <li>因为要两个线程分别生产产品和消费产品，所以需要两个线程对象，但是这两个线程对象均访问一个产品资源</li> <li> <p>接着考虑产品中的属性，首先是产品当前的数量，定义为<code>count</code>，接着是标记生产或者消费，定义为<code>flag</code>（假设<code>flag</code>为<code>true</code>时代表当前存在产品，不需要生产，可以进行消费；否则不存在为<code>false</code>，不可以消费，需要生产）</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>需要注意，数量和消费成员可以不需要使用<code>static</code></p> </div> </li> <li> <p>考虑生产产品和消费产品的逻辑，为了保证两个线程不会出现同一时刻访问到同一个数据或者一个线程进行中，因为切换导致另一个线程执行，需要使用锁对象，此时需要使用到同步代码块：</p> <ol> <li>对于生产产品线程来说：当<code>flag</code>为<code>true</code>的时候证明当前存在产品，本线程不可以再执行，需要等待；当<code>flag</code>为<code>false</code>时，<code>count</code>加1，并将<code>flag</code>标记为<code>true</code>。最后唤醒正在等待的消费线程，生产产品线程退出同步代码块</li> <li>对于消费产品线程来说：当<code>flag</code>为<code>true</code>的时候证明当前存在产品，本线程需要执行，直接打印当前<code>count</code>的值（表示消费第几个产品），并将<code>flag</code>标记为<code>false</code>，唤醒正在等待的消费线程，生产产品线程退出同步代码块；当<code>flag</code>为<code>false</code>时，说明不存在产品，不可以执行消费，本线程需要等待。</li> </ol> <div class="admonition note"> <p class=admonition-title>Note</p> <p>因为需要确保两个线程使用同一个锁对象，所以可以在创建线程对象时传递同一个锁对象，此时需要为两个自定义线程类提供对象成员以及构造函数 此处需要注意，与前面线程共享资源不完全相同，这里通过同一个锁对象实现两个线程访问同一个锁对象中的资源，而前面的共享资源是通过同一个类对象创建三个线程，所以每个线程都是访问同一个类对象的空间</p> </div> </li> <li> <p>为了便于观察，可以通过<code>sleep</code>方法降低运行速度</p> </li> </ol> <p>示例代码：</p> <div class="language-java highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>Java</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>  1</span>
<span class=normal>  2</span>
<span class=normal>  3</span>
<span class=normal>  4</span>
<span class=normal>  5</span>
<span class=normal>  6</span>
<span class=normal>  7</span>
<span class=normal>  8</span>
<span class=normal>  9</span>
<span class=normal> 10</span>
<span class=normal> 11</span>
<span class=normal> 12</span>
<span class=normal> 13</span>
<span class=normal> 14</span>
<span class=normal> 15</span>
<span class=normal> 16</span>
<span class=normal> 17</span>
<span class=normal> 18</span>
<span class=normal> 19</span>
<span class=normal> 20</span>
<span class=normal> 21</span>
<span class=normal> 22</span>
<span class=normal> 23</span>
<span class=normal> 24</span>
<span class=normal> 25</span>
<span class=normal> 26</span>
<span class=normal> 27</span>
<span class=normal> 28</span>
<span class=normal> 29</span>
<span class=normal> 30</span>
<span class=normal> 31</span>
<span class=normal> 32</span>
<span class=normal> 33</span>
<span class=normal> 34</span>
<span class=normal> 35</span>
<span class=normal> 36</span>
<span class=normal> 37</span>
<span class=normal> 38</span>
<span class=normal> 39</span>
<span class=normal> 40</span>
<span class=normal> 41</span>
<span class=normal> 42</span>
<span class=normal> 43</span>
<span class=normal> 44</span>
<span class=normal> 45</span>
<span class=normal> 46</span>
<span class=normal> 47</span>
<span class=normal> 48</span>
<span class=normal> 49</span>
<span class=normal> 50</span>
<span class=normal> 51</span>
<span class=normal> 52</span>
<span class=normal> 53</span>
<span class=normal> 54</span>
<span class=normal> 55</span>
<span class=normal> 56</span>
<span class=normal> 57</span>
<span class=normal> 58</span>
<span class=normal> 59</span>
<span class=normal> 60</span>
<span class=normal> 61</span>
<span class=normal> 62</span>
<span class=normal> 63</span>
<span class=normal> 64</span>
<span class=normal> 65</span>
<span class=normal> 66</span>
<span class=normal> 67</span>
<span class=normal> 68</span>
<span class=normal> 69</span>
<span class=normal> 70</span>
<span class=normal> 71</span>
<span class=normal> 72</span>
<span class=normal> 73</span>
<span class=normal> 74</span>
<span class=normal> 75</span>
<span class=normal> 76</span>
<span class=normal> 77</span>
<span class=normal> 78</span>
<span class=normal> 79</span>
<span class=normal> 80</span>
<span class=normal> 81</span>
<span class=normal> 82</span>
<span class=normal> 83</span>
<span class=normal> 84</span>
<span class=normal> 85</span>
<span class=normal> 86</span>
<span class=normal> 87</span>
<span class=normal> 88</span>
<span class=normal> 89</span>
<span class=normal> 90</span>
<span class=normal> 91</span>
<span class=normal> 92</span>
<span class=normal> 93</span>
<span class=normal> 94</span>
<span class=normal> 95</span>
<span class=normal> 96</span>
<span class=normal> 97</span>
<span class=normal> 98</span>
<span class=normal> 99</span>
<span class=normal>100</span>
<span class=normal>101</span>
<span class=normal>102</span>
<span class=normal>103</span>
<span class=normal>104</span>
<span class=normal>105</span>
<span class=normal>106</span>
<span class=normal>107</span>
<span class=normal>108</span>
<span class=normal>109</span>
<span class=normal>110</span>
<span class=normal>111</span>
<span class=normal>112</span>
<span class=normal>113</span>
<span class=normal>114</span>
<span class=normal>115</span>
<span class=normal>116</span>
<span class=normal>117</span>
<span class=normal>118</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-20-1><span class=c1>// 产品类</span>
</span><span id=__span-20-2><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Product</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-20-3><span class=w>    </span><span class=c1>// 产品数量</span>
</span><span id=__span-20-4><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>count</span><span class=p>;</span>
</span><span id=__span-20-5><span class=w>    </span><span class=c1>// 标记是否需要生产</span>
</span><span id=__span-20-6><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=n>flag</span><span class=p>;</span>
</span><span id=__span-20-7>
</span><span id=__span-20-8><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>getCount</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-20-9><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;消费了&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>count</span><span class=p>);</span>
</span><span id=__span-20-10><span class=w>    </span><span class=p>}</span>
</span><span id=__span-20-11>
</span><span id=__span-20-12><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>setCount</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-20-13><span class=w>        </span><span class=n>count</span><span class=o>++</span><span class=p>;</span>
</span><span id=__span-20-14><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;生产了&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>count</span><span class=p>);</span>
</span><span id=__span-20-15><span class=w>    </span><span class=p>}</span>
</span><span id=__span-20-16>
</span><span id=__span-20-17><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=nf>isFlag</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-20-18><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>flag</span><span class=p>;</span>
</span><span id=__span-20-19><span class=w>    </span><span class=p>}</span>
</span><span id=__span-20-20>
</span><span id=__span-20-21><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>setFlag</span><span class=p>(</span><span class=kt>boolean</span><span class=w> </span><span class=n>flag</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-20-22><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>flag</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>flag</span><span class=p>;</span>
</span><span id=__span-20-23><span class=w>    </span><span class=p>}</span>
</span><span id=__span-20-24><span class=p>}</span>
</span><span id=__span-20-25>
</span><span id=__span-20-26><span class=c1>// 消费线程</span>
</span><span id=__span-20-27><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Consume</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>Runnable</span><span class=p>{</span>
</span><span id=__span-20-28><span class=w>    </span><span class=c1>// 锁对象引用</span>
</span><span id=__span-20-29><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Product</span><span class=w> </span><span class=n>product</span><span class=p>;</span>
</span><span id=__span-20-30>
</span><span id=__span-20-31><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>Consume</span><span class=p>(</span><span class=n>Product</span><span class=w> </span><span class=n>product</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-20-32><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>product</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>product</span><span class=p>;</span>
</span><span id=__span-20-33><span class=w>    </span><span class=p>}</span>
</span><span id=__span-20-34>
</span><span id=__span-20-35><span class=w>    </span><span class=nd>@Override</span>
</span><span id=__span-20-36><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>run</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-20-37><span class=w>        </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=kc>true</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-20-38><span class=w>            </span><span class=c1>// 降低运行速度</span>
</span><span id=__span-20-39><span class=w>            </span><span class=k>try</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-20-40><span class=w>                </span><span class=n>Thread</span><span class=p>.</span><span class=na>sleep</span><span class=p>(</span><span class=mi>1000L</span><span class=p>);</span>
</span><span id=__span-20-41><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>InterruptedException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-20-42><span class=w>                </span><span class=n>e</span><span class=p>.</span><span class=na>printStackTrace</span><span class=p>();</span>
</span><span id=__span-20-43><span class=w>            </span><span class=p>}</span>
</span><span id=__span-20-44><span class=w>            </span><span class=kd>synchronized</span><span class=w> </span><span class=p>(</span><span class=n>product</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-20-45><span class=w>                </span><span class=c1>// 如果没有产品，则不消费</span>
</span><span id=__span-20-46><span class=w>                </span><span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>product</span><span class=p>.</span><span class=na>isFlag</span><span class=p>())</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-20-47><span class=w>                    </span><span class=c1>// 调用父类Object中的wait()</span>
</span><span id=__span-20-48><span class=w>                    </span><span class=k>try</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-20-49><span class=w>                        </span><span class=n>product</span><span class=p>.</span><span class=na>wait</span><span class=p>();</span>
</span><span id=__span-20-50><span class=w>                    </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>InterruptedException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-20-51><span class=w>                        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;生产线异常&quot;</span><span class=p>);</span>
</span><span id=__span-20-52><span class=w>                    </span><span class=p>}</span>
</span><span id=__span-20-53><span class=w>                </span><span class=p>}</span>
</span><span id=__span-20-54>
</span><span id=__span-20-55><span class=w>                </span><span class=c1>// 如果有产品，则消费</span>
</span><span id=__span-20-56><span class=w>                </span><span class=n>product</span><span class=p>.</span><span class=na>getCount</span><span class=p>();</span>
</span><span id=__span-20-57><span class=w>                </span><span class=c1>// 更改标志</span>
</span><span id=__span-20-58><span class=w>                </span><span class=n>product</span><span class=p>.</span><span class=na>setFlag</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
</span><span id=__span-20-59><span class=w>                </span><span class=c1>// 唤醒其他线程</span>
</span><span id=__span-20-60><span class=w>                </span><span class=n>product</span><span class=p>.</span><span class=na>notify</span><span class=p>();</span>
</span><span id=__span-20-61><span class=w>            </span><span class=p>}</span>
</span><span id=__span-20-62><span class=w>        </span><span class=p>}</span>
</span><span id=__span-20-63><span class=w>    </span><span class=p>}</span>
</span><span id=__span-20-64><span class=p>}</span>
</span><span id=__span-20-65>
</span><span id=__span-20-66><span class=c1>// 生产线程</span>
</span><span id=__span-20-67><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Create</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>Runnable</span><span class=p>{</span>
</span><span id=__span-20-68><span class=w>    </span><span class=c1>// 锁对象</span>
</span><span id=__span-20-69><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Product</span><span class=w> </span><span class=n>product</span><span class=p>;</span>
</span><span id=__span-20-70>
</span><span id=__span-20-71><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>Create</span><span class=p>(</span><span class=n>Product</span><span class=w> </span><span class=n>product</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-20-72><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>product</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>product</span><span class=p>;</span>
</span><span id=__span-20-73><span class=w>    </span><span class=p>}</span>
</span><span id=__span-20-74>
</span><span id=__span-20-75><span class=w>    </span><span class=nd>@Override</span>
</span><span id=__span-20-76><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>run</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-20-77><span class=w>        </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=kc>true</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-20-78><span class=w>            </span><span class=c1>// 降低运行速度</span>
</span><span id=__span-20-79><span class=w>            </span><span class=k>try</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-20-80><span class=w>                </span><span class=n>Thread</span><span class=p>.</span><span class=na>sleep</span><span class=p>(</span><span class=mi>1000L</span><span class=p>);</span>
</span><span id=__span-20-81><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>InterruptedException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-20-82><span class=w>                </span><span class=n>e</span><span class=p>.</span><span class=na>printStackTrace</span><span class=p>();</span>
</span><span id=__span-20-83><span class=w>            </span><span class=p>}</span>
</span><span id=__span-20-84><span class=w>            </span><span class=kd>synchronized</span><span class=w> </span><span class=p>(</span><span class=n>product</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-20-85><span class=w>                </span><span class=c1>// 如果有产品，则不生产</span>
</span><span id=__span-20-86><span class=w>                </span><span class=k>if</span><span class=p>(</span><span class=n>product</span><span class=p>.</span><span class=na>isFlag</span><span class=p>())</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-20-87><span class=w>                    </span><span class=c1>// 调用父类Object中的wait()</span>
</span><span id=__span-20-88><span class=w>                    </span><span class=k>try</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-20-89><span class=w>                        </span><span class=n>product</span><span class=p>.</span><span class=na>wait</span><span class=p>();</span>
</span><span id=__span-20-90><span class=w>                    </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>InterruptedException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-20-91><span class=w>                        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;生产线异常&quot;</span><span class=p>);</span>
</span><span id=__span-20-92><span class=w>                    </span><span class=p>}</span>
</span><span id=__span-20-93><span class=w>                </span><span class=p>}</span>
</span><span id=__span-20-94>
</span><span id=__span-20-95><span class=w>                </span><span class=c1>// 如果没有产品，则生产</span>
</span><span id=__span-20-96><span class=w>                </span><span class=n>product</span><span class=p>.</span><span class=na>setCount</span><span class=p>();</span>
</span><span id=__span-20-97><span class=w>                </span><span class=c1>// 更改标志</span>
</span><span id=__span-20-98><span class=w>                </span><span class=n>product</span><span class=p>.</span><span class=na>setFlag</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span>
</span><span id=__span-20-99><span class=w>                </span><span class=c1>// 唤醒其他线程</span>
</span><span id=__span-20-100><span class=w>                </span><span class=n>product</span><span class=p>.</span><span class=na>notify</span><span class=p>();</span>
</span><span id=__span-20-101><span class=w>            </span><span class=p>}</span>
</span><span id=__span-20-102><span class=w>        </span><span class=p>}</span>
</span><span id=__span-20-103><span class=w>    </span><span class=p>}</span>
</span><span id=__span-20-104><span class=p>}</span>
</span><span id=__span-20-105>
</span><span id=__span-20-106><span class=c1>// 测试</span>
</span><span id=__span-20-107><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Test</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-20-108><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-20-109><span class=w>        </span><span class=c1>// 锁对象</span>
</span><span id=__span-20-110><span class=w>        </span><span class=n>Product</span><span class=w> </span><span class=n>product</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Product</span><span class=p>();</span>
</span><span id=__span-20-111><span class=w>        </span><span class=c1>// 创建线程对象</span>
</span><span id=__span-20-112><span class=w>        </span><span class=n>Create</span><span class=w> </span><span class=n>create</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Create</span><span class=p>(</span><span class=n>product</span><span class=p>);</span>
</span><span id=__span-20-113><span class=w>        </span><span class=n>Consume</span><span class=w> </span><span class=n>consume</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Consume</span><span class=p>(</span><span class=n>product</span><span class=p>);</span>
</span><span id=__span-20-114><span class=w>        </span><span class=c1>// 启动线程</span>
</span><span id=__span-20-115><span class=w>        </span><span class=k>new</span><span class=w> </span><span class=n>Thread</span><span class=p>(</span><span class=n>create</span><span class=p>).</span><span class=na>start</span><span class=p>();</span>
</span><span id=__span-20-116><span class=w>        </span><span class=k>new</span><span class=w> </span><span class=n>Thread</span><span class=p>(</span><span class=n>consume</span><span class=p>).</span><span class=na>start</span><span class=p>();</span>
</span><span id=__span-20-117><span class=w>    </span><span class=p>}</span>
</span><span id=__span-20-118><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <p>效果如下：</p> <p><a class=glightbox href="13. Java多线程.assets\image5.png" data-type=image data-width=100% data-height=auto data-desc-position=bottom><img src="13. Java多线程.assets\image5.png"></a></p> <p>但是，上面的代码只实现了两个线程之间的通信，如果涉及到多个生产线程和消费线程，此时就打破了前面实现的消费模式平衡，考虑出现问题的原因：</p> <ol> <li> <p>原因1：在前面只有两个线程进行通信时，只会出现一个线程运行一个线程等待交替进行，根据<code>notify</code>方法的特性「每一次随机唤醒一个等待的进程」可以确保一定唤醒另一个正在等待的线程；但是如果出现多个生产线程和消费线程，则此时<code>notify</code>方法的特性中的「随机」就会导致此处出现问题「多次生产或者多次消费」，因为<code>notify</code>无法保证下一次唤醒的一定是正在等待的生产线程（消费运行）或者正在等待的消费线程（生产运行）。假设开始一个生产线程运行，当该线程运行完毕释放锁后，下一次还是生产线程时，就会产生多次生产，同样对于消费线程也是如此</p> <div class="admonition info"> <p class=admonition-title>Info</p> <p>针对原因1，提出解决方案：当一个线程结束后，唤醒其他所有线程一起抢锁，此时需要使用<code>notifyAll()</code>方法</p> </div> </li> <li> <p>原因2：原因2出现在原因1之后，尽管使用了<code>notifyAll()</code>方法依旧没有解决问题，假设开始运行的线程为生产线程，其他线程均处于等待状态，如果使用<code>notifyAll()</code>唤醒了所有的线程，此时所有线程开始抢锁，若抢到锁的依旧是生产线程，上面的代码就会因为是<code>if</code>语句，而走完<code>if</code>语句之后就继续向下走，走到生产产品部分导致出现连续生产</p> <div class="admonition info"> <p class=admonition-title>Info</p> <p>针对原因2，提出解决方案：将if语句换成<code>while</code>语句，此时对于原因2中的情况来说，走完<code>while</code>内部的语句后会因为是while继续判断是否执行<code>while</code>内部的语句，而因为第一次线程生产产品已经将<code>flag</code>设置为<code>true</code>，所以此时<code>flag</code>为<code>true</code>，<code>while</code>判断为真，第二个抢到锁的生产线程就会继续进入<code>while</code>内部执行等待</p> </div> </li> </ol> <p>根据前面的两个解决方案修改代码如下：</p> <div class="language-java highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>Java</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span>
<span class=normal>45</span>
<span class=normal>46</span>
<span class=normal>47</span>
<span class=normal>48</span>
<span class=normal>49</span>
<span class=normal>50</span>
<span class=normal>51</span>
<span class=normal>52</span>
<span class=normal>53</span>
<span class=normal>54</span>
<span class=normal>55</span>
<span class=normal>56</span>
<span class=normal>57</span>
<span class=normal>58</span>
<span class=normal>59</span>
<span class=normal>60</span>
<span class=normal>61</span>
<span class=normal>62</span>
<span class=normal>63</span>
<span class=normal>64</span>
<span class=normal>65</span>
<span class=normal>66</span>
<span class=normal>67</span>
<span class=normal>68</span>
<span class=normal>69</span>
<span class=normal>70</span>
<span class=normal>71</span>
<span class=normal>72</span>
<span class=normal>73</span>
<span class=normal>74</span>
<span class=normal>75</span>
<span class=normal>76</span>
<span class=normal>77</span>
<span class=normal>78</span>
<span class=normal>79</span>
<span class=normal>80</span>
<span class=normal>81</span>
<span class=normal>82</span>
<span class=normal>83</span>
<span class=normal>84</span>
<span class=normal>85</span>
<span class=normal>86</span>
<span class=normal>87</span>
<span class=normal>88</span>
<span class=normal>89</span>
<span class=normal>90</span>
<span class=normal>91</span>
<span class=normal>92</span>
<span class=normal>93</span>
<span class=normal>94</span>
<span class=normal>95</span>
<span class=normal>96</span>
<span class=normal>97</span>
<span class=normal>98</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-21-1><span class=c1>// 生产线程</span>
</span><span id=__span-21-2><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Create</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>Runnable</span><span class=p>{</span>
</span><span id=__span-21-3><span class=w>    </span><span class=c1>// 锁对象</span>
</span><span id=__span-21-4><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Product</span><span class=w> </span><span class=n>product</span><span class=p>;</span>
</span><span id=__span-21-5>
</span><span id=__span-21-6><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>Create</span><span class=p>(</span><span class=n>Product</span><span class=w> </span><span class=n>product</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-21-7><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>product</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>product</span><span class=p>;</span>
</span><span id=__span-21-8><span class=w>    </span><span class=p>}</span>
</span><span id=__span-21-9>
</span><span id=__span-21-10><span class=w>    </span><span class=nd>@Override</span>
</span><span id=__span-21-11><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>run</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-21-12><span class=w>        </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=kc>true</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-21-13><span class=w>            </span><span class=c1>// 降低运行速度</span>
</span><span id=__span-21-14><span class=w>            </span><span class=k>try</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-21-15><span class=w>                </span><span class=n>Thread</span><span class=p>.</span><span class=na>sleep</span><span class=p>(</span><span class=mi>1000L</span><span class=p>);</span>
</span><span id=__span-21-16><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>InterruptedException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-21-17><span class=w>                </span><span class=n>e</span><span class=p>.</span><span class=na>printStackTrace</span><span class=p>();</span>
</span><span id=__span-21-18><span class=w>            </span><span class=p>}</span>
</span><span id=__span-21-19><span class=w>            </span><span class=kd>synchronized</span><span class=w> </span><span class=p>(</span><span class=n>product</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-21-20><span class=w>                </span><span class=c1>// 如果有产品，则不生产</span>
</span><span id=__span-21-21><span class=w>                </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>product</span><span class=p>.</span><span class=na>isFlag</span><span class=p>())</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-21-22><span class=w>                    </span><span class=c1>// 调用父类Object中的wait()</span>
</span><span id=__span-21-23><span class=w>                    </span><span class=k>try</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-21-24><span class=w>                        </span><span class=n>product</span><span class=p>.</span><span class=na>wait</span><span class=p>();</span>
</span><span id=__span-21-25><span class=w>                    </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>InterruptedException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-21-26><span class=w>                        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;生产线异常&quot;</span><span class=p>);</span>
</span><span id=__span-21-27><span class=w>                    </span><span class=p>}</span>
</span><span id=__span-21-28><span class=w>                </span><span class=p>}</span>
</span><span id=__span-21-29>
</span><span id=__span-21-30><span class=w>                </span><span class=c1>// 如果没有产品，则生产</span>
</span><span id=__span-21-31><span class=w>                </span><span class=n>product</span><span class=p>.</span><span class=na>setCount</span><span class=p>();</span>
</span><span id=__span-21-32><span class=w>                </span><span class=c1>// 更改标志</span>
</span><span id=__span-21-33><span class=w>                </span><span class=n>product</span><span class=p>.</span><span class=na>setFlag</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span>
</span><span id=__span-21-34><span class=w>                </span><span class=c1>// 唤醒所有线程</span>
</span><span id=__span-21-35><span class=w>                </span><span class=n>product</span><span class=p>.</span><span class=na>notifyAll</span><span class=p>();</span>
</span><span id=__span-21-36><span class=w>            </span><span class=p>}</span>
</span><span id=__span-21-37><span class=w>        </span><span class=p>}</span>
</span><span id=__span-21-38><span class=w>    </span><span class=p>}</span>
</span><span id=__span-21-39><span class=p>}</span>
</span><span id=__span-21-40>
</span><span id=__span-21-41><span class=c1>// 消费线程</span>
</span><span id=__span-21-42><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Consume</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>Runnable</span><span class=p>{</span>
</span><span id=__span-21-43><span class=w>    </span><span class=c1>// 锁对象引用</span>
</span><span id=__span-21-44><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Product</span><span class=w> </span><span class=n>product</span><span class=p>;</span>
</span><span id=__span-21-45>
</span><span id=__span-21-46><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>Consume</span><span class=p>(</span><span class=n>Product</span><span class=w> </span><span class=n>product</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-21-47><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>product</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>product</span><span class=p>;</span>
</span><span id=__span-21-48><span class=w>    </span><span class=p>}</span>
</span><span id=__span-21-49>
</span><span id=__span-21-50><span class=w>    </span><span class=nd>@Override</span>
</span><span id=__span-21-51><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>run</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-21-52><span class=w>        </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=kc>true</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-21-53><span class=w>            </span><span class=c1>// 降低运行速度</span>
</span><span id=__span-21-54><span class=w>            </span><span class=k>try</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-21-55><span class=w>                </span><span class=n>Thread</span><span class=p>.</span><span class=na>sleep</span><span class=p>(</span><span class=mi>1000L</span><span class=p>);</span>
</span><span id=__span-21-56><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>InterruptedException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-21-57><span class=w>                </span><span class=n>e</span><span class=p>.</span><span class=na>printStackTrace</span><span class=p>();</span>
</span><span id=__span-21-58><span class=w>            </span><span class=p>}</span>
</span><span id=__span-21-59><span class=w>            </span><span class=kd>synchronized</span><span class=w> </span><span class=p>(</span><span class=n>product</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-21-60><span class=w>                </span><span class=c1>// 如果没有产品，则不消费</span>
</span><span id=__span-21-61><span class=w>                </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>product</span><span class=p>.</span><span class=na>isFlag</span><span class=p>())</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-21-62><span class=w>                    </span><span class=c1>// 调用父类Object中的wait()</span>
</span><span id=__span-21-63><span class=w>                    </span><span class=k>try</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-21-64><span class=w>                        </span><span class=n>product</span><span class=p>.</span><span class=na>wait</span><span class=p>();</span>
</span><span id=__span-21-65><span class=w>                    </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>InterruptedException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-21-66><span class=w>                        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;生产线异常&quot;</span><span class=p>);</span>
</span><span id=__span-21-67><span class=w>                    </span><span class=p>}</span>
</span><span id=__span-21-68><span class=w>                </span><span class=p>}</span>
</span><span id=__span-21-69>
</span><span id=__span-21-70><span class=w>                </span><span class=c1>// 如果有产品，则消费</span>
</span><span id=__span-21-71><span class=w>                </span><span class=n>product</span><span class=p>.</span><span class=na>getCount</span><span class=p>();</span>
</span><span id=__span-21-72><span class=w>                </span><span class=c1>// 更改标志</span>
</span><span id=__span-21-73><span class=w>                </span><span class=n>product</span><span class=p>.</span><span class=na>setFlag</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
</span><span id=__span-21-74><span class=w>                </span><span class=c1>// 唤醒所有线程</span>
</span><span id=__span-21-75><span class=w>                </span><span class=n>product</span><span class=p>.</span><span class=na>notifyAll</span><span class=p>();</span>
</span><span id=__span-21-76><span class=w>            </span><span class=p>}</span>
</span><span id=__span-21-77><span class=w>        </span><span class=p>}</span>
</span><span id=__span-21-78><span class=w>    </span><span class=p>}</span>
</span><span id=__span-21-79><span class=p>}</span>
</span><span id=__span-21-80>
</span><span id=__span-21-81><span class=c1>// 测试</span>
</span><span id=__span-21-82><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Test</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-21-83><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-21-84><span class=w>        </span><span class=c1>// 锁对象</span>
</span><span id=__span-21-85><span class=w>        </span><span class=n>Product</span><span class=w> </span><span class=n>product</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Product</span><span class=p>();</span>
</span><span id=__span-21-86><span class=w>        </span><span class=c1>// 创建线程对象</span>
</span><span id=__span-21-87><span class=w>        </span><span class=n>Create</span><span class=w> </span><span class=n>create</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Create</span><span class=p>(</span><span class=n>product</span><span class=p>);</span>
</span><span id=__span-21-88><span class=w>        </span><span class=n>Consume</span><span class=w> </span><span class=n>consume</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Consume</span><span class=p>(</span><span class=n>product</span><span class=p>);</span>
</span><span id=__span-21-89><span class=w>        </span><span class=c1>// 启动线程</span>
</span><span id=__span-21-90><span class=w>        </span><span class=k>new</span><span class=w> </span><span class=n>Thread</span><span class=p>(</span><span class=n>create</span><span class=p>).</span><span class=na>start</span><span class=p>();</span>
</span><span id=__span-21-91><span class=w>        </span><span class=k>new</span><span class=w> </span><span class=n>Thread</span><span class=p>(</span><span class=n>create</span><span class=p>).</span><span class=na>start</span><span class=p>();</span>
</span><span id=__span-21-92><span class=w>        </span><span class=k>new</span><span class=w> </span><span class=n>Thread</span><span class=p>(</span><span class=n>create</span><span class=p>).</span><span class=na>start</span><span class=p>();</span>
</span><span id=__span-21-93>
</span><span id=__span-21-94><span class=w>        </span><span class=k>new</span><span class=w> </span><span class=n>Thread</span><span class=p>(</span><span class=n>consume</span><span class=p>).</span><span class=na>start</span><span class=p>();</span>
</span><span id=__span-21-95><span class=w>        </span><span class=k>new</span><span class=w> </span><span class=n>Thread</span><span class=p>(</span><span class=n>consume</span><span class=p>).</span><span class=na>start</span><span class=p>();</span>
</span><span id=__span-21-96><span class=w>        </span><span class=k>new</span><span class=w> </span><span class=n>Thread</span><span class=p>(</span><span class=n>consume</span><span class=p>).</span><span class=na>start</span><span class=p>();</span>
</span><span id=__span-21-97><span class=w>    </span><span class=p>}</span>
</span><span id=__span-21-98><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <h4 id=_23>实例实现（使用同步方法）<a class=headerlink href=#_23 title="Permanent link">&para;</a></h4> <p>基本逻辑与前面一致，基于非静态同步方法修改，需要注意，同步方法不需要使用锁对象，对于非静态同步方法来说，锁对象默认是<code>this</code></p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>注意，不可以使用静态同步方法，因为如果是静态同步方法，就需要在静态同步方法中使用静态的<code>wait</code>和<code>notify</code>，但是二者并没有对应的静态版本</p> </div> <ul> <li>非静态同步方法</li> </ul> <div class="admonition note"> <p class=admonition-title>Note</p> <p>为了保证<code>this</code>指向同一个对象，依旧需要使用构造函数将产品对象传入，确保锁唯一</p> </div> <div class="language-java highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>Java</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span>
<span class=normal>45</span>
<span class=normal>46</span>
<span class=normal>47</span>
<span class=normal>48</span>
<span class=normal>49</span>
<span class=normal>50</span>
<span class=normal>51</span>
<span class=normal>52</span>
<span class=normal>53</span>
<span class=normal>54</span>
<span class=normal>55</span>
<span class=normal>56</span>
<span class=normal>57</span>
<span class=normal>58</span>
<span class=normal>59</span>
<span class=normal>60</span>
<span class=normal>61</span>
<span class=normal>62</span>
<span class=normal>63</span>
<span class=normal>64</span>
<span class=normal>65</span>
<span class=normal>66</span>
<span class=normal>67</span>
<span class=normal>68</span>
<span class=normal>69</span>
<span class=normal>70</span>
<span class=normal>71</span>
<span class=normal>72</span>
<span class=normal>73</span>
<span class=normal>74</span>
<span class=normal>75</span>
<span class=normal>76</span>
<span class=normal>77</span>
<span class=normal>78</span>
<span class=normal>79</span>
<span class=normal>80</span>
<span class=normal>81</span>
<span class=normal>82</span>
<span class=normal>83</span>
<span class=normal>84</span>
<span class=normal>85</span>
<span class=normal>86</span>
<span class=normal>87</span>
<span class=normal>88</span>
<span class=normal>89</span>
<span class=normal>90</span>
<span class=normal>91</span>
<span class=normal>92</span>
<span class=normal>93</span>
<span class=normal>94</span>
<span class=normal>95</span>
<span class=normal>96</span>
<span class=normal>97</span>
<span class=normal>98</span>
<span class=normal>99</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-22-1><span class=c1>// 产品类</span>
</span><span id=__span-22-2><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Product01</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-22-3><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>count</span><span class=p>;</span>
</span><span id=__span-22-4><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=n>flag</span><span class=p>;</span>
</span><span id=__span-22-5>
</span><span id=__span-22-6><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>synchronized</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>getCount</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-22-7><span class=w>        </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>isFlag</span><span class=p>())</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-22-8><span class=w>            </span><span class=k>try</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-22-9><span class=w>                </span><span class=n>wait</span><span class=p>();</span>
</span><span id=__span-22-10><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>InterruptedException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-22-11><span class=w>                </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;消费异常&quot;</span><span class=p>);</span>
</span><span id=__span-22-12><span class=w>            </span><span class=p>}</span>
</span><span id=__span-22-13><span class=w>        </span><span class=p>}</span>
</span><span id=__span-22-14><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;消费了&quot;</span><span class=o>+</span><span class=n>count</span><span class=p>);</span>
</span><span id=__span-22-15><span class=w>        </span><span class=n>setFlag</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
</span><span id=__span-22-16><span class=w>        </span><span class=n>notifyAll</span><span class=p>();</span>
</span><span id=__span-22-17><span class=w>    </span><span class=p>}</span>
</span><span id=__span-22-18>
</span><span id=__span-22-19><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>synchronized</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>setCount</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-22-20><span class=w>        </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>isFlag</span><span class=p>())</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-22-21><span class=w>            </span><span class=k>try</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-22-22><span class=w>                </span><span class=n>wait</span><span class=p>();</span>
</span><span id=__span-22-23><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>InterruptedException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-22-24><span class=w>                </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;生产异常&quot;</span><span class=p>);</span>
</span><span id=__span-22-25><span class=w>            </span><span class=p>}</span>
</span><span id=__span-22-26><span class=w>        </span><span class=p>}</span>
</span><span id=__span-22-27>
</span><span id=__span-22-28><span class=w>        </span><span class=n>count</span><span class=o>++</span><span class=p>;</span>
</span><span id=__span-22-29><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;生产了&quot;</span><span class=o>+</span><span class=n>count</span><span class=p>);</span>
</span><span id=__span-22-30><span class=w>        </span><span class=n>setFlag</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span>
</span><span id=__span-22-31><span class=w>        </span><span class=n>notifyAll</span><span class=p>();</span>
</span><span id=__span-22-32><span class=w>    </span><span class=p>}</span>
</span><span id=__span-22-33>
</span><span id=__span-22-34><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=nf>isFlag</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-22-35><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>flag</span><span class=p>;</span>
</span><span id=__span-22-36><span class=w>    </span><span class=p>}</span>
</span><span id=__span-22-37>
</span><span id=__span-22-38><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>setFlag</span><span class=p>(</span><span class=kt>boolean</span><span class=w> </span><span class=n>flag</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-22-39><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>flag</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>flag</span><span class=p>;</span>
</span><span id=__span-22-40><span class=w>    </span><span class=p>}</span>
</span><span id=__span-22-41><span class=p>}</span>
</span><span id=__span-22-42>
</span><span id=__span-22-43><span class=c1>// 消费线程</span>
</span><span id=__span-22-44><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Consume01</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>Runnable</span><span class=p>{</span>
</span><span id=__span-22-45><span class=w>    </span><span class=n>Product</span><span class=w> </span><span class=n>product</span><span class=p>;</span>
</span><span id=__span-22-46><span class=w>    </span><span class=nd>@Override</span>
</span><span id=__span-22-47><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>run</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-22-48><span class=w>        </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=kc>true</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-22-49><span class=w>            </span><span class=k>try</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-22-50><span class=w>                </span><span class=n>Thread</span><span class=p>.</span><span class=na>sleep</span><span class=p>(</span><span class=mi>1000L</span><span class=p>);</span>
</span><span id=__span-22-51><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>InterruptedException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-22-52><span class=w>                </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>RuntimeException</span><span class=p>(</span><span class=n>e</span><span class=p>);</span>
</span><span id=__span-22-53><span class=w>            </span><span class=p>}</span>
</span><span id=__span-22-54>
</span><span id=__span-22-55><span class=w>            </span><span class=n>product</span><span class=p>.</span><span class=na>getCount</span><span class=p>();</span>
</span><span id=__span-22-56><span class=w>        </span><span class=p>}</span>
</span><span id=__span-22-57><span class=w>    </span><span class=p>}</span>
</span><span id=__span-22-58><span class=p>}</span>
</span><span id=__span-22-59>
</span><span id=__span-22-60><span class=c1>// 生产线程</span>
</span><span id=__span-22-61><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Create01</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>Runnable</span><span class=p>{</span>
</span><span id=__span-22-62><span class=w>    </span><span class=n>Product</span><span class=w> </span><span class=n>product</span><span class=p>;</span>
</span><span id=__span-22-63>
</span><span id=__span-22-64><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>Create01</span><span class=p>(</span><span class=n>Product</span><span class=w> </span><span class=n>product</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-22-65><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>product</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>product</span><span class=p>;</span>
</span><span id=__span-22-66><span class=w>    </span><span class=p>}</span>
</span><span id=__span-22-67>
</span><span id=__span-22-68><span class=w>    </span><span class=nd>@Override</span>
</span><span id=__span-22-69><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>run</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-22-70><span class=w>        </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=kc>true</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-22-71><span class=w>            </span><span class=k>try</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-22-72><span class=w>                </span><span class=n>Thread</span><span class=p>.</span><span class=na>sleep</span><span class=p>(</span><span class=mi>1000L</span><span class=p>);</span>
</span><span id=__span-22-73><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>InterruptedException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-22-74><span class=w>                </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>RuntimeException</span><span class=p>(</span><span class=n>e</span><span class=p>);</span>
</span><span id=__span-22-75><span class=w>            </span><span class=p>}</span>
</span><span id=__span-22-76>
</span><span id=__span-22-77><span class=w>            </span><span class=n>product</span><span class=p>.</span><span class=na>setCount</span><span class=p>();</span>
</span><span id=__span-22-78><span class=w>        </span><span class=p>}</span>
</span><span id=__span-22-79><span class=w>    </span><span class=p>}</span>
</span><span id=__span-22-80><span class=p>}</span>
</span><span id=__span-22-81>
</span><span id=__span-22-82><span class=c1>// 测试</span>
</span><span id=__span-22-83><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Test</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-22-84><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-22-85><span class=w>        </span><span class=c1>// 同步方法</span>
</span><span id=__span-22-86><span class=w>        </span><span class=n>Product</span><span class=w> </span><span class=n>product</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Product</span><span class=p>();</span>
</span><span id=__span-22-87><span class=w>        </span><span class=c1>// 创建线程对象</span>
</span><span id=__span-22-88><span class=w>        </span><span class=n>Create</span><span class=w> </span><span class=n>create</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Create</span><span class=p>(</span><span class=n>product</span><span class=p>);</span>
</span><span id=__span-22-89><span class=w>        </span><span class=n>Consume</span><span class=w> </span><span class=n>consume</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Consume</span><span class=p>(</span><span class=n>product</span><span class=p>);</span>
</span><span id=__span-22-90><span class=w>        </span><span class=c1>// 启动线程</span>
</span><span id=__span-22-91><span class=w>        </span><span class=k>new</span><span class=w> </span><span class=n>Thread</span><span class=p>(</span><span class=n>create</span><span class=p>).</span><span class=na>start</span><span class=p>();</span>
</span><span id=__span-22-92><span class=w>        </span><span class=k>new</span><span class=w> </span><span class=n>Thread</span><span class=p>(</span><span class=n>create</span><span class=p>).</span><span class=na>start</span><span class=p>();</span>
</span><span id=__span-22-93><span class=w>        </span><span class=k>new</span><span class=w> </span><span class=n>Thread</span><span class=p>(</span><span class=n>create</span><span class=p>).</span><span class=na>start</span><span class=p>();</span>
</span><span id=__span-22-94>
</span><span id=__span-22-95><span class=w>        </span><span class=k>new</span><span class=w> </span><span class=n>Thread</span><span class=p>(</span><span class=n>consume</span><span class=p>).</span><span class=na>start</span><span class=p>();</span>
</span><span id=__span-22-96><span class=w>        </span><span class=k>new</span><span class=w> </span><span class=n>Thread</span><span class=p>(</span><span class=n>consume</span><span class=p>).</span><span class=na>start</span><span class=p>();</span>
</span><span id=__span-22-97><span class=w>        </span><span class=k>new</span><span class=w> </span><span class=n>Thread</span><span class=p>(</span><span class=n>consume</span><span class=p>).</span><span class=na>start</span><span class=p>();</span>
</span><span id=__span-22-98><span class=w>    </span><span class=p>}</span>
</span><span id=__span-22-99><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <h2 id=_24>定时器（了解）<a class=headerlink href=#_24 title="Permanent link">&para;</a></h2> <p>使用定时器可以规定间隔多长时间执行一次线程任务</p> <p>创建定时器可以使用<code>Timer()</code>构造方法</p> <p>在<code>Timer</code>中存在一个方法<code>void schedule(TimerTask task, Date firstTime, long period)</code>可以对给定的线程进行执行时间设置，第一个参数为线程任务，<code>TimeTask</code>是一个抽象类，该类实现自<code>Runnable</code>接口，所以也存在一个抽象方法<code>run()</code>，实现了<code>TimerTask</code>的类需要重写<code>run()</code>重写，第二个参数表示开始时间，第三个参数表示间隔时间，单位为毫秒</p> <p>使用实例：</p> <div class="language-java highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>Java</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-23-1><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Test08</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-23-2><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-23-3><span class=w>        </span><span class=n>Timer</span><span class=w> </span><span class=n>timer</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Timer</span><span class=p>();</span>
</span><span id=__span-23-4><span class=w>        </span><span class=c1>// 使用匿名内部类实现TimerTask()接口</span>
</span><span id=__span-23-5><span class=w>        </span><span class=n>timer</span><span class=p>.</span><span class=na>schedule</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>TimerTask</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-23-6><span class=w>            </span><span class=nd>@Override</span>
</span><span id=__span-23-7><span class=w>            </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>run</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-23-8><span class=w>                </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;重写Runnable方法&quot;</span><span class=p>);</span>
</span><span id=__span-23-9><span class=w>            </span><span class=p>}</span>
</span><span id=__span-23-10><span class=w>        </span><span class=p>},</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Date</span><span class=p>(),</span><span class=w> </span><span class=mi>1000L</span><span class=p>);</span>
</span><span id=__span-23-11><span class=w>    </span><span class=p>}</span>
</span><span id=__span-23-12><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title=最后更新> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">2025年7月30日</span> </span> </aside> <form class=md-feedback name=feedback hidden> <fieldset> <legend class=md-feedback__title> 页面有帮助吗？ </legend> <div class=md-feedback__inner> <div class=md-feedback__list> <button class="md-feedback__icon md-icon" type=submit title=页面对我有帮助 data-md-value=1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M5 9v12H1V9zm4 12a2 2 0 0 1-2-2V9c0-.55.22-1.05.59-1.41L14.17 1l1.06 1.06c.27.27.44.64.44 1.05l-.03.32L14.69 8H21a2 2 0 0 1 2 2v2c0 .26-.05.5-.14.73l-3.02 7.05C19.54 20.5 18.83 21 18 21zm0-2h9.03L21 12v-2h-8.79l1.13-5.32L9 9.03z"/></svg> </button> <button class="md-feedback__icon md-icon" type=submit title=页面没有帮助到我 data-md-value=0> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 15V3h4v12zM15 3a2 2 0 0 1 2 2v10c0 .55-.22 1.05-.59 1.41L9.83 23l-1.06-1.06c-.27-.27-.44-.64-.44-1.06l.03-.31.95-4.57H3a2 2 0 0 1-2-2v-2c0-.26.05-.5.14-.73l3.02-7.05C4.46 3.5 5.17 3 6 3zm0 2H5.97L3 12v2h8.78l-1.13 5.32L15 14.97z"/></svg> </button> </div> <div class=md-feedback__note> <div data-md-value=1 hidden> 谢谢你的反馈！ </div> <div data-md-value=0 hidden> 谢谢你的反馈！联系<a href=https://www.help-doc.top/author/contact/contact.html>作者</a>提供更详细的信息 </div> </div> </div> </fieldset> </form> <!-- Waline 评论系统 --> <div id=waline></div> <!-- 阅读进度条 - 直接在HTML中定义 --> <div class=reading-progress></div> <!-- 滚动指示器 - 直接在HTML中定义 --> <div class=scroll-indicator></div> <!-- 评论系统 --> <!-- Waline 评论系统 --> <div id=waline></div> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <!--
  Copyright (c) 2016-2024 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
--> <!-- Footer --> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2024-2025 柯懒不是柯南 </div> </div> <div class="md-footer-love md-typeset"> 一闪一闪亮晶晶，不及<span class=love-highlight>小亮</span><span class=love-heart>♥</span>照我心。To Li Liang </div> <div class=md-social> <a href=https://github.com/H0308 target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> <a href=https://www.help-doc.top/author/contact/contact.html target=_blank rel=noopener title=www.help-doc.top class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M433.754 420.445c-11.526 1.393-44.86-52.741-44.86-52.741 0 31.345-16.136 72.247-51.051 101.786 16.842 5.192 54.843 19.167 45.803 34.421-7.316 12.343-125.51 7.881-159.632 4.037-34.122 3.844-152.316 8.306-159.632-4.037-9.045-15.25 28.918-29.214 45.783-34.415-34.92-29.539-51.059-70.445-51.059-101.792 0 0-33.334 54.134-44.859 52.741-5.37-.65-12.424-29.644 9.347-99.704 10.261-33.024 21.995-60.478 40.144-105.779C60.683 98.063 108.982.006 224 0c113.737.006 163.156 96.133 160.264 214.963 18.118 45.223 29.912 72.85 40.144 105.778 21.768 70.06 14.716 99.053 9.346 99.704"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.indexes", "navigation.prune", "navigation.tabs", "search.highlight", "content.code.copy"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script> <script src=../../assets/javascripts/bundle.c8b220af.min.js></script> <script src=../../javascripts/katex.min.js></script> <script src=../../javascripts/other.min.js></script> <script src=../../javascripts/copyright.min.js></script> <script src=https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.js></script> <script src=https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/contrib/auto-render.min.js></script> <script src=../../assets/javascripts/toggle-sidebar.js async></script> <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body> </html>