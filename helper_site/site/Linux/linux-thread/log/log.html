<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=canonical href=https://www.help-doc.top/Linux/linux-thread/log/log.html><link rel=prev href=../thread-pc/thread-pc.html><link rel=next href=../thread-safe-deadlock/thread-safe-deadlock.html><link rel=icon href=../../../images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.12"><title>日志系统 - 柯懒的知识库</title><link rel=stylesheet href=../../../assets/stylesheets/main.2afb09e1.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.06af60db.min.css><link rel=stylesheet href=../../../css/timeline.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.css><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-9XWRGNRRSY"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-9XWRGNRRSY",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-9XWRGNRRSY",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script><link rel=stylesheet href=../../../stylesheets/colors.min.css><link rel=stylesheet href=../../../stylesheets/theme2.min.css media="screen and (max-width: 1199px)"><link rel=stylesheet href=../../../stylesheets/theme2.min.css media="screen and (min-width: 1200px)" id=theme2-desktop><link rel=stylesheet href=../../../stylesheets/theme1.min.css media="screen and (min-width: 1200px)" id=theme1-desktop><link rel=stylesheet href=../../../stylesheets/print.min.css><link rel=stylesheet href=../../../stylesheets/font-dongguanti.min.css id=font-dongguanti><link rel=stylesheet href=../../../stylesheets/font-oppoti.min.css id=font-oppoti disabled><link rel=stylesheet href=../../../stylesheets/font-jiangchengti.min.css id=font-jiangchengti disabled><link rel=stylesheet href=../../../stylesheets/font-lxgw.min.css id=font-lxgw disabled><link rel=stylesheet href=../../../stylesheets/code-font-dejavu-sans-mono.min.css id=code-font-dejavu-sans-mono><link rel=stylesheet href=../../../stylesheets/code-font-zsft-hk.min.css id=code-font-zsft-hk disabled><link rel=stylesheet href=../../../stylesheets/code-font-google-sans-code.min.css id=code-font-google-sans-code disabled><link rel=stylesheet href=https://unpkg.com/@waline/client@v3/dist/waline.css><link rel=stylesheet href=../../../stylesheets/waline.min.css><script src=../../../javascripts/start.min.js></script> <link href="../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../../assets/javascripts/glightbox.min.js"></script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=white data-md-color-accent=cyan> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#_1 class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=页眉> <a href=../../../index.html title=柯懒的知识库 class="md-header__button md-logo" aria-label=柯懒的知识库 data-md-component=logo> <img src=../../../assets/logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> 柯懒的知识库 </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> 日志系统 </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=white data-md-color-accent=cyan aria-label type=radio name=__palette id=__palette_1> </form> <div class=header-avatar> <img src=../../../author/作者.assets/20250206-200653.jpg alt=头像> <div class=avatar-dropdown> <p><strong>柯懒不是柯南</strong></p> <a href=../../../author/contact/contact.html class=avatar-dropdown-item>联系作者</a> <div class=avatar-dropdown-divider></div> <a href=../../../author/about/about.html class=avatar-dropdown-item>关于作者</a> <div class=avatar-dropdown-divider></div> <a href=https://github.com/H0308 class=avatar-dropdown-item>Github仓库</a> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=查找> <button type=reset class="md-search__icon md-icon" title=清空当前内容 aria-label=清空当前内容 tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 正在初始化搜索引擎 </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> </nav> </header> <div class=toolbar-toggle-btn id=toolbarToggleBtn onclick=toggleToolbar()> <div class=toggle-icon> <svg class=toggle-arrow-icon viewbox="0 0 1024 1024" version=1.1 xmlns=http://www.w3.org/2000/svg width=16 height=16> <path d="M346.538667 1024L170.666667 853.333333l341.333333-341.333333-341.333333-341.333333 175.872-170.666667L853.333333 512z" fill=currentColor></path> </svg> </div> </div> <div class=floating-toolbar id=floatingToolbar> <div class="toolbar-item font-switcher"> <div class=toolbar-icon> <svg class=font-icon viewbox="0 0 1024 1024" version=1.1 xmlns=http://www.w3.org/2000/svg width=20 height=20> <path d="M913.408 1024l-66.56 0q-29.696 0-51.2-5.12t-36.864-15.872-26.112-27.136-19.968-37.888q-15.36-38.912-28.16-70.656t-22.016-55.296q-11.264-26.624-20.48-49.152l-254.976 0q-7.168 23.552-17.408 51.2-8.192 23.552-21.504 56.832t-30.72 72.192q-20.48 46.08-47.104 63.488t-60.416 17.408l-70.656 0q-45.056 0-60.928-19.968t2.56-68.096q18.432-46.08 43.008-108.544t52.224-132.608 57.344-143.872 57.344-144.384q65.536-164.864 137.216-343.04 7.168-17.408 18.432-31.744 10.24-11.264 27.136-21.504t42.496-10.24q26.624 0 43.52 10.752t28.16 24.064q12.288 15.36 19.456 33.792 72.704 180.224 138.24 345.088 27.648 70.656 57.344 143.872t56.832 142.336 51.2 129.536 41.472 104.448q14.336 34.816 4.096 62.464t-43.008 27.648zM616.448 634.88l-97.28-347.136-1.024 0-108.544 347.136 206.848 0z" fill=currentColor></path> </svg> </div> <div class=toolbar-label>内容字体</div> <div class=font-dropdown-toolbar> <div class=font-current-toolbar onclick=toggleFontDropdownToolbar()> <span class=current-font-name-toolbar>东观体</span> <svg class=dropdown-arrow-icon viewbox="0 0 1024 1024" version=1.1 xmlns=http://www.w3.org/2000/svg width=12 height=12> <path d="M878.592 250.88q29.696 0 48.128 11.264t24.576 29.696 0 41.472-26.624 45.568q-82.944 92.16-159.744 180.224t-148.48 164.864q-19.456 20.48-45.568 31.744t-53.76 11.776-53.248-8.704-43.008-28.672q-39.936-44.032-82.944-90.112l-88.064-92.16q-43.008-46.08-85.504-90.624t-79.36-86.528q-17.408-19.456-22.528-40.448t1.024-38.4 23.552-28.672 45.056-11.264q35.84 0 98.816-0.512t137.728-0.512l153.6 0 150.528 0 125.952 0 79.872 0z" fill=currentColor></path> </svg> </div> <div class=font-options-toolbar> <div class=font-option-toolbar data-font=dongguanti onclick="selectFontToolbar('dongguanti')">上图东观体 </div> <div class=font-option-toolbar data-font=oppoti onclick="selectFontToolbar('oppoti')">OPPO Sans </div> <div class=font-option-toolbar data-font=jiangchengti onclick="selectFontToolbar('jiangchengti')"> 江城黑体</div> <div class=font-option-toolbar data-font=lxgw onclick="selectFontToolbar('lxgw')">霞鹜臻楷</div> </div> </div> </div> <div class="toolbar-item code-font-switcher"> <div class=toolbar-icon> <svg t=1753672111433 class="icon code-font-icon" viewbox="0 0 1024 1024" version=1.1 xmlns=http://www.w3.org/2000/svg p-id=5148 width=20 height=20> <path d="M941.709938 0H82.290062A82.290062 82.290062 0 0 0 0 82.290062v859.419876A82.290062 82.290062 0 0 0 82.290062 1022.53923h859.419876A82.290062 82.290062 0 0 0 1022.53923 941.709938V82.290062A82.290062 82.290062 0 0 0 941.709938 0zM188.439372 553.631954a40.901569 40.901569 0 0 1-29.215406-70.116975L292.154066 351.558726 159.223966 218.628626a40.901569 40.901569 0 0 1 58.430813-57.94389l160.197813 162.145507a40.901569 40.901569 0 0 1 0 57.943889l-160.197813 160.684736a40.901569 40.901569 0 0 1-29.215407 12.173086z m443.587257 0H405.120304a40.901569 40.901569 0 0 1 0-82.290061H633.000476a40.901569 40.901569 0 0 1 0 82.290061z" fill=currentColor p-id=5149></path> </svg> </div> <div class=toolbar-label>代码字体</div> <div class=code-font-dropdown-toolbar> <div class=code-font-current-toolbar onclick=toggleCodeFontDropdownToolbar()> <span class=current-code-font-name-toolbar>DejaVu Sans Mono</span> <svg class=dropdown-arrow-icon viewbox="0 0 1024 1024" version=1.1 xmlns=http://www.w3.org/2000/svg width=12 height=12> <path d="M878.592 250.88q29.696 0 48.128 11.264t24.576 29.696 0 41.472-26.624 45.568q-82.944 92.16-159.744 180.224t-148.48 164.864q-19.456 20.48-45.568 31.744t-53.76 11.776-53.248-8.704-43.008-28.672q-39.936-44.032-82.944-90.112l-88.064-92.16q-43.008-46.08-85.504-90.624t-79.36-86.528q-17.408-19.456-22.528-40.448t1.024-38.4 23.552-28.672 45.056-11.264q35.84 0 98.816-0.512t137.728-0.512l153.6 0 150.528 0 125.952 0 79.872 0z" fill=currentColor></path> </svg> </div> <div class=code-font-options-toolbar> <div class=code-font-option-toolbar data-code-font=dejavu onclick="selectCodeFontToolbar('dejavu')"> DejaVu Sans Mono</div> <div class=code-font-option-toolbar data-code-font=google-sans-code onclick="selectCodeFontToolbar('google-sans-code')"> Google Sans Code</div> <div class=code-font-option-toolbar data-code-font=zsft onclick="selectCodeFontToolbar('zsft')"> JetBrains Mono</div> </div> </div> </div> <div class="toolbar-item theme-switcher" onclick=switchTheme()> <div class=toolbar-icon> <svg class=theme-icon viewbox="0 0 1024 1024" version=1.1 xmlns=http://www.w3.org/2000/svg width=20 height=20> <path d="M876.572788 522.301623c-1.886977 12.375865-9.657964 30.331819-35.880185 45.48903-56.489572 32.697703-150.21828 83.990926-174.010149 96.958262-13.143345 24.431435-66.067718 122.221646-98.141204 178.503487-16.117073 28.124548-36.055171 34.041304-50.030463 34.041304-0.031722 0-0.031722 0-0.031722 0-14.613836 0-29.1806-6.460132-43.234687-19.218714-47.183626-42.643216-125.994576-117.105115-146.013515-136.083351-27.757181-4.732791-138.338718-23.743774-200.584388-35.752272-17.924231-3.533476-32.649608-14.07046-40.372499-29.084409-5.78782-11.256368-10.281157-30.05962 1.471514-55.658647 26.989701-59.047838 74.126254-157.557432 85.957721-182.196599-3.437286-27.117614-16.996093-135.060045-23.760147-198.905142-1.886977-17.460674 3.901867-35.096333 15.829524-48.351218 12.791327-14.278191 30.667463-21.48943 49.854455-19.426445 63.669088 6.332219 173.259042 19.426445 200.584388 22.705118 24.335245-11.879562 121.085776-58.936297 180.133613-86.34146 9.91379-4.573155 19.85828-6.92369 29.596062-6.92369 28.748764 0 52.172243 20.642133 58.328453 51.421136 12.599969 62.997799 30.93864 166.70272 35.639708 193.484689 18.851347 19.682271 91.953272 96.031147 135.060045 143.07151C872.72004 487.125473 879.307062 504.71406 876.572788 522.301623L876.572788 522.301623zM825.375755 499.085876C776.017604 445.314205 687.245791 352.977193 686.365748 352.017332c-2.942005-3.069919-4.956895-6.971785-5.676279-11.208273-0.207731-1.215688-22.193465-127.001509-36.551474-198.936865-0.799202-3.917216-4.285606-16.836457-16.196891-16.836457-3.453658 0-7.30743 1.006933-11.464099 2.942005-67.282383 31.179117-183.955662 88.180342-185.170327 88.771813-3.693112 1.790786-7.850805 2.558265-11.975752 2.01489-1.295506-0.224104-133.63765-16.165168-205.988468-23.424502-0.079818 0-0.207731 0-0.287549 0-7.30743 0-11.128455 2.89391-13.319353 5.40408-3.677762 4.124947-5.644557 9.91379-5.068436 15.110139 7.674796 72.623018 24.255427 202.934922 24.463158 204.325595 0.511653 4.109598-0.159636 8.266267-1.966795 11.960403-0.591471 1.215688-57.657164 120.04712-88.339977 187.201589-3.565199 7.754614-4.41352 14.214746-2.350534 18.131963 1.935072 3.725858 6.588045 5.820566 10.360975 6.53995 70.719668 13.718443 204.644867 36.519752 206.036563 36.727483 4.189416 0.671289 8.058536 2.686179 11.112082 5.580089 1.006933 0.87902 96.414887 91.281983 150.090367 139.889027 8.314363 7.563256 13.143345 8.106632 14.437827 8.106632 3.485381 0 8.314363-4.621251 12.727882-12.391215 36.343743-63.828724 100.011808-181.988868 100.636025-183.155437 1.983167-3.64604 5.004991-6.667863 8.650007-8.650007 1.134847-0.671289 114.418936-62.373583 178.6314-99.516528 8.698103-5.036713 14.278191-10.568706 14.94948-14.854313C834.681702 511.845481 831.49922 505.800811 825.375755 499.085876L825.375755 499.085876zM935.333076 935.670256c-4.157693 4.157693-9.689686 6.299473-15.141862 6.299473-5.548366 0-11.048637-2.142803-15.238053-6.299473l-171.915441-171.915441c-8.362458-8.394181-8.362458-21.98471 0-30.426987 8.394181-8.394181 21.98471-8.394181 30.379914 0l171.915441 171.915441C943.727257 913.684522 943.727257 927.275052 935.333076 935.670256L935.333076 935.670256z" fill=currentColor></path> </svg> </div> <div class=toolbar-label>主题切换</div> </div> <div class="toolbar-item back-to-top" onclick=scrollToTop()> <div class=toolbar-icon> <svg class=back-to-top-icon viewbox="0 0 1024 1024" xmlns=http://www.w3.org/2000/svg> <path d="M882.688 624.128l-336.896-583.68c-15.872-27.136-54.784-27.136-70.656 0L138.24 624.128c-15.872 27.136 4.096 61.44 35.328 61.44H317.44c22.528 0 40.96 18.432 40.96 40.96v239.616c0 22.528 18.432 40.96 40.96 40.96h223.232c22.528 0 40.96-18.432 40.96-40.96v-239.616c0-22.528 18.432-40.96 40.96-40.96h143.872c30.208 0 50.176-34.304 34.304-61.44z"> </path> </svg> </div> <div class=toolbar-label>返回顶部</div> </div> </div> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=标签 data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../../index.html class=md-tabs__link> 主页 </a> </li> <li class=md-tabs__item> <a href=../../../intro/intro.html class=md-tabs__link> 网站介绍 </a> </li> <li class=md-tabs__item> <a href=../../../timeline/timeline.html class=md-tabs__link> 网站时间线 </a> </li> <li class=md-tabs__item> <a href=../../../languages/index.html class=md-tabs__link> 编程语言 </a> </li> <li class=md-tabs__item> <a href=../../../data-structure-algo/index.html class=md-tabs__link> 数据结构与算法 </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../../index.html class=md-tabs__link> Linux </a> </li> <li class=md-tabs__item> <a href=../../../front-end/index.html class=md-tabs__link> 前端 </a> </li> <li class=md-tabs__item> <a href=../../../MySQL/index.html class=md-tabs__link> MySQL </a> </li> <li class=md-tabs__item> <a href=../../../JavaEE/index.html class=md-tabs__link> JavaEE应用开发 </a> </li> <li class=md-tabs__item> <a href=../../../other/index.html class=md-tabs__link> 扩展知识 </a> </li> <li class=md-tabs__item> <a href=../../../tooltips/index.html class=md-tabs__link> 工具帮助 </a> </li> <li class=md-tabs__item> <a href=../../../test-encrypt/test-encrypt.html class=md-tabs__link> 测试加密功能 </a> </li> <li class=md-tabs__item> <a href=../../../projects/index.html class=md-tabs__link> 项目 </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=导航栏 data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../../index.html title=柯懒的知识库 class="md-nav__button md-logo" aria-label=柯懒的知识库 data-md-component=logo> <img src=../../../assets/logo.png alt=logo> </a> 柯懒的知识库 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../index.html class=md-nav__link> <span class=md-ellipsis> 主页 </span> </a> </li> <li class=md-nav__item> <a href=../../../intro/intro.html class=md-nav__link> <span class=md-ellipsis> 网站介绍 </span> </a> </li> <li class=md-nav__item> <a href=../../../timeline/timeline.html class=md-nav__link> <span class=md-ellipsis> 网站时间线 </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../languages/index.html class=md-nav__link> <span class=md-ellipsis> 编程语言 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../data-structure-algo/index.html class=md-nav__link> <span class=md-ellipsis> 数据结构与算法 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6 checked> <div class="md-nav__link md-nav__container"> <a href=../../index.html class="md-nav__link "> <span class=md-ellipsis> Linux </span> </a> <label class="md-nav__link " for=__nav_6 id=__nav_6_label tabindex> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=true> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Linux </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../options-commands/options-commands.html class=md-nav__link> <span class=md-ellipsis> Linux常用选项和指令 </span> </a> </li> <li class=md-nav__item> <a href=../../permission/permission.html class=md-nav__link> <span class=md-ellipsis> Linux权限相关 </span> </a> </li> <li class=md-nav__item> <a href=../../software-installation/software-installation.html class=md-nav__link> <span class=md-ellipsis> CentOS软件安装 </span> </a> </li> <li class=md-nav__item> <a href=../../gcc-gdb/gcc-gdb.html class=md-nav__link> <span class=md-ellipsis> Linux下的gcc与gdb </span> </a> </li> <li class=md-nav__item> <a href=../../makefile-progress-bar/makefile-progress-bar.html class=md-nav__link> <span class=md-ellipsis> Linux下的Makefile与进度条程序 </span> </a> </li> <li class=md-nav__item> <a href=../../os-basic/os-basic.html class=md-nav__link> <span class=md-ellipsis> 操作系统基础知识 </span> </a> </li> <li class=md-nav__item> <a href=../../process-basic/process-basic.html class=md-nav__link> <span class=md-ellipsis> Linux进程基础 </span> </a> </li> <li class=md-nav__item> <a href=../../process-state-priority/process-state-priority.html class=md-nav__link> <span class=md-ellipsis> Linux进程状态与进程优先级 </span> </a> </li> <li class=md-nav__item> <a href=../../process-switch-scheduling/process-switch-scheduling.html class=md-nav__link> <span class=md-ellipsis> Linux进程切换以及调度算法 </span> </a> </li> <li class=md-nav__item> <a href=../../command-line-env/command-line-env.html class=md-nav__link> <span class=md-ellipsis> Linux命令行与环境变量 </span> </a> </li> <li class=md-nav__item> <a href=../../process-address-space/process-address-space.html class=md-nav__link> <span class=md-ellipsis> Linux进程地址空间 </span> </a> </li> <li class=md-nav__item> <a href=../../process-control/process-control.html class=md-nav__link> <span class=md-ellipsis> Linux进程控制 </span> </a> </li> <li class=md-nav__item> <a href=../../linux-fileop/linux-fileop.html class=md-nav__link> <span class=md-ellipsis> Linux文件操作基础 </span> </a> </li> <li class=md-nav__item> <a href=../../io-process/io-process.html class=md-nav__link> <span class=md-ellipsis> Linux中输入和输出基本过程 </span> </a> </li> <li class=md-nav__item> <a href=../../file-system/file-system.html class=md-nav__link> <span class=md-ellipsis> Linux文件系统 </span> </a> </li> <li class=md-nav__item> <a href=../../soft-hard-link/soft-hard-link.html class=md-nav__link> <span class=md-ellipsis> Linux软链接和硬链接 </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../com-process/com-anonymous-pipe/com-anonymous-pipe.html class=md-nav__link> <span class=md-ellipsis> Linux进程间通信 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class=md-nav__item> <a href=../../signals-os-principles/signals-os-principles.html class=md-nav__link> <span class=md-ellipsis> Linux信号与操作系统原理 </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_20 checked> <label class=md-nav__link for=__nav_6_20 id=__nav_6_20_label tabindex=0> <span class=md-ellipsis> Linux线程 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_20_label aria-expanded=true> <label class=md-nav__title for=__nav_6_20> <span class="md-nav__icon md-icon"></span> Linux线程 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../thread-concept-op/thread-concept-op.html class=md-nav__link> <span class=md-ellipsis> Linux线程概念与线程操作 </span> </a> </li> <li class=md-nav__item> <a href=../thread-lib/thread-lib.html class=md-nav__link> <span class=md-ellipsis> Linux线程库与线程库封装 </span> </a> </li> <li class=md-nav__item> <a href=../thread-sync/thread-sync.html class=md-nav__link> <span class=md-ellipsis> Linux线程互斥与同步 </span> </a> </li> <li class=md-nav__item> <a href=../thread-semaphore/thread-semaphore.html class=md-nav__link> <span class=md-ellipsis> Linux线程与信号量 </span> </a> </li> <li class=md-nav__item> <a href=../thread-pc/thread-pc.html class=md-nav__link> <span class=md-ellipsis> 生产者消费者模型（Producer-Consumer Model） </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> 日志系统 </span> <span class="md-nav__icon md-icon"></span> </label> <a href=log.html class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> 日志系统 </span> </a> <nav class="md-nav md-nav--secondary" aria-label=本节目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 本节目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#_2 class=md-nav__link> <span class=md-ellipsis> 日志与日志系统介绍 </span> </a> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> <span class=md-ellipsis> 设计日志系统 </span> </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> <span class=md-ellipsis> 实现日志系统 </span> </a> <nav class=md-nav aria-label=实现日志系统> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_5 class=md-nav__link> <span class=md-ellipsis> 前置工作 </span> </a> </li> <li class=md-nav__item> <a href=#_6 class=md-nav__link> <span class=md-ellipsis> 策略模式（抽象策略类） </span> </a> </li> <li class=md-nav__item> <a href=#_7 class=md-nav__link> <span class=md-ellipsis> 策略模式（具体策略类） </span> </a> </li> <li class=md-nav__item> <a href=#_8 class=md-nav__link> <span class=md-ellipsis> 策略模式（上下文类） </span> </a> </li> <li class=md-nav__item> <a href=#_9 class=md-nav__link> <span class=md-ellipsis> 宏函数设定 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_10 class=md-nav__link> <span class=md-ellipsis> 测试日志系统 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../thread-safe-deadlock/thread-safe-deadlock.html class=md-nav__link> <span class=md-ellipsis> Linux线程安全与死锁 </span> </a> </li> <li class=md-nav__item> <a href=../thread-pool/thread-pool.html class=md-nav__link> <span class=md-ellipsis> Linux线程池 </span> </a> </li> <li class=md-nav__item> <a href=../thread-rw/thread-rw.html class=md-nav__link> <span class=md-ellipsis> 读者写者问题与读写锁 </span> </a> </li> <li class=md-nav__item> <a href=../thread-spin/thread-spin.html class=md-nav__link> <span class=md-ellipsis> 自旋锁 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../net-basic/net-basic.html class=md-nav__link> <span class=md-ellipsis> 网络基础知识 </span> </a> </li> <li class=md-nav__item> <a href=../../socket-basic/socket-basic.html class=md-nav__link> <span class=md-ellipsis> Socket编程基础 </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../udp/udp-basic/udp-basic.html class=md-nav__link> <span class=md-ellipsis> UDP编程 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class=md-nav__item> <a href=../../tcp-basic/tcp-basic.html class=md-nav__link> <span class=md-ellipsis> TCP编程接口基本使用 </span> </a> </li> <li class=md-nav__item> <a href=../../serialization-net-cal/serialization-net-cal.html class=md-nav__link> <span class=md-ellipsis> 序列化和反序列化与网络计算器 </span> </a> </li> <li class=md-nav__item> <a href=../../process-relationship-daemon/process-relationship-daemon.html class=md-nav__link> <span class=md-ellipsis> 进程间关系和守护进程 </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../http/http-basic-httpserver/http-basic-httpserver.html class=md-nav__link> <span class=md-ellipsis> 应用层协议HTTP </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class=md-nav__item> <a href=../../udp-principles/udp-principles.html class=md-nav__link> <span class=md-ellipsis> UDP协议原理 </span> </a> </li> <li class=md-nav__item> <a href=../../tcp-principles/tcp-principles.html class=md-nav__link> <span class=md-ellipsis> TCP协议原理 </span> </a> </li> <li class=md-nav__item> <a href=../../tcp-connection-backlog/tcp-connection-backlog.html class=md-nav__link> <span class=md-ellipsis> 理解Linux如何看待连接以及TCP全连接队列 </span> </a> </li> <li class=md-nav__item> <a href=../../ip/ip.html class=md-nav__link> <span class=md-ellipsis> 网络层IP协议 </span> </a> </li> <li class=md-nav__item> <a href=../../datalink/datalink.html class=md-nav__link> <span class=md-ellipsis> 数据链路层协议 </span> </a> </li> <li class=md-nav__item> <a href=../../dns-icmp/dns-icmp.html class=md-nav__link> <span class=md-ellipsis> DNS与ICMP </span> </a> </li> <li class=md-nav__item> <a href=../../nat-proxy/nat-proxy.html class=md-nav__link> <span class=md-ellipsis> NAT技术、代理服务器和内网穿透 </span> </a> </li> <li class=md-nav__item> <a href=../../io-model-select-poll/io-model-select-poll.html class=md-nav__link> <span class=md-ellipsis> 五种IO模型与select和poll分别实现多路转接 </span> </a> </li> <li class=md-nav__item> <a href=../../epoll/epoll.html class=md-nav__link> <span class=md-ellipsis> epoll实现多路转接 </span> </a> </li> <li class=md-nav__item> <a href=../../reactor-et/reactor-et.html class=md-nav__link> <span class=md-ellipsis> Reactor模式与完善基于边缘触发模式epoll实现TCP服务器 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../front-end/index.html class=md-nav__link> <span class=md-ellipsis> 前端 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../MySQL/index.html class=md-nav__link> <span class=md-ellipsis> MySQL </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../JavaEE/index.html class=md-nav__link> <span class=md-ellipsis> JavaEE应用开发 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../other/index.html class=md-nav__link> <span class=md-ellipsis> 扩展知识 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../tooltips/index.html class=md-nav__link> <span class=md-ellipsis> 工具帮助 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../test-encrypt/test-encrypt.html class=md-nav__link> <span class=md-ellipsis> 测试加密功能 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../projects/index.html class=md-nav__link> <span class=md-ellipsis> 项目 </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=本节目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 本节目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#_2 class=md-nav__link> <span class=md-ellipsis> 日志与日志系统介绍 </span> </a> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> <span class=md-ellipsis> 设计日志系统 </span> </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> <span class=md-ellipsis> 实现日志系统 </span> </a> <nav class=md-nav aria-label=实现日志系统> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_5 class=md-nav__link> <span class=md-ellipsis> 前置工作 </span> </a> </li> <li class=md-nav__item> <a href=#_6 class=md-nav__link> <span class=md-ellipsis> 策略模式（抽象策略类） </span> </a> </li> <li class=md-nav__item> <a href=#_7 class=md-nav__link> <span class=md-ellipsis> 策略模式（具体策略类） </span> </a> </li> <li class=md-nav__item> <a href=#_8 class=md-nav__link> <span class=md-ellipsis> 策略模式（上下文类） </span> </a> </li> <li class=md-nav__item> <a href=#_9 class=md-nav__link> <span class=md-ellipsis> 宏函数设定 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_10 class=md-nav__link> <span class=md-ellipsis> 测试日志系统 </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=_1>日志系统<a class=headerlink href=#_1 title="Permanent link">&para;</a></h1> <div style="margin-top: -30px; font-size: 0.75em; opacity: 0.7;"> <p><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10h-2a8 8 0 0 1-8 8 8 8 0 0 1-8-8 8 8 0 0 1 8-8zm6.78 1a.7.7 0 0 0-.48.2l-1.22 1.21 2.5 2.5L20.8 5.7c.26-.26.26-.7 0-.95L19.25 3.2c-.13-.13-.3-.2-.47-.2m-2.41 2.12L9 12.5V15h2.5l7.37-7.38z"/></svg></span> 约 3937 个字 <span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M392.8 1.2c-17-4.9-34.7 5-39.6 22l-128 448c-4.9 17 5 34.7 22 39.6s34.7-5 39.6-22l128-448c4.9-17-5-34.7-22-39.6m80.6 120.1c-12.5 12.5-12.5 32.8 0 45.3l89.3 89.4-89.4 89.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l112-112c12.5-12.5 12.5-32.8 0-45.3l-112-112c-12.5-12.5-32.8-12.5-45.3 0zm-306.7 0c-12.5-12.5-32.8-12.5-45.3 0l-112 112c-12.5 12.5-12.5 32.8 0 45.3l112 112c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256l89.4-89.4c12.5-12.5 12.5-32.8 0-45.3"/></svg></span> 280 行代码 <span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 20c4.42 0 8-3.58 8-8s-3.58-8-8-8-8 3.58-8 8 3.58 8 8 8m0-18c5.5 0 10 4.5 10 10s-4.5 10-10 10C6.47 22 2 17.5 2 12S6.5 2 12 2m.5 11H11V7h1.5v4.26l3.7-2.13.75 1.3z"/></svg></span> 预计阅读时间 17 分钟</p> </div> <h2 id=_2>日志与日志系统介绍<a class=headerlink href=#_2 title="Permanent link">&para;</a></h2> <p>计算机中的日志是记录系统和软件运行中发生事件的文件，主要作用是监控运行状态、记录异常信息，帮助快速定位问题并支持程序员进行问题修复。它是系统维护、故障排查和安全管理的重要工具</p> <p>一般情况下，日志会包含以下的内容：</p> <ul> <li>时间</li> <li>日志等级</li> <li>日志内容</li> </ul> <p>有些日志也有可能还包含下面的内容：</p> <ul> <li>文件名</li> <li>当前日志在文件中所在的行号</li> <li>进程或者线程信息</li> </ul> <p>在Linux操作系统中也会有一些日志信息，可以使用下面的指令查看当前操作系统的日志文件：</p> <div class="language-shell highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>Bash</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-1>ll<span class=w> </span>/var/log/
</span></code></pre></div></td></tr></table></div> <p>查看日志文件内容例如：</p> <div class="language-shell highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>Bash</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-1-1><span class=c1># 开机之后操作系统运行的日志信息</span>
</span><span id=__span-1-2>cat<span class=w> </span>/var/log/dmesg
</span><span id=__span-1-3><span class=c1># 软件的日志信息（需要管理员权限）</span>
</span><span id=__span-1-4>sudo<span class=w> </span>cat/var/log/syslog
</span></code></pre></div></td></tr></table></div> <p>日志实际上也有一些现成的解决方案，例如spdlog、glog、Boost.Log、Log4cXx等等。本次日志系统就是为了实现一个简易版的日志系统，显示出来的日志效果如下：</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-2-1><span class=p>[</span><span class=n>可读性很好的时间</span><span class=p>][</span><span class=n>日志等级</span><span class=p>][</span><span class=n>进程pid</span><span class=p>][</span><span class=n>打印对应日志的文件名</span><span class=p>][</span><span class=n>行号</span><span class=p>]</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>消息内容</span><span class=err>，</span><span class=n>支持可变参数</span>
</span><span id=__span-2-2><span class=p>[</span><span class=mi>2024-08</span><span class=mo>-04</span><span class=w> </span><span class=mi>12</span><span class=o>:</span><span class=mi>27</span><span class=o>:</span><span class=mo>03</span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=n>DEBUG</span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=mi>202938</span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=n>main</span><span class=p>.</span><span class=n>cc</span><span class=p>][</span><span class=mi>16</span><span class=p>]</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>hello</span><span class=w> </span><span class=n>world</span>
</span><span id=__span-2-3><span class=p>[</span><span class=mi>2024-08</span><span class=mo>-04</span><span class=w> </span><span class=mi>12</span><span class=o>:</span><span class=mi>27</span><span class=o>:</span><span class=mo>03</span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=n>DEBUG</span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=mi>202938</span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=n>main</span><span class=p>.</span><span class=n>cc</span><span class=p>][</span><span class=mi>17</span><span class=p>]</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>hello</span><span class=w> </span><span class=n>world</span>
</span><span id=__span-2-4><span class=p>[</span><span class=mi>2024-08</span><span class=mo>-04</span><span class=w> </span><span class=mi>12</span><span class=o>:</span><span class=mi>27</span><span class=o>:</span><span class=mo>03</span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=n>DEBUG</span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=mi>202938</span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=n>main</span><span class=p>.</span><span class=n>cc</span><span class=p>][</span><span class=mi>18</span><span class=p>]</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>hello</span><span class=w> </span><span class=n>world</span>
</span><span id=__span-2-5><span class=p>[</span><span class=mi>2024-08</span><span class=mo>-04</span><span class=w> </span><span class=mi>12</span><span class=o>:</span><span class=mi>27</span><span class=o>:</span><span class=mo>03</span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=n>DEBUG</span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=mi>202938</span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=n>main</span><span class=p>.</span><span class=n>cc</span><span class=p>][</span><span class=mi>20</span><span class=p>]</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>hello</span><span class=w> </span><span class=n>world</span>
</span><span id=__span-2-6><span class=p>[</span><span class=mi>2024-08</span><span class=mo>-04</span><span class=w> </span><span class=mi>12</span><span class=o>:</span><span class=mi>27</span><span class=o>:</span><span class=mo>03</span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=n>DEBUG</span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=mi>202938</span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=n>main</span><span class=p>.</span><span class=n>cc</span><span class=p>][</span><span class=mi>21</span><span class=p>]</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>hello</span><span class=w> </span><span class=n>world</span>
</span><span id=__span-2-7><span class=p>[</span><span class=mi>2024-08</span><span class=mo>-04</span><span class=w> </span><span class=mi>12</span><span class=o>:</span><span class=mi>27</span><span class=o>:</span><span class=mo>03</span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=n>WARNING</span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=mi>202938</span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=n>main</span><span class=p>.</span><span class=n>cc</span><span class=p>][</span><span class=mi>23</span><span class=p>]</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>hello</span><span class=w> </span><span class=n>world</span>
</span></code></pre></div></td></tr></table></div> <h2 id=_3>设计日志系统<a class=headerlink href=#_3 title="Permanent link">&para;</a></h2> <p>根据上面的日志效果，考虑让系统自动生成除了消息内容以外的信息，包括时间、日志等级、进程<code>pid</code>、文件名和行号</p> <p>本次设计日志系统考虑使用一种设计模式：策略模式。策略模式是一种行为型设计模式，其核心思想是将算法或行为封装为独立对象，使它们可以在运行时动态替换，从而避免复杂的条件判断并提升代码扩展性。</p> <p>一般来说，策略模式核心组成如下：</p> <ol> <li>抽象策略类（Strategy）：用于定义算法的公共接口，声明策略的通用行为。</li> <li>具体策略类（ConcreteStrategy）：实现抽象策略接口，封装具体算法（如不同的支付方式、折扣策略）。</li> <li>上下文类（Context）：持有策略对象的引用，通过接口调用具体策略的算法，对外屏蔽实现细节</li> </ol> <p>根据这个策略模式，考虑整体的设计思路：</p> <p>首先是定义一个抽象策略类，类名设为<code>LogStrategy</code>，既然这个类作为了抽象策略类，那么根据抽象策略类的作用考虑定义日志系统的日志处理方式的抽象虚函数<code>printLog(const std::string &amp;message)</code>，该函数的作用是让具体策略类实现具体的日志处理方式，在本次日志系统中，日志处理方式分为两种：</p> <ol> <li>将日志打印到控制台</li> <li>将日志写入指定目录下的指定文件中（目录和文件均可以由用户额外指定）</li> </ol> <p>既然有两种日志处理方式，那么对应的具体策略类就有两种：</p> <ol> <li><code>ConsoleLogStrategy</code>类：表示日志输出到控制台，对应地实现方法<code>printLog(const std::string &amp;message)</code>，函数内部主要逻辑就是将日志内容输出到控制台</li> <li><code>FileLogStrategy</code>类：表示日志输出到文件，对应地实现方法<code>printLog(const std::string &amp;message)</code>，函数内部主要逻辑就是将日志输出到文件</li> </ol> <p>设计完这两个类后，整体的日志系统就有了处理方式，但是现在还缺少处理日志方式控制的类，所以还需要一个类用于处理日志方式控制，定义为<code>LogHandle</code>类，这个类就是策略模式中的上下文类</p> <p>既然是处理日志信息控制，那么肯定少不了的就是确定日志信息的输出位置，本次考虑默认输出位置为控制台，同时提供两个函数<code>enableConsoleLog()</code>和<code>enableFileLog()</code>分别表示启用控制台打印和启用输出到文件</p> <p>有了日志输出方式的定义和控制，接下来就是考虑如何确定日志信息内容，对于日志信息内容，原则上并不属于控制输出位置类，所以考虑单独创建一个类，但是如果单独创建一个类，那么该类中就需要有<code>LogHandle</code>类的对象作为成员以便可以在输出时可以直到输出位置。这里可以考虑两种方式：</p> <ol> <li>组合</li> <li>内部类</li> </ol> <p>本次考虑使用内部类的方式，类名设定为<code>LogMessage</code>，这个类主要用于合成日志信息</p> <p>以上就是日志系统的基本思路和相关的类，下面针对每个类的具体设计进行详细介绍</p> <h2 id=_4>实现日志系统<a class=headerlink href=#_4 title="Permanent link">&para;</a></h2> <h3 id=_5>前置工作<a class=headerlink href=#_5 title="Permanent link">&para;</a></h3> <p>在日志系统中需要使用日志等级，所以可以考虑使用一个枚举类，类名为<code>LogLevel</code>，一共包括5种等级：</p> <ol> <li><code>DEBUG</code></li> <li><code>INFO</code></li> <li><code>WARNING</code></li> <li><code>ERROR</code></li> <li><code>FATAL</code></li> </ol> <p>参考代码如下：</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-3-1><span class=c1>// 日志等级</span>
</span><span id=__span-3-2><span class=k>enum</span><span class=w> </span><span class=k>class</span><span class=w> </span><span class=nc>LogLevel</span>
</span><span id=__span-3-3><span class=p>{</span>
</span><span id=__span-3-4><span class=w>    </span><span class=c1>// 默认从1开始</span>
</span><span id=__span-3-5><span class=w>    </span><span class=n>DEBUG</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>,</span>
</span><span id=__span-3-6><span class=w>    </span><span class=n>INFO</span><span class=p>,</span>
</span><span id=__span-3-7><span class=w>    </span><span class=n>WARNING</span><span class=p>,</span>
</span><span id=__span-3-8><span class=w>    </span><span class=n>ERROR</span><span class=p>,</span>
</span><span id=__span-3-9><span class=w>    </span><span class=n>FATAL</span>
</span><span id=__span-3-10><span class=p>};</span>
</span></code></pre></div></td></tr></table></div> <h3 id=_6>策略模式（抽象策略类）<a class=headerlink href=#_6 title="Permanent link">&para;</a></h3> <p>根据对策略模式的认识设计抽象策略类，可以考虑下面的思路：</p> <ol> <li>需要一个抽象虚函数<code>printLog()</code>，后面这个虚函数要被子类重写</li> <li>将虚构函数设计为虚函数，确保先析构子类再析构父类防止有内存泄漏问题</li> </ol> <p>参考代码如下：</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span>
<span class=normal>8</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-4-1><span class=k>class</span><span class=w> </span><span class=nc>LogStrategy</span>
</span><span id=__span-4-2><span class=p>{</span>
</span><span id=__span-4-3><span class=k>public</span><span class=o>:</span>
</span><span id=__span-4-4><span class=w>    </span><span class=c1>// 使用默认析构函数</span>
</span><span id=__span-4-5><span class=w>    </span><span class=k>virtual</span><span class=w> </span><span class=o>~</span><span class=n>LogStrategy</span><span class=p>()</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>default</span><span class=p>;</span>
</span><span id=__span-4-6><span class=w>    </span><span class=c1>// 定义抽象虚函数</span>
</span><span id=__span-4-7><span class=w>    </span><span class=k>virtual</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>printLog</span><span class=p>(</span><span class=k>const</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=w> </span><span class=o>&amp;</span><span class=n>message</span><span class=p>)</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-4-8><span class=p>};</span>
</span></code></pre></div></td></tr></table></div> <h3 id=_7>策略模式（具体策略类）<a class=headerlink href=#_7 title="Permanent link">&para;</a></h3> <p>根据前面的描述，具体策略类需要有两个类，分别是<code>ConsoleLogStrategy</code>类和<code>FileLogStrategy</code>类，具体作用见上方设计日志系统部分，下面考虑设计思路：</p> <p>对于<code>ConsoleLogStrategy</code>类来说，首先继承父类<code>LogStrategy</code>，因为该类需要将日志内容打印到控制台中，所以少不了需要重写并且实现父类的方法，在该方法中，根据前面多线程打印的经验：「如果多个线程同时打印，那么内容会出现错乱的问题」，所以在打印之前需要先使用互斥锁，每个线程需要先拿到这把锁才能开始打印。根据这个思路，在<code>ConsoleLogStrategy</code>类中，需要一个互斥锁成员，在实现<code>printLog()</code>函数时先抢锁，再开始打印，参考代码如下：</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>需要注意，下面的代码使用到了前面封装的<a href=https://www.help-doc.top/Linux/linux-thread/thread-sync/thread-sync.html#_6>互斥锁</a></p> </div> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-5-1><span class=k>class</span><span class=w> </span><span class=nc>ConsoleLogStrategy</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=k>public</span><span class=w> </span><span class=n>LogStrategy</span>
</span><span id=__span-5-2><span class=p>{</span>
</span><span id=__span-5-3><span class=k>public</span><span class=o>:</span>
</span><span id=__span-5-4><span class=w>    </span><span class=n>ConsoleLogStrategy</span><span class=p>()</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>default</span><span class=p>;</span>
</span><span id=__span-5-5>
</span><span id=__span-5-6><span class=w>    </span><span class=k>virtual</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>printLog</span><span class=p>(</span><span class=k>const</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=w> </span><span class=o>&amp;</span><span class=n>message</span><span class=p>)</span><span class=w> </span><span class=k>override</span>
</span><span id=__span-5-7><span class=w>    </span><span class=p>{</span>
</span><span id=__span-5-8><span class=w>        </span><span class=c1>// 先申请锁</span>
</span><span id=__span-5-9><span class=w>        </span><span class=n>MutexGuard</span><span class=w> </span><span class=n>guard</span><span class=p>(</span><span class=n>_lock</span><span class=p>);</span>
</span><span id=__span-5-10><span class=w>        </span><span class=n>std</span><span class=o>::</span><span class=n>cout</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>message</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span><span id=__span-5-11><span class=w>    </span><span class=p>}</span>
</span><span id=__span-5-12>
</span><span id=__span-5-13><span class=w>    </span><span class=o>~</span><span class=n>ConsoleLogStrategy</span><span class=p>()</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>default</span><span class=p>;</span>
</span><span id=__span-5-14>
</span><span id=__span-5-15><span class=k>private</span><span class=o>:</span>
</span><span id=__span-5-16><span class=w>    </span><span class=n>Mutex</span><span class=w> </span><span class=n>_lock</span><span class=p>;</span>
</span><span id=__span-5-17><span class=p>};</span>
</span></code></pre></div></td></tr></table></div> <p>对于<code>FileLogStrategy</code>来说，同样是先继承父类<code>LogStrategy</code>，因为该类是为了将日志信息输出到文件中，在本日志系统中，考虑将日志文件<code>log.txt</code>放在一个单独的目录<code>log</code>中，其中的<code>log.txt</code>和<code>log</code>表示默认的文件名和路径名，所以可以考虑设置为缺省参数，对应地就需要两个变量分别记录用户指定位置和指定文件名，初始化时使用<code>log</code>和<code>log.txt</code>作为初始值。但是需要注意的是这一步只是完成了指定目录名和文件名，并没有实际创建一个实际的目录和文件，所以可以考虑在创建<code>FileLogStrategy</code>类时就创建对应的目录和文件，此时就需要判断目录和文件是否存在</p> <p>对于判断目录是否存在可以使用<code>&lt;filesystem&gt;</code>库中的<code>exists</code>接口，该接口接收一个参数，表示目录位置，如果目录不在就可以使用系统接口<code>mkdir</code>创建目录，也可以考虑使用<code>&lt;filesystem&gt;</code>库中的<code>create_directories</code>接口，该接口接收一个参数，表示目录位置，考虑到这个函数可能会因为创建失败抛出异常，可以考虑使用<code>try_catch</code>捕捉异常，异常类型为<code>filesystem_error</code></p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>需要注意，<code>&lt;filesystem&gt;</code>库是C++17才支持的</p> </div> <p>对于判断文件是否存在其实不需要，因为如果文件存在就在该文件中写，如果不存在就新建，所以不需要单独判断文件是否存在，只需要考虑不存在就创建，否则就追加的思路</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>注意，日志文件中的写不建议是覆盖写，如果覆盖写就会导致之前的日志被清除</p> </div> <p>本次考虑使用<a href=https://www.help-doc.top/os-basic/os-basic.html>C++ IO流</a>打开文件，本次考虑使用既可以输入又可以输出的<code>fstream</code>，对于写方法，可以考虑使用<code>write</code>函数，但是更方便的还是使用流插入<code>&lt;&lt;</code>，写完文件后关闭文件即可</p> <p>同样，如果是多个线程，此时就只能允许一个线程写文件防止文件内容错乱，既然如此，同样需要考虑在哪加锁，为了防止一个文件被多个线程重复打开，所以考虑在打开文件直接就进行加锁，文件关闭后再解锁</p> <p>参考代码如下：</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span>
<span class=normal>45</span>
<span class=normal>46</span>
<span class=normal>47</span>
<span class=normal>48</span>
<span class=normal>49</span>
<span class=normal>50</span>
<span class=normal>51</span>
<span class=normal>52</span>
<span class=normal>53</span>
<span class=normal>54</span>
<span class=normal>55</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-6-1><span class=c1>// 默认的目录路径和文件路径</span>
</span><span id=__span-6-2><span class=k>const</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=w> </span><span class=n>d_dir_path</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;./log/&quot;</span><span class=p>;</span>
</span><span id=__span-6-3><span class=k>const</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=w> </span><span class=n>d_file_path</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;log.txt&quot;</span><span class=p>;</span>
</span><span id=__span-6-4>
</span><span id=__span-6-5><span class=c1>// 具体策略类——文件输出</span>
</span><span id=__span-6-6><span class=k>class</span><span class=w> </span><span class=nc>FileLogStrategy</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=k>public</span><span class=w> </span><span class=n>LogStrategy</span>
</span><span id=__span-6-7><span class=p>{</span>
</span><span id=__span-6-8><span class=k>public</span><span class=o>:</span>
</span><span id=__span-6-9><span class=w>    </span><span class=n>FileLogStrategy</span><span class=p>(</span><span class=k>const</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=w> </span><span class=o>&amp;</span><span class=n>dir_path</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>d_dir_path</span><span class=p>,</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=w> </span><span class=o>&amp;</span><span class=n>file_path</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>d_file_path</span><span class=p>)</span>
</span><span id=__span-6-10><span class=w>        </span><span class=o>:</span><span class=w> </span><span class=n>_dir_path</span><span class=p>(</span><span class=n>dir_path</span><span class=p>),</span><span class=w> </span><span class=n>_file_path</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span>
</span><span id=__span-6-11><span class=w>    </span><span class=p>{</span>
</span><span id=__span-6-12><span class=w>        </span><span class=c1>// 先申请锁</span>
</span><span id=__span-6-13><span class=w>        </span><span class=n>MutexGuard</span><span class=w> </span><span class=nf>guard</span><span class=p>(</span><span class=n>_lock</span><span class=p>);</span>
</span><span id=__span-6-14>
</span><span id=__span-6-15><span class=w>        </span><span class=c1>// 判断目录是否存在</span>
</span><span id=__span-6-16><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>filesystem</span><span class=o>::</span><span class=n>exists</span><span class=p>(</span><span class=n>_dir_path</span><span class=p>))</span>
</span><span id=__span-6-17><span class=w>            </span><span class=k>return</span><span class=p>;</span><span class=w> </span><span class=c1>// 存在直接返回</span>
</span><span id=__span-6-18><span class=w>        </span><span class=k>else</span>
</span><span id=__span-6-19><span class=w>        </span><span class=p>{</span>
</span><span id=__span-6-20><span class=w>            </span><span class=k>try</span>
</span><span id=__span-6-21><span class=w>            </span><span class=p>{</span>
</span><span id=__span-6-22><span class=w>                </span><span class=c1>// 创建目录</span>
</span><span id=__span-6-23><span class=w>                </span><span class=n>std</span><span class=o>::</span><span class=n>filesystem</span><span class=o>::</span><span class=n>create_directories</span><span class=p>(</span><span class=n>_dir_path</span><span class=p>);</span>
</span><span id=__span-6-24><span class=w>            </span><span class=p>}</span>
</span><span id=__span-6-25><span class=w>            </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=k>const</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>filesystem</span><span class=o>::</span><span class=n>filesystem_error</span><span class=w> </span><span class=o>&amp;</span><span class=n>e</span><span class=p>)</span>
</span><span id=__span-6-26><span class=w>            </span><span class=p>{</span>
</span><span id=__span-6-27><span class=w>                </span><span class=n>std</span><span class=o>::</span><span class=n>cerr</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=n>what</span><span class=p>()</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=sc>&#39;\n&#39;</span><span class=p>;</span>
</span><span id=__span-6-28><span class=w>            </span><span class=p>}</span>
</span><span id=__span-6-29><span class=w>        </span><span class=p>}</span>
</span><span id=__span-6-30><span class=w>    </span><span class=p>}</span>
</span><span id=__span-6-31>
</span><span id=__span-6-32><span class=w>    </span><span class=k>virtual</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=n>printLog</span><span class=p>(</span><span class=k>const</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=w> </span><span class=o>&amp;</span><span class=n>message</span><span class=p>)</span><span class=w> </span><span class=k>override</span>
</span><span id=__span-6-33><span class=w>    </span><span class=p>{</span>
</span><span id=__span-6-34><span class=w>        </span><span class=c1>// 先申请锁</span>
</span><span id=__span-6-35><span class=w>        </span><span class=n>MutexGuard</span><span class=w> </span><span class=nf>guard</span><span class=p>(</span><span class=n>_lock</span><span class=p>);</span>
</span><span id=__span-6-36>
</span><span id=__span-6-37><span class=w>        </span><span class=c1>// 打开文件并追加写入</span>
</span><span id=__span-6-38><span class=w>        </span><span class=k>const</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=w> </span><span class=n>path</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>_dir_path</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>_file_path</span><span class=p>;</span>
</span><span id=__span-6-39><span class=w>        </span><span class=n>std</span><span class=o>::</span><span class=n>fstream</span><span class=w> </span><span class=nf>out</span><span class=p>(</span><span class=n>path</span><span class=p>,</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>ios</span><span class=o>::</span><span class=n>app</span><span class=p>);</span>
</span><span id=__span-6-40><span class=w>        </span><span class=n>out</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>message</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>;</span>
</span><span id=__span-6-41>
</span><span id=__span-6-42><span class=w>        </span><span class=c1>// 关闭文件</span>
</span><span id=__span-6-43><span class=w>        </span><span class=n>out</span><span class=p>.</span><span class=n>close</span><span class=p>();</span>
</span><span id=__span-6-44><span class=w>    </span><span class=p>}</span>
</span><span id=__span-6-45>
</span><span id=__span-6-46><span class=w>    </span><span class=o>~</span><span class=n>FileLogStrategy</span><span class=p>()</span>
</span><span id=__span-6-47><span class=w>    </span><span class=p>{</span>
</span><span id=__span-6-48><span class=w>    </span><span class=p>}</span>
</span><span id=__span-6-49>
</span><span id=__span-6-50><span class=k>private</span><span class=o>:</span>
</span><span id=__span-6-51><span class=w>    </span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=w> </span><span class=n>_dir_path</span><span class=p>;</span>
</span><span id=__span-6-52><span class=w>    </span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=w> </span><span class=n>_file_path</span><span class=p>;</span>
</span><span id=__span-6-53>
</span><span id=__span-6-54><span class=w>    </span><span class=n>Mutex</span><span class=w> </span><span class=n>_lock</span><span class=p>;</span>
</span><span id=__span-6-55><span class=p>};</span>
</span></code></pre></div></td></tr></table></div> <h3 id=_8>策略模式（上下文类）<a class=headerlink href=#_8 title="Permanent link">&para;</a></h3> <p>对于上下文类<code>LogHandler</code>，少不了的就是父类指针或者引用作为成员指向子类成员，因为默认考虑的是将日志输出到控制台，所以当该类创建对象时，其父类指针或者引用成员指向<code>ConsoleLogStrategy</code>类对象，这里可以考虑使用智能指针，在初始化时使用<code>ConsoleLogStrategy</code>类对象：</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-7-1><span class=k>class</span><span class=w> </span><span class=nc>LogHandler</span>
</span><span id=__span-7-2><span class=p>{</span>
</span><span id=__span-7-3><span class=k>public</span><span class=o>:</span>
</span><span id=__span-7-4><span class=w>    </span><span class=c1>// 默认使用ConsoleLogStrategy类初始化</span>
</span><span id=__span-7-5><span class=w>    </span><span class=n>LogHandler</span><span class=p>()</span>
</span><span id=__span-7-6><span class=w>        </span><span class=o>:</span><span class=w> </span><span class=n>_log</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>make_shared</span><span class=o>&lt;</span><span class=n>ConsoleLogStrategy</span><span class=o>&gt;</span><span class=p>())</span>
</span><span id=__span-7-7><span class=w>    </span><span class=p>{</span>
</span><span id=__span-7-8><span class=w>    </span><span class=p>}</span>
</span><span id=__span-7-9><span class=w>    </span><span class=o>~</span><span class=n>LogHandler</span><span class=p>()</span>
</span><span id=__span-7-10><span class=w>    </span><span class=p>{</span>
</span><span id=__span-7-11><span class=w>    </span><span class=p>}</span>
</span><span id=__span-7-12>
</span><span id=__span-7-13><span class=k>private</span><span class=o>:</span>
</span><span id=__span-7-14><span class=w>    </span><span class=n>std</span><span class=o>::</span><span class=n>shared_ptr</span><span class=o>&lt;</span><span class=n>LogStrategy</span><span class=o>&gt;</span><span class=w> </span><span class=n>_log</span><span class=p>;</span>
</span><span id=__span-7-15><span class=p>};</span>
</span></code></pre></div></td></tr></table></div> <p>接着，在设计日志系统部分提到，<code>LogHandler</code>类需要提供两个函数，分别为<code>enableConsoleLog()</code>和<code>enableFileLog()</code>，表示启用控制台打印和启用输出到文件，这个切换实际上就是改变父类指针的指向，所以在<code>enableConsoleLog</code>函数中让成员<code>_log</code>指向<code>ConsoleLogStrategy</code>对象，在<code>enableFileLog()</code>函数中让成员<code>_log</code>指向<code>FileLogStrategy</code>对象：</p> <div class="tabbed-set tabbed-alternate" data-tabs=1:2><input checked=checked id=__tabbed_1_1 name=__tabbed_1 type=radio><input id=__tabbed_1_2 name=__tabbed_1 type=radio><div class=tabbed-labels><label for=__tabbed_1_1>启用控制台输出函数</label><label for=__tabbed_1_2>启用文件输出函数</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-8-1><span class=kt>void</span><span class=w> </span><span class=nf>enableConsoleLog</span><span class=p>()</span>
</span><span id=__span-8-2><span class=p>{</span>
</span><span id=__span-8-3><span class=w>    </span><span class=n>_log</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>make_shared</span><span class=o>&lt;</span><span class=n>ConsoleLogStrategy</span><span class=o>&gt;</span><span class=p>();</span>
</span><span id=__span-8-4><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> </div> <div class=tabbed-block> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-9-1><span class=c1>// 启用文件输出</span>
</span><span id=__span-9-2><span class=kt>void</span><span class=w> </span><span class=nf>enableFileLog</span><span class=p>()</span>
</span><span id=__span-9-3><span class=p>{</span>
</span><span id=__span-9-4><span class=w>    </span><span class=n>_log</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>make_shared</span><span class=o>&lt;</span><span class=n>FileLogStrategy</span><span class=o>&gt;</span><span class=p>();</span>
</span><span id=__span-9-5><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> </div> </div> </div> <div class="admonition note"> <p class=admonition-title>Note</p> <p>默认的就是启用控制台输出，提供<code>enableConsoleLog</code>是便于从文件输出切换回控制台输出</p> </div> <p>上面已经解决了日志信息的控制，接下来就是处理日志信息内容，在设计日志系统部分已经提到过使用内部类的方式完成本部分，所以接下来主要考虑内部类的实现思路：</p> <p>定义一个<code>LogMessage</code>类，该类就是用于处理日志信息内容，在日志信息内容中，时间和进程<code>pid</code>是可以直接通过函数调用获取的，但是日志等级、文件名、行号都必须通过外部行为获取，所以在<code>LogMessage</code>构造函数中需要对这些进行接收。添加需要相关的成员和实现，整体代码如下：</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>下面的代码使用到了前面封装的<a href=https://www.help-doc.top/Linux/com-process/com-named-pipe-shm/com-named-pipe-shm.html#_8>获取时间函数</a>，但是对细节进行了修改：</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span>
<span class=normal>8</span>
<span class=normal>9</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-10-1><span class=c1>// 获取时间函数</span>
</span><span id=__span-10-2><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=w> </span><span class=nf>getCurrentTime</span><span class=p>()</span>
</span><span id=__span-10-3><span class=p>{</span>
</span><span id=__span-10-4><span class=w>    </span><span class=c1>// ...</span>
</span><span id=__span-10-5><span class=w>    </span><span class=c1>// 将时间戳转换为时间，考虑使用localtime_r而不是localtime，确保多线程下安全</span>
</span><span id=__span-10-6><span class=w>    </span><span class=k>struct</span><span class=w> </span><span class=nc>tm</span><span class=w> </span><span class=n>time_struct</span><span class=p>;</span>
</span><span id=__span-10-7><span class=w>    </span><span class=n>localtime_r</span><span class=p>(</span><span class=o>&amp;</span><span class=n>time_stamp</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>time_struct</span><span class=p>);</span>
</span><span id=__span-10-8><span class=w>    </span><span class=c1>// ...</span>
</span><span id=__span-10-9><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> </div> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-11-1><span class=k>class</span><span class=w> </span><span class=nc>LogHandler</span>
</span><span id=__span-11-2><span class=p>{</span>
</span><span id=__span-11-3><span class=k>public</span><span class=o>:</span>
</span><span id=__span-11-4><span class=w>    </span><span class=c1>// ...</span>
</span><span id=__span-11-5>
</span><span id=__span-11-6><span class=w>    </span><span class=k>class</span><span class=w> </span><span class=nc>LogMessage</span>
</span><span id=__span-11-7><span class=w>    </span><span class=p>{</span>
</span><span id=__span-11-8><span class=w>    </span><span class=k>public</span><span class=o>:</span>
</span><span id=__span-11-9><span class=w>        </span><span class=n>LogMessage</span><span class=p>(</span><span class=n>LogLevel</span><span class=w> </span><span class=n>level</span><span class=p>,</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=w> </span><span class=o>&amp;</span><span class=n>filename</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>lineno</span><span class=p>)</span>
</span><span id=__span-11-10><span class=w>            </span><span class=o>:</span><span class=w> </span><span class=n>_time</span><span class=p>(</span><span class=n>getCurrentTime</span><span class=p>()),</span><span class=w> </span><span class=n>_level</span><span class=p>(</span><span class=n>level</span><span class=p>),</span><span class=w> </span><span class=n>_pid</span><span class=p>(</span><span class=n>getpid</span><span class=p>()),</span><span class=w> </span><span class=n>_filename</span><span class=p>(</span><span class=n>filename</span><span class=p>),</span><span class=w> </span><span class=n>_lineno</span><span class=p>(</span><span class=n>lineno</span><span class=p>)</span>
</span><span id=__span-11-11><span class=w>        </span><span class=p>{</span>
</span><span id=__span-11-12><span class=w>        </span><span class=p>}</span>
</span><span id=__span-11-13>
</span><span id=__span-11-14><span class=w>    </span><span class=k>private</span><span class=o>:</span>
</span><span id=__span-11-15><span class=w>        </span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=w> </span><span class=n>_time</span><span class=p>;</span><span class=w>     </span><span class=c1>// 时间</span>
</span><span id=__span-11-16><span class=w>        </span><span class=n>LogLevel</span><span class=w> </span><span class=n>_level</span><span class=p>;</span><span class=w>       </span><span class=c1>// 日志等级</span>
</span><span id=__span-11-17><span class=w>        </span><span class=kt>pid_t</span><span class=w> </span><span class=n>_pid</span><span class=p>;</span><span class=w>            </span><span class=c1>// 进程pid</span>
</span><span id=__span-11-18><span class=w>        </span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=w> </span><span class=n>_filename</span><span class=p>;</span><span class=w> </span><span class=c1>// 文件名</span>
</span><span id=__span-11-19><span class=w>        </span><span class=kt>int</span><span class=w> </span><span class=n>_lineno</span><span class=p>;</span><span class=w>           </span><span class=c1>// 行号</span>
</span><span id=__span-11-20><span class=w>    </span><span class=p>};</span>
</span><span id=__span-11-21>
</span><span id=__span-11-22><span class=w>    </span><span class=c1>// ...</span>
</span><span id=__span-11-23><span class=p>};</span>
</span></code></pre></div></td></tr></table></div> <p>接下来就是根据已有的信息按照需要的格式进行拼接，本次考虑在<code>LogMessage</code>对象初始化时就进行拼接，因为上面的数据涉及到各种数据类型，所以考虑使用字符串流<code>stringstream</code>完成拼接，拼接的结果放到一个成员变量<code>_message</code>中，用于之后与日志的自定义内容进行拼接。但是拼接之前还要考虑一个问题，在日志系统的预期效果中，日志等级是显示日志等级对应的名称而不是编号，但是日志等级枚举类直接获取为一个编号，其次枚举类型不能直接输出到流中，所以考虑额外定义一个函数<code>level2string</code>处理这种情况</p> <p>这个函数的主要思路就是根据不同的枚举值返回不同的字符串，所以直接穷举结果即可，因为枚举值是一个常量，所以可以考虑使用<code>switch_case</code>语句：</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-12-1><span class=c1>// 将枚举值转换为对应的字符串</span>
</span><span id=__span-12-2><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=w> </span><span class=nf>level2string</span><span class=p>(</span><span class=n>LogLevel</span><span class=w> </span><span class=n>level</span><span class=p>)</span>
</span><span id=__span-12-3><span class=p>{</span>
</span><span id=__span-12-4><span class=w>    </span><span class=k>switch</span><span class=w> </span><span class=p>(</span><span class=n>level</span><span class=p>)</span>
</span><span id=__span-12-5><span class=w>    </span><span class=p>{</span>
</span><span id=__span-12-6><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=no>LogLevel</span><span class=o>::</span><span class=no>DEBUG</span><span class=p>:</span>
</span><span id=__span-12-7><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=s>&quot;DEBUG&quot;</span><span class=p>;</span>
</span><span id=__span-12-8><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=no>LogLevel</span><span class=o>::</span><span class=no>INFO</span><span class=p>:</span>
</span><span id=__span-12-9><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=s>&quot;INFO&quot;</span><span class=p>;</span>
</span><span id=__span-12-10><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=no>LogLevel</span><span class=o>::</span><span class=no>WARNING</span><span class=p>:</span>
</span><span id=__span-12-11><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=s>&quot;WARNING&quot;</span><span class=p>;</span>
</span><span id=__span-12-12><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=no>LogLevel</span><span class=o>::</span><span class=no>ERROR</span><span class=p>:</span>
</span><span id=__span-12-13><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=s>&quot;WARNING&quot;</span><span class=p>;</span>
</span><span id=__span-12-14><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=no>LogLevel</span><span class=o>::</span><span class=no>FATAL</span><span class=p>:</span>
</span><span id=__span-12-15><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=s>&quot;FATAL&quot;</span><span class=p>;</span>
</span><span id=__span-12-16><span class=w>    </span><span class=k>default</span><span class=o>:</span>
</span><span id=__span-12-17><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=s>&quot;&quot;</span><span class=p>;</span>
</span><span id=__span-12-18><span class=w>    </span><span class=p>}</span>
</span><span id=__span-12-19><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=s>&quot;&quot;</span><span class=p>;</span>
</span><span id=__span-12-20><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <p>拼接代码如下：</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-13-1><span class=k>class</span><span class=w> </span><span class=nc>LogMessage</span>
</span><span id=__span-13-2><span class=p>{</span>
</span><span id=__span-13-3><span class=k>public</span><span class=o>:</span>
</span><span id=__span-13-4><span class=w>    </span><span class=n>LogMessage</span><span class=p>(</span><span class=n>LogLevel</span><span class=w> </span><span class=n>level</span><span class=p>,</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=w> </span><span class=o>&amp;</span><span class=n>filename</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>lineno</span><span class=p>)</span>
</span><span id=__span-13-5><span class=w>        </span><span class=o>:</span><span class=w> </span><span class=n>_time</span><span class=p>(</span><span class=n>getCurrentTime</span><span class=p>()),</span><span class=w> </span><span class=n>_level</span><span class=p>(</span><span class=n>level</span><span class=p>),</span><span class=w> </span><span class=n>_pid</span><span class=p>(</span><span class=n>getpid</span><span class=p>()),</span><span class=w> </span><span class=n>_filename</span><span class=p>(</span><span class=n>filename</span><span class=p>),</span><span class=w> </span><span class=n>_lineno</span><span class=p>(</span><span class=n>lineno</span><span class=p>)</span>
</span><span id=__span-13-6><span class=w>    </span><span class=p>{</span>
</span><span id=__span-13-7><span class=w>        </span><span class=n>std</span><span class=o>::</span><span class=n>stringstream</span><span class=w> </span><span class=n>ss</span><span class=p>;</span>
</span><span id=__span-13-8><span class=w>        </span><span class=n>ss</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;[&quot;</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>_time</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;] &quot;</span>
</span><span id=__span-13-9><span class=w>           </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;[&quot;</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>level2string</span><span class=p>(</span><span class=n>_level</span><span class=p>)</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;] &quot;</span>
</span><span id=__span-13-10><span class=w>           </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;[&quot;</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>_pid</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;] &quot;</span>
</span><span id=__span-13-11><span class=w>           </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;[&quot;</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>_filename</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;] &quot;</span>
</span><span id=__span-13-12><span class=w>           </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;[&quot;</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>_lineno</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;] - &quot;</span><span class=p>;</span>
</span><span id=__span-13-13>
</span><span id=__span-13-14><span class=w>        </span><span class=n>_message</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ss</span><span class=p>.</span><span class=n>str</span><span class=p>();</span>
</span><span id=__span-13-15><span class=w>    </span><span class=p>}</span>
</span><span id=__span-13-16>
</span><span id=__span-13-17><span class=k>private</span><span class=o>:</span>
</span><span id=__span-13-18><span class=w>    </span><span class=c1>// ...</span>
</span><span id=__span-13-19><span class=w>    </span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=w> </span><span class=n>_message</span><span class=p>;</span><span class=w>  </span><span class=c1>// 记录结果</span>
</span><span id=__span-13-20><span class=p>};</span>
</span></code></pre></div></td></tr></table></div> <p>有了基本信息之后，接下来就是获取用户输入的基本信息，本次考虑基本的使用方法是通过流插入的方式，即类似于下面的方式：</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-14-1><span class=n>LogMessage对象</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>自定义信息</span><span class=p>;</span>
</span></code></pre></div></td></tr></table></div> <p>所以需要在<code>LogMessage</code>类中重载流插入函数，但是考虑到自定义信息可能不止一种内置数据类型，所以需要使用到模板，因为只有当前函数才需要使用到模板，所以只需要在当前函数中使用模板即可。在流插入重载函数中，同样使用<code>stringstream</code>流处理字符串拼接问题，最后将整个字符串放到成员<code>_message</code>中：</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-15-1><span class=c1>// 重载流插入函数</span>
</span><span id=__span-15-2><span class=k>template</span><span class=w> </span><span class=o>&lt;</span><span class=k>class</span><span class=w> </span><span class=nc>T</span><span class=o>&gt;</span>
</span><span id=__span-15-3><span class=n>LogMessage</span><span class=w> </span><span class=o>&amp;</span><span class=k>operator</span><span class=o>&lt;&lt;</span><span class=p>(</span><span class=k>const</span><span class=w> </span><span class=n>T</span><span class=w> </span><span class=o>&amp;</span><span class=n>content</span><span class=p>)</span>
</span><span id=__span-15-4><span class=p>{</span>
</span><span id=__span-15-5><span class=w>    </span><span class=n>std</span><span class=o>::</span><span class=n>stringstream</span><span class=w> </span><span class=n>ss</span><span class=p>;</span>
</span><span id=__span-15-6><span class=w>    </span><span class=n>ss</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>content</span><span class=p>;</span>
</span><span id=__span-15-7><span class=w>    </span><span class=n>_message</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=n>ss</span><span class=p>.</span><span class=n>str</span><span class=p>();</span>
</span><span id=__span-15-8>
</span><span id=__span-15-9><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=o>*</span><span class=k>this</span><span class=p>;</span>
</span><span id=__span-15-10><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <p>现在，<code>LogMessage</code>就已经完成了基本的设计，但是目前<code>LogHandler</code>和<code>LogMessage</code>并没有具体的联系，所以接下来的目标就是让二者建立联系，而二者所谓的联系就是<code>LogMessage</code>类根据当前<code>LogHandler</code>的策略将日志输出到指定位置，所以在<code>LogMessage</code>中需要有一个<code>LogHandler</code>对象成员引用，并在构造时，需要外部传入一个<code>LogHandler</code>对象初始化当前<code>LogMessage</code>中的<code>LogHandler</code>对象成员引用：</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p><a href=https://www.help-doc.top/cpp/class-obj-other/class-obj-other.html#_4>注意，内部类中不可以创建外部类对象</a></p> </div> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-16-1><span class=k>class</span><span class=w> </span><span class=nc>LogHandler</span>
</span><span id=__span-16-2><span class=p>{</span>
</span><span id=__span-16-3><span class=k>public</span><span class=o>:</span>
</span><span id=__span-16-4><span class=w>    </span><span class=c1>// ...</span>
</span><span id=__span-16-5>
</span><span id=__span-16-6><span class=w>    </span><span class=k>class</span><span class=w> </span><span class=nc>LogMessage</span>
</span><span id=__span-16-7><span class=w>    </span><span class=p>{</span>
</span><span id=__span-16-8><span class=w>    </span><span class=k>public</span><span class=o>:</span>
</span><span id=__span-16-9><span class=w>        </span><span class=n>LogMessage</span><span class=p>(</span><span class=cm>/* ... */</span><span class=p>,</span><span class=w> </span><span class=n>LogHandler</span><span class=w> </span><span class=o>&amp;</span><span class=n>loghandler</span><span class=p>)</span>
</span><span id=__span-16-10><span class=w>            </span><span class=o>:</span><span class=w> </span><span class=c1>// ...</span>
</span><span id=__span-16-11><span class=w>            </span><span class=p>,</span><span class=w> </span><span class=n>_loghandler</span><span class=p>(</span><span class=n>loghandler</span><span class=p>)</span>
</span><span id=__span-16-12><span class=w>        </span><span class=p>{</span>
</span><span id=__span-16-13><span class=w>            </span><span class=c1>//...</span>
</span><span id=__span-16-14><span class=w>        </span><span class=p>}</span>
</span><span id=__span-16-15>
</span><span id=__span-16-16><span class=w>        </span><span class=c1>// ...</span>
</span><span id=__span-16-17>
</span><span id=__span-16-18><span class=w>    </span><span class=k>private</span><span class=o>:</span>
</span><span id=__span-16-19><span class=w>        </span><span class=c1>// ...</span>
</span><span id=__span-16-20><span class=w>        </span><span class=n>LogHandler</span><span class=w> </span><span class=o>&amp;</span><span class=n>_loghandler</span><span class=p>;</span>
</span><span id=__span-16-21><span class=w>    </span><span class=p>};</span>
</span><span id=__span-16-22>
</span><span id=__span-16-23><span class=k>private</span><span class=o>:</span>
</span><span id=__span-16-24><span class=w>    </span><span class=n>std</span><span class=o>::</span><span class=n>shared_ptr</span><span class=o>&lt;</span><span class=n>LogStrategy</span><span class=o>&gt;</span><span class=w> </span><span class=n>_log</span><span class=p>;</span>
</span><span id=__span-16-25><span class=p>};</span>
</span></code></pre></div></td></tr></table></div> <p>完成上面的步骤之后，接下来就是将日志输出到指定位置，既然要输出信息，那么肯定需要创建<code>LogMessage</code>对象先构建信息，本次考虑一种思路：通过<code>LogMessage</code>临时对象析构时自动调用日志输出。这个思路涉及到一个知识点：临时对象的生命周期会延长</p> <p>在C++中，临时对象可以支持流插入操作。这是因为临时对象在语句结束之前都是有效的,可以安全地进行流插入操作。而此时的临时对象的声明周期就被延长到流插入操作结束后，一旦流插入重载函数返回对象的引用，就可以进行链式调用</p> <p>所以根据这个知识考虑在<code>LogMessage</code>的析构函数中写入日志输出的逻辑：</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-17-1><span class=o>~</span><span class=n>LogMessage</span><span class=p>()</span>
</span><span id=__span-17-2><span class=p>{</span>
</span><span id=__span-17-3><span class=w>    </span><span class=c1>// 如果父类引用不为空指针，就可以实现日志输出到指定为止</span>
</span><span id=__span-17-4><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>_loghandler</span><span class=p>.</span><span class=n>_log</span><span class=p>)</span>
</span><span id=__span-17-5><span class=w>        </span><span class=n>_loghandler</span><span class=p>.</span><span class=n>_log</span><span class=o>-&gt;</span><span class=n>printLog</span><span class=p>(</span><span class=n>_message</span><span class=p>);</span>
</span><span id=__span-17-6><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <p>接着考虑构建出一个临时对象，本次日志系统希望用户以如下的方式使用：</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-18-1><span class=n>LogHandler对象</span><span class=p>(</span><span class=n>日志等级</span><span class=p>)</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>自定义信息</span>
</span></code></pre></div></td></tr></table></div> <p>因为<code>LogHandler</code>类本身没有重载流插入<code>&lt;&lt;</code>，所以<code>LogHandler对象(日志等级)</code>就必须是重载了流插入的<code>LogMessage</code>对象，所以在<code>LogHandler</code>中需要重载<code>()</code>，该函数返回一个<code>LogMessage</code>对象，接收一个日志等级参数、一个文件名参数和一个行号参数</p> <p>但是，如果<code>LogHandler</code>的<code>()</code>重载函数只有三个参数，那么在构造<code>LogMessage</code>对象时就会出现还有<code>loghandler</code>无法初始化。这就是接下来需要考虑的问题，对于<code>loghandler</code>来说，因为<code>LogMessage</code>类是<code>LogHandler</code>类的内部类，并且<code>()</code>重载函数是<code>LogHandler</code>类的成员函数，所以可以使用<code>*this</code>作为参数传递给<code>loghandler</code>，此时的<code>*this</code>代表的就是<code>LogHandler</code>类的对象</p> <p>所以，整个函数的设计如下：</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-19-1><span class=n>LogMessage</span><span class=w> </span><span class=nf>operator</span><span class=p>()(</span><span class=n>LogLevel</span><span class=w> </span><span class=n>level</span><span class=p>,</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=w> </span><span class=n>filename</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>lineno</span><span class=p>)</span>
</span><span id=__span-19-2><span class=p>{</span>
</span><span id=__span-19-3><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>LogMessage</span><span class=p>(</span><span class=n>level</span><span class=p>,</span><span class=w> </span><span class=n>filename</span><span class=p>,</span><span class=w> </span><span class=n>lineno</span><span class=p>,</span><span class=w> </span><span class=o>*</span><span class=k>this</span><span class=p>);</span>
</span><span id=__span-19-4><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <p>至此，基于策略模式的日志系统基本框架已经形成</p> <h3 id=_9>宏函数设定<a class=headerlink href=#_9 title="Permanent link">&para;</a></h3> <p>虽然已经写好了基本的日志系统，但是为了让日志系统更利于使用，在原来期望的使用方式的基础之上：</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-20-1><span class=n>LogHandler对象</span><span class=p>(</span><span class=n>日志等级</span><span class=p>)</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>自定义信息</span><span class=p>;</span>
</span></code></pre></div></td></tr></table></div> <p>再修改为如下的使用方式：</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-21-1><span class=n>LOG</span><span class=p>(</span><span class=n>日志等级</span><span class=p>)</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>自定义信息</span><span class=p>;</span>
</span></code></pre></div></td></tr></table></div> <p>先创建一个<code>LogHandler</code>对象：</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-22-1><span class=c1>// 创建LogHandler对象</span>
</span><span id=__span-22-2><span class=n>LogHandler</span><span class=w> </span><span class=n>loghandler</span><span class=p>;</span>
</span></code></pre></div></td></tr></table></div> <p>可以考虑使用一个宏函数：</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-23-1><span class=cp>#define LOG(LEVEL) loghandler(LEVEL, __FILE__, __LINE__)</span>
</span></code></pre></div></td></tr></table></div> <p>这个宏函数的作用是通过<code>LogHandler</code>类对象调用其中的<code>operator()</code>函数根据传递的日志等级创建<code>LogMessage</code>类对象，并且也可以利用到C语言宏中提供的一个<code>__FILE__</code>和一个<code>__LINE__</code>，二者分别表示的就是当前文件名和当前行号，这样可以获取到当前文件名和当前行号，并且因为是宏，所以其替换的位置就是最终结果。此时只要想在指定行打日志，那么最后日志所表示的行就是对应该日志代码所在的行</p> <p>此外，还可以将<code>enableConsoleLog</code>和<code>enableFileLog</code>分别封装成宏函数方便使用：</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-24-1><span class=cp>#define ENABLECONSOLELOG() loghandler.enableConsoleLog()</span>
</span><span id=__span-24-2><span class=cp>#define ENABLEFILELOG() loghandler.enableFileLog()</span>
</span></code></pre></div></td></tr></table></div> <h2 id=_10>测试日志系统<a class=headerlink href=#_10 title="Permanent link">&para;</a></h2> <p>使用下面的代码测试：</p> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-25-1><span class=cp>#include</span><span class=w> </span><span class=cpf>&quot;log.hpp&quot;</span>
</span><span id=__span-25-2>
</span><span id=__span-25-3><span class=k>using</span><span class=w> </span><span class=k>namespace</span><span class=w> </span><span class=nn>LogSystemModule</span><span class=p>;</span>
</span><span id=__span-25-4>
</span><span id=__span-25-5><span class=kt>int</span><span class=w> </span><span class=nf>main</span><span class=p>()</span>
</span><span id=__span-25-6><span class=p>{</span>
</span><span id=__span-25-7><span class=w>    </span><span class=n>ENABLECONSOLELOG</span><span class=p>();</span>
</span><span id=__span-25-8>
</span><span id=__span-25-9><span class=w>    </span><span class=n>LOG</span><span class=p>(</span><span class=n>LogLevel</span><span class=o>::</span><span class=n>DEBUG</span><span class=p>)</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;hello console&quot;</span><span class=p>;</span>
</span><span id=__span-25-10><span class=w>    </span><span class=n>LOG</span><span class=p>(</span><span class=n>LogLevel</span><span class=o>::</span><span class=n>DEBUG</span><span class=p>)</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;hello console&quot;</span><span class=p>;</span>
</span><span id=__span-25-11><span class=w>    </span><span class=n>LOG</span><span class=p>(</span><span class=n>LogLevel</span><span class=o>::</span><span class=n>DEBUG</span><span class=p>)</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;hello console&quot;</span><span class=p>;</span>
</span><span id=__span-25-12><span class=w>    </span><span class=n>LOG</span><span class=p>(</span><span class=n>LogLevel</span><span class=o>::</span><span class=n>DEBUG</span><span class=p>)</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;hello console&quot;</span><span class=p>;</span>
</span><span id=__span-25-13>
</span><span id=__span-25-14><span class=w>    </span><span class=n>ENABLEFILELOG</span><span class=p>();</span>
</span><span id=__span-25-15><span class=w>    </span><span class=n>LOG</span><span class=p>(</span><span class=n>LogLevel</span><span class=o>::</span><span class=n>DEBUG</span><span class=p>)</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;hello file&quot;</span><span class=p>;</span>
</span><span id=__span-25-16><span class=w>    </span><span class=n>LOG</span><span class=p>(</span><span class=n>LogLevel</span><span class=o>::</span><span class=n>DEBUG</span><span class=p>)</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;hello file&quot;</span><span class=p>;</span>
</span><span id=__span-25-17><span class=w>    </span><span class=n>LOG</span><span class=p>(</span><span class=n>LogLevel</span><span class=o>::</span><span class=n>DEBUG</span><span class=p>)</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;hello file&quot;</span><span class=p>;</span>
</span><span id=__span-25-18><span class=w>    </span><span class=n>LOG</span><span class=p>(</span><span class=n>LogLevel</span><span class=o>::</span><span class=n>DEBUG</span><span class=p>)</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;hello file&quot;</span><span class=p>;</span>
</span><span id=__span-25-19><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-25-20><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> <p>一共有两个输出结果：</p> <div class="tabbed-set tabbed-alternate" data-tabs=2:2><input checked=checked id=__tabbed_2_1 name=__tabbed_2 type=radio><input id=__tabbed_2_2 name=__tabbed_2 type=radio><div class=tabbed-labels><label for=__tabbed_2_1>控制台</label><label for=__tabbed_2_2>当前源文件所在目录的<code>log/log.txt</code></label></div> <div class=tabbed-content> <div class=tabbed-block> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-26-1><span class=p>[</span><span class=mi>2025</span><span class=mo>-02</span><span class=mi>-19</span><span class=w> </span><span class=mi>20-26-50</span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=n>DEBUG</span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=mi>6351</span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=n>main</span><span class=p>.</span><span class=n>cc</span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=mi>9</span><span class=p>]</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>hello</span><span class=w> </span><span class=n>console</span>
</span><span id=__span-26-2><span class=p>[</span><span class=mi>2025</span><span class=mo>-02</span><span class=mi>-19</span><span class=w> </span><span class=mi>20-26-50</span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=n>DEBUG</span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=mi>6351</span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=n>main</span><span class=p>.</span><span class=n>cc</span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=mi>10</span><span class=p>]</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>hello</span><span class=w> </span><span class=n>console</span>
</span><span id=__span-26-3><span class=p>[</span><span class=mi>2025</span><span class=mo>-02</span><span class=mi>-19</span><span class=w> </span><span class=mi>20-26-50</span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=n>DEBUG</span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=mi>6351</span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=n>main</span><span class=p>.</span><span class=n>cc</span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=mi>11</span><span class=p>]</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>hello</span><span class=w> </span><span class=n>console</span>
</span><span id=__span-26-4><span class=p>[</span><span class=mi>2025</span><span class=mo>-02</span><span class=mi>-19</span><span class=w> </span><span class=mi>20-26-50</span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=n>DEBUG</span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=mi>6351</span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=n>main</span><span class=p>.</span><span class=n>cc</span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=mi>12</span><span class=p>]</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>hello</span><span class=w> </span><span class=n>console</span>
</span></code></pre></div></td></tr></table></div> </div> <div class=tabbed-block> <div class="language-c++ highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>C++</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-27-1><span class=p>[</span><span class=mi>2025</span><span class=mo>-02</span><span class=mi>-19</span><span class=w> </span><span class=mi>20-26-50</span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=n>DEBUG</span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=mi>6351</span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=n>main</span><span class=p>.</span><span class=n>cc</span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=mi>15</span><span class=p>]</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>hello</span><span class=w> </span><span class=n>file</span>
</span><span id=__span-27-2><span class=p>[</span><span class=mi>2025</span><span class=mo>-02</span><span class=mi>-19</span><span class=w> </span><span class=mi>20-26-50</span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=n>DEBUG</span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=mi>6351</span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=n>main</span><span class=p>.</span><span class=n>cc</span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=mi>16</span><span class=p>]</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>hello</span><span class=w> </span><span class=n>file</span>
</span><span id=__span-27-3><span class=p>[</span><span class=mi>2025</span><span class=mo>-02</span><span class=mi>-19</span><span class=w> </span><span class=mi>20-26-50</span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=n>DEBUG</span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=mi>6351</span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=n>main</span><span class=p>.</span><span class=n>cc</span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=mi>17</span><span class=p>]</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>hello</span><span class=w> </span><span class=n>file</span>
</span><span id=__span-27-4><span class=p>[</span><span class=mi>2025</span><span class=mo>-02</span><span class=mi>-19</span><span class=w> </span><span class=mi>20-26-50</span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=n>DEBUG</span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=mi>6351</span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=n>main</span><span class=p>.</span><span class=n>cc</span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=mi>18</span><span class=p>]</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>hello</span><span class=w> </span><span class=n>file</span>
</span></code></pre></div></td></tr></table></div> </div> </div> </div> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title=最后更新> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">2025年7月30日</span> </span> </aside> <form class=md-feedback name=feedback hidden> <fieldset> <legend class=md-feedback__title> 页面有帮助吗？ </legend> <div class=md-feedback__inner> <div class=md-feedback__list> <button class="md-feedback__icon md-icon" type=submit title=页面对我有帮助 data-md-value=1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M5 9v12H1V9zm4 12a2 2 0 0 1-2-2V9c0-.55.22-1.05.59-1.41L14.17 1l1.06 1.06c.27.27.44.64.44 1.05l-.03.32L14.69 8H21a2 2 0 0 1 2 2v2c0 .26-.05.5-.14.73l-3.02 7.05C19.54 20.5 18.83 21 18 21zm0-2h9.03L21 12v-2h-8.79l1.13-5.32L9 9.03z"/></svg> </button> <button class="md-feedback__icon md-icon" type=submit title=页面没有帮助到我 data-md-value=0> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 15V3h4v12zM15 3a2 2 0 0 1 2 2v10c0 .55-.22 1.05-.59 1.41L9.83 23l-1.06-1.06c-.27-.27-.44-.64-.44-1.06l.03-.31.95-4.57H3a2 2 0 0 1-2-2v-2c0-.26.05-.5.14-.73l3.02-7.05C4.46 3.5 5.17 3 6 3zm0 2H5.97L3 12v2h8.78l-1.13 5.32L15 14.97z"/></svg> </button> </div> <div class=md-feedback__note> <div data-md-value=1 hidden> 谢谢你的反馈！ </div> <div data-md-value=0 hidden> 谢谢你的反馈！联系<a href=https://www.help-doc.top/author/contact/contact.html>作者</a>提供更详细的信息 </div> </div> </div> </fieldset> </form> <!-- Waline 评论系统 --> <div id=waline></div> <!-- 评论系统 --> <!-- Waline 评论系统 --> <div id=waline></div> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2024-2025 柯懒不是柯南 </div> </div> <div class="md-footer-love md-typeset"> 一闪一闪亮晶晶，不及<span class=love-highlight>小亮</span><span class=love-heart>♥</span>照我心。To Li Liang </div> <div class=md-social> <a href=https://github.com/H0308 target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> <a href=https://www.help-doc.top/author/contact/contact.html target=_blank rel=noopener title=www.help-doc.top class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M433.754 420.445c-11.526 1.393-44.86-52.741-44.86-52.741 0 31.345-16.136 72.247-51.051 101.786 16.842 5.192 54.843 19.167 45.803 34.421-7.316 12.343-125.51 7.881-159.632 4.037-34.122 3.844-152.316 8.306-159.632-4.037-9.045-15.25 28.918-29.214 45.783-34.415-34.92-29.539-51.059-70.445-51.059-101.792 0 0-33.334 54.134-44.859 52.741-5.37-.65-12.424-29.644 9.347-99.704 10.261-33.024 21.995-60.478 40.144-105.779C60.683 98.063 108.982.006 224 0c113.737.006 163.156 96.133 160.264 214.963 18.118 45.223 29.912 72.85 40.144 105.778 21.768 70.06 14.716 99.053 9.346 99.704"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": ["navigation.indexes", "navigation.prune", "navigation.tabs", "search.highlight", "content.code.copy"], "search": "../../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script> <script src=../../../assets/javascripts/bundle.c8b220af.min.js></script> <script src=../../../javascripts/katex.min.js></script> <script src=../../../javascripts/other.min.js></script> <script src=../../../javascripts/copyright.min.js></script> <script src=../../../javascripts/waline.min.js></script> <script src=https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.js></script> <script src=https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/contrib/auto-render.min.js></script> <script src=https://cdn.jsdelivr.net/npm/mermaid@11.5.0/dist/mermaid.min.js></script> <script src=../../../assets/javascripts/toggle-sidebar.js async></script> <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body> </html>