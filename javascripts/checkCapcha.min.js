var isExclude=false;var excludePages=['/网站验证码','/阅读档案','/作者','/网站时间线'];var currentPath=decodeURIComponent(window.location.pathname).replace(/\/$/,'').toLowerCase();isExclude=excludePages.some(page=>currentPath.includes(page.toLowerCase()));var isMobile=navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);var allowMobile=true;if(!isExclude&&(!isMobile||(isMobile&&allowMobile))){try{var plugin=new ReadmorePlugin();plugin.init({id:"readmore-container",blogId:"36140-2300591443397-093",name:"阅读档案",keyword:"验证码",qrcode:"https://www.help-doc.top/index.assets/qrcode_for_gh_166df3e5da8b_258.jpg",type:"website",height:"600",expires:"31",interval:"60",random:"1.0"})}catch(e){console.warn("readmore plugin occurred error: "+e.name+" | "+e.message);}}
let verificationInProgress=false;function isContentUnlocked(){const readmoreWrapper=document.getElementById('readmore-wrapper');const readmoreModel=document.getElementById('readmore-model-wrapper');const readmoreModalMask=document.getElementById('readmore-modal-mask');if(verificationInProgress){return false;}
if(!readmoreWrapper&&!readmoreModel&&!readmoreModalMask){return true;}
return readmoreWrapper&&window.getComputedStyle(readmoreWrapper).display==='none'&&(!readmoreModel||window.getComputedStyle(readmoreModel).display==='none')&&(!readmoreModalMask||window.getComputedStyle(readmoreModalMask).display==='none');}
function showVerificationModal(){const readmoreBtn=document.getElementById('readmore-btn');if(readmoreBtn){verificationInProgress=true;readmoreBtn.click();const observer=new MutationObserver(()=>{const modalMask=document.getElementById('readmore-modal-mask');if(!modalMask||window.getComputedStyle(modalMask).display==='none'){setTimeout(()=>{if(!isContentUnlocked()){verificationInProgress=false;}},100);}});observer.observe(document.body,{childList:true,subtree:true,attributes:true,attributeFilter:['style','class']});}}
function showConfirmPanel(){}
function handleAnchorNavigation(e,href){if(!isContentUnlocked()){e.preventDefault();e.stopPropagation();if(!verificationInProgress){showVerificationModal();}
return false;}
if(href&&href.includes('#')){const targetId=href.split('#')[1];const targetElement=document.getElementById(targetId);if(targetElement){e.preventDefault();targetElement.scrollIntoView({behavior:'smooth',block:'start'});}}
return true;}
document.addEventListener('DOMContentLoaded',()=>{let searchResultsInitialized=false;const searchInput=document.querySelector('.md-search__input');if(searchInput){searchInput.addEventListener('click',(e)=>{const readmoreWrapper=document.getElementById('readmore-wrapper');if(readmoreWrapper&&window.getComputedStyle(readmoreWrapper).display!=='none'){e.preventDefault();e.stopPropagation();searchInput.disabled=true;if(!verificationInProgress){showVerificationModal();const restoreObserver=new MutationObserver(()=>{if(isContentUnlocked()){searchInput.disabled=false;restoreObserver.disconnect();}});restoreObserver.observe(document.body,{childList:true,subtree:true,attributes:true,attributeFilter:['style']});}
return false;}});searchInput.addEventListener('blur',resetSearchState);searchInput.addEventListener('search',resetSearchState);}
const searchObserver=new MutationObserver((mutations)=>{if(searchResultsInitialized)return;const searchResults=document.querySelectorAll('.md-search-result__link');if(searchResults.length>0){searchResults.forEach(link=>{const href=link.getAttribute('href');if(href&&href.includes('#')&&!href.includes('#__tabbed_')){link.addEventListener('click',(e)=>{const currentPath=window.location.pathname;const[linkPath,hash]=href.split('#');if(!linkPath||linkPath===currentPath){handleAnchorNavigation(e,'#'+hash);}},{capture:true,once:true});}});searchResultsInitialized=true;setTimeout(()=>{searchResultsInitialized=false;},100);}});const searchContainer=document.querySelector('.md-search');if(searchContainer){searchObserver.observe(searchContainer,{childList:true,subtree:true});}
function resetSearchState(){searchResultsInitialized=false;}
if(searchInput){searchInput.addEventListener('blur',resetSearchState);searchInput.addEventListener('search',resetSearchState);}
document.addEventListener('click',(e)=>{const target=e.target.closest('a[href*="#"]');if(!target)return;const href=target.getAttribute('href');if(href&&(href.startsWith('#')||href.includes('/#'))&&!href.includes('#__tabbed_')){handleAnchorNavigation(e,href);}},true);setTimeout(()=>{const hash=window.location.hash;if(hash&&!isContentUnlocked()){showVerificationModal();}},300);window.addEventListener('load',()=>{const REFRESH_FLAG='readmore_page_refreshed';const lastRefreshTime=sessionStorage.getItem(REFRESH_FLAG);const currentTime=new Date().getTime();const contentAlreadyUnlocked=isContentUnlocked();if(contentAlreadyUnlocked){if(lastRefreshTime){sessionStorage.removeItem(REFRESH_FLAG);}
return;}
if(lastRefreshTime&&(currentTime-parseInt(lastRefreshTime))<5000){return;}
const readmoreElements=document.getElementById('readmore-wrapper')||document.getElementById('readmore-model-wrapper')||document.getElementById('readmore-modal-mask');if(!isExclude&&readmoreElements&&!lastRefreshTime){sessionStorage.setItem(REFRESH_FLAG,currentTime.toString());setTimeout(()=>{window.location.reload();},100);}});window.addEventListener('beforeunload',(e)=>{const currentUrl=window.location.href.split('#')[0];const previousUrl=sessionStorage.getItem('previous_page_url');sessionStorage.setItem('previous_page_url',currentUrl);if(previousUrl&&previousUrl!==currentUrl){sessionStorage.removeItem(REFRESH_FLAG);}});window.addEventListener('hashchange',(e)=>{if(!isContentUnlocked()){e.preventDefault();showVerificationModal();}},false);const modalObserver=new MutationObserver(()=>{const modalMask=document.getElementById('readmore-modal-mask');if(modalMask&&window.getComputedStyle(modalMask).display==='none'){setTimeout(()=>{if(!isContentUnlocked()){verificationInProgress=false;}},100);}});modalObserver.observe(document.body,{childList:true,subtree:true,attributes:true,attributeFilter:['style']});});